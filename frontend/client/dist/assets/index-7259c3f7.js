(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();function cg(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Cf={exports:{}},yo={},If={exports:{}},Z={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ci=Symbol.for("react.element"),dg=Symbol.for("react.portal"),fg=Symbol.for("react.fragment"),hg=Symbol.for("react.strict_mode"),mg=Symbol.for("react.profiler"),gg=Symbol.for("react.provider"),pg=Symbol.for("react.context"),yg=Symbol.for("react.forward_ref"),xg=Symbol.for("react.suspense"),vg=Symbol.for("react.memo"),Eg=Symbol.for("react.lazy"),uc=Symbol.iterator;function Sg(n){return n===null||typeof n!="object"?null:(n=uc&&n[uc]||n["@@iterator"],typeof n=="function"?n:null)}var kf={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},bf=Object.assign,Df={};function kr(n,e,t){this.props=n,this.context=e,this.refs=Df,this.updater=t||kf}kr.prototype.isReactComponent={};kr.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};kr.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function _f(){}_f.prototype=kr.prototype;function Hl(n,e,t){this.props=n,this.context=e,this.refs=Df,this.updater=t||kf}var zl=Hl.prototype=new _f;zl.constructor=Hl;bf(zl,kr.prototype);zl.isPureReactComponent=!0;var cc=Array.isArray,Nf=Object.prototype.hasOwnProperty,Wl={current:null},Pf={key:!0,ref:!0,__self:!0,__source:!0};function Ff(n,e,t){var r,i={},s=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)Nf.call(e,r)&&!Pf.hasOwnProperty(r)&&(i[r]=e[r]);var a=arguments.length-2;if(a===1)i.children=t;else if(1<a){for(var l=Array(a),u=0;u<a;u++)l[u]=arguments[u+2];i.children=l}if(n&&n.defaultProps)for(r in a=n.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:Ci,type:n,key:s,ref:o,props:i,_owner:Wl.current}}function Tg(n,e){return{$$typeof:Ci,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function Yl(n){return typeof n=="object"&&n!==null&&n.$$typeof===Ci}function Lg(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var dc=/\/+/g;function Uo(n,e){return typeof n=="object"&&n!==null&&n.key!=null?Lg(""+n.key):e.toString(36)}function fs(n,e,t,r,i){var s=typeof n;(s==="undefined"||s==="boolean")&&(n=null);var o=!1;if(n===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(n.$$typeof){case Ci:case dg:o=!0}}if(o)return o=n,i=i(o),n=r===""?"."+Uo(o,0):r,cc(i)?(t="",n!=null&&(t=n.replace(dc,"$&/")+"/"),fs(i,e,t,"",function(u){return u})):i!=null&&(Yl(i)&&(i=Tg(i,t+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(dc,"$&/")+"/")+n)),e.push(i)),1;if(o=0,r=r===""?".":r+":",cc(n))for(var a=0;a<n.length;a++){s=n[a];var l=r+Uo(s,a);o+=fs(s,e,t,l,i)}else if(l=Sg(n),typeof l=="function")for(n=l.call(n),a=0;!(s=n.next()).done;)s=s.value,l=r+Uo(s,a++),o+=fs(s,e,t,l,i);else if(s==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Fi(n,e,t){if(n==null)return n;var r=[],i=0;return fs(n,r,"","",function(s){return e.call(t,s,i++)}),r}function Rg(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var Ke={current:null},hs={transition:null},Ag={ReactCurrentDispatcher:Ke,ReactCurrentBatchConfig:hs,ReactCurrentOwner:Wl};function Of(){throw Error("act(...) is not supported in production builds of React.")}Z.Children={map:Fi,forEach:function(n,e,t){Fi(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return Fi(n,function(){e++}),e},toArray:function(n){return Fi(n,function(e){return e})||[]},only:function(n){if(!Yl(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};Z.Component=kr;Z.Fragment=fg;Z.Profiler=mg;Z.PureComponent=Hl;Z.StrictMode=hg;Z.Suspense=xg;Z.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ag;Z.act=Of;Z.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var r=bf({},n.props),i=n.key,s=n.ref,o=n._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=Wl.current),e.key!==void 0&&(i=""+e.key),n.type&&n.type.defaultProps)var a=n.type.defaultProps;for(l in e)Nf.call(e,l)&&!Pf.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=t;else if(1<l){a=Array(l);for(var u=0;u<l;u++)a[u]=arguments[u+2];r.children=a}return{$$typeof:Ci,type:n.type,key:i,ref:s,props:r,_owner:o}};Z.createContext=function(n){return n={$$typeof:pg,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:gg,_context:n},n.Consumer=n};Z.createElement=Ff;Z.createFactory=function(n){var e=Ff.bind(null,n);return e.type=n,e};Z.createRef=function(){return{current:null}};Z.forwardRef=function(n){return{$$typeof:yg,render:n}};Z.isValidElement=Yl;Z.lazy=function(n){return{$$typeof:Eg,_payload:{_status:-1,_result:n},_init:Rg}};Z.memo=function(n,e){return{$$typeof:vg,type:n,compare:e===void 0?null:e}};Z.startTransition=function(n){var e=hs.transition;hs.transition={};try{n()}finally{hs.transition=e}};Z.unstable_act=Of;Z.useCallback=function(n,e){return Ke.current.useCallback(n,e)};Z.useContext=function(n){return Ke.current.useContext(n)};Z.useDebugValue=function(){};Z.useDeferredValue=function(n){return Ke.current.useDeferredValue(n)};Z.useEffect=function(n,e){return Ke.current.useEffect(n,e)};Z.useId=function(){return Ke.current.useId()};Z.useImperativeHandle=function(n,e,t){return Ke.current.useImperativeHandle(n,e,t)};Z.useInsertionEffect=function(n,e){return Ke.current.useInsertionEffect(n,e)};Z.useLayoutEffect=function(n,e){return Ke.current.useLayoutEffect(n,e)};Z.useMemo=function(n,e){return Ke.current.useMemo(n,e)};Z.useReducer=function(n,e,t){return Ke.current.useReducer(n,e,t)};Z.useRef=function(n){return Ke.current.useRef(n)};Z.useState=function(n){return Ke.current.useState(n)};Z.useSyncExternalStore=function(n,e,t){return Ke.current.useSyncExternalStore(n,e,t)};Z.useTransition=function(){return Ke.current.useTransition()};Z.version="18.3.1";If.exports=Z;var D=If.exports;const wg=cg(D);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Cg=D,Ig=Symbol.for("react.element"),kg=Symbol.for("react.fragment"),bg=Object.prototype.hasOwnProperty,Dg=Cg.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,_g={key:!0,ref:!0,__self:!0,__source:!0};function Mf(n,e,t){var r,i={},s=null,o=null;t!==void 0&&(s=""+t),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)bg.call(e,r)&&!_g.hasOwnProperty(r)&&(i[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:Ig,type:n,key:s,ref:o,props:i,_owner:Dg.current}}yo.Fragment=kg;yo.jsx=Mf;yo.jsxs=Mf;Cf.exports=yo;var g=Cf.exports,Fa={},Uf={exports:{}},rt={},Bf={exports:{}},$f={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(M,F){var N=M.length;M.push(F);e:for(;0<N;){var $=N-1>>>1,V=M[$];if(0<i(V,F))M[$]=F,M[N]=V,N=$;else break e}}function t(M){return M.length===0?null:M[0]}function r(M){if(M.length===0)return null;var F=M[0],N=M.pop();if(N!==F){M[0]=N;e:for(var $=0,V=M.length,ee=V>>>1;$<ee;){var re=2*($+1)-1,ae=M[re],le=re+1,_e=M[le];if(0>i(ae,N))le<V&&0>i(_e,ae)?(M[$]=_e,M[le]=N,$=le):(M[$]=ae,M[re]=N,$=re);else if(le<V&&0>i(_e,N))M[$]=_e,M[le]=N,$=le;else break e}}return F}function i(M,F){var N=M.sortIndex-F.sortIndex;return N!==0?N:M.id-F.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;n.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var l=[],u=[],c=1,d=null,f=3,h=!1,m=!1,p=!1,x=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function S(M){for(var F=t(u);F!==null;){if(F.callback===null)r(u);else if(F.startTime<=M)r(u),F.sortIndex=F.expirationTime,e(l,F);else break;F=t(u)}}function L(M){if(p=!1,S(M),!m)if(t(l)!==null)m=!0,K(T);else{var F=t(u);F!==null&&J(L,F.startTime-M)}}function T(M,F){m=!1,p&&(p=!1,y(k),k=-1),h=!0;var N=f;try{for(S(F),d=t(l);d!==null&&(!(d.expirationTime>F)||M&&!P());){var $=d.callback;if(typeof $=="function"){d.callback=null,f=d.priorityLevel;var V=$(d.expirationTime<=F);F=n.unstable_now(),typeof V=="function"?d.callback=V:d===t(l)&&r(l),S(F)}else r(l);d=t(l)}if(d!==null)var ee=!0;else{var re=t(u);re!==null&&J(L,re.startTime-F),ee=!1}return ee}finally{d=null,f=N,h=!1}}var A=!1,R=null,k=-1,_=5,C=-1;function P(){return!(n.unstable_now()-C<_)}function H(){if(R!==null){var M=n.unstable_now();C=M;var F=!0;try{F=R(!0,M)}finally{F?B():(A=!1,R=null)}}else A=!1}var B;if(typeof v=="function")B=function(){v(H)};else if(typeof MessageChannel<"u"){var q=new MessageChannel,Y=q.port2;q.port1.onmessage=H,B=function(){Y.postMessage(null)}}else B=function(){x(H,0)};function K(M){R=M,A||(A=!0,B())}function J(M,F){k=x(function(){M(n.unstable_now())},F)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(M){M.callback=null},n.unstable_continueExecution=function(){m||h||(m=!0,K(T))},n.unstable_forceFrameRate=function(M){0>M||125<M?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):_=0<M?Math.floor(1e3/M):5},n.unstable_getCurrentPriorityLevel=function(){return f},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(M){switch(f){case 1:case 2:case 3:var F=3;break;default:F=f}var N=f;f=F;try{return M()}finally{f=N}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(M,F){switch(M){case 1:case 2:case 3:case 4:case 5:break;default:M=3}var N=f;f=M;try{return F()}finally{f=N}},n.unstable_scheduleCallback=function(M,F,N){var $=n.unstable_now();switch(typeof N=="object"&&N!==null?(N=N.delay,N=typeof N=="number"&&0<N?$+N:$):N=$,M){case 1:var V=-1;break;case 2:V=250;break;case 5:V=1073741823;break;case 4:V=1e4;break;default:V=5e3}return V=N+V,M={id:c++,callback:F,priorityLevel:M,startTime:N,expirationTime:V,sortIndex:-1},N>$?(M.sortIndex=N,e(u,M),t(l)===null&&M===t(u)&&(p?(y(k),k=-1):p=!0,J(L,N-$))):(M.sortIndex=V,e(l,M),m||h||(m=!0,K(T))),M},n.unstable_shouldYield=P,n.unstable_wrapCallback=function(M){var F=f;return function(){var N=f;f=F;try{return M.apply(this,arguments)}finally{f=N}}}})($f);Bf.exports=$f;var Ng=Bf.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Pg=D,nt=Ng;function U(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var jf=new Set,si={};function zn(n,e){vr(n,e),vr(n+"Capture",e)}function vr(n,e){for(si[n]=e,n=0;n<e.length;n++)jf.add(e[n])}var Xt=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Oa=Object.prototype.hasOwnProperty,Fg=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,fc={},hc={};function Og(n){return Oa.call(hc,n)?!0:Oa.call(fc,n)?!1:Fg.test(n)?hc[n]=!0:(fc[n]=!0,!1)}function Mg(n,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function Ug(n,e,t,r){if(e===null||typeof e>"u"||Mg(n,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function He(n,e,t,r,i,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var Oe={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){Oe[n]=new He(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];Oe[e]=new He(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){Oe[n]=new He(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){Oe[n]=new He(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){Oe[n]=new He(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){Oe[n]=new He(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){Oe[n]=new He(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){Oe[n]=new He(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){Oe[n]=new He(n,5,!1,n.toLowerCase(),null,!1,!1)});var ql=/[\-:]([a-z])/g;function Xl(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(ql,Xl);Oe[e]=new He(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(ql,Xl);Oe[e]=new He(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(ql,Xl);Oe[e]=new He(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){Oe[n]=new He(n,1,!1,n.toLowerCase(),null,!1,!1)});Oe.xlinkHref=new He("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){Oe[n]=new He(n,1,!1,n.toLowerCase(),null,!0,!0)});function Ql(n,e,t,r){var i=Oe.hasOwnProperty(e)?Oe[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(Ug(e,t,i,r)&&(t=null),r||i===null?Og(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):i.mustUseProperty?n[i.propertyName]=t===null?i.type===3?!1:"":t:(e=i.attributeName,r=i.attributeNamespace,t===null?n.removeAttribute(e):(i=i.type,t=i===3||i===4&&t===!0?"":""+t,r?n.setAttributeNS(r,e,t):n.setAttribute(e,t))))}var en=Pg.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Oi=Symbol.for("react.element"),Zn=Symbol.for("react.portal"),er=Symbol.for("react.fragment"),Jl=Symbol.for("react.strict_mode"),Ma=Symbol.for("react.profiler"),Gf=Symbol.for("react.provider"),Vf=Symbol.for("react.context"),Zl=Symbol.for("react.forward_ref"),Ua=Symbol.for("react.suspense"),Ba=Symbol.for("react.suspense_list"),eu=Symbol.for("react.memo"),sn=Symbol.for("react.lazy"),Kf=Symbol.for("react.offscreen"),mc=Symbol.iterator;function Fr(n){return n===null||typeof n!="object"?null:(n=mc&&n[mc]||n["@@iterator"],typeof n=="function"?n:null)}var xe=Object.assign,Bo;function Hr(n){if(Bo===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);Bo=e&&e[1]||""}return`
`+Bo+n}var $o=!1;function jo(n,e){if(!n||$o)return"";$o=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var r=u}Reflect.construct(n,[],e)}else{try{e.call()}catch(u){r=u}n.call(e.prototype)}else{try{throw Error()}catch(u){r=u}n()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var i=u.stack.split(`
`),s=r.stack.split(`
`),o=i.length-1,a=s.length-1;1<=o&&0<=a&&i[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(i[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||i[o]!==s[a]){var l=`
`+i[o].replace(" at new "," at ");return n.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",n.displayName)),l}while(1<=o&&0<=a);break}}}finally{$o=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?Hr(n):""}function Bg(n){switch(n.tag){case 5:return Hr(n.type);case 16:return Hr("Lazy");case 13:return Hr("Suspense");case 19:return Hr("SuspenseList");case 0:case 2:case 15:return n=jo(n.type,!1),n;case 11:return n=jo(n.type.render,!1),n;case 1:return n=jo(n.type,!0),n;default:return""}}function $a(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case er:return"Fragment";case Zn:return"Portal";case Ma:return"Profiler";case Jl:return"StrictMode";case Ua:return"Suspense";case Ba:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case Vf:return(n.displayName||"Context")+".Consumer";case Gf:return(n._context.displayName||"Context")+".Provider";case Zl:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case eu:return e=n.displayName||null,e!==null?e:$a(n.type)||"Memo";case sn:e=n._payload,n=n._init;try{return $a(n(e))}catch{}}return null}function $g(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return $a(e);case 8:return e===Jl?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function En(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function Hf(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function jg(n){var e=Hf(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),r=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var i=t.get,s=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return i.call(this)},set:function(o){r=""+o,s.call(this,o)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function Mi(n){n._valueTracker||(n._valueTracker=jg(n))}function zf(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return n&&(r=Hf(n)?n.checked?"true":"false":n.value),n=r,n!==t?(e.setValue(n),!0):!1}function Ps(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function ja(n,e){var t=e.checked;return xe({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function gc(n,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=En(e.value!=null?e.value:t),n._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Wf(n,e){e=e.checked,e!=null&&Ql(n,"checked",e,!1)}function Ga(n,e){Wf(n,e);var t=En(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?Va(n,e.type,t):e.hasOwnProperty("defaultValue")&&Va(n,e.type,En(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function pc(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function Va(n,e,t){(e!=="number"||Ps(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var zr=Array.isArray;function fr(n,e,t,r){if(n=n.options,e){e={};for(var i=0;i<t.length;i++)e["$"+t[i]]=!0;for(t=0;t<n.length;t++)i=e.hasOwnProperty("$"+n[t].value),n[t].selected!==i&&(n[t].selected=i),i&&r&&(n[t].defaultSelected=!0)}else{for(t=""+En(t),e=null,i=0;i<n.length;i++){if(n[i].value===t){n[i].selected=!0,r&&(n[i].defaultSelected=!0);return}e!==null||n[i].disabled||(e=n[i])}e!==null&&(e.selected=!0)}}function Ka(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(U(91));return xe({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function yc(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(U(92));if(zr(t)){if(1<t.length)throw Error(U(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:En(t)}}function Yf(n,e){var t=En(e.value),r=En(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),r!=null&&(n.defaultValue=""+r)}function xc(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function qf(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ha(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?qf(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var Ui,Xf=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,r,i){MSApp.execUnsafeLocalFunction(function(){return n(e,t,r,i)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(Ui=Ui||document.createElement("div"),Ui.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Ui.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function oi(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var qr={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Gg=["Webkit","ms","Moz","O"];Object.keys(qr).forEach(function(n){Gg.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),qr[e]=qr[n]})});function Qf(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||qr.hasOwnProperty(n)&&qr[n]?(""+e).trim():e+"px"}function Jf(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,i=Qf(t,e[t],r);t==="float"&&(t="cssFloat"),r?n.setProperty(t,i):n[t]=i}}var Vg=xe({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function za(n,e){if(e){if(Vg[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(U(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(U(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(U(61))}if(e.style!=null&&typeof e.style!="object")throw Error(U(62))}}function Wa(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ya=null;function tu(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var qa=null,hr=null,mr=null;function vc(n){if(n=bi(n)){if(typeof qa!="function")throw Error(U(280));var e=n.stateNode;e&&(e=To(e),qa(n.stateNode,n.type,e))}}function Zf(n){hr?mr?mr.push(n):mr=[n]:hr=n}function eh(){if(hr){var n=hr,e=mr;if(mr=hr=null,vc(n),e)for(n=0;n<e.length;n++)vc(e[n])}}function th(n,e){return n(e)}function nh(){}var Go=!1;function rh(n,e,t){if(Go)return n(e,t);Go=!0;try{return th(n,e,t)}finally{Go=!1,(hr!==null||mr!==null)&&(nh(),eh())}}function ai(n,e){var t=n.stateNode;if(t===null)return null;var r=To(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(U(231,e,typeof t));return t}var Xa=!1;if(Xt)try{var Or={};Object.defineProperty(Or,"passive",{get:function(){Xa=!0}}),window.addEventListener("test",Or,Or),window.removeEventListener("test",Or,Or)}catch{Xa=!1}function Kg(n,e,t,r,i,s,o,a,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(t,u)}catch(c){this.onError(c)}}var Xr=!1,Fs=null,Os=!1,Qa=null,Hg={onError:function(n){Xr=!0,Fs=n}};function zg(n,e,t,r,i,s,o,a,l){Xr=!1,Fs=null,Kg.apply(Hg,arguments)}function Wg(n,e,t,r,i,s,o,a,l){if(zg.apply(this,arguments),Xr){if(Xr){var u=Fs;Xr=!1,Fs=null}else throw Error(U(198));Os||(Os=!0,Qa=u)}}function Wn(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function ih(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function Ec(n){if(Wn(n)!==n)throw Error(U(188))}function Yg(n){var e=n.alternate;if(!e){if(e=Wn(n),e===null)throw Error(U(188));return e!==n?null:n}for(var t=n,r=e;;){var i=t.return;if(i===null)break;var s=i.alternate;if(s===null){if(r=i.return,r!==null){t=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===t)return Ec(i),n;if(s===r)return Ec(i),e;s=s.sibling}throw Error(U(188))}if(t.return!==r.return)t=i,r=s;else{for(var o=!1,a=i.child;a;){if(a===t){o=!0,t=i,r=s;break}if(a===r){o=!0,r=i,t=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===t){o=!0,t=s,r=i;break}if(a===r){o=!0,r=s,t=i;break}a=a.sibling}if(!o)throw Error(U(189))}}if(t.alternate!==r)throw Error(U(190))}if(t.tag!==3)throw Error(U(188));return t.stateNode.current===t?n:e}function sh(n){return n=Yg(n),n!==null?oh(n):null}function oh(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=oh(n);if(e!==null)return e;n=n.sibling}return null}var ah=nt.unstable_scheduleCallback,Sc=nt.unstable_cancelCallback,qg=nt.unstable_shouldYield,Xg=nt.unstable_requestPaint,Ee=nt.unstable_now,Qg=nt.unstable_getCurrentPriorityLevel,nu=nt.unstable_ImmediatePriority,lh=nt.unstable_UserBlockingPriority,Ms=nt.unstable_NormalPriority,Jg=nt.unstable_LowPriority,uh=nt.unstable_IdlePriority,xo=null,_t=null;function Zg(n){if(_t&&typeof _t.onCommitFiberRoot=="function")try{_t.onCommitFiberRoot(xo,n,void 0,(n.current.flags&128)===128)}catch{}}var St=Math.clz32?Math.clz32:np,ep=Math.log,tp=Math.LN2;function np(n){return n>>>=0,n===0?32:31-(ep(n)/tp|0)|0}var Bi=64,$i=4194304;function Wr(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function Us(n,e){var t=n.pendingLanes;if(t===0)return 0;var r=0,i=n.suspendedLanes,s=n.pingedLanes,o=t&268435455;if(o!==0){var a=o&~i;a!==0?r=Wr(a):(s&=o,s!==0&&(r=Wr(s)))}else o=t&~i,o!==0?r=Wr(o):s!==0&&(r=Wr(s));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,s=e&-e,i>=s||i===16&&(s&4194240)!==0))return e;if(r&4&&(r|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=r;0<e;)t=31-St(e),i=1<<t,r|=n[t],e&=~i;return r}function rp(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ip(n,e){for(var t=n.suspendedLanes,r=n.pingedLanes,i=n.expirationTimes,s=n.pendingLanes;0<s;){var o=31-St(s),a=1<<o,l=i[o];l===-1?(!(a&t)||a&r)&&(i[o]=rp(a,e)):l<=e&&(n.expiredLanes|=a),s&=~a}}function Ja(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function ch(){var n=Bi;return Bi<<=1,!(Bi&4194240)&&(Bi=64),n}function Vo(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function Ii(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-St(e),n[e]=t}function sp(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var r=n.eventTimes;for(n=n.expirationTimes;0<t;){var i=31-St(t),s=1<<i;e[i]=0,r[i]=-1,n[i]=-1,t&=~s}}function ru(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var r=31-St(t),i=1<<r;i&e|n[r]&e&&(n[r]|=e),t&=~i}}var oe=0;function dh(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var fh,iu,hh,mh,gh,Za=!1,ji=[],fn=null,hn=null,mn=null,li=new Map,ui=new Map,ln=[],op="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Tc(n,e){switch(n){case"focusin":case"focusout":fn=null;break;case"dragenter":case"dragleave":hn=null;break;case"mouseover":case"mouseout":mn=null;break;case"pointerover":case"pointerout":li.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":ui.delete(e.pointerId)}}function Mr(n,e,t,r,i,s){return n===null||n.nativeEvent!==s?(n={blockedOn:e,domEventName:t,eventSystemFlags:r,nativeEvent:s,targetContainers:[i]},e!==null&&(e=bi(e),e!==null&&iu(e)),n):(n.eventSystemFlags|=r,e=n.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),n)}function ap(n,e,t,r,i){switch(e){case"focusin":return fn=Mr(fn,n,e,t,r,i),!0;case"dragenter":return hn=Mr(hn,n,e,t,r,i),!0;case"mouseover":return mn=Mr(mn,n,e,t,r,i),!0;case"pointerover":var s=i.pointerId;return li.set(s,Mr(li.get(s)||null,n,e,t,r,i)),!0;case"gotpointercapture":return s=i.pointerId,ui.set(s,Mr(ui.get(s)||null,n,e,t,r,i)),!0}return!1}function ph(n){var e=_n(n.target);if(e!==null){var t=Wn(e);if(t!==null){if(e=t.tag,e===13){if(e=ih(t),e!==null){n.blockedOn=e,gh(n.priority,function(){hh(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function ms(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=el(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var r=new t.constructor(t.type,t);Ya=r,t.target.dispatchEvent(r),Ya=null}else return e=bi(t),e!==null&&iu(e),n.blockedOn=t,!1;e.shift()}return!0}function Lc(n,e,t){ms(n)&&t.delete(e)}function lp(){Za=!1,fn!==null&&ms(fn)&&(fn=null),hn!==null&&ms(hn)&&(hn=null),mn!==null&&ms(mn)&&(mn=null),li.forEach(Lc),ui.forEach(Lc)}function Ur(n,e){n.blockedOn===e&&(n.blockedOn=null,Za||(Za=!0,nt.unstable_scheduleCallback(nt.unstable_NormalPriority,lp)))}function ci(n){function e(i){return Ur(i,n)}if(0<ji.length){Ur(ji[0],n);for(var t=1;t<ji.length;t++){var r=ji[t];r.blockedOn===n&&(r.blockedOn=null)}}for(fn!==null&&Ur(fn,n),hn!==null&&Ur(hn,n),mn!==null&&Ur(mn,n),li.forEach(e),ui.forEach(e),t=0;t<ln.length;t++)r=ln[t],r.blockedOn===n&&(r.blockedOn=null);for(;0<ln.length&&(t=ln[0],t.blockedOn===null);)ph(t),t.blockedOn===null&&ln.shift()}var gr=en.ReactCurrentBatchConfig,Bs=!0;function up(n,e,t,r){var i=oe,s=gr.transition;gr.transition=null;try{oe=1,su(n,e,t,r)}finally{oe=i,gr.transition=s}}function cp(n,e,t,r){var i=oe,s=gr.transition;gr.transition=null;try{oe=4,su(n,e,t,r)}finally{oe=i,gr.transition=s}}function su(n,e,t,r){if(Bs){var i=el(n,e,t,r);if(i===null)Zo(n,e,r,$s,t),Tc(n,r);else if(ap(i,n,e,t,r))r.stopPropagation();else if(Tc(n,r),e&4&&-1<op.indexOf(n)){for(;i!==null;){var s=bi(i);if(s!==null&&fh(s),s=el(n,e,t,r),s===null&&Zo(n,e,r,$s,t),s===i)break;i=s}i!==null&&r.stopPropagation()}else Zo(n,e,r,null,t)}}var $s=null;function el(n,e,t,r){if($s=null,n=tu(r),n=_n(n),n!==null)if(e=Wn(n),e===null)n=null;else if(t=e.tag,t===13){if(n=ih(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return $s=n,null}function yh(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Qg()){case nu:return 1;case lh:return 4;case Ms:case Jg:return 16;case uh:return 536870912;default:return 16}default:return 16}}var cn=null,ou=null,gs=null;function xh(){if(gs)return gs;var n,e=ou,t=e.length,r,i="value"in cn?cn.value:cn.textContent,s=i.length;for(n=0;n<t&&e[n]===i[n];n++);var o=t-n;for(r=1;r<=o&&e[t-r]===i[s-r];r++);return gs=i.slice(n,1<r?1-r:void 0)}function ps(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function Gi(){return!0}function Rc(){return!1}function it(n){function e(t,r,i,s,o){this._reactName=t,this._targetInst=i,this.type=r,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in n)n.hasOwnProperty(a)&&(t=n[a],this[a]=t?t(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?Gi:Rc,this.isPropagationStopped=Rc,this}return xe(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=Gi)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=Gi)},persist:function(){},isPersistent:Gi}),e}var br={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},au=it(br),ki=xe({},br,{view:0,detail:0}),dp=it(ki),Ko,Ho,Br,vo=xe({},ki,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:lu,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Br&&(Br&&n.type==="mousemove"?(Ko=n.screenX-Br.screenX,Ho=n.screenY-Br.screenY):Ho=Ko=0,Br=n),Ko)},movementY:function(n){return"movementY"in n?n.movementY:Ho}}),Ac=it(vo),fp=xe({},vo,{dataTransfer:0}),hp=it(fp),mp=xe({},ki,{relatedTarget:0}),zo=it(mp),gp=xe({},br,{animationName:0,elapsedTime:0,pseudoElement:0}),pp=it(gp),yp=xe({},br,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),xp=it(yp),vp=xe({},br,{data:0}),wc=it(vp),Ep={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Sp={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Tp={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Lp(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=Tp[n])?!!e[n]:!1}function lu(){return Lp}var Rp=xe({},ki,{key:function(n){if(n.key){var e=Ep[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=ps(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?Sp[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:lu,charCode:function(n){return n.type==="keypress"?ps(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?ps(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),Ap=it(Rp),wp=xe({},vo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Cc=it(wp),Cp=xe({},ki,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:lu}),Ip=it(Cp),kp=xe({},br,{propertyName:0,elapsedTime:0,pseudoElement:0}),bp=it(kp),Dp=xe({},vo,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),_p=it(Dp),Np=[9,13,27,32],uu=Xt&&"CompositionEvent"in window,Qr=null;Xt&&"documentMode"in document&&(Qr=document.documentMode);var Pp=Xt&&"TextEvent"in window&&!Qr,vh=Xt&&(!uu||Qr&&8<Qr&&11>=Qr),Ic=String.fromCharCode(32),kc=!1;function Eh(n,e){switch(n){case"keyup":return Np.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Sh(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var tr=!1;function Fp(n,e){switch(n){case"compositionend":return Sh(e);case"keypress":return e.which!==32?null:(kc=!0,Ic);case"textInput":return n=e.data,n===Ic&&kc?null:n;default:return null}}function Op(n,e){if(tr)return n==="compositionend"||!uu&&Eh(n,e)?(n=xh(),gs=ou=cn=null,tr=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return vh&&e.locale!=="ko"?null:e.data;default:return null}}var Mp={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function bc(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!Mp[n.type]:e==="textarea"}function Th(n,e,t,r){Zf(r),e=js(e,"onChange"),0<e.length&&(t=new au("onChange","change",null,t,r),n.push({event:t,listeners:e}))}var Jr=null,di=null;function Up(n){Nh(n,0)}function Eo(n){var e=ir(n);if(zf(e))return n}function Bp(n,e){if(n==="change")return e}var Lh=!1;if(Xt){var Wo;if(Xt){var Yo="oninput"in document;if(!Yo){var Dc=document.createElement("div");Dc.setAttribute("oninput","return;"),Yo=typeof Dc.oninput=="function"}Wo=Yo}else Wo=!1;Lh=Wo&&(!document.documentMode||9<document.documentMode)}function _c(){Jr&&(Jr.detachEvent("onpropertychange",Rh),di=Jr=null)}function Rh(n){if(n.propertyName==="value"&&Eo(di)){var e=[];Th(e,di,n,tu(n)),rh(Up,e)}}function $p(n,e,t){n==="focusin"?(_c(),Jr=e,di=t,Jr.attachEvent("onpropertychange",Rh)):n==="focusout"&&_c()}function jp(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Eo(di)}function Gp(n,e){if(n==="click")return Eo(e)}function Vp(n,e){if(n==="input"||n==="change")return Eo(e)}function Kp(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var Lt=typeof Object.is=="function"?Object.is:Kp;function fi(n,e){if(Lt(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var i=t[r];if(!Oa.call(e,i)||!Lt(n[i],e[i]))return!1}return!0}function Nc(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function Pc(n,e){var t=Nc(n);n=0;for(var r;t;){if(t.nodeType===3){if(r=n+t.textContent.length,n<=e&&r>=e)return{node:t,offset:e-n};n=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=Nc(t)}}function Ah(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?Ah(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function wh(){for(var n=window,e=Ps();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=Ps(n.document)}return e}function cu(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function Hp(n){var e=wh(),t=n.focusedElem,r=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&Ah(t.ownerDocument.documentElement,t)){if(r!==null&&cu(t)){if(e=r.start,n=r.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var i=t.textContent.length,s=Math.min(r.start,i);r=r.end===void 0?s:Math.min(r.end,i),!n.extend&&s>r&&(i=r,r=s,s=i),i=Pc(t,s);var o=Pc(t,r);i&&o&&(n.rangeCount!==1||n.anchorNode!==i.node||n.anchorOffset!==i.offset||n.focusNode!==o.node||n.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),n.removeAllRanges(),s>r?(n.addRange(e),n.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var zp=Xt&&"documentMode"in document&&11>=document.documentMode,nr=null,tl=null,Zr=null,nl=!1;function Fc(n,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;nl||nr==null||nr!==Ps(r)||(r=nr,"selectionStart"in r&&cu(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Zr&&fi(Zr,r)||(Zr=r,r=js(tl,"onSelect"),0<r.length&&(e=new au("onSelect","select",null,e,t),n.push({event:e,listeners:r}),e.target=nr)))}function Vi(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var rr={animationend:Vi("Animation","AnimationEnd"),animationiteration:Vi("Animation","AnimationIteration"),animationstart:Vi("Animation","AnimationStart"),transitionend:Vi("Transition","TransitionEnd")},qo={},Ch={};Xt&&(Ch=document.createElement("div").style,"AnimationEvent"in window||(delete rr.animationend.animation,delete rr.animationiteration.animation,delete rr.animationstart.animation),"TransitionEvent"in window||delete rr.transitionend.transition);function So(n){if(qo[n])return qo[n];if(!rr[n])return n;var e=rr[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in Ch)return qo[n]=e[t];return n}var Ih=So("animationend"),kh=So("animationiteration"),bh=So("animationstart"),Dh=So("transitionend"),_h=new Map,Oc="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ln(n,e){_h.set(n,e),zn(e,[n])}for(var Xo=0;Xo<Oc.length;Xo++){var Qo=Oc[Xo],Wp=Qo.toLowerCase(),Yp=Qo[0].toUpperCase()+Qo.slice(1);Ln(Wp,"on"+Yp)}Ln(Ih,"onAnimationEnd");Ln(kh,"onAnimationIteration");Ln(bh,"onAnimationStart");Ln("dblclick","onDoubleClick");Ln("focusin","onFocus");Ln("focusout","onBlur");Ln(Dh,"onTransitionEnd");vr("onMouseEnter",["mouseout","mouseover"]);vr("onMouseLeave",["mouseout","mouseover"]);vr("onPointerEnter",["pointerout","pointerover"]);vr("onPointerLeave",["pointerout","pointerover"]);zn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));zn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));zn("onBeforeInput",["compositionend","keypress","textInput","paste"]);zn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));zn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));zn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Yr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),qp=new Set("cancel close invalid load scroll toggle".split(" ").concat(Yr));function Mc(n,e,t){var r=n.type||"unknown-event";n.currentTarget=t,Wg(r,e,void 0,n),n.currentTarget=null}function Nh(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var r=n[t],i=r.event;r=r.listeners;e:{var s=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],l=a.instance,u=a.currentTarget;if(a=a.listener,l!==s&&i.isPropagationStopped())break e;Mc(i,a,u),s=l}else for(o=0;o<r.length;o++){if(a=r[o],l=a.instance,u=a.currentTarget,a=a.listener,l!==s&&i.isPropagationStopped())break e;Mc(i,a,u),s=l}}}if(Os)throw n=Qa,Os=!1,Qa=null,n}function de(n,e){var t=e[al];t===void 0&&(t=e[al]=new Set);var r=n+"__bubble";t.has(r)||(Ph(e,n,2,!1),t.add(r))}function Jo(n,e,t){var r=0;e&&(r|=4),Ph(t,n,r,e)}var Ki="_reactListening"+Math.random().toString(36).slice(2);function hi(n){if(!n[Ki]){n[Ki]=!0,jf.forEach(function(t){t!=="selectionchange"&&(qp.has(t)||Jo(t,!1,n),Jo(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[Ki]||(e[Ki]=!0,Jo("selectionchange",!1,e))}}function Ph(n,e,t,r){switch(yh(e)){case 1:var i=up;break;case 4:i=cp;break;default:i=su}t=i.bind(null,e,t,n),i=void 0,!Xa||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?n.addEventListener(e,t,{capture:!0,passive:i}):n.addEventListener(e,t,!0):i!==void 0?n.addEventListener(e,t,{passive:i}):n.addEventListener(e,t,!1)}function Zo(n,e,t,r,i){var s=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===i||a.nodeType===8&&a.parentNode===i)break;if(o===4)for(o=r.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===i||l.nodeType===8&&l.parentNode===i))return;o=o.return}for(;a!==null;){if(o=_n(a),o===null)return;if(l=o.tag,l===5||l===6){r=s=o;continue e}a=a.parentNode}}r=r.return}rh(function(){var u=s,c=tu(t),d=[];e:{var f=_h.get(n);if(f!==void 0){var h=au,m=n;switch(n){case"keypress":if(ps(t)===0)break e;case"keydown":case"keyup":h=Ap;break;case"focusin":m="focus",h=zo;break;case"focusout":m="blur",h=zo;break;case"beforeblur":case"afterblur":h=zo;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":h=Ac;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":h=hp;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":h=Ip;break;case Ih:case kh:case bh:h=pp;break;case Dh:h=bp;break;case"scroll":h=dp;break;case"wheel":h=_p;break;case"copy":case"cut":case"paste":h=xp;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":h=Cc}var p=(e&4)!==0,x=!p&&n==="scroll",y=p?f!==null?f+"Capture":null:f;p=[];for(var v=u,S;v!==null;){S=v;var L=S.stateNode;if(S.tag===5&&L!==null&&(S=L,y!==null&&(L=ai(v,y),L!=null&&p.push(mi(v,L,S)))),x)break;v=v.return}0<p.length&&(f=new h(f,m,null,t,c),d.push({event:f,listeners:p}))}}if(!(e&7)){e:{if(f=n==="mouseover"||n==="pointerover",h=n==="mouseout"||n==="pointerout",f&&t!==Ya&&(m=t.relatedTarget||t.fromElement)&&(_n(m)||m[Qt]))break e;if((h||f)&&(f=c.window===c?c:(f=c.ownerDocument)?f.defaultView||f.parentWindow:window,h?(m=t.relatedTarget||t.toElement,h=u,m=m?_n(m):null,m!==null&&(x=Wn(m),m!==x||m.tag!==5&&m.tag!==6)&&(m=null)):(h=null,m=u),h!==m)){if(p=Ac,L="onMouseLeave",y="onMouseEnter",v="mouse",(n==="pointerout"||n==="pointerover")&&(p=Cc,L="onPointerLeave",y="onPointerEnter",v="pointer"),x=h==null?f:ir(h),S=m==null?f:ir(m),f=new p(L,v+"leave",h,t,c),f.target=x,f.relatedTarget=S,L=null,_n(c)===u&&(p=new p(y,v+"enter",m,t,c),p.target=S,p.relatedTarget=x,L=p),x=L,h&&m)t:{for(p=h,y=m,v=0,S=p;S;S=Yn(S))v++;for(S=0,L=y;L;L=Yn(L))S++;for(;0<v-S;)p=Yn(p),v--;for(;0<S-v;)y=Yn(y),S--;for(;v--;){if(p===y||y!==null&&p===y.alternate)break t;p=Yn(p),y=Yn(y)}p=null}else p=null;h!==null&&Uc(d,f,h,p,!1),m!==null&&x!==null&&Uc(d,x,m,p,!0)}}e:{if(f=u?ir(u):window,h=f.nodeName&&f.nodeName.toLowerCase(),h==="select"||h==="input"&&f.type==="file")var T=Bp;else if(bc(f))if(Lh)T=Vp;else{T=jp;var A=$p}else(h=f.nodeName)&&h.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(T=Gp);if(T&&(T=T(n,u))){Th(d,T,t,c);break e}A&&A(n,f,u),n==="focusout"&&(A=f._wrapperState)&&A.controlled&&f.type==="number"&&Va(f,"number",f.value)}switch(A=u?ir(u):window,n){case"focusin":(bc(A)||A.contentEditable==="true")&&(nr=A,tl=u,Zr=null);break;case"focusout":Zr=tl=nr=null;break;case"mousedown":nl=!0;break;case"contextmenu":case"mouseup":case"dragend":nl=!1,Fc(d,t,c);break;case"selectionchange":if(zp)break;case"keydown":case"keyup":Fc(d,t,c)}var R;if(uu)e:{switch(n){case"compositionstart":var k="onCompositionStart";break e;case"compositionend":k="onCompositionEnd";break e;case"compositionupdate":k="onCompositionUpdate";break e}k=void 0}else tr?Eh(n,t)&&(k="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(k="onCompositionStart");k&&(vh&&t.locale!=="ko"&&(tr||k!=="onCompositionStart"?k==="onCompositionEnd"&&tr&&(R=xh()):(cn=c,ou="value"in cn?cn.value:cn.textContent,tr=!0)),A=js(u,k),0<A.length&&(k=new wc(k,n,null,t,c),d.push({event:k,listeners:A}),R?k.data=R:(R=Sh(t),R!==null&&(k.data=R)))),(R=Pp?Fp(n,t):Op(n,t))&&(u=js(u,"onBeforeInput"),0<u.length&&(c=new wc("onBeforeInput","beforeinput",null,t,c),d.push({event:c,listeners:u}),c.data=R))}Nh(d,e)})}function mi(n,e,t){return{instance:n,listener:e,currentTarget:t}}function js(n,e){for(var t=e+"Capture",r=[];n!==null;){var i=n,s=i.stateNode;i.tag===5&&s!==null&&(i=s,s=ai(n,t),s!=null&&r.unshift(mi(n,s,i)),s=ai(n,e),s!=null&&r.push(mi(n,s,i))),n=n.return}return r}function Yn(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function Uc(n,e,t,r,i){for(var s=e._reactName,o=[];t!==null&&t!==r;){var a=t,l=a.alternate,u=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&u!==null&&(a=u,i?(l=ai(t,s),l!=null&&o.unshift(mi(t,l,a))):i||(l=ai(t,s),l!=null&&o.push(mi(t,l,a)))),t=t.return}o.length!==0&&n.push({event:e,listeners:o})}var Xp=/\r\n?/g,Qp=/\u0000|\uFFFD/g;function Bc(n){return(typeof n=="string"?n:""+n).replace(Xp,`
`).replace(Qp,"")}function Hi(n,e,t){if(e=Bc(e),Bc(n)!==e&&t)throw Error(U(425))}function Gs(){}var rl=null,il=null;function sl(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var ol=typeof setTimeout=="function"?setTimeout:void 0,Jp=typeof clearTimeout=="function"?clearTimeout:void 0,$c=typeof Promise=="function"?Promise:void 0,Zp=typeof queueMicrotask=="function"?queueMicrotask:typeof $c<"u"?function(n){return $c.resolve(null).then(n).catch(ey)}:ol;function ey(n){setTimeout(function(){throw n})}function ea(n,e){var t=e,r=0;do{var i=t.nextSibling;if(n.removeChild(t),i&&i.nodeType===8)if(t=i.data,t==="/$"){if(r===0){n.removeChild(i),ci(e);return}r--}else t!=="$"&&t!=="$?"&&t!=="$!"||r++;t=i}while(t);ci(e)}function gn(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function jc(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var Dr=Math.random().toString(36).slice(2),kt="__reactFiber$"+Dr,gi="__reactProps$"+Dr,Qt="__reactContainer$"+Dr,al="__reactEvents$"+Dr,ty="__reactListeners$"+Dr,ny="__reactHandles$"+Dr;function _n(n){var e=n[kt];if(e)return e;for(var t=n.parentNode;t;){if(e=t[Qt]||t[kt]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=jc(n);n!==null;){if(t=n[kt])return t;n=jc(n)}return e}n=t,t=n.parentNode}return null}function bi(n){return n=n[kt]||n[Qt],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function ir(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(U(33))}function To(n){return n[gi]||null}var ll=[],sr=-1;function Rn(n){return{current:n}}function fe(n){0>sr||(n.current=ll[sr],ll[sr]=null,sr--)}function ce(n,e){sr++,ll[sr]=n.current,n.current=e}var Sn={},je=Rn(Sn),Xe=Rn(!1),$n=Sn;function Er(n,e){var t=n.type.contextTypes;if(!t)return Sn;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},s;for(s in t)i[s]=e[s];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=i),i}function Qe(n){return n=n.childContextTypes,n!=null}function Vs(){fe(Xe),fe(je)}function Gc(n,e,t){if(je.current!==Sn)throw Error(U(168));ce(je,e),ce(Xe,t)}function Fh(n,e,t){var r=n.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(U(108,$g(n)||"Unknown",i));return xe({},t,r)}function Ks(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||Sn,$n=je.current,ce(je,n),ce(Xe,Xe.current),!0}function Vc(n,e,t){var r=n.stateNode;if(!r)throw Error(U(169));t?(n=Fh(n,e,$n),r.__reactInternalMemoizedMergedChildContext=n,fe(Xe),fe(je),ce(je,n)):fe(Xe),ce(Xe,t)}var Kt=null,Lo=!1,ta=!1;function Oh(n){Kt===null?Kt=[n]:Kt.push(n)}function ry(n){Lo=!0,Oh(n)}function An(){if(!ta&&Kt!==null){ta=!0;var n=0,e=oe;try{var t=Kt;for(oe=1;n<t.length;n++){var r=t[n];do r=r(!0);while(r!==null)}Kt=null,Lo=!1}catch(i){throw Kt!==null&&(Kt=Kt.slice(n+1)),ah(nu,An),i}finally{oe=e,ta=!1}}return null}var or=[],ar=0,Hs=null,zs=0,at=[],lt=0,jn=null,Ht=1,zt="";function Cn(n,e){or[ar++]=zs,or[ar++]=Hs,Hs=n,zs=e}function Mh(n,e,t){at[lt++]=Ht,at[lt++]=zt,at[lt++]=jn,jn=n;var r=Ht;n=zt;var i=32-St(r)-1;r&=~(1<<i),t+=1;var s=32-St(e)+i;if(30<s){var o=i-i%5;s=(r&(1<<o)-1).toString(32),r>>=o,i-=o,Ht=1<<32-St(e)+i|t<<i|r,zt=s+n}else Ht=1<<s|t<<i|r,zt=n}function du(n){n.return!==null&&(Cn(n,1),Mh(n,1,0))}function fu(n){for(;n===Hs;)Hs=or[--ar],or[ar]=null,zs=or[--ar],or[ar]=null;for(;n===jn;)jn=at[--lt],at[lt]=null,zt=at[--lt],at[lt]=null,Ht=at[--lt],at[lt]=null}var tt=null,et=null,he=!1,vt=null;function Uh(n,e){var t=ut(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function Kc(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,tt=n,et=gn(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,tt=n,et=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=jn!==null?{id:Ht,overflow:zt}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=ut(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,tt=n,et=null,!0):!1;default:return!1}}function ul(n){return(n.mode&1)!==0&&(n.flags&128)===0}function cl(n){if(he){var e=et;if(e){var t=e;if(!Kc(n,e)){if(ul(n))throw Error(U(418));e=gn(t.nextSibling);var r=tt;e&&Kc(n,e)?Uh(r,t):(n.flags=n.flags&-4097|2,he=!1,tt=n)}}else{if(ul(n))throw Error(U(418));n.flags=n.flags&-4097|2,he=!1,tt=n}}}function Hc(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;tt=n}function zi(n){if(n!==tt)return!1;if(!he)return Hc(n),he=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!sl(n.type,n.memoizedProps)),e&&(e=et)){if(ul(n))throw Bh(),Error(U(418));for(;e;)Uh(n,e),e=gn(e.nextSibling)}if(Hc(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(U(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){et=gn(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}et=null}}else et=tt?gn(n.stateNode.nextSibling):null;return!0}function Bh(){for(var n=et;n;)n=gn(n.nextSibling)}function Sr(){et=tt=null,he=!1}function hu(n){vt===null?vt=[n]:vt.push(n)}var iy=en.ReactCurrentBatchConfig;function $r(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(U(309));var r=t.stateNode}if(!r)throw Error(U(147,n));var i=r,s=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=i.refs;o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof n!="string")throw Error(U(284));if(!t._owner)throw Error(U(290,n))}return n}function Wi(n,e){throw n=Object.prototype.toString.call(e),Error(U(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function zc(n){var e=n._init;return e(n._payload)}function $h(n){function e(y,v){if(n){var S=y.deletions;S===null?(y.deletions=[v],y.flags|=16):S.push(v)}}function t(y,v){if(!n)return null;for(;v!==null;)e(y,v),v=v.sibling;return null}function r(y,v){for(y=new Map;v!==null;)v.key!==null?y.set(v.key,v):y.set(v.index,v),v=v.sibling;return y}function i(y,v){return y=vn(y,v),y.index=0,y.sibling=null,y}function s(y,v,S){return y.index=S,n?(S=y.alternate,S!==null?(S=S.index,S<v?(y.flags|=2,v):S):(y.flags|=2,v)):(y.flags|=1048576,v)}function o(y){return n&&y.alternate===null&&(y.flags|=2),y}function a(y,v,S,L){return v===null||v.tag!==6?(v=la(S,y.mode,L),v.return=y,v):(v=i(v,S),v.return=y,v)}function l(y,v,S,L){var T=S.type;return T===er?c(y,v,S.props.children,L,S.key):v!==null&&(v.elementType===T||typeof T=="object"&&T!==null&&T.$$typeof===sn&&zc(T)===v.type)?(L=i(v,S.props),L.ref=$r(y,v,S),L.return=y,L):(L=Ls(S.type,S.key,S.props,null,y.mode,L),L.ref=$r(y,v,S),L.return=y,L)}function u(y,v,S,L){return v===null||v.tag!==4||v.stateNode.containerInfo!==S.containerInfo||v.stateNode.implementation!==S.implementation?(v=ua(S,y.mode,L),v.return=y,v):(v=i(v,S.children||[]),v.return=y,v)}function c(y,v,S,L,T){return v===null||v.tag!==7?(v=Mn(S,y.mode,L,T),v.return=y,v):(v=i(v,S),v.return=y,v)}function d(y,v,S){if(typeof v=="string"&&v!==""||typeof v=="number")return v=la(""+v,y.mode,S),v.return=y,v;if(typeof v=="object"&&v!==null){switch(v.$$typeof){case Oi:return S=Ls(v.type,v.key,v.props,null,y.mode,S),S.ref=$r(y,null,v),S.return=y,S;case Zn:return v=ua(v,y.mode,S),v.return=y,v;case sn:var L=v._init;return d(y,L(v._payload),S)}if(zr(v)||Fr(v))return v=Mn(v,y.mode,S,null),v.return=y,v;Wi(y,v)}return null}function f(y,v,S,L){var T=v!==null?v.key:null;if(typeof S=="string"&&S!==""||typeof S=="number")return T!==null?null:a(y,v,""+S,L);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case Oi:return S.key===T?l(y,v,S,L):null;case Zn:return S.key===T?u(y,v,S,L):null;case sn:return T=S._init,f(y,v,T(S._payload),L)}if(zr(S)||Fr(S))return T!==null?null:c(y,v,S,L,null);Wi(y,S)}return null}function h(y,v,S,L,T){if(typeof L=="string"&&L!==""||typeof L=="number")return y=y.get(S)||null,a(v,y,""+L,T);if(typeof L=="object"&&L!==null){switch(L.$$typeof){case Oi:return y=y.get(L.key===null?S:L.key)||null,l(v,y,L,T);case Zn:return y=y.get(L.key===null?S:L.key)||null,u(v,y,L,T);case sn:var A=L._init;return h(y,v,S,A(L._payload),T)}if(zr(L)||Fr(L))return y=y.get(S)||null,c(v,y,L,T,null);Wi(v,L)}return null}function m(y,v,S,L){for(var T=null,A=null,R=v,k=v=0,_=null;R!==null&&k<S.length;k++){R.index>k?(_=R,R=null):_=R.sibling;var C=f(y,R,S[k],L);if(C===null){R===null&&(R=_);break}n&&R&&C.alternate===null&&e(y,R),v=s(C,v,k),A===null?T=C:A.sibling=C,A=C,R=_}if(k===S.length)return t(y,R),he&&Cn(y,k),T;if(R===null){for(;k<S.length;k++)R=d(y,S[k],L),R!==null&&(v=s(R,v,k),A===null?T=R:A.sibling=R,A=R);return he&&Cn(y,k),T}for(R=r(y,R);k<S.length;k++)_=h(R,y,k,S[k],L),_!==null&&(n&&_.alternate!==null&&R.delete(_.key===null?k:_.key),v=s(_,v,k),A===null?T=_:A.sibling=_,A=_);return n&&R.forEach(function(P){return e(y,P)}),he&&Cn(y,k),T}function p(y,v,S,L){var T=Fr(S);if(typeof T!="function")throw Error(U(150));if(S=T.call(S),S==null)throw Error(U(151));for(var A=T=null,R=v,k=v=0,_=null,C=S.next();R!==null&&!C.done;k++,C=S.next()){R.index>k?(_=R,R=null):_=R.sibling;var P=f(y,R,C.value,L);if(P===null){R===null&&(R=_);break}n&&R&&P.alternate===null&&e(y,R),v=s(P,v,k),A===null?T=P:A.sibling=P,A=P,R=_}if(C.done)return t(y,R),he&&Cn(y,k),T;if(R===null){for(;!C.done;k++,C=S.next())C=d(y,C.value,L),C!==null&&(v=s(C,v,k),A===null?T=C:A.sibling=C,A=C);return he&&Cn(y,k),T}for(R=r(y,R);!C.done;k++,C=S.next())C=h(R,y,k,C.value,L),C!==null&&(n&&C.alternate!==null&&R.delete(C.key===null?k:C.key),v=s(C,v,k),A===null?T=C:A.sibling=C,A=C);return n&&R.forEach(function(H){return e(y,H)}),he&&Cn(y,k),T}function x(y,v,S,L){if(typeof S=="object"&&S!==null&&S.type===er&&S.key===null&&(S=S.props.children),typeof S=="object"&&S!==null){switch(S.$$typeof){case Oi:e:{for(var T=S.key,A=v;A!==null;){if(A.key===T){if(T=S.type,T===er){if(A.tag===7){t(y,A.sibling),v=i(A,S.props.children),v.return=y,y=v;break e}}else if(A.elementType===T||typeof T=="object"&&T!==null&&T.$$typeof===sn&&zc(T)===A.type){t(y,A.sibling),v=i(A,S.props),v.ref=$r(y,A,S),v.return=y,y=v;break e}t(y,A);break}else e(y,A);A=A.sibling}S.type===er?(v=Mn(S.props.children,y.mode,L,S.key),v.return=y,y=v):(L=Ls(S.type,S.key,S.props,null,y.mode,L),L.ref=$r(y,v,S),L.return=y,y=L)}return o(y);case Zn:e:{for(A=S.key;v!==null;){if(v.key===A)if(v.tag===4&&v.stateNode.containerInfo===S.containerInfo&&v.stateNode.implementation===S.implementation){t(y,v.sibling),v=i(v,S.children||[]),v.return=y,y=v;break e}else{t(y,v);break}else e(y,v);v=v.sibling}v=ua(S,y.mode,L),v.return=y,y=v}return o(y);case sn:return A=S._init,x(y,v,A(S._payload),L)}if(zr(S))return m(y,v,S,L);if(Fr(S))return p(y,v,S,L);Wi(y,S)}return typeof S=="string"&&S!==""||typeof S=="number"?(S=""+S,v!==null&&v.tag===6?(t(y,v.sibling),v=i(v,S),v.return=y,y=v):(t(y,v),v=la(S,y.mode,L),v.return=y,y=v),o(y)):t(y,v)}return x}var Tr=$h(!0),jh=$h(!1),Ws=Rn(null),Ys=null,lr=null,mu=null;function gu(){mu=lr=Ys=null}function pu(n){var e=Ws.current;fe(Ws),n._currentValue=e}function dl(n,e,t){for(;n!==null;){var r=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),n===t)break;n=n.return}}function pr(n,e){Ys=n,mu=lr=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(qe=!0),n.firstContext=null)}function dt(n){var e=n._currentValue;if(mu!==n)if(n={context:n,memoizedValue:e,next:null},lr===null){if(Ys===null)throw Error(U(308));lr=n,Ys.dependencies={lanes:0,firstContext:n}}else lr=lr.next=n;return e}var Nn=null;function yu(n){Nn===null?Nn=[n]:Nn.push(n)}function Gh(n,e,t,r){var i=e.interleaved;return i===null?(t.next=t,yu(e)):(t.next=i.next,i.next=t),e.interleaved=t,Jt(n,r)}function Jt(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var on=!1;function xu(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Vh(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function Yt(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function pn(n,e,t){var r=n.updateQueue;if(r===null)return null;if(r=r.shared,ne&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,Jt(n,t)}return i=r.interleaved,i===null?(e.next=e,yu(r)):(e.next=i.next,i.next=e),r.interleaved=e,Jt(n,t)}function ys(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,ru(n,t)}}function Wc(n,e){var t=n.updateQueue,r=n.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var i=null,s=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};s===null?i=s=o:s=s.next=o,t=t.next}while(t!==null);s===null?i=s=e:s=s.next=e}else i=s=e;t={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:r.shared,effects:r.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function qs(n,e,t,r){var i=n.updateQueue;on=!1;var s=i.firstBaseUpdate,o=i.lastBaseUpdate,a=i.shared.pending;if(a!==null){i.shared.pending=null;var l=a,u=l.next;l.next=null,o===null?s=u:o.next=u,o=l;var c=n.alternate;c!==null&&(c=c.updateQueue,a=c.lastBaseUpdate,a!==o&&(a===null?c.firstBaseUpdate=u:a.next=u,c.lastBaseUpdate=l))}if(s!==null){var d=i.baseState;o=0,c=u=l=null,a=s;do{var f=a.lane,h=a.eventTime;if((r&f)===f){c!==null&&(c=c.next={eventTime:h,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var m=n,p=a;switch(f=e,h=t,p.tag){case 1:if(m=p.payload,typeof m=="function"){d=m.call(h,d,f);break e}d=m;break e;case 3:m.flags=m.flags&-65537|128;case 0:if(m=p.payload,f=typeof m=="function"?m.call(h,d,f):m,f==null)break e;d=xe({},d,f);break e;case 2:on=!0}}a.callback!==null&&a.lane!==0&&(n.flags|=64,f=i.effects,f===null?i.effects=[a]:f.push(a))}else h={eventTime:h,lane:f,tag:a.tag,payload:a.payload,callback:a.callback,next:null},c===null?(u=c=h,l=d):c=c.next=h,o|=f;if(a=a.next,a===null){if(a=i.shared.pending,a===null)break;f=a,a=f.next,f.next=null,i.lastBaseUpdate=f,i.shared.pending=null}}while(1);if(c===null&&(l=d),i.baseState=l,i.firstBaseUpdate=u,i.lastBaseUpdate=c,e=i.shared.interleaved,e!==null){i=e;do o|=i.lane,i=i.next;while(i!==e)}else s===null&&(i.shared.lanes=0);Vn|=o,n.lanes=o,n.memoizedState=d}}function Yc(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var r=n[e],i=r.callback;if(i!==null){if(r.callback=null,r=t,typeof i!="function")throw Error(U(191,i));i.call(r)}}}var Di={},Nt=Rn(Di),pi=Rn(Di),yi=Rn(Di);function Pn(n){if(n===Di)throw Error(U(174));return n}function vu(n,e){switch(ce(yi,e),ce(pi,n),ce(Nt,Di),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Ha(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=Ha(e,n)}fe(Nt),ce(Nt,e)}function Lr(){fe(Nt),fe(pi),fe(yi)}function Kh(n){Pn(yi.current);var e=Pn(Nt.current),t=Ha(e,n.type);e!==t&&(ce(pi,n),ce(Nt,t))}function Eu(n){pi.current===n&&(fe(Nt),fe(pi))}var ge=Rn(0);function Xs(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var na=[];function Su(){for(var n=0;n<na.length;n++)na[n]._workInProgressVersionPrimary=null;na.length=0}var xs=en.ReactCurrentDispatcher,ra=en.ReactCurrentBatchConfig,Gn=0,pe=null,Re=null,Ce=null,Qs=!1,ei=!1,xi=0,sy=0;function Me(){throw Error(U(321))}function Tu(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!Lt(n[t],e[t]))return!1;return!0}function Lu(n,e,t,r,i,s){if(Gn=s,pe=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,xs.current=n===null||n.memoizedState===null?uy:cy,n=t(r,i),ei){s=0;do{if(ei=!1,xi=0,25<=s)throw Error(U(301));s+=1,Ce=Re=null,e.updateQueue=null,xs.current=dy,n=t(r,i)}while(ei)}if(xs.current=Js,e=Re!==null&&Re.next!==null,Gn=0,Ce=Re=pe=null,Qs=!1,e)throw Error(U(300));return n}function Ru(){var n=xi!==0;return xi=0,n}function wt(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ce===null?pe.memoizedState=Ce=n:Ce=Ce.next=n,Ce}function ft(){if(Re===null){var n=pe.alternate;n=n!==null?n.memoizedState:null}else n=Re.next;var e=Ce===null?pe.memoizedState:Ce.next;if(e!==null)Ce=e,Re=n;else{if(n===null)throw Error(U(310));Re=n,n={memoizedState:Re.memoizedState,baseState:Re.baseState,baseQueue:Re.baseQueue,queue:Re.queue,next:null},Ce===null?pe.memoizedState=Ce=n:Ce=Ce.next=n}return Ce}function vi(n,e){return typeof e=="function"?e(n):e}function ia(n){var e=ft(),t=e.queue;if(t===null)throw Error(U(311));t.lastRenderedReducer=n;var r=Re,i=r.baseQueue,s=t.pending;if(s!==null){if(i!==null){var o=i.next;i.next=s.next,s.next=o}r.baseQueue=i=s,t.pending=null}if(i!==null){s=i.next,r=r.baseState;var a=o=null,l=null,u=s;do{var c=u.lane;if((Gn&c)===c)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:n(r,u.action);else{var d={lane:c,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(a=l=d,o=r):l=l.next=d,pe.lanes|=c,Vn|=c}u=u.next}while(u!==null&&u!==s);l===null?o=r:l.next=a,Lt(r,e.memoizedState)||(qe=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=l,t.lastRenderedState=r}if(n=t.interleaved,n!==null){i=n;do s=i.lane,pe.lanes|=s,Vn|=s,i=i.next;while(i!==n)}else i===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function sa(n){var e=ft(),t=e.queue;if(t===null)throw Error(U(311));t.lastRenderedReducer=n;var r=t.dispatch,i=t.pending,s=e.memoizedState;if(i!==null){t.pending=null;var o=i=i.next;do s=n(s,o.action),o=o.next;while(o!==i);Lt(s,e.memoizedState)||(qe=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),t.lastRenderedState=s}return[s,r]}function Hh(){}function zh(n,e){var t=pe,r=ft(),i=e(),s=!Lt(r.memoizedState,i);if(s&&(r.memoizedState=i,qe=!0),r=r.queue,Au(qh.bind(null,t,r,n),[n]),r.getSnapshot!==e||s||Ce!==null&&Ce.memoizedState.tag&1){if(t.flags|=2048,Ei(9,Yh.bind(null,t,r,i,e),void 0,null),be===null)throw Error(U(349));Gn&30||Wh(t,e,i)}return i}function Wh(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=pe.updateQueue,e===null?(e={lastEffect:null,stores:null},pe.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function Yh(n,e,t,r){e.value=t,e.getSnapshot=r,Xh(e)&&Qh(n)}function qh(n,e,t){return t(function(){Xh(e)&&Qh(n)})}function Xh(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!Lt(n,t)}catch{return!0}}function Qh(n){var e=Jt(n,1);e!==null&&Tt(e,n,1,-1)}function qc(n){var e=wt();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:vi,lastRenderedState:n},e.queue=n,n=n.dispatch=ly.bind(null,pe,n),[e.memoizedState,n]}function Ei(n,e,t,r){return n={tag:n,create:e,destroy:t,deps:r,next:null},e=pe.updateQueue,e===null?(e={lastEffect:null,stores:null},pe.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(r=t.next,t.next=n,n.next=r,e.lastEffect=n)),n}function Jh(){return ft().memoizedState}function vs(n,e,t,r){var i=wt();pe.flags|=n,i.memoizedState=Ei(1|e,t,void 0,r===void 0?null:r)}function Ro(n,e,t,r){var i=ft();r=r===void 0?null:r;var s=void 0;if(Re!==null){var o=Re.memoizedState;if(s=o.destroy,r!==null&&Tu(r,o.deps)){i.memoizedState=Ei(e,t,s,r);return}}pe.flags|=n,i.memoizedState=Ei(1|e,t,s,r)}function Xc(n,e){return vs(8390656,8,n,e)}function Au(n,e){return Ro(2048,8,n,e)}function Zh(n,e){return Ro(4,2,n,e)}function em(n,e){return Ro(4,4,n,e)}function tm(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function nm(n,e,t){return t=t!=null?t.concat([n]):null,Ro(4,4,tm.bind(null,e,n),t)}function wu(){}function rm(n,e){var t=ft();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&Tu(e,r[1])?r[0]:(t.memoizedState=[n,e],n)}function im(n,e){var t=ft();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&Tu(e,r[1])?r[0]:(n=n(),t.memoizedState=[n,e],n)}function sm(n,e,t){return Gn&21?(Lt(t,e)||(t=ch(),pe.lanes|=t,Vn|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,qe=!0),n.memoizedState=t)}function oy(n,e){var t=oe;oe=t!==0&&4>t?t:4,n(!0);var r=ra.transition;ra.transition={};try{n(!1),e()}finally{oe=t,ra.transition=r}}function om(){return ft().memoizedState}function ay(n,e,t){var r=xn(n);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},am(n))lm(e,t);else if(t=Gh(n,e,t,r),t!==null){var i=Ve();Tt(t,n,r,i),um(t,e,r)}}function ly(n,e,t){var r=xn(n),i={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(am(n))lm(e,i);else{var s=n.alternate;if(n.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,t);if(i.hasEagerState=!0,i.eagerState=a,Lt(a,o)){var l=e.interleaved;l===null?(i.next=i,yu(e)):(i.next=l.next,l.next=i),e.interleaved=i;return}}catch{}finally{}t=Gh(n,e,i,r),t!==null&&(i=Ve(),Tt(t,n,r,i),um(t,e,r))}}function am(n){var e=n.alternate;return n===pe||e!==null&&e===pe}function lm(n,e){ei=Qs=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function um(n,e,t){if(t&4194240){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,ru(n,t)}}var Js={readContext:dt,useCallback:Me,useContext:Me,useEffect:Me,useImperativeHandle:Me,useInsertionEffect:Me,useLayoutEffect:Me,useMemo:Me,useReducer:Me,useRef:Me,useState:Me,useDebugValue:Me,useDeferredValue:Me,useTransition:Me,useMutableSource:Me,useSyncExternalStore:Me,useId:Me,unstable_isNewReconciler:!1},uy={readContext:dt,useCallback:function(n,e){return wt().memoizedState=[n,e===void 0?null:e],n},useContext:dt,useEffect:Xc,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,vs(4194308,4,tm.bind(null,e,n),t)},useLayoutEffect:function(n,e){return vs(4194308,4,n,e)},useInsertionEffect:function(n,e){return vs(4,2,n,e)},useMemo:function(n,e){var t=wt();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var r=wt();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},r.queue=n,n=n.dispatch=ay.bind(null,pe,n),[r.memoizedState,n]},useRef:function(n){var e=wt();return n={current:n},e.memoizedState=n},useState:qc,useDebugValue:wu,useDeferredValue:function(n){return wt().memoizedState=n},useTransition:function(){var n=qc(!1),e=n[0];return n=oy.bind(null,n[1]),wt().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var r=pe,i=wt();if(he){if(t===void 0)throw Error(U(407));t=t()}else{if(t=e(),be===null)throw Error(U(349));Gn&30||Wh(r,e,t)}i.memoizedState=t;var s={value:t,getSnapshot:e};return i.queue=s,Xc(qh.bind(null,r,s,n),[n]),r.flags|=2048,Ei(9,Yh.bind(null,r,s,t,e),void 0,null),t},useId:function(){var n=wt(),e=be.identifierPrefix;if(he){var t=zt,r=Ht;t=(r&~(1<<32-St(r)-1)).toString(32)+t,e=":"+e+"R"+t,t=xi++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=sy++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},cy={readContext:dt,useCallback:rm,useContext:dt,useEffect:Au,useImperativeHandle:nm,useInsertionEffect:Zh,useLayoutEffect:em,useMemo:im,useReducer:ia,useRef:Jh,useState:function(){return ia(vi)},useDebugValue:wu,useDeferredValue:function(n){var e=ft();return sm(e,Re.memoizedState,n)},useTransition:function(){var n=ia(vi)[0],e=ft().memoizedState;return[n,e]},useMutableSource:Hh,useSyncExternalStore:zh,useId:om,unstable_isNewReconciler:!1},dy={readContext:dt,useCallback:rm,useContext:dt,useEffect:Au,useImperativeHandle:nm,useInsertionEffect:Zh,useLayoutEffect:em,useMemo:im,useReducer:sa,useRef:Jh,useState:function(){return sa(vi)},useDebugValue:wu,useDeferredValue:function(n){var e=ft();return Re===null?e.memoizedState=n:sm(e,Re.memoizedState,n)},useTransition:function(){var n=sa(vi)[0],e=ft().memoizedState;return[n,e]},useMutableSource:Hh,useSyncExternalStore:zh,useId:om,unstable_isNewReconciler:!1};function yt(n,e){if(n&&n.defaultProps){e=xe({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function fl(n,e,t,r){e=n.memoizedState,t=t(r,e),t=t==null?e:xe({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var Ao={isMounted:function(n){return(n=n._reactInternals)?Wn(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var r=Ve(),i=xn(n),s=Yt(r,i);s.payload=e,t!=null&&(s.callback=t),e=pn(n,s,i),e!==null&&(Tt(e,n,i,r),ys(e,n,i))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var r=Ve(),i=xn(n),s=Yt(r,i);s.tag=1,s.payload=e,t!=null&&(s.callback=t),e=pn(n,s,i),e!==null&&(Tt(e,n,i,r),ys(e,n,i))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=Ve(),r=xn(n),i=Yt(t,r);i.tag=2,e!=null&&(i.callback=e),e=pn(n,i,r),e!==null&&(Tt(e,n,r,t),ys(e,n,r))}};function Qc(n,e,t,r,i,s,o){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,s,o):e.prototype&&e.prototype.isPureReactComponent?!fi(t,r)||!fi(i,s):!0}function cm(n,e,t){var r=!1,i=Sn,s=e.contextType;return typeof s=="object"&&s!==null?s=dt(s):(i=Qe(e)?$n:je.current,r=e.contextTypes,s=(r=r!=null)?Er(n,i):Sn),e=new e(t,s),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Ao,n.stateNode=e,e._reactInternals=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=i,n.__reactInternalMemoizedMaskedChildContext=s),e}function Jc(n,e,t,r){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==n&&Ao.enqueueReplaceState(e,e.state,null)}function hl(n,e,t,r){var i=n.stateNode;i.props=t,i.state=n.memoizedState,i.refs={},xu(n);var s=e.contextType;typeof s=="object"&&s!==null?i.context=dt(s):(s=Qe(e)?$n:je.current,i.context=Er(n,s)),i.state=n.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(fl(n,e,s,t),i.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&Ao.enqueueReplaceState(i,i.state,null),qs(n,t,i,r),i.state=n.memoizedState),typeof i.componentDidMount=="function"&&(n.flags|=4194308)}function Rr(n,e){try{var t="",r=e;do t+=Bg(r),r=r.return;while(r);var i=t}catch(s){i=`
Error generating stack: `+s.message+`
`+s.stack}return{value:n,source:e,stack:i,digest:null}}function oa(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function ml(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var fy=typeof WeakMap=="function"?WeakMap:Map;function dm(n,e,t){t=Yt(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){eo||(eo=!0,Rl=r),ml(n,e)},t}function fm(n,e,t){t=Yt(-1,t),t.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;t.payload=function(){return r(i)},t.callback=function(){ml(n,e)}}var s=n.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(t.callback=function(){ml(n,e),typeof r!="function"&&(yn===null?yn=new Set([this]):yn.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function Zc(n,e,t){var r=n.pingCache;if(r===null){r=n.pingCache=new fy;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(t)||(i.add(t),n=wy.bind(null,n,e,t),e.then(n,n))}function ed(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function td(n,e,t,r,i){return n.mode&1?(n.flags|=65536,n.lanes=i,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=Yt(-1,1),e.tag=2,pn(t,e,1))),t.lanes|=1),n)}var hy=en.ReactCurrentOwner,qe=!1;function Ge(n,e,t,r){e.child=n===null?jh(e,null,t,r):Tr(e,n.child,t,r)}function nd(n,e,t,r,i){t=t.render;var s=e.ref;return pr(e,i),r=Lu(n,e,t,r,s,i),t=Ru(),n!==null&&!qe?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,Zt(n,e,i)):(he&&t&&du(e),e.flags|=1,Ge(n,e,r,i),e.child)}function rd(n,e,t,r,i){if(n===null){var s=t.type;return typeof s=="function"&&!Pu(s)&&s.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=s,hm(n,e,s,r,i)):(n=Ls(t.type,null,r,e,e.mode,i),n.ref=e.ref,n.return=e,e.child=n)}if(s=n.child,!(n.lanes&i)){var o=s.memoizedProps;if(t=t.compare,t=t!==null?t:fi,t(o,r)&&n.ref===e.ref)return Zt(n,e,i)}return e.flags|=1,n=vn(s,r),n.ref=e.ref,n.return=e,e.child=n}function hm(n,e,t,r,i){if(n!==null){var s=n.memoizedProps;if(fi(s,r)&&n.ref===e.ref)if(qe=!1,e.pendingProps=r=s,(n.lanes&i)!==0)n.flags&131072&&(qe=!0);else return e.lanes=n.lanes,Zt(n,e,i)}return gl(n,e,t,r,i)}function mm(n,e,t){var r=e.pendingProps,i=r.children,s=n!==null?n.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},ce(cr,Ze),Ze|=t;else{if(!(t&1073741824))return n=s!==null?s.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,ce(cr,Ze),Ze|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=s!==null?s.baseLanes:t,ce(cr,Ze),Ze|=r}else s!==null?(r=s.baseLanes|t,e.memoizedState=null):r=t,ce(cr,Ze),Ze|=r;return Ge(n,e,i,t),e.child}function gm(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function gl(n,e,t,r,i){var s=Qe(t)?$n:je.current;return s=Er(e,s),pr(e,i),t=Lu(n,e,t,r,s,i),r=Ru(),n!==null&&!qe?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,Zt(n,e,i)):(he&&r&&du(e),e.flags|=1,Ge(n,e,t,i),e.child)}function id(n,e,t,r,i){if(Qe(t)){var s=!0;Ks(e)}else s=!1;if(pr(e,i),e.stateNode===null)Es(n,e),cm(e,t,r),hl(e,t,r,i),r=!0;else if(n===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,u=t.contextType;typeof u=="object"&&u!==null?u=dt(u):(u=Qe(t)?$n:je.current,u=Er(e,u));var c=t.getDerivedStateFromProps,d=typeof c=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||l!==u)&&Jc(e,o,r,u),on=!1;var f=e.memoizedState;o.state=f,qs(e,r,o,i),l=e.memoizedState,a!==r||f!==l||Xe.current||on?(typeof c=="function"&&(fl(e,t,c,r),l=e.memoizedState),(a=on||Qc(e,t,a,r,f,l,u))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),o.props=r,o.state=l,o.context=u,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,Vh(n,e),a=e.memoizedProps,u=e.type===e.elementType?a:yt(e.type,a),o.props=u,d=e.pendingProps,f=o.context,l=t.contextType,typeof l=="object"&&l!==null?l=dt(l):(l=Qe(t)?$n:je.current,l=Er(e,l));var h=t.getDerivedStateFromProps;(c=typeof h=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==d||f!==l)&&Jc(e,o,r,l),on=!1,f=e.memoizedState,o.state=f,qs(e,r,o,i);var m=e.memoizedState;a!==d||f!==m||Xe.current||on?(typeof h=="function"&&(fl(e,t,h,r),m=e.memoizedState),(u=on||Qc(e,t,u,r,f,m,l)||!1)?(c||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,m,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,m,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=m),o.props=r,o.state=m,o.context=l,r=u):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=1024),r=!1)}return pl(n,e,t,r,s,i)}function pl(n,e,t,r,i,s){gm(n,e);var o=(e.flags&128)!==0;if(!r&&!o)return i&&Vc(e,t,!1),Zt(n,e,s);r=e.stateNode,hy.current=e;var a=o&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,n!==null&&o?(e.child=Tr(e,n.child,null,s),e.child=Tr(e,null,a,s)):Ge(n,e,a,s),e.memoizedState=r.state,i&&Vc(e,t,!0),e.child}function pm(n){var e=n.stateNode;e.pendingContext?Gc(n,e.pendingContext,e.pendingContext!==e.context):e.context&&Gc(n,e.context,!1),vu(n,e.containerInfo)}function sd(n,e,t,r,i){return Sr(),hu(i),e.flags|=256,Ge(n,e,t,r),e.child}var yl={dehydrated:null,treeContext:null,retryLane:0};function xl(n){return{baseLanes:n,cachePool:null,transitions:null}}function ym(n,e,t){var r=e.pendingProps,i=ge.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=n!==null&&n.memoizedState===null?!1:(i&2)!==0),a?(s=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(i|=1),ce(ge,i&1),n===null)return cl(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,n=r.fallback,s?(r=e.mode,s=e.child,o={mode:"hidden",children:o},!(r&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=Io(o,r,0,null),n=Mn(n,r,t,null),s.return=e,n.return=e,s.sibling=n,e.child=s,e.child.memoizedState=xl(t),e.memoizedState=yl,n):Cu(e,o));if(i=n.memoizedState,i!==null&&(a=i.dehydrated,a!==null))return my(n,e,o,r,a,i,t);if(s){s=r.fallback,o=e.mode,i=n.child,a=i.sibling;var l={mode:"hidden",children:r.children};return!(o&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=vn(i,l),r.subtreeFlags=i.subtreeFlags&14680064),a!==null?s=vn(a,s):(s=Mn(s,o,t,null),s.flags|=2),s.return=e,r.return=e,r.sibling=s,e.child=r,r=s,s=e.child,o=n.child.memoizedState,o=o===null?xl(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=n.childLanes&~t,e.memoizedState=yl,r}return s=n.child,n=s.sibling,r=vn(s,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=t),r.return=e,r.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=r,e.memoizedState=null,r}function Cu(n,e){return e=Io({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function Yi(n,e,t,r){return r!==null&&hu(r),Tr(e,n.child,null,t),n=Cu(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function my(n,e,t,r,i,s,o){if(t)return e.flags&256?(e.flags&=-257,r=oa(Error(U(422))),Yi(n,e,o,r)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(s=r.fallback,i=e.mode,r=Io({mode:"visible",children:r.children},i,0,null),s=Mn(s,i,o,null),s.flags|=2,r.return=e,s.return=e,r.sibling=s,e.child=r,e.mode&1&&Tr(e,n.child,null,o),e.child.memoizedState=xl(o),e.memoizedState=yl,s);if(!(e.mode&1))return Yi(n,e,o,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var a=r.dgst;return r=a,s=Error(U(419)),r=oa(s,r,void 0),Yi(n,e,o,r)}if(a=(o&n.childLanes)!==0,qe||a){if(r=be,r!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|o)?0:i,i!==0&&i!==s.retryLane&&(s.retryLane=i,Jt(n,i),Tt(r,n,i,-1))}return Nu(),r=oa(Error(U(421))),Yi(n,e,o,r)}return i.data==="$?"?(e.flags|=128,e.child=n.child,e=Cy.bind(null,n),i._reactRetry=e,null):(n=s.treeContext,et=gn(i.nextSibling),tt=e,he=!0,vt=null,n!==null&&(at[lt++]=Ht,at[lt++]=zt,at[lt++]=jn,Ht=n.id,zt=n.overflow,jn=e),e=Cu(e,r.children),e.flags|=4096,e)}function od(n,e,t){n.lanes|=e;var r=n.alternate;r!==null&&(r.lanes|=e),dl(n.return,e,t)}function aa(n,e,t,r,i){var s=n.memoizedState;s===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:i}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=t,s.tailMode=i)}function xm(n,e,t){var r=e.pendingProps,i=r.revealOrder,s=r.tail;if(Ge(n,e,r.children,t),r=ge.current,r&2)r=r&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&od(n,t,e);else if(n.tag===19)od(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(ce(ge,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(t=e.child,i=null;t!==null;)n=t.alternate,n!==null&&Xs(n)===null&&(i=t),t=t.sibling;t=i,t===null?(i=e.child,e.child=null):(i=t.sibling,t.sibling=null),aa(e,!1,i,t,s);break;case"backwards":for(t=null,i=e.child,e.child=null;i!==null;){if(n=i.alternate,n!==null&&Xs(n)===null){e.child=i;break}n=i.sibling,i.sibling=t,t=i,i=n}aa(e,!0,t,null,s);break;case"together":aa(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Es(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function Zt(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),Vn|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(U(153));if(e.child!==null){for(n=e.child,t=vn(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=vn(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function gy(n,e,t){switch(e.tag){case 3:pm(e),Sr();break;case 5:Kh(e);break;case 1:Qe(e.type)&&Ks(e);break;case 4:vu(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;ce(Ws,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(ce(ge,ge.current&1),e.flags|=128,null):t&e.child.childLanes?ym(n,e,t):(ce(ge,ge.current&1),n=Zt(n,e,t),n!==null?n.sibling:null);ce(ge,ge.current&1);break;case 19:if(r=(t&e.childLanes)!==0,n.flags&128){if(r)return xm(n,e,t);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),ce(ge,ge.current),r)break;return null;case 22:case 23:return e.lanes=0,mm(n,e,t)}return Zt(n,e,t)}var vm,vl,Em,Sm;vm=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};vl=function(){};Em=function(n,e,t,r){var i=n.memoizedProps;if(i!==r){n=e.stateNode,Pn(Nt.current);var s=null;switch(t){case"input":i=ja(n,i),r=ja(n,r),s=[];break;case"select":i=xe({},i,{value:void 0}),r=xe({},r,{value:void 0}),s=[];break;case"textarea":i=Ka(n,i),r=Ka(n,r),s=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(n.onclick=Gs)}za(t,r);var o;t=null;for(u in i)if(!r.hasOwnProperty(u)&&i.hasOwnProperty(u)&&i[u]!=null)if(u==="style"){var a=i[u];for(o in a)a.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(si.hasOwnProperty(u)?s||(s=[]):(s=s||[]).push(u,null));for(u in r){var l=r[u];if(a=i!=null?i[u]:void 0,r.hasOwnProperty(u)&&l!==a&&(l!=null||a!=null))if(u==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(t||(t={}),t[o]=l[o])}else t||(s||(s=[]),s.push(u,t)),t=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(si.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&de("scroll",n),s||a===l||(s=[])):(s=s||[]).push(u,l))}t&&(s=s||[]).push("style",t);var u=s;(e.updateQueue=u)&&(e.flags|=4)}};Sm=function(n,e,t,r){t!==r&&(e.flags|=4)};function jr(n,e){if(!he)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function Ue(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,r=0;if(e)for(var i=n.child;i!==null;)t|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=n,i=i.sibling;else for(i=n.child;i!==null;)t|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=n,i=i.sibling;return n.subtreeFlags|=r,n.childLanes=t,e}function py(n,e,t){var r=e.pendingProps;switch(fu(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ue(e),null;case 1:return Qe(e.type)&&Vs(),Ue(e),null;case 3:return r=e.stateNode,Lr(),fe(Xe),fe(je),Su(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(zi(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,vt!==null&&(Cl(vt),vt=null))),vl(n,e),Ue(e),null;case 5:Eu(e);var i=Pn(yi.current);if(t=e.type,n!==null&&e.stateNode!=null)Em(n,e,t,r,i),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(U(166));return Ue(e),null}if(n=Pn(Nt.current),zi(e)){r=e.stateNode,t=e.type;var s=e.memoizedProps;switch(r[kt]=e,r[gi]=s,n=(e.mode&1)!==0,t){case"dialog":de("cancel",r),de("close",r);break;case"iframe":case"object":case"embed":de("load",r);break;case"video":case"audio":for(i=0;i<Yr.length;i++)de(Yr[i],r);break;case"source":de("error",r);break;case"img":case"image":case"link":de("error",r),de("load",r);break;case"details":de("toggle",r);break;case"input":gc(r,s),de("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},de("invalid",r);break;case"textarea":yc(r,s),de("invalid",r)}za(t,s),i=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?r.textContent!==a&&(s.suppressHydrationWarning!==!0&&Hi(r.textContent,a,n),i=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&Hi(r.textContent,a,n),i=["children",""+a]):si.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&de("scroll",r)}switch(t){case"input":Mi(r),pc(r,s,!0);break;case"textarea":Mi(r),xc(r);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(r.onclick=Gs)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=qf(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=o.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=o.createElement(t,{is:r.is}):(n=o.createElement(t),t==="select"&&(o=n,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):n=o.createElementNS(n,t),n[kt]=e,n[gi]=r,vm(n,e,!1,!1),e.stateNode=n;e:{switch(o=Wa(t,r),t){case"dialog":de("cancel",n),de("close",n),i=r;break;case"iframe":case"object":case"embed":de("load",n),i=r;break;case"video":case"audio":for(i=0;i<Yr.length;i++)de(Yr[i],n);i=r;break;case"source":de("error",n),i=r;break;case"img":case"image":case"link":de("error",n),de("load",n),i=r;break;case"details":de("toggle",n),i=r;break;case"input":gc(n,r),i=ja(n,r),de("invalid",n);break;case"option":i=r;break;case"select":n._wrapperState={wasMultiple:!!r.multiple},i=xe({},r,{value:void 0}),de("invalid",n);break;case"textarea":yc(n,r),i=Ka(n,r),de("invalid",n);break;default:i=r}za(t,i),a=i;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?Jf(n,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&Xf(n,l)):s==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&oi(n,l):typeof l=="number"&&oi(n,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(si.hasOwnProperty(s)?l!=null&&s==="onScroll"&&de("scroll",n):l!=null&&Ql(n,s,l,o))}switch(t){case"input":Mi(n),pc(n,r,!1);break;case"textarea":Mi(n),xc(n);break;case"option":r.value!=null&&n.setAttribute("value",""+En(r.value));break;case"select":n.multiple=!!r.multiple,s=r.value,s!=null?fr(n,!!r.multiple,s,!1):r.defaultValue!=null&&fr(n,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(n.onclick=Gs)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Ue(e),null;case 6:if(n&&e.stateNode!=null)Sm(n,e,n.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(U(166));if(t=Pn(yi.current),Pn(Nt.current),zi(e)){if(r=e.stateNode,t=e.memoizedProps,r[kt]=e,(s=r.nodeValue!==t)&&(n=tt,n!==null))switch(n.tag){case 3:Hi(r.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&Hi(r.nodeValue,t,(n.mode&1)!==0)}s&&(e.flags|=4)}else r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[kt]=e,e.stateNode=r}return Ue(e),null;case 13:if(fe(ge),r=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(he&&et!==null&&e.mode&1&&!(e.flags&128))Bh(),Sr(),e.flags|=98560,s=!1;else if(s=zi(e),r!==null&&r.dehydrated!==null){if(n===null){if(!s)throw Error(U(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(U(317));s[kt]=e}else Sr(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Ue(e),s=!1}else vt!==null&&(Cl(vt),vt=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(r=r!==null,r!==(n!==null&&n.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(n===null||ge.current&1?Ae===0&&(Ae=3):Nu())),e.updateQueue!==null&&(e.flags|=4),Ue(e),null);case 4:return Lr(),vl(n,e),n===null&&hi(e.stateNode.containerInfo),Ue(e),null;case 10:return pu(e.type._context),Ue(e),null;case 17:return Qe(e.type)&&Vs(),Ue(e),null;case 19:if(fe(ge),s=e.memoizedState,s===null)return Ue(e),null;if(r=(e.flags&128)!==0,o=s.rendering,o===null)if(r)jr(s,!1);else{if(Ae!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(o=Xs(n),o!==null){for(e.flags|=128,jr(s,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=t,t=e.child;t!==null;)s=t,n=r,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=n,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,n=o.dependencies,s.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return ce(ge,ge.current&1|2),e.child}n=n.sibling}s.tail!==null&&Ee()>Ar&&(e.flags|=128,r=!0,jr(s,!1),e.lanes=4194304)}else{if(!r)if(n=Xs(o),n!==null){if(e.flags|=128,r=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),jr(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!he)return Ue(e),null}else 2*Ee()-s.renderingStartTime>Ar&&t!==1073741824&&(e.flags|=128,r=!0,jr(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(t=s.last,t!==null?t.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=Ee(),e.sibling=null,t=ge.current,ce(ge,r?t&1|2:t&1),e):(Ue(e),null);case 22:case 23:return _u(),r=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Ze&1073741824&&(Ue(e),e.subtreeFlags&6&&(e.flags|=8192)):Ue(e),null;case 24:return null;case 25:return null}throw Error(U(156,e.tag))}function yy(n,e){switch(fu(e),e.tag){case 1:return Qe(e.type)&&Vs(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return Lr(),fe(Xe),fe(je),Su(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return Eu(e),null;case 13:if(fe(ge),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(U(340));Sr()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return fe(ge),null;case 4:return Lr(),null;case 10:return pu(e.type._context),null;case 22:case 23:return _u(),null;case 24:return null;default:return null}}var qi=!1,$e=!1,xy=typeof WeakSet=="function"?WeakSet:Set,j=null;function ur(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){ve(n,e,r)}else t.current=null}function El(n,e,t){try{t()}catch(r){ve(n,e,r)}}var ad=!1;function vy(n,e){if(rl=Bs,n=wh(),cu(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var r=t.getSelection&&t.getSelection();if(r&&r.rangeCount!==0){t=r.anchorNode;var i=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{t.nodeType,s.nodeType}catch{t=null;break e}var o=0,a=-1,l=-1,u=0,c=0,d=n,f=null;t:for(;;){for(var h;d!==t||i!==0&&d.nodeType!==3||(a=o+i),d!==s||r!==0&&d.nodeType!==3||(l=o+r),d.nodeType===3&&(o+=d.nodeValue.length),(h=d.firstChild)!==null;)f=d,d=h;for(;;){if(d===n)break t;if(f===t&&++u===i&&(a=o),f===s&&++c===r&&(l=o),(h=d.nextSibling)!==null)break;d=f,f=d.parentNode}d=h}t=a===-1||l===-1?null:{start:a,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(il={focusedElem:n,selectionRange:t},Bs=!1,j=e;j!==null;)if(e=j,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,j=n;else for(;j!==null;){e=j;try{var m=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(m!==null){var p=m.memoizedProps,x=m.memoizedState,y=e.stateNode,v=y.getSnapshotBeforeUpdate(e.elementType===e.type?p:yt(e.type,p),x);y.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var S=e.stateNode.containerInfo;S.nodeType===1?S.textContent="":S.nodeType===9&&S.documentElement&&S.removeChild(S.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(U(163))}}catch(L){ve(e,e.return,L)}if(n=e.sibling,n!==null){n.return=e.return,j=n;break}j=e.return}return m=ad,ad=!1,m}function ti(n,e,t){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&n)===n){var s=i.destroy;i.destroy=void 0,s!==void 0&&El(e,t,s)}i=i.next}while(i!==r)}}function wo(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}}function Sl(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function Tm(n){var e=n.alternate;e!==null&&(n.alternate=null,Tm(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[kt],delete e[gi],delete e[al],delete e[ty],delete e[ny])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function Lm(n){return n.tag===5||n.tag===3||n.tag===4}function ld(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||Lm(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function Tl(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=Gs));else if(r!==4&&(n=n.child,n!==null))for(Tl(n,e,t),n=n.sibling;n!==null;)Tl(n,e,t),n=n.sibling}function Ll(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for(Ll(n,e,t),n=n.sibling;n!==null;)Ll(n,e,t),n=n.sibling}var Ne=null,xt=!1;function nn(n,e,t){for(t=t.child;t!==null;)Rm(n,e,t),t=t.sibling}function Rm(n,e,t){if(_t&&typeof _t.onCommitFiberUnmount=="function")try{_t.onCommitFiberUnmount(xo,t)}catch{}switch(t.tag){case 5:$e||ur(t,e);case 6:var r=Ne,i=xt;Ne=null,nn(n,e,t),Ne=r,xt=i,Ne!==null&&(xt?(n=Ne,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):Ne.removeChild(t.stateNode));break;case 18:Ne!==null&&(xt?(n=Ne,t=t.stateNode,n.nodeType===8?ea(n.parentNode,t):n.nodeType===1&&ea(n,t),ci(n)):ea(Ne,t.stateNode));break;case 4:r=Ne,i=xt,Ne=t.stateNode.containerInfo,xt=!0,nn(n,e,t),Ne=r,xt=i;break;case 0:case 11:case 14:case 15:if(!$e&&(r=t.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var s=i,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&El(t,e,o),i=i.next}while(i!==r)}nn(n,e,t);break;case 1:if(!$e&&(ur(t,e),r=t.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(a){ve(t,e,a)}nn(n,e,t);break;case 21:nn(n,e,t);break;case 22:t.mode&1?($e=(r=$e)||t.memoizedState!==null,nn(n,e,t),$e=r):nn(n,e,t);break;default:nn(n,e,t)}}function ud(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new xy),e.forEach(function(r){var i=Iy.bind(null,n,r);t.has(r)||(t.add(r),r.then(i,i))})}}function mt(n,e){var t=e.deletions;if(t!==null)for(var r=0;r<t.length;r++){var i=t[r];try{var s=n,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Ne=a.stateNode,xt=!1;break e;case 3:Ne=a.stateNode.containerInfo,xt=!0;break e;case 4:Ne=a.stateNode.containerInfo,xt=!0;break e}a=a.return}if(Ne===null)throw Error(U(160));Rm(s,o,i),Ne=null,xt=!1;var l=i.alternate;l!==null&&(l.return=null),i.return=null}catch(u){ve(i,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)Am(e,n),e=e.sibling}function Am(n,e){var t=n.alternate,r=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(mt(e,n),Rt(n),r&4){try{ti(3,n,n.return),wo(3,n)}catch(p){ve(n,n.return,p)}try{ti(5,n,n.return)}catch(p){ve(n,n.return,p)}}break;case 1:mt(e,n),Rt(n),r&512&&t!==null&&ur(t,t.return);break;case 5:if(mt(e,n),Rt(n),r&512&&t!==null&&ur(t,t.return),n.flags&32){var i=n.stateNode;try{oi(i,"")}catch(p){ve(n,n.return,p)}}if(r&4&&(i=n.stateNode,i!=null)){var s=n.memoizedProps,o=t!==null?t.memoizedProps:s,a=n.type,l=n.updateQueue;if(n.updateQueue=null,l!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&Wf(i,s),Wa(a,o);var u=Wa(a,s);for(o=0;o<l.length;o+=2){var c=l[o],d=l[o+1];c==="style"?Jf(i,d):c==="dangerouslySetInnerHTML"?Xf(i,d):c==="children"?oi(i,d):Ql(i,c,d,u)}switch(a){case"input":Ga(i,s);break;case"textarea":Yf(i,s);break;case"select":var f=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var h=s.value;h!=null?fr(i,!!s.multiple,h,!1):f!==!!s.multiple&&(s.defaultValue!=null?fr(i,!!s.multiple,s.defaultValue,!0):fr(i,!!s.multiple,s.multiple?[]:"",!1))}i[gi]=s}catch(p){ve(n,n.return,p)}}break;case 6:if(mt(e,n),Rt(n),r&4){if(n.stateNode===null)throw Error(U(162));i=n.stateNode,s=n.memoizedProps;try{i.nodeValue=s}catch(p){ve(n,n.return,p)}}break;case 3:if(mt(e,n),Rt(n),r&4&&t!==null&&t.memoizedState.isDehydrated)try{ci(e.containerInfo)}catch(p){ve(n,n.return,p)}break;case 4:mt(e,n),Rt(n);break;case 13:mt(e,n),Rt(n),i=n.child,i.flags&8192&&(s=i.memoizedState!==null,i.stateNode.isHidden=s,!s||i.alternate!==null&&i.alternate.memoizedState!==null||(bu=Ee())),r&4&&ud(n);break;case 22:if(c=t!==null&&t.memoizedState!==null,n.mode&1?($e=(u=$e)||c,mt(e,n),$e=u):mt(e,n),Rt(n),r&8192){if(u=n.memoizedState!==null,(n.stateNode.isHidden=u)&&!c&&n.mode&1)for(j=n,c=n.child;c!==null;){for(d=j=c;j!==null;){switch(f=j,h=f.child,f.tag){case 0:case 11:case 14:case 15:ti(4,f,f.return);break;case 1:ur(f,f.return);var m=f.stateNode;if(typeof m.componentWillUnmount=="function"){r=f,t=f.return;try{e=r,m.props=e.memoizedProps,m.state=e.memoizedState,m.componentWillUnmount()}catch(p){ve(r,t,p)}}break;case 5:ur(f,f.return);break;case 22:if(f.memoizedState!==null){dd(d);continue}}h!==null?(h.return=f,j=h):dd(d)}c=c.sibling}e:for(c=null,d=n;;){if(d.tag===5){if(c===null){c=d;try{i=d.stateNode,u?(s=i.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=d.stateNode,l=d.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=Qf("display",o))}catch(p){ve(n,n.return,p)}}}else if(d.tag===6){if(c===null)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(p){ve(n,n.return,p)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===n)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===n)break e;for(;d.sibling===null;){if(d.return===null||d.return===n)break e;c===d&&(c=null),d=d.return}c===d&&(c=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:mt(e,n),Rt(n),r&4&&ud(n);break;case 21:break;default:mt(e,n),Rt(n)}}function Rt(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(Lm(t)){var r=t;break e}t=t.return}throw Error(U(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(oi(i,""),r.flags&=-33);var s=ld(n);Ll(n,s,i);break;case 3:case 4:var o=r.stateNode.containerInfo,a=ld(n);Tl(n,a,o);break;default:throw Error(U(161))}}catch(l){ve(n,n.return,l)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function Ey(n,e,t){j=n,wm(n)}function wm(n,e,t){for(var r=(n.mode&1)!==0;j!==null;){var i=j,s=i.child;if(i.tag===22&&r){var o=i.memoizedState!==null||qi;if(!o){var a=i.alternate,l=a!==null&&a.memoizedState!==null||$e;a=qi;var u=$e;if(qi=o,($e=l)&&!u)for(j=i;j!==null;)o=j,l=o.child,o.tag===22&&o.memoizedState!==null?fd(i):l!==null?(l.return=o,j=l):fd(i);for(;s!==null;)j=s,wm(s),s=s.sibling;j=i,qi=a,$e=u}cd(n)}else i.subtreeFlags&8772&&s!==null?(s.return=i,j=s):cd(n)}}function cd(n){for(;j!==null;){var e=j;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:$e||wo(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!$e)if(t===null)r.componentDidMount();else{var i=e.elementType===e.type?t.memoizedProps:yt(e.type,t.memoizedProps);r.componentDidUpdate(i,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&Yc(e,s,r);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}Yc(e,o,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var c=u.memoizedState;if(c!==null){var d=c.dehydrated;d!==null&&ci(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(U(163))}$e||e.flags&512&&Sl(e)}catch(f){ve(e,e.return,f)}}if(e===n){j=null;break}if(t=e.sibling,t!==null){t.return=e.return,j=t;break}j=e.return}}function dd(n){for(;j!==null;){var e=j;if(e===n){j=null;break}var t=e.sibling;if(t!==null){t.return=e.return,j=t;break}j=e.return}}function fd(n){for(;j!==null;){var e=j;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{wo(4,e)}catch(l){ve(e,t,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(l){ve(e,i,l)}}var s=e.return;try{Sl(e)}catch(l){ve(e,s,l)}break;case 5:var o=e.return;try{Sl(e)}catch(l){ve(e,o,l)}}}catch(l){ve(e,e.return,l)}if(e===n){j=null;break}var a=e.sibling;if(a!==null){a.return=e.return,j=a;break}j=e.return}}var Sy=Math.ceil,Zs=en.ReactCurrentDispatcher,Iu=en.ReactCurrentOwner,ct=en.ReactCurrentBatchConfig,ne=0,be=null,Se=null,Fe=0,Ze=0,cr=Rn(0),Ae=0,Si=null,Vn=0,Co=0,ku=0,ni=null,We=null,bu=0,Ar=1/0,jt=null,eo=!1,Rl=null,yn=null,Xi=!1,dn=null,to=0,ri=0,Al=null,Ss=-1,Ts=0;function Ve(){return ne&6?Ee():Ss!==-1?Ss:Ss=Ee()}function xn(n){return n.mode&1?ne&2&&Fe!==0?Fe&-Fe:iy.transition!==null?(Ts===0&&(Ts=ch()),Ts):(n=oe,n!==0||(n=window.event,n=n===void 0?16:yh(n.type)),n):1}function Tt(n,e,t,r){if(50<ri)throw ri=0,Al=null,Error(U(185));Ii(n,t,r),(!(ne&2)||n!==be)&&(n===be&&(!(ne&2)&&(Co|=t),Ae===4&&un(n,Fe)),Je(n,r),t===1&&ne===0&&!(e.mode&1)&&(Ar=Ee()+500,Lo&&An()))}function Je(n,e){var t=n.callbackNode;ip(n,e);var r=Us(n,n===be?Fe:0);if(r===0)t!==null&&Sc(t),n.callbackNode=null,n.callbackPriority=0;else if(e=r&-r,n.callbackPriority!==e){if(t!=null&&Sc(t),e===1)n.tag===0?ry(hd.bind(null,n)):Oh(hd.bind(null,n)),Zp(function(){!(ne&6)&&An()}),t=null;else{switch(dh(r)){case 1:t=nu;break;case 4:t=lh;break;case 16:t=Ms;break;case 536870912:t=uh;break;default:t=Ms}t=Pm(t,Cm.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function Cm(n,e){if(Ss=-1,Ts=0,ne&6)throw Error(U(327));var t=n.callbackNode;if(yr()&&n.callbackNode!==t)return null;var r=Us(n,n===be?Fe:0);if(r===0)return null;if(r&30||r&n.expiredLanes||e)e=no(n,r);else{e=r;var i=ne;ne|=2;var s=km();(be!==n||Fe!==e)&&(jt=null,Ar=Ee()+500,On(n,e));do try{Ry();break}catch(a){Im(n,a)}while(1);gu(),Zs.current=s,ne=i,Se!==null?e=0:(be=null,Fe=0,e=Ae)}if(e!==0){if(e===2&&(i=Ja(n),i!==0&&(r=i,e=wl(n,i))),e===1)throw t=Si,On(n,0),un(n,r),Je(n,Ee()),t;if(e===6)un(n,r);else{if(i=n.current.alternate,!(r&30)&&!Ty(i)&&(e=no(n,r),e===2&&(s=Ja(n),s!==0&&(r=s,e=wl(n,s))),e===1))throw t=Si,On(n,0),un(n,r),Je(n,Ee()),t;switch(n.finishedWork=i,n.finishedLanes=r,e){case 0:case 1:throw Error(U(345));case 2:In(n,We,jt);break;case 3:if(un(n,r),(r&130023424)===r&&(e=bu+500-Ee(),10<e)){if(Us(n,0)!==0)break;if(i=n.suspendedLanes,(i&r)!==r){Ve(),n.pingedLanes|=n.suspendedLanes&i;break}n.timeoutHandle=ol(In.bind(null,n,We,jt),e);break}In(n,We,jt);break;case 4:if(un(n,r),(r&4194240)===r)break;for(e=n.eventTimes,i=-1;0<r;){var o=31-St(r);s=1<<o,o=e[o],o>i&&(i=o),r&=~s}if(r=i,r=Ee()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Sy(r/1960))-r,10<r){n.timeoutHandle=ol(In.bind(null,n,We,jt),r);break}In(n,We,jt);break;case 5:In(n,We,jt);break;default:throw Error(U(329))}}}return Je(n,Ee()),n.callbackNode===t?Cm.bind(null,n):null}function wl(n,e){var t=ni;return n.current.memoizedState.isDehydrated&&(On(n,e).flags|=256),n=no(n,e),n!==2&&(e=We,We=t,e!==null&&Cl(e)),n}function Cl(n){We===null?We=n:We.push.apply(We,n)}function Ty(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var r=0;r<t.length;r++){var i=t[r],s=i.getSnapshot;i=i.value;try{if(!Lt(s(),i))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function un(n,e){for(e&=~ku,e&=~Co,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-St(e),r=1<<t;n[t]=-1,e&=~r}}function hd(n){if(ne&6)throw Error(U(327));yr();var e=Us(n,0);if(!(e&1))return Je(n,Ee()),null;var t=no(n,e);if(n.tag!==0&&t===2){var r=Ja(n);r!==0&&(e=r,t=wl(n,r))}if(t===1)throw t=Si,On(n,0),un(n,e),Je(n,Ee()),t;if(t===6)throw Error(U(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,In(n,We,jt),Je(n,Ee()),null}function Du(n,e){var t=ne;ne|=1;try{return n(e)}finally{ne=t,ne===0&&(Ar=Ee()+500,Lo&&An())}}function Kn(n){dn!==null&&dn.tag===0&&!(ne&6)&&yr();var e=ne;ne|=1;var t=ct.transition,r=oe;try{if(ct.transition=null,oe=1,n)return n()}finally{oe=r,ct.transition=t,ne=e,!(ne&6)&&An()}}function _u(){Ze=cr.current,fe(cr)}function On(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,Jp(t)),Se!==null)for(t=Se.return;t!==null;){var r=t;switch(fu(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Vs();break;case 3:Lr(),fe(Xe),fe(je),Su();break;case 5:Eu(r);break;case 4:Lr();break;case 13:fe(ge);break;case 19:fe(ge);break;case 10:pu(r.type._context);break;case 22:case 23:_u()}t=t.return}if(be=n,Se=n=vn(n.current,null),Fe=Ze=e,Ae=0,Si=null,ku=Co=Vn=0,We=ni=null,Nn!==null){for(e=0;e<Nn.length;e++)if(t=Nn[e],r=t.interleaved,r!==null){t.interleaved=null;var i=r.next,s=t.pending;if(s!==null){var o=s.next;s.next=i,r.next=o}t.pending=r}Nn=null}return n}function Im(n,e){do{var t=Se;try{if(gu(),xs.current=Js,Qs){for(var r=pe.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}Qs=!1}if(Gn=0,Ce=Re=pe=null,ei=!1,xi=0,Iu.current=null,t===null||t.return===null){Ae=1,Si=e,Se=null;break}e:{var s=n,o=t.return,a=t,l=e;if(e=Fe,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,c=a,d=c.tag;if(!(c.mode&1)&&(d===0||d===11||d===15)){var f=c.alternate;f?(c.updateQueue=f.updateQueue,c.memoizedState=f.memoizedState,c.lanes=f.lanes):(c.updateQueue=null,c.memoizedState=null)}var h=ed(o);if(h!==null){h.flags&=-257,td(h,o,a,s,e),h.mode&1&&Zc(s,u,e),e=h,l=u;var m=e.updateQueue;if(m===null){var p=new Set;p.add(l),e.updateQueue=p}else m.add(l);break e}else{if(!(e&1)){Zc(s,u,e),Nu();break e}l=Error(U(426))}}else if(he&&a.mode&1){var x=ed(o);if(x!==null){!(x.flags&65536)&&(x.flags|=256),td(x,o,a,s,e),hu(Rr(l,a));break e}}s=l=Rr(l,a),Ae!==4&&(Ae=2),ni===null?ni=[s]:ni.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var y=dm(s,l,e);Wc(s,y);break e;case 1:a=l;var v=s.type,S=s.stateNode;if(!(s.flags&128)&&(typeof v.getDerivedStateFromError=="function"||S!==null&&typeof S.componentDidCatch=="function"&&(yn===null||!yn.has(S)))){s.flags|=65536,e&=-e,s.lanes|=e;var L=fm(s,a,e);Wc(s,L);break e}}s=s.return}while(s!==null)}Dm(t)}catch(T){e=T,Se===t&&t!==null&&(Se=t=t.return);continue}break}while(1)}function km(){var n=Zs.current;return Zs.current=Js,n===null?Js:n}function Nu(){(Ae===0||Ae===3||Ae===2)&&(Ae=4),be===null||!(Vn&268435455)&&!(Co&268435455)||un(be,Fe)}function no(n,e){var t=ne;ne|=2;var r=km();(be!==n||Fe!==e)&&(jt=null,On(n,e));do try{Ly();break}catch(i){Im(n,i)}while(1);if(gu(),ne=t,Zs.current=r,Se!==null)throw Error(U(261));return be=null,Fe=0,Ae}function Ly(){for(;Se!==null;)bm(Se)}function Ry(){for(;Se!==null&&!qg();)bm(Se)}function bm(n){var e=Nm(n.alternate,n,Ze);n.memoizedProps=n.pendingProps,e===null?Dm(n):Se=e,Iu.current=null}function Dm(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=yy(t,e),t!==null){t.flags&=32767,Se=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{Ae=6,Se=null;return}}else if(t=py(t,e,Ze),t!==null){Se=t;return}if(e=e.sibling,e!==null){Se=e;return}Se=e=n}while(e!==null);Ae===0&&(Ae=5)}function In(n,e,t){var r=oe,i=ct.transition;try{ct.transition=null,oe=1,Ay(n,e,t,r)}finally{ct.transition=i,oe=r}return null}function Ay(n,e,t,r){do yr();while(dn!==null);if(ne&6)throw Error(U(327));t=n.finishedWork;var i=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(U(177));n.callbackNode=null,n.callbackPriority=0;var s=t.lanes|t.childLanes;if(sp(n,s),n===be&&(Se=be=null,Fe=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||Xi||(Xi=!0,Pm(Ms,function(){return yr(),null})),s=(t.flags&15990)!==0,t.subtreeFlags&15990||s){s=ct.transition,ct.transition=null;var o=oe;oe=1;var a=ne;ne|=4,Iu.current=null,vy(n,t),Am(t,n),Hp(il),Bs=!!rl,il=rl=null,n.current=t,Ey(t),Xg(),ne=a,oe=o,ct.transition=s}else n.current=t;if(Xi&&(Xi=!1,dn=n,to=i),s=n.pendingLanes,s===0&&(yn=null),Zg(t.stateNode),Je(n,Ee()),e!==null)for(r=n.onRecoverableError,t=0;t<e.length;t++)i=e[t],r(i.value,{componentStack:i.stack,digest:i.digest});if(eo)throw eo=!1,n=Rl,Rl=null,n;return to&1&&n.tag!==0&&yr(),s=n.pendingLanes,s&1?n===Al?ri++:(ri=0,Al=n):ri=0,An(),null}function yr(){if(dn!==null){var n=dh(to),e=ct.transition,t=oe;try{if(ct.transition=null,oe=16>n?16:n,dn===null)var r=!1;else{if(n=dn,dn=null,to=0,ne&6)throw Error(U(331));var i=ne;for(ne|=4,j=n.current;j!==null;){var s=j,o=s.child;if(j.flags&16){var a=s.deletions;if(a!==null){for(var l=0;l<a.length;l++){var u=a[l];for(j=u;j!==null;){var c=j;switch(c.tag){case 0:case 11:case 15:ti(8,c,s)}var d=c.child;if(d!==null)d.return=c,j=d;else for(;j!==null;){c=j;var f=c.sibling,h=c.return;if(Tm(c),c===u){j=null;break}if(f!==null){f.return=h,j=f;break}j=h}}}var m=s.alternate;if(m!==null){var p=m.child;if(p!==null){m.child=null;do{var x=p.sibling;p.sibling=null,p=x}while(p!==null)}}j=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,j=o;else e:for(;j!==null;){if(s=j,s.flags&2048)switch(s.tag){case 0:case 11:case 15:ti(9,s,s.return)}var y=s.sibling;if(y!==null){y.return=s.return,j=y;break e}j=s.return}}var v=n.current;for(j=v;j!==null;){o=j;var S=o.child;if(o.subtreeFlags&2064&&S!==null)S.return=o,j=S;else e:for(o=v;j!==null;){if(a=j,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:wo(9,a)}}catch(T){ve(a,a.return,T)}if(a===o){j=null;break e}var L=a.sibling;if(L!==null){L.return=a.return,j=L;break e}j=a.return}}if(ne=i,An(),_t&&typeof _t.onPostCommitFiberRoot=="function")try{_t.onPostCommitFiberRoot(xo,n)}catch{}r=!0}return r}finally{oe=t,ct.transition=e}}return!1}function md(n,e,t){e=Rr(t,e),e=dm(n,e,1),n=pn(n,e,1),e=Ve(),n!==null&&(Ii(n,1,e),Je(n,e))}function ve(n,e,t){if(n.tag===3)md(n,n,t);else for(;e!==null;){if(e.tag===3){md(e,n,t);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(yn===null||!yn.has(r))){n=Rr(t,n),n=fm(e,n,1),e=pn(e,n,1),n=Ve(),e!==null&&(Ii(e,1,n),Je(e,n));break}}e=e.return}}function wy(n,e,t){var r=n.pingCache;r!==null&&r.delete(e),e=Ve(),n.pingedLanes|=n.suspendedLanes&t,be===n&&(Fe&t)===t&&(Ae===4||Ae===3&&(Fe&130023424)===Fe&&500>Ee()-bu?On(n,0):ku|=t),Je(n,e)}function _m(n,e){e===0&&(n.mode&1?(e=$i,$i<<=1,!($i&130023424)&&($i=4194304)):e=1);var t=Ve();n=Jt(n,e),n!==null&&(Ii(n,e,t),Je(n,t))}function Cy(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),_m(n,t)}function Iy(n,e){var t=0;switch(n.tag){case 13:var r=n.stateNode,i=n.memoizedState;i!==null&&(t=i.retryLane);break;case 19:r=n.stateNode;break;default:throw Error(U(314))}r!==null&&r.delete(e),_m(n,t)}var Nm;Nm=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||Xe.current)qe=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return qe=!1,gy(n,e,t);qe=!!(n.flags&131072)}else qe=!1,he&&e.flags&1048576&&Mh(e,zs,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Es(n,e),n=e.pendingProps;var i=Er(e,je.current);pr(e,t),i=Lu(null,e,r,n,i,t);var s=Ru();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Qe(r)?(s=!0,Ks(e)):s=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,xu(e),i.updater=Ao,e.stateNode=i,i._reactInternals=e,hl(e,r,n,t),e=pl(null,e,r,!0,s,t)):(e.tag=0,he&&s&&du(e),Ge(null,e,i,t),e=e.child),e;case 16:r=e.elementType;e:{switch(Es(n,e),n=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=by(r),n=yt(r,n),i){case 0:e=gl(null,e,r,n,t);break e;case 1:e=id(null,e,r,n,t);break e;case 11:e=nd(null,e,r,n,t);break e;case 14:e=rd(null,e,r,yt(r.type,n),t);break e}throw Error(U(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:yt(r,i),gl(n,e,r,i,t);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:yt(r,i),id(n,e,r,i,t);case 3:e:{if(pm(e),n===null)throw Error(U(387));r=e.pendingProps,s=e.memoizedState,i=s.element,Vh(n,e),qs(e,r,null,t);var o=e.memoizedState;if(r=o.element,s.isDehydrated)if(s={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){i=Rr(Error(U(423)),e),e=sd(n,e,r,t,i);break e}else if(r!==i){i=Rr(Error(U(424)),e),e=sd(n,e,r,t,i);break e}else for(et=gn(e.stateNode.containerInfo.firstChild),tt=e,he=!0,vt=null,t=jh(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(Sr(),r===i){e=Zt(n,e,t);break e}Ge(n,e,r,t)}e=e.child}return e;case 5:return Kh(e),n===null&&cl(e),r=e.type,i=e.pendingProps,s=n!==null?n.memoizedProps:null,o=i.children,sl(r,i)?o=null:s!==null&&sl(r,s)&&(e.flags|=32),gm(n,e),Ge(n,e,o,t),e.child;case 6:return n===null&&cl(e),null;case 13:return ym(n,e,t);case 4:return vu(e,e.stateNode.containerInfo),r=e.pendingProps,n===null?e.child=Tr(e,null,r,t):Ge(n,e,r,t),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:yt(r,i),nd(n,e,r,i,t);case 7:return Ge(n,e,e.pendingProps,t),e.child;case 8:return Ge(n,e,e.pendingProps.children,t),e.child;case 12:return Ge(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,s=e.memoizedProps,o=i.value,ce(Ws,r._currentValue),r._currentValue=o,s!==null)if(Lt(s.value,o)){if(s.children===i.children&&!Xe.current){e=Zt(n,e,t);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var l=a.firstContext;l!==null;){if(l.context===r){if(s.tag===1){l=Yt(-1,t&-t),l.tag=2;var u=s.updateQueue;if(u!==null){u=u.shared;var c=u.pending;c===null?l.next=l:(l.next=c.next,c.next=l),u.pending=l}}s.lanes|=t,l=s.alternate,l!==null&&(l.lanes|=t),dl(s.return,t,e),a.lanes|=t;break}l=l.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(U(341));o.lanes|=t,a=o.alternate,a!==null&&(a.lanes|=t),dl(o,t,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}Ge(n,e,i.children,t),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,pr(e,t),i=dt(i),r=r(i),e.flags|=1,Ge(n,e,r,t),e.child;case 14:return r=e.type,i=yt(r,e.pendingProps),i=yt(r.type,i),rd(n,e,r,i,t);case 15:return hm(n,e,e.type,e.pendingProps,t);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:yt(r,i),Es(n,e),e.tag=1,Qe(r)?(n=!0,Ks(e)):n=!1,pr(e,t),cm(e,r,i),hl(e,r,i,t),pl(null,e,r,!0,n,t);case 19:return xm(n,e,t);case 22:return mm(n,e,t)}throw Error(U(156,e.tag))};function Pm(n,e){return ah(n,e)}function ky(n,e,t,r){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ut(n,e,t,r){return new ky(n,e,t,r)}function Pu(n){return n=n.prototype,!(!n||!n.isReactComponent)}function by(n){if(typeof n=="function")return Pu(n)?1:0;if(n!=null){if(n=n.$$typeof,n===Zl)return 11;if(n===eu)return 14}return 2}function vn(n,e){var t=n.alternate;return t===null?(t=ut(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function Ls(n,e,t,r,i,s){var o=2;if(r=n,typeof n=="function")Pu(n)&&(o=1);else if(typeof n=="string")o=5;else e:switch(n){case er:return Mn(t.children,i,s,e);case Jl:o=8,i|=8;break;case Ma:return n=ut(12,t,e,i|2),n.elementType=Ma,n.lanes=s,n;case Ua:return n=ut(13,t,e,i),n.elementType=Ua,n.lanes=s,n;case Ba:return n=ut(19,t,e,i),n.elementType=Ba,n.lanes=s,n;case Kf:return Io(t,i,s,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case Gf:o=10;break e;case Vf:o=9;break e;case Zl:o=11;break e;case eu:o=14;break e;case sn:o=16,r=null;break e}throw Error(U(130,n==null?n:typeof n,""))}return e=ut(o,t,e,i),e.elementType=n,e.type=r,e.lanes=s,e}function Mn(n,e,t,r){return n=ut(7,n,r,e),n.lanes=t,n}function Io(n,e,t,r){return n=ut(22,n,r,e),n.elementType=Kf,n.lanes=t,n.stateNode={isHidden:!1},n}function la(n,e,t){return n=ut(6,n,null,e),n.lanes=t,n}function ua(n,e,t){return e=ut(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function Dy(n,e,t,r,i){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Vo(0),this.expirationTimes=Vo(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Vo(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function Fu(n,e,t,r,i,s,o,a,l){return n=new Dy(n,e,t,a,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=ut(3,null,null,e),n.current=s,s.stateNode=n,s.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},xu(s),n}function _y(n,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Zn,key:r==null?null:""+r,children:n,containerInfo:e,implementation:t}}function Fm(n){if(!n)return Sn;n=n._reactInternals;e:{if(Wn(n)!==n||n.tag!==1)throw Error(U(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Qe(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(U(171))}if(n.tag===1){var t=n.type;if(Qe(t))return Fh(n,t,e)}return e}function Om(n,e,t,r,i,s,o,a,l){return n=Fu(t,r,!0,n,i,s,o,a,l),n.context=Fm(null),t=n.current,r=Ve(),i=xn(t),s=Yt(r,i),s.callback=e??null,pn(t,s,i),n.current.lanes=i,Ii(n,i,r),Je(n,r),n}function ko(n,e,t,r){var i=e.current,s=Ve(),o=xn(i);return t=Fm(t),e.context===null?e.context=t:e.pendingContext=t,e=Yt(s,o),e.payload={element:n},r=r===void 0?null:r,r!==null&&(e.callback=r),n=pn(i,e,o),n!==null&&(Tt(n,i,o,s),ys(n,i,o)),o}function ro(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function gd(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function Ou(n,e){gd(n,e),(n=n.alternate)&&gd(n,e)}function Ny(){return null}var Mm=typeof reportError=="function"?reportError:function(n){console.error(n)};function Mu(n){this._internalRoot=n}bo.prototype.render=Mu.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(U(409));ko(n,e,null,null)};bo.prototype.unmount=Mu.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;Kn(function(){ko(null,n,null,null)}),e[Qt]=null}};function bo(n){this._internalRoot=n}bo.prototype.unstable_scheduleHydration=function(n){if(n){var e=mh();n={blockedOn:null,target:n,priority:e};for(var t=0;t<ln.length&&e!==0&&e<ln[t].priority;t++);ln.splice(t,0,n),t===0&&ph(n)}};function Uu(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function Do(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function pd(){}function Py(n,e,t,r,i){if(i){if(typeof r=="function"){var s=r;r=function(){var u=ro(o);s.call(u)}}var o=Om(e,r,n,0,null,!1,!1,"",pd);return n._reactRootContainer=o,n[Qt]=o.current,hi(n.nodeType===8?n.parentNode:n),Kn(),o}for(;i=n.lastChild;)n.removeChild(i);if(typeof r=="function"){var a=r;r=function(){var u=ro(l);a.call(u)}}var l=Fu(n,0,!1,null,null,!1,!1,"",pd);return n._reactRootContainer=l,n[Qt]=l.current,hi(n.nodeType===8?n.parentNode:n),Kn(function(){ko(e,l,t,r)}),l}function _o(n,e,t,r,i){var s=t._reactRootContainer;if(s){var o=s;if(typeof i=="function"){var a=i;i=function(){var l=ro(o);a.call(l)}}ko(e,o,n,i)}else o=Py(t,e,n,i,r);return ro(o)}fh=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=Wr(e.pendingLanes);t!==0&&(ru(e,t|1),Je(e,Ee()),!(ne&6)&&(Ar=Ee()+500,An()))}break;case 13:Kn(function(){var r=Jt(n,1);if(r!==null){var i=Ve();Tt(r,n,1,i)}}),Ou(n,1)}};iu=function(n){if(n.tag===13){var e=Jt(n,134217728);if(e!==null){var t=Ve();Tt(e,n,134217728,t)}Ou(n,134217728)}};hh=function(n){if(n.tag===13){var e=xn(n),t=Jt(n,e);if(t!==null){var r=Ve();Tt(t,n,e,r)}Ou(n,e)}};mh=function(){return oe};gh=function(n,e){var t=oe;try{return oe=n,e()}finally{oe=t}};qa=function(n,e,t){switch(e){case"input":if(Ga(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==n&&r.form===n.form){var i=To(r);if(!i)throw Error(U(90));zf(r),Ga(r,i)}}}break;case"textarea":Yf(n,t);break;case"select":e=t.value,e!=null&&fr(n,!!t.multiple,e,!1)}};th=Du;nh=Kn;var Fy={usingClientEntryPoint:!1,Events:[bi,ir,To,Zf,eh,Du]},Gr={findFiberByHostInstance:_n,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Oy={bundleType:Gr.bundleType,version:Gr.version,rendererPackageName:Gr.rendererPackageName,rendererConfig:Gr.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:en.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=sh(n),n===null?null:n.stateNode},findFiberByHostInstance:Gr.findFiberByHostInstance||Ny,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Qi=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Qi.isDisabled&&Qi.supportsFiber)try{xo=Qi.inject(Oy),_t=Qi}catch{}}rt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Fy;rt.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Uu(e))throw Error(U(200));return _y(n,e,null,t)};rt.createRoot=function(n,e){if(!Uu(n))throw Error(U(299));var t=!1,r="",i=Mm;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=Fu(n,1,!1,null,null,t,!1,r,i),n[Qt]=e.current,hi(n.nodeType===8?n.parentNode:n),new Mu(e)};rt.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(U(188)):(n=Object.keys(n).join(","),Error(U(268,n)));return n=sh(e),n=n===null?null:n.stateNode,n};rt.flushSync=function(n){return Kn(n)};rt.hydrate=function(n,e,t){if(!Do(e))throw Error(U(200));return _o(null,n,e,!0,t)};rt.hydrateRoot=function(n,e,t){if(!Uu(n))throw Error(U(405));var r=t!=null&&t.hydratedSources||null,i=!1,s="",o=Mm;if(t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=Om(e,null,n,1,t??null,i,!1,s,o),n[Qt]=e.current,hi(n),r)for(n=0;n<r.length;n++)t=r[n],i=t._getVersion,i=i(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,i]:e.mutableSourceEagerHydrationData.push(t,i);return new bo(e)};rt.render=function(n,e,t){if(!Do(e))throw Error(U(200));return _o(null,n,e,!1,t)};rt.unmountComponentAtNode=function(n){if(!Do(n))throw Error(U(40));return n._reactRootContainer?(Kn(function(){_o(null,null,n,!1,function(){n._reactRootContainer=null,n[Qt]=null})}),!0):!1};rt.unstable_batchedUpdates=Du;rt.unstable_renderSubtreeIntoContainer=function(n,e,t,r){if(!Do(t))throw Error(U(200));if(n==null||n._reactInternals===void 0)throw Error(U(38));return _o(n,e,t,!1,r)};rt.version="18.3.1-next-f1338f8080-20240426";function Um(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Um)}catch(n){console.error(n)}}Um(),Uf.exports=rt;var My=Uf.exports,yd=My;Fa.createRoot=yd.createRoot,Fa.hydrateRoot=yd.hydrateRoot;const Uy="modulepreload",By=function(n){return"/"+n},xd={},$y=function(e,t,r){if(!t||t.length===0)return e();const i=document.getElementsByTagName("link");return Promise.all(t.map(s=>{if(s=By(s),s in xd)return;xd[s]=!0;const o=s.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let c=i.length-1;c>=0;c--){const d=i[c];if(d.href===s&&(!o||d.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${a}`))return;const u=document.createElement("link");if(u.rel=o?"stylesheet":Uy,o||(u.as="script",u.crossOrigin=""),u.href=s,document.head.appendChild(u),o)return new Promise((c,d)=>{u.addEventListener("load",c),u.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>e()).catch(s=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=s,window.dispatchEvent(o),!o.defaultPrevented)throw s})};var Bu={};Object.defineProperty(Bu,"__esModule",{value:!0});Bu.parse=Wy;Bu.serialize=Yy;const jy=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,Gy=/^[\u0021-\u003A\u003C-\u007E]*$/,Vy=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,Ky=/^[\u0020-\u003A\u003D-\u007E]*$/,Hy=Object.prototype.toString,zy=(()=>{const n=function(){};return n.prototype=Object.create(null),n})();function Wy(n,e){const t=new zy,r=n.length;if(r<2)return t;const i=(e==null?void 0:e.decode)||qy;let s=0;do{const o=n.indexOf("=",s);if(o===-1)break;const a=n.indexOf(";",s),l=a===-1?r:a;if(o>l){s=n.lastIndexOf(";",o-1)+1;continue}const u=vd(n,s,o),c=Ed(n,o,u),d=n.slice(u,c);if(t[d]===void 0){let f=vd(n,o+1,l),h=Ed(n,l,f);const m=i(n.slice(f,h));t[d]=m}s=l+1}while(s<r);return t}function vd(n,e,t){do{const r=n.charCodeAt(e);if(r!==32&&r!==9)return e}while(++e<t);return t}function Ed(n,e,t){for(;e>t;){const r=n.charCodeAt(--e);if(r!==32&&r!==9)return e+1}return t}function Yy(n,e,t){const r=(t==null?void 0:t.encode)||encodeURIComponent;if(!jy.test(n))throw new TypeError(`argument name is invalid: ${n}`);const i=r(e);if(!Gy.test(i))throw new TypeError(`argument val is invalid: ${e}`);let s=n+"="+i;if(!t)return s;if(t.maxAge!==void 0){if(!Number.isInteger(t.maxAge))throw new TypeError(`option maxAge is invalid: ${t.maxAge}`);s+="; Max-Age="+t.maxAge}if(t.domain){if(!Vy.test(t.domain))throw new TypeError(`option domain is invalid: ${t.domain}`);s+="; Domain="+t.domain}if(t.path){if(!Ky.test(t.path))throw new TypeError(`option path is invalid: ${t.path}`);s+="; Path="+t.path}if(t.expires){if(!Xy(t.expires)||!Number.isFinite(t.expires.valueOf()))throw new TypeError(`option expires is invalid: ${t.expires}`);s+="; Expires="+t.expires.toUTCString()}if(t.httpOnly&&(s+="; HttpOnly"),t.secure&&(s+="; Secure"),t.partitioned&&(s+="; Partitioned"),t.priority)switch(typeof t.priority=="string"?t.priority.toLowerCase():void 0){case"low":s+="; Priority=Low";break;case"medium":s+="; Priority=Medium";break;case"high":s+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${t.priority}`)}if(t.sameSite)switch(typeof t.sameSite=="string"?t.sameSite.toLowerCase():t.sameSite){case!0:case"strict":s+="; SameSite=Strict";break;case"lax":s+="; SameSite=Lax";break;case"none":s+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${t.sameSite}`)}return s}function qy(n){if(n.indexOf("%")===-1)return n;try{return decodeURIComponent(n)}catch{return n}}function Xy(n){return Hy.call(n)==="[object Date]"}var Sd="popstate";function Qy(n={}){function e(r,i){let{pathname:s,search:o,hash:a}=r.location;return Il("",{pathname:s,search:o,hash:a},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function t(r,i){return typeof i=="string"?i:Ti(i)}return Zy(e,t,null,n)}function ye(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function Ft(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function Jy(){return Math.random().toString(36).substring(2,10)}function Td(n,e){return{usr:n.state,key:n.key,idx:e}}function Il(n,e,t=null,r){return{pathname:typeof n=="string"?n:n.pathname,search:"",hash:"",...typeof e=="string"?_r(e):e,state:t,key:e&&e.key||r||Jy()}}function Ti({pathname:n="/",search:e="",hash:t=""}){return e&&e!=="?"&&(n+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(n+=t.charAt(0)==="#"?t:"#"+t),n}function _r(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substring(t),n=n.substring(0,t));let r=n.indexOf("?");r>=0&&(e.search=n.substring(r),n=n.substring(0,r)),n&&(e.pathname=n)}return e}function Zy(n,e,t,r={}){let{window:i=document.defaultView,v5Compat:s=!1}=r,o=i.history,a="POP",l=null,u=c();u==null&&(u=0,o.replaceState({...o.state,idx:u},""));function c(){return(o.state||{idx:null}).idx}function d(){a="POP";let x=c(),y=x==null?null:x-u;u=x,l&&l({action:a,location:p.location,delta:y})}function f(x,y){a="PUSH";let v=Il(p.location,x,y);t&&t(v,x),u=c()+1;let S=Td(v,u),L=p.createHref(v);try{o.pushState(S,"",L)}catch(T){if(T instanceof DOMException&&T.name==="DataCloneError")throw T;i.location.assign(L)}s&&l&&l({action:a,location:p.location,delta:1})}function h(x,y){a="REPLACE";let v=Il(p.location,x,y);t&&t(v,x),u=c();let S=Td(v,u),L=p.createHref(v);o.replaceState(S,"",L),s&&l&&l({action:a,location:p.location,delta:0})}function m(x){let y=i.location.origin!=="null"?i.location.origin:i.location.href,v=typeof x=="string"?x:Ti(x);return v=v.replace(/ $/,"%20"),ye(y,`No window.location.(origin|href) available to create URL for href: ${v}`),new URL(v,y)}let p={get action(){return a},get location(){return n(i,o)},listen(x){if(l)throw new Error("A history only accepts one active listener");return i.addEventListener(Sd,d),l=x,()=>{i.removeEventListener(Sd,d),l=null}},createHref(x){return e(i,x)},createURL:m,encodeLocation(x){let y=m(x);return{pathname:y.pathname,search:y.search,hash:y.hash}},push:f,replace:h,go(x){return o.go(x)}};return p}function Bm(n,e,t="/"){return ex(n,e,t,!1)}function ex(n,e,t,r){let i=typeof e=="string"?_r(e):e,s=Tn(i.pathname||"/",t);if(s==null)return null;let o=$m(n);tx(o);let a=null;for(let l=0;a==null&&l<o.length;++l){let u=fx(s);a=cx(o[l],u,r)}return a}function $m(n,e=[],t=[],r=""){let i=(s,o,a)=>{let l={relativePath:a===void 0?s.path||"":a,caseSensitive:s.caseSensitive===!0,childrenIndex:o,route:s};l.relativePath.startsWith("/")&&(ye(l.relativePath.startsWith(r),`Absolute route path "${l.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),l.relativePath=l.relativePath.slice(r.length));let u=qt([r,l.relativePath]),c=t.concat(l);s.children&&s.children.length>0&&(ye(s.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${u}".`),$m(s.children,e,c,u)),!(s.path==null&&!s.index)&&e.push({path:u,score:lx(u,s.index),routesMeta:c})};return n.forEach((s,o)=>{var a;if(s.path===""||!((a=s.path)!=null&&a.includes("?")))i(s,o);else for(let l of jm(s.path))i(s,o,l)}),e}function jm(n){let e=n.split("/");if(e.length===0)return[];let[t,...r]=e,i=t.endsWith("?"),s=t.replace(/\?$/,"");if(r.length===0)return i?[s,""]:[s];let o=jm(r.join("/")),a=[];return a.push(...o.map(l=>l===""?s:[s,l].join("/"))),i&&a.push(...o),a.map(l=>n.startsWith("/")&&l===""?"/":l)}function tx(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:ux(e.routesMeta.map(r=>r.childrenIndex),t.routesMeta.map(r=>r.childrenIndex)))}var nx=/^:[\w-]+$/,rx=3,ix=2,sx=1,ox=10,ax=-2,Ld=n=>n==="*";function lx(n,e){let t=n.split("/"),r=t.length;return t.some(Ld)&&(r+=ax),e&&(r+=ix),t.filter(i=>!Ld(i)).reduce((i,s)=>i+(nx.test(s)?rx:s===""?sx:ox),r)}function ux(n,e){return n.length===e.length&&n.slice(0,-1).every((r,i)=>r===e[i])?n[n.length-1]-e[e.length-1]:0}function cx(n,e,t=!1){let{routesMeta:r}=n,i={},s="/",o=[];for(let a=0;a<r.length;++a){let l=r[a],u=a===r.length-1,c=s==="/"?e:e.slice(s.length)||"/",d=io({path:l.relativePath,caseSensitive:l.caseSensitive,end:u},c),f=l.route;if(!d&&u&&t&&!r[r.length-1].route.index&&(d=io({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},c)),!d)return null;Object.assign(i,d.params),o.push({params:i,pathname:qt([s,d.pathname]),pathnameBase:px(qt([s,d.pathnameBase])),route:f}),d.pathnameBase!=="/"&&(s=qt([s,d.pathnameBase]))}return o}function io(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,r]=dx(n.path,n.caseSensitive,n.end),i=e.match(t);if(!i)return null;let s=i[0],o=s.replace(/(.)\/+$/,"$1"),a=i.slice(1);return{params:r.reduce((u,{paramName:c,isOptional:d},f)=>{if(c==="*"){let m=a[f]||"";o=s.slice(0,s.length-m.length).replace(/(.)\/+$/,"$1")}const h=a[f];return d&&!h?u[c]=void 0:u[c]=(h||"").replace(/%2F/g,"/"),u},{}),pathname:s,pathnameBase:o,pattern:n}}function dx(n,e=!1,t=!0){Ft(n==="*"||!n.endsWith("*")||n.endsWith("/*"),`Route path "${n}" will be treated as if it were "${n.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${n.replace(/\*$/,"/*")}".`);let r=[],i="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,a,l)=>(r.push({paramName:a,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(r.push({paramName:"*"}),i+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?i+="\\/*$":n!==""&&n!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),r]}function fx(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Ft(!1,`The URL path "${n}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),n}}function Tn(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,r=n.charAt(t);return r&&r!=="/"?null:n.slice(t)||"/"}function hx(n,e="/"){let{pathname:t,search:r="",hash:i=""}=typeof n=="string"?_r(n):n;return{pathname:t?t.startsWith("/")?t:mx(t,e):e,search:yx(r),hash:xx(i)}}function mx(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(i=>{i===".."?t.length>1&&t.pop():i!=="."&&t.push(i)}),t.length>1?t.join("/"):"/"}function ca(n,e,t,r){return`Cannot include a '${n}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function gx(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function Gm(n){let e=gx(n);return e.map((t,r)=>r===e.length-1?t.pathname:t.pathnameBase)}function Vm(n,e,t,r=!1){let i;typeof n=="string"?i=_r(n):(i={...n},ye(!i.pathname||!i.pathname.includes("?"),ca("?","pathname","search",i)),ye(!i.pathname||!i.pathname.includes("#"),ca("#","pathname","hash",i)),ye(!i.search||!i.search.includes("#"),ca("#","search","hash",i)));let s=n===""||i.pathname==="",o=s?"/":i.pathname,a;if(o==null)a=t;else{let d=e.length-1;if(!r&&o.startsWith("..")){let f=o.split("/");for(;f[0]==="..";)f.shift(),d-=1;i.pathname=f.join("/")}a=d>=0?e[d]:"/"}let l=hx(i,a),u=o&&o!=="/"&&o.endsWith("/"),c=(s||o===".")&&t.endsWith("/");return!l.pathname.endsWith("/")&&(u||c)&&(l.pathname+="/"),l}var qt=n=>n.join("/").replace(/\/\/+/g,"/"),px=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),yx=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,xx=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function vx(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}var Km=["POST","PUT","PATCH","DELETE"];new Set(Km);var Ex=["GET",...Km];new Set(Ex);var Nr=D.createContext(null);Nr.displayName="DataRouter";var No=D.createContext(null);No.displayName="DataRouterState";var Hm=D.createContext({isTransitioning:!1});Hm.displayName="ViewTransition";var Sx=D.createContext(new Map);Sx.displayName="Fetchers";var Tx=D.createContext(null);Tx.displayName="Await";var Mt=D.createContext(null);Mt.displayName="Navigation";var _i=D.createContext(null);_i.displayName="Location";var tn=D.createContext({outlet:null,matches:[],isDataRoute:!1});tn.displayName="Route";var $u=D.createContext(null);$u.displayName="RouteError";function Lx(n,{relative:e}={}){ye(Ni(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:r}=D.useContext(Mt),{hash:i,pathname:s,search:o}=Pi(n,{relative:e}),a=s;return t!=="/"&&(a=s==="/"?t:qt([t,s])),r.createHref({pathname:a,search:o,hash:i})}function Ni(){return D.useContext(_i)!=null}function Ut(){return ye(Ni(),"useLocation() may be used only in the context of a <Router> component."),D.useContext(_i).location}var zm="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function Wm(n){D.useContext(Mt).static||D.useLayoutEffect(n)}function Ym(){let{isDataRoute:n}=D.useContext(tn);return n?Ox():Rx()}function Rx(){ye(Ni(),"useNavigate() may be used only in the context of a <Router> component.");let n=D.useContext(Nr),{basename:e,navigator:t}=D.useContext(Mt),{matches:r}=D.useContext(tn),{pathname:i}=Ut(),s=JSON.stringify(Gm(r)),o=D.useRef(!1);return Wm(()=>{o.current=!0}),D.useCallback((l,u={})=>{if(Ft(o.current,zm),!o.current)return;if(typeof l=="number"){t.go(l);return}let c=Vm(l,JSON.parse(s),i,u.relative==="path");n==null&&e!=="/"&&(c.pathname=c.pathname==="/"?e:qt([e,c.pathname])),(u.replace?t.replace:t.push)(c,u.state,u)},[e,t,s,i,n])}D.createContext(null);function Pi(n,{relative:e}={}){let{matches:t}=D.useContext(tn),{pathname:r}=Ut(),i=JSON.stringify(Gm(t));return D.useMemo(()=>Vm(n,JSON.parse(i),r,e==="path"),[n,i,r,e])}function Ax(n,e){return qm(n,e)}function qm(n,e,t,r){var y;ye(Ni(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:i}=D.useContext(Mt),{matches:s}=D.useContext(tn),o=s[s.length-1],a=o?o.params:{},l=o?o.pathname:"/",u=o?o.pathnameBase:"/",c=o&&o.route;{let v=c&&c.path||"";Xm(l,!c||v.endsWith("*")||v.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${l}" (under <Route path="${v}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${v}"> to <Route path="${v==="/"?"*":`${v}/*`}">.`)}let d=Ut(),f;if(e){let v=typeof e=="string"?_r(e):e;ye(u==="/"||((y=v.pathname)==null?void 0:y.startsWith(u)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${u}" but pathname "${v.pathname}" was given in the \`location\` prop.`),f=v}else f=d;let h=f.pathname||"/",m=h;if(u!=="/"){let v=u.replace(/^\//,"").split("/");m="/"+h.replace(/^\//,"").split("/").slice(v.length).join("/")}let p=Bm(n,{pathname:m});Ft(c||p!=null,`No routes matched location "${f.pathname}${f.search}${f.hash}" `),Ft(p==null||p[p.length-1].route.element!==void 0||p[p.length-1].route.Component!==void 0||p[p.length-1].route.lazy!==void 0,`Matched leaf route at location "${f.pathname}${f.search}${f.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let x=bx(p&&p.map(v=>Object.assign({},v,{params:Object.assign({},a,v.params),pathname:qt([u,i.encodeLocation?i.encodeLocation(v.pathname).pathname:v.pathname]),pathnameBase:v.pathnameBase==="/"?u:qt([u,i.encodeLocation?i.encodeLocation(v.pathnameBase).pathname:v.pathnameBase])})),s,t,r);return e&&x?D.createElement(_i.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...f},navigationType:"POP"}},x):x}function wx(){let n=Fx(),e=vx(n)?`${n.status} ${n.statusText}`:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,r="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:r},s={padding:"2px 4px",backgroundColor:r},o=null;return console.error("Error handled by React Router default ErrorBoundary:",n),o=D.createElement(D.Fragment,null,D.createElement("p",null,"💿 Hey developer 👋"),D.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",D.createElement("code",{style:s},"ErrorBoundary")," or"," ",D.createElement("code",{style:s},"errorElement")," prop on your route.")),D.createElement(D.Fragment,null,D.createElement("h2",null,"Unexpected Application Error!"),D.createElement("h3",{style:{fontStyle:"italic"}},e),t?D.createElement("pre",{style:i},t):null,o)}var Cx=D.createElement(wx,null),Ix=class extends D.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,e){return e.location!==n.location||e.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:e.error,location:e.location,revalidation:n.revalidation||e.revalidation}}componentDidCatch(n,e){console.error("React Router caught the following error during render",n,e)}render(){return this.state.error!==void 0?D.createElement(tn.Provider,{value:this.props.routeContext},D.createElement($u.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function kx({routeContext:n,match:e,children:t}){let r=D.useContext(Nr);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),D.createElement(tn.Provider,{value:n},t)}function bx(n,e=[],t=null,r=null){if(n==null){if(!t)return null;if(t.errors)n=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let i=n,s=t==null?void 0:t.errors;if(s!=null){let l=i.findIndex(u=>u.route.id&&(s==null?void 0:s[u.route.id])!==void 0);ye(l>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(s).join(",")}`),i=i.slice(0,Math.min(i.length,l+1))}let o=!1,a=-1;if(t)for(let l=0;l<i.length;l++){let u=i[l];if((u.route.HydrateFallback||u.route.hydrateFallbackElement)&&(a=l),u.route.id){let{loaderData:c,errors:d}=t,f=u.route.loader&&!c.hasOwnProperty(u.route.id)&&(!d||d[u.route.id]===void 0);if(u.route.lazy||f){o=!0,a>=0?i=i.slice(0,a+1):i=[i[0]];break}}}return i.reduceRight((l,u,c)=>{let d,f=!1,h=null,m=null;t&&(d=s&&u.route.id?s[u.route.id]:void 0,h=u.route.errorElement||Cx,o&&(a<0&&c===0?(Xm("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),f=!0,m=null):a===c&&(f=!0,m=u.route.hydrateFallbackElement||null)));let p=e.concat(i.slice(0,c+1)),x=()=>{let y;return d?y=h:f?y=m:u.route.Component?y=D.createElement(u.route.Component,null):u.route.element?y=u.route.element:y=l,D.createElement(kx,{match:u,routeContext:{outlet:l,matches:p,isDataRoute:t!=null},children:y})};return t&&(u.route.ErrorBoundary||u.route.errorElement||c===0)?D.createElement(Ix,{location:t.location,revalidation:t.revalidation,component:h,error:d,children:x(),routeContext:{outlet:null,matches:p,isDataRoute:!0}}):x()},null)}function ju(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Dx(n){let e=D.useContext(Nr);return ye(e,ju(n)),e}function _x(n){let e=D.useContext(No);return ye(e,ju(n)),e}function Nx(n){let e=D.useContext(tn);return ye(e,ju(n)),e}function Gu(n){let e=Nx(n),t=e.matches[e.matches.length-1];return ye(t.route.id,`${n} can only be used on routes that contain a unique "id"`),t.route.id}function Px(){return Gu("useRouteId")}function Fx(){var r;let n=D.useContext($u),e=_x("useRouteError"),t=Gu("useRouteError");return n!==void 0?n:(r=e.errors)==null?void 0:r[t]}function Ox(){let{router:n}=Dx("useNavigate"),e=Gu("useNavigate"),t=D.useRef(!1);return Wm(()=>{t.current=!0}),D.useCallback(async(i,s={})=>{Ft(t.current,zm),t.current&&(typeof i=="number"?n.navigate(i):await n.navigate(i,{fromRouteId:e,...s}))},[n,e])}var Rd={};function Xm(n,e,t){!e&&!Rd[n]&&(Rd[n]=!0,Ft(!1,t))}D.memo(Mx);function Mx({routes:n,future:e,state:t}){return qm(n,void 0,t,e)}function kn(n){ye(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function Ux({basename:n="/",children:e=null,location:t,navigationType:r="POP",navigator:i,static:s=!1}){ye(!Ni(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let o=n.replace(/^\/*/,"/"),a=D.useMemo(()=>({basename:o,navigator:i,static:s,future:{}}),[o,i,s]);typeof t=="string"&&(t=_r(t));let{pathname:l="/",search:u="",hash:c="",state:d=null,key:f="default"}=t,h=D.useMemo(()=>{let m=Tn(l,o);return m==null?null:{location:{pathname:m,search:u,hash:c,state:d,key:f},navigationType:r}},[o,l,u,c,d,f,r]);return Ft(h!=null,`<Router basename="${o}"> is not able to match the URL "${l}${u}${c}" because it does not start with the basename, so the <Router> won't render anything.`),h==null?null:D.createElement(Mt.Provider,{value:a},D.createElement(_i.Provider,{children:e,value:h}))}function Bx({children:n,location:e}){return Ax(kl(n),e)}function kl(n,e=[]){let t=[];return D.Children.forEach(n,(r,i)=>{if(!D.isValidElement(r))return;let s=[...e,i];if(r.type===D.Fragment){t.push.apply(t,kl(r.props.children,s));return}ye(r.type===kn,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),ye(!r.props.index||!r.props.children,"An index route cannot have child routes.");let o={id:r.props.id||s.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(o.children=kl(r.props.children,s)),t.push(o)}),t}var Rs="get",As="application/x-www-form-urlencoded";function Po(n){return n!=null&&typeof n.tagName=="string"}function $x(n){return Po(n)&&n.tagName.toLowerCase()==="button"}function jx(n){return Po(n)&&n.tagName.toLowerCase()==="form"}function Gx(n){return Po(n)&&n.tagName.toLowerCase()==="input"}function Vx(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function Kx(n,e){return n.button===0&&(!e||e==="_self")&&!Vx(n)}var Ji=null;function Hx(){if(Ji===null)try{new FormData(document.createElement("form"),0),Ji=!1}catch{Ji=!0}return Ji}var zx=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function da(n){return n!=null&&!zx.has(n)?(Ft(!1,`"${n}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${As}"`),null):n}function Wx(n,e){let t,r,i,s,o;if(jx(n)){let a=n.getAttribute("action");r=a?Tn(a,e):null,t=n.getAttribute("method")||Rs,i=da(n.getAttribute("enctype"))||As,s=new FormData(n)}else if($x(n)||Gx(n)&&(n.type==="submit"||n.type==="image")){let a=n.form;if(a==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let l=n.getAttribute("formaction")||a.getAttribute("action");if(r=l?Tn(l,e):null,t=n.getAttribute("formmethod")||a.getAttribute("method")||Rs,i=da(n.getAttribute("formenctype"))||da(a.getAttribute("enctype"))||As,s=new FormData(a,n),!Hx()){let{name:u,type:c,value:d}=n;if(c==="image"){let f=u?`${u}.`:"";s.append(`${f}x`,"0"),s.append(`${f}y`,"0")}else u&&s.append(u,d)}}else{if(Po(n))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=Rs,r=null,i=As,o=n}return s&&i==="text/plain"&&(o=s,s=void 0),{action:r,method:t.toLowerCase(),encType:i,formData:s,body:o}}function Vu(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}async function Yx(n,e){if(n.id in e)return e[n.id];try{let t=await $y(()=>import(n.module),[]);return e[n.id]=t,t}catch(t){return console.error(`Error loading route module \`${n.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function qx(n){return n!=null&&typeof n.page=="string"}function Xx(n){return n==null?!1:n.href==null?n.rel==="preload"&&typeof n.imageSrcSet=="string"&&typeof n.imageSizes=="string":typeof n.rel=="string"&&typeof n.href=="string"}async function Qx(n,e,t){let r=await Promise.all(n.map(async i=>{let s=e.routes[i.route.id];if(s){let o=await Yx(s,t);return o.links?o.links():[]}return[]}));return tv(r.flat(1).filter(Xx).filter(i=>i.rel==="stylesheet"||i.rel==="preload").map(i=>i.rel==="stylesheet"?{...i,rel:"prefetch",as:"style"}:{...i,rel:"prefetch"}))}function Ad(n,e,t,r,i,s){let o=(l,u)=>t[u]?l.route.id!==t[u].route.id:!0,a=(l,u)=>{var c;return t[u].pathname!==l.pathname||((c=t[u].route.path)==null?void 0:c.endsWith("*"))&&t[u].params["*"]!==l.params["*"]};return s==="assets"?e.filter((l,u)=>o(l,u)||a(l,u)):s==="data"?e.filter((l,u)=>{var d;let c=r.routes[l.route.id];if(!c||!c.hasLoader)return!1;if(o(l,u)||a(l,u))return!0;if(l.route.shouldRevalidate){let f=l.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:((d=t[0])==null?void 0:d.params)||{},nextUrl:new URL(n,window.origin),nextParams:l.params,defaultShouldRevalidate:!0});if(typeof f=="boolean")return f}return!0}):[]}function Jx(n,e){return Zx(n.map(t=>{let r=e.routes[t.route.id];if(!r)return[];let i=[r.module];return r.imports&&(i=i.concat(r.imports)),i}).flat(1))}function Zx(n){return[...new Set(n)]}function ev(n){let e={},t=Object.keys(n).sort();for(let r of t)e[r]=n[r];return e}function tv(n,e){let t=new Set,r=new Set(e);return n.reduce((i,s)=>{if(e&&!qx(s)&&s.as==="script"&&s.href&&r.has(s.href))return i;let a=JSON.stringify(ev(s));return t.has(a)||(t.add(a),i.push({key:a,link:s})),i},[])}function nv(n){let e=typeof n=="string"?new URL(n,typeof window>"u"?"server://singlefetch/":window.location.origin):n;return e.pathname==="/"?e.pathname="_root.data":e.pathname=`${e.pathname.replace(/\/$/,"")}.data`,e}function rv(){let n=D.useContext(Nr);return Vu(n,"You must render this element inside a <DataRouterContext.Provider> element"),n}function iv(){let n=D.useContext(No);return Vu(n,"You must render this element inside a <DataRouterStateContext.Provider> element"),n}var Ku=D.createContext(void 0);Ku.displayName="FrameworkContext";function Qm(){let n=D.useContext(Ku);return Vu(n,"You must render this element inside a <HydratedRouter> element"),n}function sv(n,e){let t=D.useContext(Ku),[r,i]=D.useState(!1),[s,o]=D.useState(!1),{onFocus:a,onBlur:l,onMouseEnter:u,onMouseLeave:c,onTouchStart:d}=e,f=D.useRef(null);D.useEffect(()=>{if(n==="render"&&o(!0),n==="viewport"){let p=y=>{y.forEach(v=>{o(v.isIntersecting)})},x=new IntersectionObserver(p,{threshold:.5});return f.current&&x.observe(f.current),()=>{x.disconnect()}}},[n]),D.useEffect(()=>{if(r){let p=setTimeout(()=>{o(!0)},100);return()=>{clearTimeout(p)}}},[r]);let h=()=>{i(!0)},m=()=>{i(!1),o(!1)};return t?n!=="intent"?[s,f,{}]:[s,f,{onFocus:Vr(a,h),onBlur:Vr(l,m),onMouseEnter:Vr(u,h),onMouseLeave:Vr(c,m),onTouchStart:Vr(d,h)}]:[!1,f,{}]}function Vr(n,e){return t=>{n&&n(t),t.defaultPrevented||e(t)}}function ov({page:n,...e}){let{router:t}=rv(),r=D.useMemo(()=>Bm(t.routes,n,t.basename),[t.routes,n,t.basename]);return r?D.createElement(lv,{page:n,matches:r,...e}):null}function av(n){let{manifest:e,routeModules:t}=Qm(),[r,i]=D.useState([]);return D.useEffect(()=>{let s=!1;return Qx(n,e,t).then(o=>{s||i(o)}),()=>{s=!0}},[n,e,t]),r}function lv({page:n,matches:e,...t}){let r=Ut(),{manifest:i,routeModules:s}=Qm(),{loaderData:o,matches:a}=iv(),l=D.useMemo(()=>Ad(n,e,a,i,r,"data"),[n,e,a,i,r]),u=D.useMemo(()=>Ad(n,e,a,i,r,"assets"),[n,e,a,i,r]),c=D.useMemo(()=>{if(n===r.pathname+r.search+r.hash)return[];let h=new Set,m=!1;if(e.forEach(x=>{var v;let y=i.routes[x.route.id];!y||!y.hasLoader||(!l.some(S=>S.route.id===x.route.id)&&x.route.id in o&&((v=s[x.route.id])!=null&&v.shouldRevalidate)||y.hasClientLoader?m=!0:h.add(x.route.id))}),h.size===0)return[];let p=nv(n);return m&&h.size>0&&p.searchParams.set("_routes",e.filter(x=>h.has(x.route.id)).map(x=>x.route.id).join(",")),[p.pathname+p.search]},[o,r,i,l,e,n,s]),d=D.useMemo(()=>Jx(u,i),[u,i]),f=av(u);return D.createElement(D.Fragment,null,c.map(h=>D.createElement("link",{key:h,rel:"prefetch",as:"fetch",href:h,...t})),d.map(h=>D.createElement("link",{key:h,rel:"modulepreload",href:h,...t})),f.map(({key:h,link:m})=>D.createElement("link",{key:h,...m})))}function uv(...n){return e=>{n.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var Jm=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{Jm&&(window.__reactRouterVersion="7.1.3")}catch{}function cv({basename:n,children:e,window:t}){let r=D.useRef();r.current==null&&(r.current=Qy({window:t,v5Compat:!0}));let i=r.current,[s,o]=D.useState({action:i.action,location:i.location}),a=D.useCallback(l=>{D.startTransition(()=>o(l))},[o]);return D.useLayoutEffect(()=>i.listen(a),[i,a]),D.createElement(Ux,{basename:n,children:e,location:s.location,navigationType:s.action,navigator:i})}var Zm=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,ke=D.forwardRef(function({onClick:e,discover:t="render",prefetch:r="none",relative:i,reloadDocument:s,replace:o,state:a,target:l,to:u,preventScrollReset:c,viewTransition:d,...f},h){let{basename:m}=D.useContext(Mt),p=typeof u=="string"&&Zm.test(u),x,y=!1;if(typeof u=="string"&&p&&(x=u,Jm))try{let _=new URL(window.location.href),C=u.startsWith("//")?new URL(_.protocol+u):new URL(u),P=Tn(C.pathname,m);C.origin===_.origin&&P!=null?u=P+C.search+C.hash:y=!0}catch{Ft(!1,`<Link to="${u}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let v=Lx(u,{relative:i}),[S,L,T]=sv(r,f),A=mv(u,{replace:o,state:a,target:l,preventScrollReset:c,relative:i,viewTransition:d});function R(_){e&&e(_),_.defaultPrevented||A(_)}let k=D.createElement("a",{...f,...T,href:x||v,onClick:y||s?e:R,ref:uv(h,L),target:l,"data-discover":!p&&t==="render"?"true":void 0});return S&&!p?D.createElement(D.Fragment,null,k,D.createElement(ov,{page:v})):k});ke.displayName="Link";var dv=D.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:r="",end:i=!1,style:s,to:o,viewTransition:a,children:l,...u},c){let d=Pi(o,{relative:u.relative}),f=Ut(),h=D.useContext(No),{navigator:m,basename:p}=D.useContext(Mt),x=h!=null&&vv(d)&&a===!0,y=m.encodeLocation?m.encodeLocation(d).pathname:d.pathname,v=f.pathname,S=h&&h.navigation&&h.navigation.location?h.navigation.location.pathname:null;t||(v=v.toLowerCase(),S=S?S.toLowerCase():null,y=y.toLowerCase()),S&&p&&(S=Tn(S,p)||S);const L=y!=="/"&&y.endsWith("/")?y.length-1:y.length;let T=v===y||!i&&v.startsWith(y)&&v.charAt(L)==="/",A=S!=null&&(S===y||!i&&S.startsWith(y)&&S.charAt(y.length)==="/"),R={isActive:T,isPending:A,isTransitioning:x},k=T?e:void 0,_;typeof r=="function"?_=r(R):_=[r,T?"active":null,A?"pending":null,x?"transitioning":null].filter(Boolean).join(" ");let C=typeof s=="function"?s(R):s;return D.createElement(ke,{...u,"aria-current":k,className:_,ref:c,style:C,to:o,viewTransition:a},typeof l=="function"?l(R):l)});dv.displayName="NavLink";var fv=D.forwardRef(({discover:n="render",fetcherKey:e,navigate:t,reloadDocument:r,replace:i,state:s,method:o=Rs,action:a,onSubmit:l,relative:u,preventScrollReset:c,viewTransition:d,...f},h)=>{let m=yv(),p=xv(a,{relative:u}),x=o.toLowerCase()==="get"?"get":"post",y=typeof a=="string"&&Zm.test(a),v=S=>{if(l&&l(S),S.defaultPrevented)return;S.preventDefault();let L=S.nativeEvent.submitter,T=(L==null?void 0:L.getAttribute("formmethod"))||o;m(L||S.currentTarget,{fetcherKey:e,method:T,navigate:t,replace:i,state:s,relative:u,preventScrollReset:c,viewTransition:d})};return D.createElement("form",{ref:h,method:x,action:p,onSubmit:r?l:v,...f,"data-discover":!y&&n==="render"?"true":void 0})});fv.displayName="Form";function hv(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function e0(n){let e=D.useContext(Nr);return ye(e,hv(n)),e}function mv(n,{target:e,replace:t,state:r,preventScrollReset:i,relative:s,viewTransition:o}={}){let a=Ym(),l=Ut(),u=Pi(n,{relative:s});return D.useCallback(c=>{if(Kx(c,e)){c.preventDefault();let d=t!==void 0?t:Ti(l)===Ti(u);a(n,{replace:d,state:r,preventScrollReset:i,relative:s,viewTransition:o})}},[l,a,u,t,r,e,n,i,s,o])}var gv=0,pv=()=>`__${String(++gv)}__`;function yv(){let{router:n}=e0("useSubmit"),{basename:e}=D.useContext(Mt),t=Px();return D.useCallback(async(r,i={})=>{let{action:s,method:o,encType:a,formData:l,body:u}=Wx(r,e);if(i.navigate===!1){let c=i.fetcherKey||pv();await n.fetch(c,t,i.action||s,{preventScrollReset:i.preventScrollReset,formData:l,body:u,formMethod:i.method||o,formEncType:i.encType||a,flushSync:i.flushSync})}else await n.navigate(i.action||s,{preventScrollReset:i.preventScrollReset,formData:l,body:u,formMethod:i.method||o,formEncType:i.encType||a,replace:i.replace,state:i.state,fromRouteId:t,flushSync:i.flushSync,viewTransition:i.viewTransition})},[n,e,t])}function xv(n,{relative:e}={}){let{basename:t}=D.useContext(Mt),r=D.useContext(tn);ye(r,"useFormAction must be used inside a RouteContext");let[i]=r.matches.slice(-1),s={...Pi(n||".",{relative:e})},o=Ut();if(n==null){s.search=o.search;let a=new URLSearchParams(s.search),l=a.getAll("index");if(l.some(c=>c==="")){a.delete("index"),l.filter(d=>d).forEach(d=>a.append("index",d));let c=a.toString();s.search=c?`?${c}`:""}}return(!n||n===".")&&i.route.index&&(s.search=s.search?s.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(s.pathname=s.pathname==="/"?t:qt([t,s.pathname])),Ti(s)}function vv(n,e={}){let t=D.useContext(Hm);ye(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=e0("useViewTransitionState"),i=Pi(n,{relative:e.relative});if(!t.isTransitioning)return!1;let s=Tn(t.currentLocation.pathname,r)||t.currentLocation.pathname,o=Tn(t.nextLocation.pathname,r)||t.nextLocation.pathname;return io(i.pathname,o)!=null||io(i.pathname,s)!=null}new TextEncoder;function Ev(){const n=Ym(),e=t=>{t.preventDefault(),n("/monitor")};return g.jsxs("div",{className:"bg-gray-50 min-h-screen flex flex-col",children:[g.jsx("div",{className:"flex-1 flex items-center justify-center px-4 sm:px-6 lg:px-8",children:g.jsxs("div",{className:"max-w-md w-full space-y-8",children:[g.jsxs("div",{className:"text-center",children:[g.jsx("h1",{className:"text-4xl font-bold text-custom mb-2",children:"I See U"}),g.jsx("p",{className:"text-gray-600 text-sm mb-8",children:"CCTV 영상 분석 솔루션"})]}),g.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-sm border border-gray-200",children:[g.jsxs("form",{className:"space-y-6",onSubmit:e,children:[g.jsxs("div",{children:[g.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"아이디"}),g.jsxs("div",{className:"relative",children:[g.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:g.jsx("i",{className:"fas fa-user text-gray-400"})}),g.jsx("input",{id:"email",name:"email",type:"email",required:!0,className:"appearance-none block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-button placeholder-gray-400 focus:outline-none focus:ring-custom focus:border-custom text-sm",placeholder:"이메일 주소를 입력하세요"})]})]}),g.jsxs("div",{children:[g.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"비밀번호"}),g.jsxs("div",{className:"relative",children:[g.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:g.jsx("i",{className:"fas fa-lock text-gray-400"})}),g.jsx("input",{id:"password",name:"password",type:"password",required:!0,className:"appearance-none block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-button placeholder-gray-400 focus:outline-none focus:ring-custom focus:border-custom text-sm",placeholder:"비밀번호를 입력하세요"})]})]}),g.jsx("button",{type:"submit",className:"w-full flex justify-center py-2 px-4 text-sm font-medium rounded-button text-white bg-custom hover:bg-custom/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-custom",children:"로그인"})]}),g.jsxs("div",{className:"mt-6 flex items-center justify-between",children:[g.jsx("a",{href:"#",className:"text-sm text-custom hover:text-custom/90",children:"회원가입"}),g.jsx("a",{href:"#",className:"text-sm text-custom hover:text-custom/90",children:"비밀번호 찾기"})]}),g.jsxs("div",{className:"mt-6 border-t pt-4",children:[g.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"또는 소셜 계정으로 로그인"}),g.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[g.jsx("a",{href:"http://localhost:4000/auth/google",className:"relative inline-block w-[240px] h-[30px] hover:opacity-90",children:g.jsx("img",{src:"/google.png",alt:"Google 로그인",className:"absolute inset-0 w-full h-full object-contain"})}),g.jsx("a",{href:"http://localhost:3000/auth/facebook",className:"relative inline-block w-[240px] h-[30px] hover:opacity-90",children:g.jsx("img",{src:"/facebook.png",alt:"Facebook 로그인",className:"absolute inset-0 w-full h-full object-contain"})}),g.jsx("a",{href:"http://localhost:3000/auth/kakao",className:"relative inline-block w-[240px] h-[30px] hover:opacity-90",children:g.jsx("img",{src:"/kakao.png",alt:"Kakao 로그인",className:"absolute inset-0 w-full h-full object-contain"})}),g.jsx("a",{href:"http://localhost:3000/auth/naver",className:"relative inline-block w-[240px] h-[30px] hover:opacity-90",children:g.jsx("img",{src:"/naver.png",alt:"Naver 로그인",className:"absolute inset-0 w-full h-full object-contain"})})]})]})]})]})}),g.jsxs("footer",{className:"py-4 text-center text-gray-500 text-sm",children:[g.jsx("p",{children:"© 2024 I See U. All rights reserved."}),g.jsx("p",{className:"mt-1",children:"Version 1.0.0"})]})]})}function Sv({open:n,onClose:e}){return n?g.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:g.jsxs("div",{className:"bg-white w-full max-w-3xl max-h-[90vh] overflow-y-auto p-6 rounded-lg relative shadow-lg",children:[g.jsx("button",{onClick:e,className:"absolute top-4 right-4 text-gray-400 hover:text-black",children:g.jsx("i",{className:"fas fa-times text-xl"})}),g.jsx("h1",{className:"text-2xl font-bold mb-4",children:"CCTV 영상 개인정보 안내"}),g.jsxs("div",{className:"space-y-6 text-sm text-gray-700 leading-relaxed",children:[g.jsxs("section",{children:[g.jsx("h2",{className:"text-lg font-bold mb-2",children:"1. CCTV 운영 목적"}),g.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[g.jsxs("li",{children:[g.jsx("strong",{children:"통계 분석"}),": 매장 방문자 수, 체류 시간, 시간대별 혼잡도 등을 파악하여 운영 효율을 높이기 위해 영상을 사용합니다."]}),g.jsxs("li",{children:[g.jsx("strong",{children:"안전 및 보안"}),": 고객과 직원 안전, 도난·사고 예방을 위한 일반 보안 목적."]})]}),g.jsxs("p",{className:"mt-2 text-gray-600",children:["*본 앱은 개인 식별이 아닌, ",g.jsx("strong",{children:"통계·운영 효율성"})," 향상을 위한 데이터를 중점으로 처리합니다."]})]}),g.jsxs("section",{children:[g.jsx("h2",{className:"text-lg font-bold mb-2",children:"2. 설치 장소 및 고지"}),g.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[g.jsxs("li",{children:[g.jsx("strong",{children:"설치 장소"}),": 매장 출입구, 내부 주요 구역, 계산대 주변 등"]}),g.jsxs("li",{children:[g.jsx("strong",{children:"안내문"}),": 매장 내 출입구 등에 CCTV 설치 안내문을 비치"]}),g.jsxs("li",{children:[g.jsx("strong",{children:"고객 동의"}),": 매장 이용 시, CCTV 촬영 및 통계 분석에 대한 안내"]})]})]}),g.jsxs("section",{children:[g.jsx("h2",{className:"text-lg font-bold mb-2",children:"3. 데이터 비식별화 및 활용"}),g.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[g.jsxs("li",{children:[g.jsx("strong",{children:"비식별 처리"}),": 얼굴·신체 정보를 저장하지 않고, 통계 지표만 추출"]}),g.jsxs("li",{children:[g.jsx("strong",{children:"AI 분석"}),": 인원 흐름, 혼잡도, 방문 패턴 등 산출"]}),g.jsxs("li",{children:[g.jsx("strong",{children:"재식별 금지"}),": 분석 후 원영상은 즉시 마스킹·삭제 처리"]})]})]}),g.jsxs("section",{children:[g.jsx("h2",{className:"text-lg font-bold mb-2",children:"4. 보관 기간 및 폐기"}),g.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[g.jsxs("li",{children:[g.jsx("strong",{children:"보관 기간"}),": 원영상은 최대 30일 등 최소 기간만 보관 후 자동 삭제"]}),g.jsxs("li",{children:[g.jsx("strong",{children:"폐기 절차"}),": 목적 달성 후 영상·데이터 영구 삭제"]}),g.jsxs("li",{children:[g.jsx("strong",{children:"예외 사항"}),": 법적 분쟁, 수사 협조 필요 시 별도 분리 보관"]})]})]}),g.jsxs("section",{children:[g.jsx("h2",{className:"text-lg font-bold mb-2",children:"5. 접근 권한 및 관리자"}),g.jsx("p",{children:"보안 담당자 또는 지정된 관리자만 영상 및 통계 데이터를 열람할 수 있으며, 접근 로그를 기록·관리합니다."}),g.jsx("p",{className:"mt-1 text-gray-600",children:"문의: security@mycompany.co.kr"})]}),g.jsxs("section",{children:[g.jsx("h2",{className:"text-lg font-bold mb-2",children:"6. 법령 준수"}),g.jsx("p",{children:"개인정보 보호법 등 관계 법령 및 회사 내부 정책을 준수합니다. 필요시 GDPR, 통신비밀 보호법 등 해외 법령도 고려됩니다."})]}),g.jsxs("section",{children:[g.jsx("h2",{className:"text-lg font-bold mb-2",children:"7. 이용자의 권리"}),g.jsx("p",{children:"본인이 식별되는 영상에 대해 열람·삭제를 요청할 수 있으며, 절차는 관련 법령에 따릅니다."})]}),g.jsxs("section",{children:[g.jsx("h2",{className:"text-lg font-bold mb-2",children:"8. 문의 안내"}),g.jsxs("p",{children:["개인정보 관련 문의: privacy@mycompany.co.kr / 000-0000-0000",g.jsx("br",{}),"CCTV 운영·보안 문의: security@mycompany.co.kr / 000-0000-0000"]})]}),g.jsx("section",{children:g.jsx("p",{className:"text-sm text-gray-600 mt-4",children:"*본 안내는 요약본이며, 자세한 내용은 회사의 개인정보처리방침을 참조해 주세요."})})]})]})}):null}function Tv(){const n=Ut(),[e,t]=D.useState(!1),[r,i]=D.useState(Date.now()),s=()=>t(!0),o=()=>t(!1),a=()=>i(Date.now()),[l,u]=D.useState(!1),[c,d]=D.useState(null),[f,h]=D.useState(""),[m,p]=D.useState(""),[x,y]=D.useState(""),[v,S]=D.useState(""),[L,T]=D.useState(""),A=async $=>{$.preventDefault(),console.log("[장치 등록]",{deviceType:c,deviceName:f,deviceIP:m,devicePort:x,deviceUser:v,devicePass:L});const V=f||`cam-${Date.now()}`,ee=`rtsp://${m||"192.168.0.10"}:${x||"554"}`;try{const ae=await(await fetch("/api/cameras",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cameraId:V,rtspUrl:ee})})).json();ae.success?(console.log("카메라 등록 성공:",ae),M(le=>[...le,{cameraId:V,hlsUrl:ae.hlsUrl}])):alert(ae.error||"카메라 등록 실패")}catch(re){console.error("Failed to register camera:",re)}N()},R=n.pathname==="/monitor",k=n.pathname==="/dashboard",_=n.pathname==="/ai-insight",C=n.pathname==="/guide",[P,H]=D.useState(!1),B=()=>H(!0),q=()=>H(!1),[Y,K]=D.useState("김관리자");D.useEffect(()=>{fetch("/api/user",{credentials:"include"}).then($=>$.ok?$.json():null).then($=>{$&&$.displayName&&K($.displayName)}).catch($=>{console.error("Failed to fetch user info:",$)})},[]);const[J,M]=D.useState([]),F=$=>{d($),u(!0)},N=()=>{u(!1),d(null),h(""),p(""),y(""),S(""),T("")};return g.jsxs("div",{className:"min-h-screen bg-gray-50 font-sans",children:[g.jsx("nav",{className:"bg-white shadow",children:g.jsx("div",{className:"max-w-8xl mx-auto px-4 sm:px-6 lg:px-8",children:g.jsxs("div",{className:"flex justify-between h-16 items-center",children:[g.jsxs("div",{className:"flex items-center space-x-8",children:[g.jsx("span",{className:"text-xl font-bold text-black",children:"I See U"}),g.jsxs("div",{className:"flex space-x-3",children:[g.jsx(ke,{to:"/monitor",className:`inline-flex items-center px-1 pt-1 nav-link ${R?"bg-black text-white font-medium":"text-gray-500 hover:text-black"}`,style:{padding:"0.5rem 1rem",borderRadius:"0.375rem",transition:"all 0.3s ease",backgroundColor:R?"#000000":"#f3f4f6",color:R?"#ffffff":"#000000"},children:"내 모니터링"}),g.jsx(ke,{to:"/dashboard",className:`inline-flex items-center px-1 pt-1 nav-link ${k?"bg-black text-white font-medium":"text-gray-500 hover:text-black"}`,style:{padding:"0.5rem 1rem",borderRadius:"0.375rem",transition:"all 0.3s ease",backgroundColor:k?"#000000":"#f3f4f6",color:k?"#ffffff":"#000000"},children:"통계 분석"}),g.jsx(ke,{to:"/ai-insight",className:`inline-flex items-center px-1 pt-1 nav-link ${_?"bg-black text-white font-medium":"text-gray-500 hover:text-black"}`,style:{padding:"0.5rem 1rem",borderRadius:"0.375rem",transition:"all 0.3s ease",backgroundColor:_?"#000000":"#f3f4f6",color:_?"#ffffff":"#000000"},children:"AI 인사이트"}),g.jsx(ke,{to:"/guide",className:`inline-flex items-center px-1 pt-1 nav-link ${C?"bg-black text-white font-medium":"text-gray-500 hover:text-black"}`,style:{padding:"0.5rem 1rem",borderRadius:"0.375rem",transition:"all 0.3s ease",backgroundColor:C?"#000000":"#f3f4f6",color:C?"#ffffff":"#000000"},children:"사용 방법"}),g.jsx("button",{type:"button",onClick:B,className:"inline-flex items-center px-1 pt-1 text-gray-500 hover:text-black nav-link",style:{padding:"0.5rem 1rem",borderRadius:"0.375rem",transition:"all 0.3s ease",backgroundColor:"#f3f4f6",color:"#000000"},children:"개인정보법 안내"})]})]}),g.jsxs("div",{className:"flex items-center",children:[g.jsxs("button",{className:"p-2 rounded-full hover:bg-gray-100 relative",children:[g.jsx("i",{className:"fas fa-bell text-gray-600"}),g.jsx("span",{className:"absolute top-1 right-1 bg-red-500 rounded-full w-2 h-2"})]}),g.jsx("button",{className:"ml-3 p-2 rounded-full hover:bg-gray-100",children:g.jsx("i",{className:"fas fa-cog text-gray-600"})}),g.jsxs("div",{className:"ml-4 flex items-center",children:[g.jsx("img",{className:"h-8 w-8 rounded-full",src:"/기본프로필.png",alt:"사용자 프로필"}),g.jsx("span",{className:"ml-2 text-sm font-medium text-gray-700",children:Y})]})]})]})})}),g.jsxs("div",{className:"max-w-8xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[g.jsxs("div",{className:"flex justify-between items-center mb-8",children:[g.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"CCTV 모니터링"}),g.jsxs("button",{onClick:()=>F("CCTV"),className:"rounded-button bg-black text-white px-4 py-2 flex items-center",children:[g.jsx("i",{className:"fas fa-plus mr-2"}),"새 장치 연결"]})]}),g.jsx("div",{className:"mb-4 text-gray-600",children:g.jsxs("span",{className:"font-medium",children:["환영합니다 ",Y,"님!"]})}),g.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6 mb-8",children:[g.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200 flex flex-col items-center justify-center min-h-[200px] cursor-pointer hover:border-custom",onClick:()=>F("CCTV"),children:[g.jsx("i",{className:"fas fa-video text-4xl text-custom mb-4"}),g.jsx("span",{className:"text-gray-700",children:"CCTV 연결"})]}),g.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200 flex flex-col items-center justify-center min-h-[200px] cursor-pointer hover:border-custom",onClick:s,children:[g.jsx("i",{className:"fas fa-webcam text-4xl text-custom mb-4"}),g.jsx("span",{className:"text-gray-700",children:"웹캠 연결"})]}),g.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200 flex flex-col items-center justify-center min-h-[200px] cursor-pointer hover:border-custom",onClick:s,children:[g.jsx("i",{className:"fas fa-mobile-alt text-4xl text-custom mb-4"}),g.jsx("span",{className:"text-gray-700",children:"스마트폰 연결"})]}),g.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200 flex flex-col items-center justify-center min-h-[200px] cursor-pointer hover:border-custom",onClick:()=>F("Blackbox"),children:[g.jsx("i",{className:"fas fa-car text-4xl text-custom mb-4"}),g.jsx("span",{className:"text-gray-700",children:"블랙박스 연결"})]})]}),g.jsx(Lv,{cameraList:J})]}),g.jsx("footer",{className:"bg-white border-t border-gray-200 mt-8",children:g.jsx("div",{className:"max-w-8xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:g.jsx("div",{className:"text-center text-sm text-gray-500",children:"© 2024 I See U. All rights reserved."})})}),e&&g.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:g.jsxs("div",{className:"relative bg-white rounded-lg shadow-lg p-8 w-full max-w-md",children:[g.jsx("button",{className:"absolute top-4 right-4 text-gray-400 hover:text-custom transition-colors rounded-button p-2",onClick:o,children:g.jsx("i",{className:"fas fa-times text-xl"})}),g.jsx("button",{className:"absolute top-4 left-4 text-gray-400 hover:text-custom transition-colors rounded-button p-2",onClick:a,title:"QR 새로고침",children:g.jsx("i",{className:"fas fa-sync-alt text-xl"})}),g.jsxs("div",{className:"text-center mb-6",children:[g.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"QR 코드 스캔"}),g.jsx("div",{className:"mt-2 text-sm text-gray-500",children:"연결 대기 중..."})]}),g.jsxs("div",{className:"relative w-64 h-64 mx-auto mb-6",children:[g.jsx("div",{className:"absolute inset-0 border-2 border-custom rounded-lg"}),g.jsx("img",{src:`https://api.qrserver.com/v1/create-qr-code/?size=240x240&data=https://example.com&t=${r}`,alt:"QR Code",className:"w-full h-full p-3"}),g.jsx("div",{className:"absolute -top-2 -left-2 w-4 h-4 border-t-2 border-l-2 border-custom"}),g.jsx("div",{className:"absolute -top-2 -right-2 w-4 h-4 border-t-2 border-r-2 border-custom"}),g.jsx("div",{className:"absolute -bottom-2 -left-2 w-4 h-4 border-b-2 border-l-2 border-custom"}),g.jsx("div",{className:"absolute -bottom-2 -right-2 w-4 h-4 border-b-2 border-r-2 border-custom"})]}),g.jsx("div",{className:"text-center text-sm text-gray-600 leading-relaxed max-w-sm mx-auto",children:g.jsx("p",{children:"모바일 또는 웹캠 카메라로 해당 QR 코드를 촬영하시면 간편하게 실시간 연동이 가능합니다"})}),g.jsxs("div",{className:"mt-6 flex items-center justify-center space-x-2",children:[g.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),g.jsx("span",{className:"text-sm text-gray-500",children:"스캔 준비 완료"})]})]})}),l&&g.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:g.jsxs("div",{className:"bg-white w-full max-w-md p-6 rounded-lg relative",children:[g.jsx("button",{onClick:N,className:"absolute top-4 right-4 text-gray-400 hover:text-custom",children:g.jsx("i",{className:"fas fa-times text-xl"})}),g.jsx("h2",{className:"text-xl font-bold mb-4",children:c==="CCTV"?"CCTV 연결 정보":"블랙박스 연결 정보"}),g.jsx("div",{className:"text-sm text-gray-600 mb-4",children:c==="CCTV"?g.jsxs(g.Fragment,{children:[g.jsx("p",{children:"IP 카메라 / NVR 등과 연결하기 위해 IP 주소와 포트, 계정 정보를 입력하세요."}),g.jsx("p",{children:"ONVIF나 RTSP 등 프로토콜을 사용할 수 있습니다."}),g.jsx("p",{className:"mt-2 text-xs text-gray-400",children:"(예: rtsp://192.168.0.10:554, 포트포워딩 필요)"})]}):g.jsxs(g.Fragment,{children:[g.jsx("p",{children:"블랙박스를 네트워크로 연결하거나, 제조사 클라우드 계정을 통해 실시간 영상을 볼 수 있습니다."}),g.jsx("p",{className:"mt-2 text-xs text-gray-400",children:"(예: cloud.blackbox.com 계정 / IP 직접 연결 등)"})]})}),g.jsxs("form",{onSubmit:A,children:[g.jsxs("div",{className:"mb-4",children:[g.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"장치 이름"}),g.jsx("input",{type:"text",value:f,onChange:$=>h($.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-custom focus:border-custom",placeholder:c==="CCTV"?"예) 정문 CCTV":"예) 차량 블랙박스"})]}),g.jsxs("div",{className:"mb-4",children:[g.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"IP / 도메인"}),g.jsx("input",{type:"text",value:m,onChange:$=>p($.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-custom focus:border-custom",placeholder:"예) 192.168.0.10 or mydevice.example.com"})]}),g.jsxs("div",{className:"mb-4",children:[g.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"포트"}),g.jsx("input",{type:"text",value:x,onChange:$=>y($.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-custom focus:border-custom",placeholder:"예) 554"})]}),g.jsxs("div",{className:"mb-4",children:[g.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"계정 (ID)"}),g.jsx("input",{type:"text",value:v,onChange:$=>S($.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-custom focus:border-custom mb-2",placeholder:"예) admin"}),g.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"비밀번호"}),g.jsx("input",{type:"password",value:L,onChange:$=>T($.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-custom focus:border-custom",placeholder:"패스워드"})]}),g.jsxs("div",{className:"flex justify-end space-x-2 mt-6",children:[g.jsx("button",{type:"button",onClick:N,className:"rounded-button border border-gray-300 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:"취소"}),g.jsx("button",{type:"submit",className:"rounded-button bg-black text-white px-4 py-2 text-sm hover:bg-black/90",children:"등록"})]})]})]})}),P&&g.jsx(Sv,{open:P,onClose:q})]})}function Lv({cameraList:n}){return g.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden mb-6",children:g.jsxs("div",{className:"p-6",children:[g.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"연결된 장치"}),n.length===0?g.jsx("p",{className:"text-gray-500",children:"아직 등록된 카메라가 없습니다."}):g.jsx("ul",{className:"space-y-3",children:n.map(e=>g.jsx("li",{className:"p-2 bg-gray-50 rounded",children:g.jsxs("div",{className:"flex justify-between items-center",children:[g.jsx("span",{className:"font-medium text-gray-700",children:e.cameraId}),g.jsx("span",{className:"text-xs text-gray-400",children:e.hlsUrl})]})},e.cameraId))})]})})}function Rv(){const n=Ut(),e=n.pathname==="/monitor",t=n.pathname==="/dashboard",r=n.pathname==="/ai-insight",i=n.pathname==="/guide",[s,o]=D.useState("CCTV 1"),[a,l]=D.useState("오늘"),u=["CCTV 1","CCTV 2","CCTV 3"],c=["오늘","어제","1주일","1달"],d=["time","gender"],[f,h]=D.useState(0),m=d[f],p=()=>{h(y=>(y-1+d.length)%d.length)},x=()=>{h(y=>(y+1)%d.length)};return g.jsxs("div",{className:"bg-gray-50",children:[g.jsx("nav",{className:"bg-white shadow",children:g.jsx("div",{className:"max-w-8xl mx-auto px-4 sm:px-6 lg:px-8",children:g.jsxs("div",{className:"flex justify-between h-16 items-center",children:[g.jsxs("div",{className:"flex items-center space-x-8",children:[g.jsx("span",{className:"text-xl font-bold text-black",children:"I See U"}),g.jsxs("div",{className:"flex space-x-3",children:[g.jsx(ke,{to:"/monitor",className:`inline-flex items-center px-1 pt-1 nav-link ${e?"bg-black text-white font-medium":"text-gray-500 hover:text-black"}`,style:{padding:"0.5rem 1rem",borderRadius:"0.375rem",transition:"all 0.3s ease",backgroundColor:e?"#000000":"#f3f4f6",color:e?"#ffffff":"#000000"},children:"내 모니터링"}),g.jsx(ke,{to:"/dashboard",className:`inline-flex items-center px-1 pt-1 nav-link ${t?"bg-black text-white font-medium":"text-gray-500 hover:text-black"}`,style:{padding:"0.5rem 1rem",borderRadius:"0.375rem",transition:"all 0.3s ease",backgroundColor:t?"#000000":"#f3f4f6",color:t?"#ffffff":"#000000"},children:"통계 분석"}),g.jsx(ke,{to:"/ai-insight",className:`inline-flex items-center px-1 pt-1 nav-link ${r?"bg-black text-white font-medium":"text-gray-500 hover:text-black"}`,style:{padding:"0.5rem 1rem",borderRadius:"0.375rem",transition:"all 0.3s ease",backgroundColor:r?"#000000":"#f3f4f6",color:r?"#ffffff":"#000000"},children:"AI 인사이트"}),g.jsx(ke,{to:"/guide",className:`inline-flex items-center px-1 pt-1 nav-link ${i?"bg-black text-white font-medium":"text-gray-500 hover:text-black"}`,style:{padding:"0.5rem 1rem",borderRadius:"0.375rem",transition:"all 0.3s ease",backgroundColor:i?"#000000":"#f3f4f6",color:i?"#ffffff":"#000000"},children:"사용 방법"}),g.jsx("button",{type:"button",className:"inline-flex items-center px-1 pt-1 text-gray-500 hover:text-black nav-link",style:{padding:"0.5rem 1rem",borderRadius:"0.375rem",transition:"all 0.3s ease",backgroundColor:"#f3f4f6",color:"#000000"},children:"개인정보법 안내"})]})]}),g.jsxs("div",{className:"flex items-center",children:[g.jsxs("button",{className:"p-2 rounded-full hover:bg-gray-100 relative",children:[g.jsx("i",{className:"fas fa-bell text-gray-600"}),g.jsx("span",{className:"absolute top-1 right-1 bg-red-500 rounded-full w-2 h-2"})]}),g.jsx("button",{className:"ml-3 p-2 rounded-full hover:bg-gray-100",children:g.jsx("i",{className:"fas fa-cog text-gray-600"})}),g.jsxs("div",{className:"ml-4 flex items-center",children:[g.jsx("img",{className:"h-8 w-8 rounded-full",src:"/기본프로필.png",alt:"사용자 프로필"}),g.jsx("span",{className:"ml-2 text-sm font-medium text-gray-700",children:"김관리자"})]})]})]})})}),g.jsx("div",{className:"flex bg-gray-50",style:{minHeight:"calc(100vh - 4rem)"},children:g.jsx("main",{className:"flex-1 overflow-y-auto",children:g.jsxs("div",{className:"container mx-auto px-6 py-8",children:[g.jsx("h1",{className:"text-2xl font-semibold text-gray-900 mb-6",children:"통계 분석"}),g.jsx("div",{className:"flex items-center space-x-4 mb-6",children:u.map(y=>g.jsx("button",{onClick:()=>o(y),className:`px-4 py-2 rounded-md transition-colors ${s===y?"bg-black text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:y},y))}),g.jsx("div",{className:"flex items-center space-x-4 mb-8",children:c.map(y=>g.jsx("button",{onClick:()=>l(y),className:`px-4 py-2 rounded-md transition-colors ${a===y?"bg-black text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:y},y))}),g.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[g.jsxs("div",{className:"bg-white shadow rounded-lg overflow-hidden p-6",children:[g.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"현황 통계"}),g.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[g.jsx("thead",{className:"bg-gray-50",children:g.jsxs("tr",{children:[g.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700 uppercase tracking-wider",children:"구분"}),g.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700 uppercase tracking-wider",children:a})]})}),g.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[g.jsxs("tr",{children:[g.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-base font-medium text-gray-800",children:"총 방문자 수"}),g.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-base text-gray-800",children:a==="오늘"?"1,234명":"데이터 예시"})]}),g.jsxs("tr",{children:[g.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-base font-medium text-gray-800",children:"평균 체류 시간"}),g.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-base text-gray-800",children:"32분"})]}),g.jsxs("tr",{children:[g.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-base font-medium text-gray-800",children:"피크 시간대"}),g.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-base text-gray-800",children:"12:00-13:00"})]}),g.jsxs("tr",{children:[g.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-base font-medium text-gray-800",children:"주요 소지품"}),g.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-base text-gray-800",children:"가방(45%), 핸드폰(38%)"})]})]})]})]}),g.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[g.jsxs("div",{className:"flex items-center justify-between mb-4",children:[g.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:m==="time"?"시간대별 방문자 통계":"성별 비율"}),g.jsxs("div",{className:"space-x-3",children:[g.jsx("button",{className:"p-2 rounded-full hover:bg-gray-100 border border-gray-200",onClick:p,children:g.jsx("i",{className:"fas fa-chevron-left text-gray-500"})}),g.jsx("button",{className:"p-2 rounded-full hover:bg-gray-100 border border-gray-200",onClick:x,children:g.jsx("i",{className:"fas fa-chevron-right text-gray-500"})})]})]}),g.jsx("div",{className:"mt-4 flex justify-center",children:m==="time"?g.jsx("img",{src:"/통계2.png",alt:"시간대별 방문자 통계",className:"w-full h-[360px] object-contain border border-gray-200"}):g.jsx("img",{src:"/통계_gender.png",alt:"성별 비율 통계 (예시)",className:"w-full h-[360px] object-contain border border-gray-200"})})]})]})]})})})]})}function Av(){const n=Ut(),e=n.pathname==="/monitor",t=n.pathname==="/dashboard",r=n.pathname==="/ai-insight",i=n.pathname==="/guide";return g.jsxs("div",{className:"bg-gray-50 min-h-screen font-['Noto_Sans_KR']",children:[g.jsx("nav",{className:"bg-white shadow",children:g.jsx("div",{className:"max-w-8xl mx-auto px-4 sm:px-6 lg:px-8",children:g.jsxs("div",{className:"flex justify-between h-16 items-center",children:[g.jsxs("div",{className:"flex items-center space-x-8",children:[g.jsx("span",{className:"text-xl font-bold text-black",children:"I See U"}),g.jsxs("div",{className:"flex space-x-3",children:[g.jsx(ke,{to:"/monitor",className:`inline-flex items-center px-1 pt-1 nav-link ${e?"bg-black text-white font-medium":"text-gray-500 hover:text-black"}`,style:{padding:"0.5rem 1rem",borderRadius:"0.375rem",transition:"all 0.3s ease",backgroundColor:e?"#000000":"#f3f4f6",color:e?"#ffffff":"#000000"},children:"내 모니터링"}),g.jsx(ke,{to:"/dashboard",className:`inline-flex items-center px-1 pt-1 nav-link ${t?"bg-black text-white font-medium":"text-gray-500 hover:text-black"}`,style:{padding:"0.5rem 1rem",borderRadius:"0.375rem",transition:"all 0.3s ease",backgroundColor:t?"#000000":"#f3f4f6",color:t?"#ffffff":"#000000"},children:"통계 분석"}),g.jsx(ke,{to:"/ai-insight",className:`inline-flex items-center px-1 pt-1 nav-link ${r?"bg-black text-white font-medium":"text-gray-500 hover:text-black"}`,style:{padding:"0.5rem 1rem",borderRadius:"0.375rem",transition:"all 0.3s ease",backgroundColor:r?"#000000":"#f3f4f6",color:r?"#ffffff":"#000000"},children:"AI 인사이트"}),g.jsx(ke,{to:"/guide",className:`inline-flex items-center px-1 pt-1 nav-link ${i?"bg-black text-white font-medium":"text-gray-500 hover:text-black"}`,style:{padding:"0.5rem 1rem",borderRadius:"0.375rem",transition:"all 0.3s ease",backgroundColor:i?"#000000":"#f3f4f6",color:i?"#ffffff":"#000000"},children:"사용 방법"}),g.jsx("button",{type:"button",className:"inline-flex items-center px-1 pt-1 text-gray-500 hover:text-black nav-link",style:{padding:"0.5rem 1rem",borderRadius:"0.375rem",transition:"all 0.3s ease",backgroundColor:"#f3f4f6",color:"#000000"},children:"개인정보법 안내"})]})]}),g.jsxs("div",{className:"flex items-center",children:[g.jsxs("button",{className:"p-2 rounded-full hover:bg-gray-100 relative",children:[g.jsx("i",{className:"fas fa-bell text-gray-600"}),g.jsx("span",{className:"absolute top-1 right-1 bg-red-500 rounded-full w-2 h-2"})]}),g.jsx("button",{className:"ml-3 p-2 rounded-full hover:bg-gray-100",children:g.jsx("i",{className:"fas fa-cog text-gray-600"})}),g.jsxs("div",{className:"ml-4 flex items-center",children:[g.jsx("img",{className:"h-8 w-8 rounded-full",src:"/기본프로필.png",alt:"사용자 프로필"}),g.jsx("span",{className:"ml-2 text-sm font-medium text-gray-700",children:"김관리자"})]})]})]})})}),g.jsxs("div",{className:"min-h-screen flex",children:[g.jsx("aside",{className:"w-64 bg-white border-r border-gray-200 fixed h-full overflow-y-auto",children:g.jsxs("div",{className:"p-6",children:[g.jsx("div",{className:"text-xl font-bold text-custom mb-8",children:"I See U"}),g.jsx("nav",{children:g.jsxs("ul",{className:"space-y-2",children:[g.jsx("li",{children:g.jsx("a",{href:"#intro",className:"block px-4 py-2 text-custom hover:bg-gray-100 rounded-lg",children:"앱 소개"})}),g.jsx("li",{children:g.jsx("a",{href:"#device",className:"block px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg",children:"장치 등록 방법"})}),g.jsx("li",{children:g.jsx("a",{href:"#monitor",className:"block px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg",children:"실시간 모니터링"})}),g.jsx("li",{children:g.jsx("a",{href:"#stats",className:"block px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg",children:"통계 분석 활용"})}),g.jsx("li",{children:g.jsx("a",{href:"#faq",className:"block px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg",children:"FAQ & 주의사항"})}),g.jsx("li",{children:g.jsx("a",{href:"#extra",className:"block px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg",children:"부가 안내"})})]})})]})}),g.jsx("main",{className:"ml-64 flex-1",children:g.jsxs("div",{className:"max-w-7xl mx-auto px-6 pt-8 pb-16",children:[g.jsxs("section",{id:"intro",className:"mb-16",children:[g.jsx("h2",{className:"text-2xl font-bold mb-6",children:"1. 앱 소개"}),g.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[g.jsx("p",{className:"text-gray-700 mb-6",children:"I See U는 다양한 디바이스(CCTV, 블랙박스, 웹캠, 스마트폰 등)로부터 실시간 영상을 모니터링하고, 방문자 통계·분석 자료를 한눈에 확인할 수 있는 솔루션입니다."}),g.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[g.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[g.jsx("h3",{className:"font-bold mb-4",children:"주요 대상"}),g.jsxs("ul",{className:"space-y-2",children:[g.jsxs("li",{className:"flex items-center",children:[g.jsx("i",{className:"fas fa-store text-custom mr-3"}),"매장 관리자"]}),g.jsxs("li",{className:"flex items-center",children:[g.jsx("i",{className:"fas fa-shield-alt text-custom mr-3"}),"보안 담당자"]}),g.jsxs("li",{className:"flex items-center",children:[g.jsx("i",{className:"fas fa-microscope text-custom mr-3"}),"연구원"]})]})]}),g.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[g.jsx("h3",{className:"font-bold mb-4",children:"핵심 기능"}),g.jsxs("ul",{className:"space-y-2",children:[g.jsxs("li",{className:"flex items-center",children:[g.jsx("i",{className:"fas fa-video text-custom mr-3"}),"실시간 모니터링"]}),g.jsxs("li",{className:"flex items-center",children:[g.jsx("i",{className:"fas fa-chart-line text-custom mr-3"}),"시간대별 방문자 통계"]}),g.jsxs("li",{className:"flex items-center",children:[g.jsx("i",{className:"fas fa-clock text-custom mr-3"}),"피크 시간대·체류 시간 분석"]}),g.jsxs("li",{className:"flex items-center",children:[g.jsx("i",{className:"fas fa-file-download text-custom mr-3"}),"보고서 다운로드"]})]})]})]})]})]}),g.jsxs("section",{id:"device",className:"mb-16",children:[g.jsx("h2",{className:"text-2xl font-bold mb-6",children:"2. 장치 등록 방법"}),g.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:g.jsxs("div",{className:"space-y-8",children:[g.jsxs("div",{children:[g.jsx("h3",{className:"text-lg font-bold mb-4",children:"2.1. 새 장치 연결"}),g.jsxs("ol",{className:"list-decimal list-inside space-y-2 ml-4",children:[g.jsx("li",{children:'"새 장치 연결" 버튼을 클릭합니다.'}),g.jsx("li",{children:"CCTV/블랙박스/웹캠/스마트폰 등 장치 유형을 선택합니다."})]})]}),g.jsxs("div",{children:[g.jsx("h3",{className:"text-lg font-bold mb-4",children:"2.2. IP 기반 장치(CCTV/블랙박스)"}),g.jsxs("ul",{className:"space-y-2 ml-4",children:[g.jsx("li",{children:"IP/도메인 + 포트 + 계정/비밀번호 입력 후 등록 (ONVIF·RTSP 등)"}),g.jsx("li",{children:"포트포워딩, 공유기 설정 등 네트워크 환경 세팅 필요"})]})]}),g.jsxs("div",{children:[g.jsx("h3",{className:"text-lg font-bold mb-4",children:"2.3. QR 연동(웹캠·스마트폰 등)"}),g.jsxs("ul",{className:"space-y-2 ml-4",children:[g.jsx("li",{children:'"QR 코드 스캔" 화면을 열고,'}),g.jsx("li",{children:"모바일·웹캠 카메라로 QR 코드를 촬영하면 자동 연결"}),g.jsx("li",{children:"장치가 정상 등록되면, 실시간 모니터링 화면에 추가됨"})]})]})]})})]}),g.jsxs("section",{id:"monitor",className:"mb-16",children:[g.jsx("h2",{className:"text-2xl font-bold mb-6",children:"3. 실시간 모니터링 화면 사용법"}),g.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[g.jsx("div",{className:"mb-6",children:g.jsx("img",{src:"/가이드1.png",alt:"모니터링 화면",className:"w-full rounded-lg mb-4"})}),g.jsxs("div",{className:"space-y-4",children:[g.jsx("p",{children:'내 모니터링 화면 혹은 통계 분석 화면 내의 "실시간 모니터링" 섹션에서, 등록된 화면(2×2 블록 등)을 확인할 수 있습니다.'}),g.jsx("p",{children:"원하는 화면을 클릭해 체크박스를 선택할 수 있습니다. 선택된 화면은 하단 목록에 표시됩니다."}),g.jsx("p",{children:'"새 장치 연결" 버튼을 통해 다른 디바이스도 지속해서 추가 가능.'}),g.jsx("div",{className:"bg-blue-50 border-l-4 border-black p-4 mt-4",children:g.jsxs("p",{className:"text-sm",children:[g.jsx("i",{className:"fas fa-info-circle text-black mr-2"}),"TIP: 네트워크 상태가 불안정하면 영상이 끊길 수 있습니다. 가능하면 유선 LAN 또는 안정된 Wi-Fi를 이용해주세요."]})})]})]})]}),g.jsxs("section",{id:"stats",className:"mb-16",children:[g.jsx("h2",{className:"text-2xl font-bold mb-6",children:"4. 통계 분석 활용"}),g.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[g.jsxs("div",{className:"grid grid-cols-2 gap-6 mb-8",children:[g.jsxs("div",{children:[g.jsx("h3",{className:"text-lg font-bold mb-4",children:"4.1. 시간대별 방문자 통계"}),g.jsx("img",{src:"/가이드2.png",alt:"시간대별 방문자 통계",className:"w-full rounded-lg"})]}),g.jsxs("div",{children:[g.jsx("h3",{className:"text-lg font-bold mb-4",children:"4.2. 현황 통계"}),g.jsxs("div",{className:"space-y-4",children:[g.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[g.jsxs("div",{className:"flex justify-between items-center",children:[g.jsx("span",{children:"오늘 방문자"}),g.jsx("span",{className:"text-green-500",children:"+15.2%"})]}),g.jsx("div",{className:"text-2xl font-bold mt-2",children:"2,458명"})]}),g.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[g.jsxs("div",{className:"flex justify-between items-center",children:[g.jsx("span",{children:"평균 체류 시간"}),g.jsx("span",{className:"text-red-500",children:"-5.3%"})]}),g.jsx("div",{className:"text-2xl font-bold mt-2",children:"32분"})]})]})]})]}),g.jsxs("div",{children:[g.jsx("h3",{className:"text-lg font-bold mb-4",children:"4.3. 최근 인사이트"}),g.jsxs("div",{className:"space-y-4",children:[g.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[g.jsxs("div",{className:"flex justify-between items-center",children:[g.jsx("span",{className:"font-medium",children:"점심 시간대 피크 분석"}),g.jsx("span",{className:"bg-green-100 text-green-800 text-xs px-2 py-1 rounded",children:"완료"})]}),g.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"12:00~13:00 방문자 증가율 분석 완료"})]}),g.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[g.jsxs("div",{className:"flex justify-between items-center",children:[g.jsx("span",{className:"font-medium",children:"매장 체류 시간 분석"}),g.jsx("span",{className:"bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded",children:"진행중"})]}),g.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"주간 체류 시간 패턴 분석중"})]})]})]})]})]}),g.jsxs("section",{id:"faq",className:"mb-16",children:[g.jsx("h2",{className:"text-2xl font-bold mb-6",children:"5. FAQ & 주의사항"}),g.jsx("div",{className:"bg-white rounded-lg shadow",children:g.jsxs("div",{className:"divide-y divide-gray-200",children:[g.jsxs("details",{className:"p-6 group",children:[g.jsxs("summary",{className:"flex justify-between items-center cursor-pointer",children:[g.jsx("span",{className:"font-medium",children:"포트포워딩이 뭔가요?"}),g.jsx("span",{className:"transition group-open:rotate-180",children:g.jsx("i",{className:"fas fa-chevron-down"})})]}),g.jsx("p",{className:"mt-4 text-gray-600",children:"외부에서 내부망 CCTV에 접속하려면 공유기 설정(포트포워딩)이 필요합니다."})]}),g.jsxs("details",{className:"p-6 group",children:[g.jsxs("summary",{className:"flex justify-between items-center cursor-pointer",children:[g.jsx("span",{className:"font-medium",children:"RTSP 프로토콜이 안 보입니다."}),g.jsx("span",{className:"transition group-open:rotate-180",children:g.jsx("i",{className:"fas fa-chevron-down"})})]}),g.jsx("p",{className:"mt-4 text-gray-600",children:"웹 브라우저는 RTSP를 직접 재생하지 못하는 경우가 많아, 중간에 WebRTC/HLS 변환이 필요할 수 있습니다."})]}),g.jsxs("details",{className:"p-6 group",children:[g.jsxs("summary",{className:"flex justify-between items-center cursor-pointer",children:[g.jsx("span",{className:"font-medium",children:"QR 코드 스캔이 실패합니다."}),g.jsx("span",{className:"transition group-open:rotate-180",children:g.jsx("i",{className:"fas fa-chevron-down"})})]}),g.jsx("p",{className:"mt-4 text-gray-600",children:"모바일 앱 권한(카메라) 또는 인터넷 연결 상태를 확인해주세요."})]}),g.jsxs("details",{className:"p-6 group",children:[g.jsxs("summary",{className:"flex justify-between items-center cursor-pointer",children:[g.jsx("span",{className:"font-medium",children:"개인정보 유의"}),g.jsx("span",{className:"transition group-open:rotate-180",children:g.jsx("i",{className:"fas fa-chevron-down"})})]}),g.jsx("p",{className:"mt-4 text-gray-600",children:"CCTV·블랙박스 영상을 녹화·분석 시 개인정보 보호법 등 관련 법령을 준수해야 합니다."})]})]})})]}),g.jsxs("section",{id:"extra",className:"mb-16",children:[g.jsx("h2",{className:"text-2xl font-bold mb-6",children:"6. 부가 안내"}),g.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:g.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[g.jsxs("div",{className:"flex items-start space-x-4",children:[g.jsx("div",{className:"bg-gray-100 p-3 rounded-full",children:g.jsx("i",{className:"fas fa-cog text-black text-xl"})}),g.jsxs("div",{children:[g.jsx("h3",{className:"font-bold mb-2",children:"설정"}),g.jsx("p",{className:"text-gray-600",children:"사용자 프로필·비밀번호 변경, 알림 설정 등을 관리할 수 있습니다."})]})]}),g.jsxs("div",{className:"flex items-start space-x-4",children:[g.jsx("div",{className:"bg-gray-100 p-3 rounded-full",children:g.jsx("i",{className:"fas fa-bell text-black text-xl"})}),g.jsxs("div",{children:[g.jsx("h3",{className:"font-bold mb-2",children:"알림"}),g.jsx("p",{className:"text-gray-600",children:"카메라 오프라인, 특정 이벤트 감지 시 알림을 받을 수 있습니다."})]})]})]})})]})]})})]})]})}function wv(){const[n,e]=D.useState(""),[t,r]=D.useState(""),[i,s]=D.useState(""),[o,a]=D.useState(""),[l,u]=D.useState(""),c=[{id:1,name:"정문 CCTV"},{id:2,name:"로비 CCTV"},{id:3,name:"주차장 CCTV"}],d=h=>{const m=h.target.value;e(m),m!=="네"&&r("")},f=()=>{alert("AI 보고서를 생성합니다. (예시)")};return g.jsxs("div",{className:"bg-gray-50 font-sans min-h-screen",children:[g.jsx("nav",{className:"bg-white shadow",children:g.jsx("div",{className:"max-w-8xl mx-auto px-4 sm:px-6 lg:px-8",children:g.jsxs("div",{className:"flex justify-between h-16 items-center",children:[g.jsxs("div",{className:"flex items-center space-x-8",children:[g.jsx("span",{className:"text-xl font-bold text-black",children:"I See U"}),g.jsxs("div",{className:"flex space-x-3",children:[g.jsx(ke,{to:"/monitor",className:"inline-flex items-center px-1 pt-1 nav-link text-gray-500 hover:text-black",style:{padding:"0.5rem 1rem",borderRadius:"0.375rem",transition:"all 0.3s ease",backgroundColor:"#f3f4f6",color:"#000000"},children:"내 모니터링"}),g.jsx(ke,{to:"/dashboard",className:"inline-flex items-center px-1 pt-1 nav-link text-gray-500 hover:text-black",style:{padding:"0.5rem 1rem",borderRadius:"0.375rem",transition:"all 0.3s ease",backgroundColor:"#f3f4f6",color:"#000000"},children:"통계 분석"}),g.jsx(ke,{to:"/ai-insight",className:"inline-flex items-center px-1 pt-1 nav-link bg-black text-white font-medium",style:{padding:"0.5rem 1rem",borderRadius:"0.375rem",transition:"all 0.3s ease"},children:"AI 인사이트"}),g.jsx(ke,{to:"/guide",className:"inline-flex items-center px-1 pt-1 nav-link text-gray-500 hover:text-black",style:{padding:"0.5rem 1rem",borderRadius:"0.375rem",transition:"all 0.3s ease",backgroundColor:"#f3f4f6",color:"#000000"},children:"사용 방법"}),g.jsx("button",{type:"button",className:"inline-flex items-center px-1 pt-1 text-gray-500 hover:text-black nav-link",style:{padding:"0.5rem 1rem",borderRadius:"0.375rem",transition:"all 0.3s ease",backgroundColor:"#f3f4f6",color:"#000000"},children:"개인정보법 안내"})]})]}),g.jsxs("div",{className:"flex items-center",children:[g.jsxs("button",{className:"p-2 rounded-full hover:bg-gray-100 relative",children:[g.jsx("i",{className:"fas fa-bell text-gray-600"}),g.jsx("span",{className:"absolute top-1 right-1 bg-red-500 rounded-full w-2 h-2"})]}),g.jsx("button",{className:"ml-3 p-2 rounded-full hover:bg-gray-100",children:g.jsx("i",{className:"fas fa-cog text-gray-600"})}),g.jsxs("div",{className:"ml-4 flex items-center",children:[g.jsx("img",{className:"h-8 w-8 rounded-full",src:"/기본프로필.png",alt:"사용자 프로필"}),g.jsx("span",{className:"ml-2 text-sm font-medium text-gray-700",children:"김관리자"})]})]})]})})}),g.jsxs("div",{className:"max-w-8xl mx-auto px-4 sm:px-6 lg:px-8 pt-8 pb-16",children:[g.jsxs("div",{className:"mb-8",children:[g.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"전략/인사이트"}),g.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"아래 정보를 입력하여 AI 기반 보고서를 생성해 보세요."})]}),g.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[g.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-4",children:[g.jsxs("div",{className:"flex-1",children:[g.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"매장 기본 정보"}),g.jsx("input",{type:"text",placeholder:"예) 매장 이름 또는 요약 정보 입력",className:"block w-full rounded-md border-gray-300 focus:border-custom focus:ring-custom"})]}),g.jsxs("div",{className:"flex-1",children:[g.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"분석할 CCTV"}),g.jsxs("select",{className:"block w-full rounded-md border-gray-300 focus:border-custom focus:ring-custom",value:l,onChange:h=>u(h.target.value),children:[g.jsx("option",{value:"",children:"CCTV를 선택하세요"}),c.map(h=>g.jsx("option",{value:h.name,children:h.name},h.id))]})]})]}),g.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-4",children:[g.jsxs("div",{className:"flex-1",children:[g.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"창업 여부"}),g.jsxs("select",{className:"mt-1 block w-full rounded-md border-gray-300 focus:border-custom focus:ring-custom",value:n,onChange:d,children:[g.jsx("option",{value:"",children:"선택"}),g.jsx("option",{value:"네",children:"네"}),g.jsx("option",{value:"아니오",children:"아니오"})]})]}),g.jsxs("div",{className:"flex-1",children:[g.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"업종 입력"}),g.jsx("input",{type:"text",placeholder:"예) 카페, 레스토랑 등",className:"mt-1 block w-full rounded-md border-gray-300 focus:border-custom focus:ring-custom",value:t,onChange:h=>r(h.target.value),disabled:n!=="네"})]})]}),g.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[g.jsxs("div",{className:"flex-1",children:[g.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"데이터 시작 일자"}),g.jsx("input",{type:"date",className:"block w-full rounded-md border-gray-300 focus:border-custom focus:ring-custom",value:i,onChange:h=>s(h.target.value)})]}),g.jsxs("div",{className:"flex-1",children:[g.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"데이터 종료 일자"}),g.jsx("input",{type:"date",className:"block w-full rounded-md border-gray-300 focus:border-custom focus:ring-custom",value:o,onChange:h=>a(h.target.value)})]})]}),g.jsx("button",{type:"button",onClick:f,className:"w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-black hover:bg-black/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-black",children:"AI 보고서 생성하기"})]}),g.jsxs("div",{className:"mt-12 bg-white shadow rounded-lg",children:[g.jsxs("div",{className:"px-6 py-5 border-b border-gray-200",children:[g.jsx("h3",{className:"text-lg font-medium leading-6 text-gray-900",children:"AI 보고서"}),g.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"생성된 보고서 내용이 표시됩니다."})]}),g.jsxs("div",{className:"px-6 py-5",children:[g.jsx("div",{className:"mb-4",children:g.jsx("h4",{className:"text-base font-semibold text-gray-900",children:"예시 보고서 제목"})}),g.jsxs("div",{className:"mb-4",children:[g.jsxs("p",{className:"text-sm text-gray-700",children:[g.jsx("strong",{children:"주요 키워드:"})," #혼잡도 #매출예측 #직장인유동인구"]}),g.jsxs("p",{className:"mt-2 text-sm text-gray-600",children:[g.jsx("strong",{children:"간단 요약:"})," ","이번 주말 저녁 시간대에 20대~30대 방문자 증가가 예상되며, 매출 상승 기회가 높습니다."]})]}),g.jsx("div",{className:"bg-gray-50 p-4 rounded-lg text-sm text-gray-700 leading-relaxed",children:g.jsxs("p",{children:["• 예상 방문자 수: 약 1,500명",g.jsx("br",{}),"• 평균 체류 시간: 40분",g.jsx("br",{}),"• 예상 매출: 3,000,000원",g.jsx("br",{}),"• 프로모션 제안: 20대 직장인을 위한 SNS 이벤트"]})}),g.jsx("div",{className:"mt-6 flex justify-end",children:g.jsx("button",{type:"button",className:"inline-flex items-center px-4 py-2 border border-black rounded-md text-black hover:bg-black/10 transition-colors",children:"상세 내용 다운로드"})})]})]})]}),g.jsx("div",{className:"fixed bottom-6 right-6",children:g.jsx("button",{type:"button",className:"rounded-full bg-black p-4 text-white shadow-lg hover:bg-black/90",children:g.jsx("i",{className:"fas fa-robot text-xl"})})})]})}function Cv(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var t0={exports:{}};(function(n,e){(function(t){var r=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,i=/^(?=([^\/?#]*))\1([^]*)$/,s=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,a={buildAbsoluteURL:function(l,u,c){if(c=c||{},l=l.trim(),u=u.trim(),!u){if(!c.alwaysNormalize)return l;var d=a.parseURL(l);if(!d)throw new Error("Error trying to parse base URL.");return d.path=a.normalizePath(d.path),a.buildURLFromParts(d)}var f=a.parseURL(u);if(!f)throw new Error("Error trying to parse relative URL.");if(f.scheme)return c.alwaysNormalize?(f.path=a.normalizePath(f.path),a.buildURLFromParts(f)):u;var h=a.parseURL(l);if(!h)throw new Error("Error trying to parse base URL.");if(!h.netLoc&&h.path&&h.path[0]!=="/"){var m=i.exec(h.path);h.netLoc=m[1],h.path=m[2]}h.netLoc&&!h.path&&(h.path="/");var p={scheme:h.scheme,netLoc:f.netLoc,path:null,params:f.params,query:f.query,fragment:f.fragment};if(!f.netLoc&&(p.netLoc=h.netLoc,f.path[0]!=="/"))if(!f.path)p.path=h.path,f.params||(p.params=h.params,f.query||(p.query=h.query));else{var x=h.path,y=x.substring(0,x.lastIndexOf("/")+1)+f.path;p.path=a.normalizePath(y)}return p.path===null&&(p.path=c.alwaysNormalize?a.normalizePath(f.path):f.path),a.buildURLFromParts(p)},parseURL:function(l){var u=r.exec(l);return u?{scheme:u[1]||"",netLoc:u[2]||"",path:u[3]||"",params:u[4]||"",query:u[5]||"",fragment:u[6]||""}:null},normalizePath:function(l){for(l=l.split("").reverse().join("").replace(s,"");l.length!==(l=l.replace(o,"")).length;);return l.split("").reverse().join("")},buildURLFromParts:function(l){return l.scheme+l.netLoc+l.path+l.params+l.query+l.fragment}};n.exports=a})()})(t0);var Hu=t0.exports;function wd(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function De(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?wd(Object(t),!0).forEach(function(r){bv(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):wd(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function Iv(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function kv(n){var e=Iv(n,"string");return typeof e=="symbol"?e:String(e)}function bv(n,e,t){return e=kv(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function Te(){return Te=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Te.apply(this,arguments)}const G=Number.isFinite||function(n){return typeof n=="number"&&isFinite(n)},Dv=Number.isSafeInteger||function(n){return typeof n=="number"&&Math.abs(n)<=_v},_v=Number.MAX_SAFE_INTEGER||9007199254740991;let E=function(n){return n.MEDIA_ATTACHING="hlsMediaAttaching",n.MEDIA_ATTACHED="hlsMediaAttached",n.MEDIA_DETACHING="hlsMediaDetaching",n.MEDIA_DETACHED="hlsMediaDetached",n.BUFFER_RESET="hlsBufferReset",n.BUFFER_CODECS="hlsBufferCodecs",n.BUFFER_CREATED="hlsBufferCreated",n.BUFFER_APPENDING="hlsBufferAppending",n.BUFFER_APPENDED="hlsBufferAppended",n.BUFFER_EOS="hlsBufferEos",n.BUFFER_FLUSHING="hlsBufferFlushing",n.BUFFER_FLUSHED="hlsBufferFlushed",n.MANIFEST_LOADING="hlsManifestLoading",n.MANIFEST_LOADED="hlsManifestLoaded",n.MANIFEST_PARSED="hlsManifestParsed",n.LEVEL_SWITCHING="hlsLevelSwitching",n.LEVEL_SWITCHED="hlsLevelSwitched",n.LEVEL_LOADING="hlsLevelLoading",n.LEVEL_LOADED="hlsLevelLoaded",n.LEVEL_UPDATED="hlsLevelUpdated",n.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",n.LEVELS_UPDATED="hlsLevelsUpdated",n.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",n.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",n.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",n.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",n.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",n.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",n.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",n.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",n.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",n.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",n.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",n.CUES_PARSED="hlsCuesParsed",n.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",n.INIT_PTS_FOUND="hlsInitPtsFound",n.FRAG_LOADING="hlsFragLoading",n.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",n.FRAG_LOADED="hlsFragLoaded",n.FRAG_DECRYPTED="hlsFragDecrypted",n.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",n.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",n.FRAG_PARSING_METADATA="hlsFragParsingMetadata",n.FRAG_PARSED="hlsFragParsed",n.FRAG_BUFFERED="hlsFragBuffered",n.FRAG_CHANGED="hlsFragChanged",n.FPS_DROP="hlsFpsDrop",n.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",n.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",n.ERROR="hlsError",n.DESTROYING="hlsDestroying",n.KEY_LOADING="hlsKeyLoading",n.KEY_LOADED="hlsKeyLoaded",n.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",n.BACK_BUFFER_REACHED="hlsBackBufferReached",n.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",n}({}),X=function(n){return n.NETWORK_ERROR="networkError",n.MEDIA_ERROR="mediaError",n.KEY_SYSTEM_ERROR="keySystemError",n.MUX_ERROR="muxError",n.OTHER_ERROR="otherError",n}({}),b=function(n){return n.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",n.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",n.KEY_SYSTEM_NO_SESSION="keySystemNoSession",n.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",n.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",n.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",n.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",n.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",n.MANIFEST_LOAD_ERROR="manifestLoadError",n.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",n.MANIFEST_PARSING_ERROR="manifestParsingError",n.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",n.LEVEL_EMPTY_ERROR="levelEmptyError",n.LEVEL_LOAD_ERROR="levelLoadError",n.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",n.LEVEL_PARSING_ERROR="levelParsingError",n.LEVEL_SWITCH_ERROR="levelSwitchError",n.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",n.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",n.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",n.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",n.FRAG_LOAD_ERROR="fragLoadError",n.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",n.FRAG_DECRYPT_ERROR="fragDecryptError",n.FRAG_PARSING_ERROR="fragParsingError",n.FRAG_GAP="fragGap",n.REMUX_ALLOC_ERROR="remuxAllocError",n.KEY_LOAD_ERROR="keyLoadError",n.KEY_LOAD_TIMEOUT="keyLoadTimeOut",n.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",n.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",n.BUFFER_APPEND_ERROR="bufferAppendError",n.BUFFER_APPENDING_ERROR="bufferAppendingError",n.BUFFER_STALLED_ERROR="bufferStalledError",n.BUFFER_FULL_ERROR="bufferFullError",n.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",n.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",n.INTERNAL_EXCEPTION="internalException",n.INTERNAL_ABORTED="aborted",n.UNKNOWN="unknown",n}({});const bn=function(){},bl={trace:bn,debug:bn,log:bn,warn:bn,info:bn,error:bn};let ii=bl;function Nv(n){const e=self.console[n];return e?e.bind(self.console,`[${n}] >`):bn}function Pv(n,...e){e.forEach(function(t){ii[t]=n[t]?n[t].bind(n):Nv(t)})}function Fv(n,e){if(typeof console=="object"&&n===!0||typeof n=="object"){Pv(n,"debug","log","info","warn","error");try{ii.log(`Debug logs enabled for "${e}" in hls.js version 1.5.20`)}catch{ii=bl}}else ii=bl}const w=ii,Ov=/^(\d+)x(\d+)$/,Cd=/(.+?)=(".*?"|.*?)(?:,|$)/g;class me{constructor(e){typeof e=="string"&&(e=me.parseAttrList(e)),Te(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const r=new Uint8Array(t.length/2);for(let i=0;i<t.length/2;i++)r[i]=parseInt(t.slice(i*2,i*2+2),16);return r}else return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const r=this[e];return r?parseFloat(r):t}enumeratedString(e){return this[e]}bool(e){return this[e]==="YES"}decimalResolution(e){const t=Ov.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e){let t;const r={},i='"';for(Cd.lastIndex=0;(t=Cd.exec(e))!==null;){let s=t[2];s.indexOf(i)===0&&s.lastIndexOf(i)===s.length-1&&(s=s.slice(1,-1));const o=t[1].trim();r[o]=s}return r}}function Mv(n){return n!=="ID"&&n!=="CLASS"&&n!=="START-DATE"&&n!=="DURATION"&&n!=="END-DATE"&&n!=="END-ON-NEXT"}function Uv(n){return n==="SCTE35-OUT"||n==="SCTE35-IN"}class n0{constructor(e,t){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,t){const r=t.attr;for(const i in r)if(Object.prototype.hasOwnProperty.call(e,i)&&e[i]!==r[i]){w.warn(`DATERANGE tag attribute: "${i}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=i;break}e=Te(new me({}),r,e)}if(this.attr=e,this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const r=new Date(this.attr["END-DATE"]);G(r.getTime())&&(this._endDate=r)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get startDate(){return this._startDate}get endDate(){if(this._endDate)return this._endDate;const e=this.duration;return e!==null?new Date(this._startDate.getTime()+e*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(G(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isValid(){return!!this.id&&!this._badValueForSameId&&G(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}class Fo{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var se={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class r0{constructor(e){this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams={[se.AUDIO]:null,[se.VIDEO]:null,[se.AUDIOVIDEO]:null},this.baseurl=e}setByteRange(e,t){const r=e.split("@",2);let i;r.length===1?i=(t==null?void 0:t.byteRangeEndOffset)||0:i=parseInt(r[1]),this._byteRange=[i,parseInt(r[0])+i]}get byteRange(){return this._byteRange?this._byteRange:[]}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Hu.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}}class fa extends r0{constructor(e,t){super(t),this._decryptdata=null,this.rawProgramDateTime=null,this.programDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.stats=new Fo,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get decryptdata(){const{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{const r=Object.keys(this.levelkeys);if(r.length===1)return this._decryptdata=this.levelkeys[r[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null||!G(this.programDateTime))return null;const e=G(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){const t=Object.keys(this.levelkeys),r=t.length;if(r>1||r===1&&this.levelkeys[t[0]].encrypted)return!0}return!1}setKeyFormat(e){if(this.levelkeys){const t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,r,i,s,o=!1){const{elementaryStreams:a}=this,l=a[e];if(!l){a[e]={startPTS:t,endPTS:r,startDTS:i,endDTS:s,partial:o};return}l.startPTS=Math.min(l.startPTS,t),l.endPTS=Math.max(l.endPTS,r),l.startDTS=Math.min(l.startDTS,i),l.endDTS=Math.max(l.endDTS,s)}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[se.AUDIO]=null,e[se.VIDEO]=null,e[se.AUDIOVIDEO]=null}}class Bv extends r0{constructor(e,t,r,i,s){super(r),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.stats=new Fo,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=i;const o=e.enumeratedString("BYTERANGE");o&&this.setByteRange(o,s),s&&(this.fragOffset=s.fragOffset+s.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}const $v=10;class jv{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,r=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!r||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&r>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1,this.availabilityDelay=e.availabilityDelay}get hasProgramDateTime(){return this.fragments.length?G(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||$v}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var e;return(e=this.fragments)!=null&&e.length?this.fragments[this.fragments.length-1].end:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}function zu(n){return Uint8Array.from(atob(n),e=>e.charCodeAt(0))}function Gv(n){const e=Dl(n).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function Vv(n){const e=function(r,i,s){const o=r[i];r[i]=r[s],r[s]=o};e(n,0,3),e(n,1,2),e(n,4,5),e(n,6,7)}function Kv(n){const e=n.split(":");let t=null;if(e[0]==="data"&&e.length===2){const r=e[1].split(";"),i=r[r.length-1].split(",");if(i.length===2){const s=i[0]==="base64",o=i[1];s?(r.splice(-1,1),t=zu(o)):t=Gv(o)}}return t}function Dl(n){return Uint8Array.from(unescape(encodeURIComponent(n)),e=>e.charCodeAt(0))}const wr=typeof self<"u"?self:void 0;var ie={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Ye={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function ha(n){switch(n){case Ye.FAIRPLAY:return ie.FAIRPLAY;case Ye.PLAYREADY:return ie.PLAYREADY;case Ye.WIDEVINE:return ie.WIDEVINE;case Ye.CLEARKEY:return ie.CLEARKEY}}var Zi={CENC:"1077efecc0b24d02ace33c1e52e2fb4b",CLEARKEY:"e2719d58a985b3c9781ab030af78d30e",FAIRPLAY:"94ce86fb07ff4f43adb893d2fa968ca2",PLAYREADY:"9a04f07998404286ab92e65be0885f95",WIDEVINE:"edef8ba979d64acea3c827dcd51d21ed"};function ma(n){if(n===Zi.WIDEVINE)return ie.WIDEVINE;if(n===Zi.PLAYREADY)return ie.PLAYREADY;if(n===Zi.CENC||n===Zi.CLEARKEY)return ie.CLEARKEY}function ga(n){switch(n){case ie.FAIRPLAY:return Ye.FAIRPLAY;case ie.PLAYREADY:return Ye.PLAYREADY;case ie.WIDEVINE:return Ye.WIDEVINE;case ie.CLEARKEY:return Ye.CLEARKEY}}function es(n){const{drmSystems:e,widevineLicenseUrl:t}=n,r=e?[ie.FAIRPLAY,ie.WIDEVINE,ie.PLAYREADY,ie.CLEARKEY].filter(i=>!!e[i]):[];return!r[ie.WIDEVINE]&&t&&r.push(ie.WIDEVINE),r}const i0=function(n){return wr!=null&&(n=wr.navigator)!=null&&n.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function Hv(n,e,t,r){let i;switch(n){case ie.FAIRPLAY:i=["cenc","sinf"];break;case ie.WIDEVINE:case ie.PLAYREADY:i=["cenc"];break;case ie.CLEARKEY:i=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${n}`)}return zv(i,e,t,r)}function zv(n,e,t,r){return[{initDataTypes:n,persistentState:r.persistentState||"optional",distinctiveIdentifier:r.distinctiveIdentifier||"optional",sessionTypes:r.sessionTypes||[r.sessionType||"temporary"],audioCapabilities:e.map(s=>({contentType:`audio/mp4; codecs="${s}"`,robustness:r.audioRobustness||"",encryptionScheme:r.audioEncryptionScheme||null})),videoCapabilities:t.map(s=>({contentType:`video/mp4; codecs="${s}"`,robustness:r.videoRobustness||"",encryptionScheme:r.videoEncryptionScheme||null}))}]}function s0(n){const e=new Uint16Array(n.buffer,n.byteOffset,n.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),r=t.substring(t.indexOf("<"),t.length),o=new DOMParser().parseFromString(r,"text/xml").getElementsByTagName("KID")[0];if(o){const a=o.childNodes[0]?o.childNodes[0].nodeValue:o.getAttribute("VALUE");if(a){const l=zu(a).subarray(0,16);return Vv(l),l}}return null}function Un(n,e,t){return Uint8Array.prototype.slice?n.slice(e,t):new Uint8Array(Array.prototype.slice.call(n,e,t))}const Wu=(n,e)=>e+10<=n.length&&n[e]===73&&n[e+1]===68&&n[e+2]===51&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128,o0=(n,e)=>e+10<=n.length&&n[e]===51&&n[e+1]===68&&n[e+2]===73&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128,Li=(n,e)=>{const t=e;let r=0;for(;Wu(n,e);){r+=10;const i=Oo(n,e+6);r+=i,o0(n,e+10)&&(r+=10),e+=r}if(r>0)return n.subarray(t,t+r)},Oo=(n,e)=>{let t=0;return t=(n[e]&127)<<21,t|=(n[e+1]&127)<<14,t|=(n[e+2]&127)<<7,t|=n[e+3]&127,t},Wv=(n,e)=>Wu(n,e)&&Oo(n,e+6)+10<=n.length-e,Yu=n=>{const e=l0(n);for(let t=0;t<e.length;t++){const r=e[t];if(a0(r))return Zv(r)}},a0=n=>n&&n.key==="PRIV"&&n.info==="com.apple.streaming.transportStreamTimestamp",Yv=n=>{const e=String.fromCharCode(n[0],n[1],n[2],n[3]),t=Oo(n,4),r=10;return{type:e,size:t,data:n.subarray(r,r+t)}},l0=n=>{let e=0;const t=[];for(;Wu(n,e);){const r=Oo(n,e+6);e+=10;const i=e+r;for(;e+8<i;){const s=Yv(n.subarray(e)),o=qv(s);o&&t.push(o),e+=s.size+10}o0(n,e)&&(e+=10)}return t},qv=n=>n.type==="PRIV"?Xv(n):n.type[0]==="W"?Jv(n):Qv(n),Xv=n=>{if(n.size<2)return;const e=Pt(n.data,!0),t=new Uint8Array(n.data.subarray(e.length+1));return{key:n.type,info:e,data:t.buffer}},Qv=n=>{if(n.size<2)return;if(n.type==="TXXX"){let t=1;const r=Pt(n.data.subarray(t),!0);t+=r.length+1;const i=Pt(n.data.subarray(t));return{key:n.type,info:r,data:i}}const e=Pt(n.data.subarray(1));return{key:n.type,data:e}},Jv=n=>{if(n.type==="WXXX"){if(n.size<2)return;let t=1;const r=Pt(n.data.subarray(t),!0);t+=r.length+1;const i=Pt(n.data.subarray(t));return{key:n.type,info:r,data:i}}const e=Pt(n.data);return{key:n.type,data:e}},Zv=n=>{if(n.data.byteLength===8){const e=new Uint8Array(n.data),t=e[3]&1;let r=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return r/=45,t&&(r+=4772185884e-2),Math.round(r)}},Pt=(n,e=!1)=>{const t=eE();if(t){const u=t.decode(n);if(e){const c=u.indexOf("\0");return c!==-1?u.substring(0,c):u}return u.replace(/\0/g,"")}const r=n.length;let i,s,o,a="",l=0;for(;l<r;){if(i=n[l++],i===0&&e)return a;if(i===0||i===3)continue;switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(i);break;case 12:case 13:s=n[l++],a+=String.fromCharCode((i&31)<<6|s&63);break;case 14:s=n[l++],o=n[l++],a+=String.fromCharCode((i&15)<<12|(s&63)<<6|(o&63)<<0);break}}return a};let pa;function eE(){if(!navigator.userAgent.includes("PlayStation 4"))return!pa&&typeof self.TextDecoder<"u"&&(pa=new self.TextDecoder("utf-8")),pa}const Ct={hexDump:function(n){let e="";for(let t=0;t<n.length;t++){let r=n[t].toString(16);r.length<2&&(r="0"+r),e+=r}return e}},so=Math.pow(2,32)-1,tE=[].push,u0={video:1,audio:2,id3:3,text:4};function Le(n){return String.fromCharCode.apply(null,n)}function c0(n,e){const t=n[e]<<8|n[e+1];return t<0?65536+t:t}function z(n,e){const t=d0(n,e);return t<0?4294967296+t:t}function Id(n,e){let t=z(n,e);return t*=Math.pow(2,32),t+=z(n,e+4),t}function d0(n,e){return n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3]}function ya(n,e,t){n[e]=t>>24,n[e+1]=t>>16&255,n[e+2]=t>>8&255,n[e+3]=t&255}function nE(n){const e=n.byteLength;for(let t=0;t<e;){const r=z(n,t);if(r>8&&n[t+4]===109&&n[t+5]===111&&n[t+6]===111&&n[t+7]===102)return!0;t=r>1?t+r:e}return!1}function Q(n,e){const t=[];if(!e.length)return t;const r=n.byteLength;for(let i=0;i<r;){const s=z(n,i),o=Le(n.subarray(i+4,i+8)),a=s>1?i+s:r;if(o===e[0])if(e.length===1)t.push(n.subarray(i+8,a));else{const l=Q(n.subarray(i+8,a),e.slice(1));l.length&&tE.apply(t,l)}i=a}return t}function rE(n){const e=[],t=n[0];let r=8;const i=z(n,r);r+=4;let s=0,o=0;t===0?(s=z(n,r),o=z(n,r+4),r+=8):(s=Id(n,r),o=Id(n,r+8),r+=16),r+=2;let a=n.length+o;const l=c0(n,r);r+=2;for(let u=0;u<l;u++){let c=r;const d=z(n,c);c+=4;const f=d&2147483647;if((d&2147483648)>>>31===1)return w.warn("SIDX has hierarchical references (not supported)"),null;const m=z(n,c);c+=4,e.push({referenceSize:f,subsegmentDuration:m,info:{duration:m/i,start:a,end:a+f-1}}),a+=f,c+=4,r=c}return{earliestPresentationTime:s,timescale:i,version:t,referencesCount:l,references:e}}function f0(n){const e=[],t=Q(n,["moov","trak"]);for(let i=0;i<t.length;i++){const s=t[i],o=Q(s,["tkhd"])[0];if(o){let a=o[0];const l=z(o,a===0?12:20),u=Q(s,["mdia","mdhd"])[0];if(u){a=u[0];const c=z(u,a===0?12:20),d=Q(s,["mdia","hdlr"])[0];if(d){const f=Le(d.subarray(8,12)),h={soun:se.AUDIO,vide:se.VIDEO}[f];if(h){const m=Q(s,["mdia","minf","stbl","stsd"])[0],p=iE(m);e[l]={timescale:c,type:h},e[h]=De({timescale:c,id:l},p)}}}}}return Q(n,["moov","mvex","trex"]).forEach(i=>{const s=z(i,4),o=e[s];o&&(o.default={duration:z(i,12),flags:z(i,20)})}),e}function iE(n){const e=n.subarray(8),t=e.subarray(8+78),r=Le(e.subarray(4,8));let i=r;const s=r==="enca"||r==="encv";if(s){const a=Q(e,[r])[0].subarray(r==="enca"?28:78);Q(a,["sinf"]).forEach(u=>{const c=Q(u,["schm"])[0];if(c){const d=Le(c.subarray(4,8));if(d==="cbcs"||d==="cenc"){const f=Q(u,["frma"])[0];f&&(i=Le(f))}}})}switch(i){case"avc1":case"avc2":case"avc3":case"avc4":{const o=Q(t,["avcC"])[0];i+="."+ts(o[1])+ts(o[2])+ts(o[3]);break}case"mp4a":{const o=Q(e,[r])[0],a=Q(o.subarray(28),["esds"])[0];if(a&&a.length>12){let l=4;if(a[l++]!==3)break;l=xa(a,l),l+=2;const u=a[l++];if(u&128&&(l+=2),u&64&&(l+=a[l++]),a[l++]!==4)break;l=xa(a,l);const c=a[l++];if(c===64)i+="."+ts(c);else break;if(l+=12,a[l++]!==5)break;l=xa(a,l);const d=a[l++];let f=(d&248)>>3;f===31&&(f+=1+((d&7)<<3)+((a[l]&224)>>5)),i+="."+f}break}case"hvc1":case"hev1":{const o=Q(t,["hvcC"])[0],a=o[1],l=["","A","B","C"][a>>6],u=a&31,c=z(o,2),d=(a&32)>>5?"H":"L",f=o[12],h=o.subarray(6,12);i+="."+l+u,i+="."+c.toString(16).toUpperCase(),i+="."+d+f;let m="";for(let p=h.length;p--;){const x=h[p];(x||m)&&(m="."+x.toString(16).toUpperCase()+m)}i+=m;break}case"dvh1":case"dvhe":{const o=Q(t,["dvcC"])[0],a=o[2]>>1&127,l=o[2]<<5&32|o[3]>>3&31;i+="."+At(a)+"."+At(l);break}case"vp09":{const o=Q(t,["vpcC"])[0],a=o[4],l=o[5],u=o[6]>>4&15;i+="."+At(a)+"."+At(l)+"."+At(u);break}case"av01":{const o=Q(t,["av1C"])[0],a=o[1]>>>5,l=o[1]&31,u=o[2]>>>7?"H":"M",c=(o[2]&64)>>6,d=(o[2]&32)>>5,f=a===2&&c?d?12:10:c?10:8,h=(o[2]&16)>>4,m=(o[2]&8)>>3,p=(o[2]&4)>>2,x=o[2]&3,y=1,v=1,S=1,L=0;i+="."+a+"."+At(l)+u+"."+At(f)+"."+h+"."+m+p+x+"."+At(y)+"."+At(v)+"."+At(S)+"."+L;break}}return{codec:i,encrypted:s}}function xa(n,e){const t=e+5;for(;n[e++]&128&&e<t;);return e}function ts(n){return("0"+n.toString(16).toUpperCase()).slice(-2)}function At(n){return(n<10?"0":"")+n}function sE(n,e){if(!n||!e)return n;const t=e.keyId;return t&&e.isCommonEncryption&&Q(n,["moov","trak"]).forEach(i=>{const o=Q(i,["mdia","minf","stbl","stsd"])[0].subarray(8);let a=Q(o,["enca"]);const l=a.length>0;l||(a=Q(o,["encv"])),a.forEach(u=>{const c=l?u.subarray(28):u.subarray(78);Q(c,["sinf"]).forEach(f=>{const h=h0(f);if(h){const m=h.subarray(8,24);m.some(p=>p!==0)||(w.log(`[eme] Patching keyId in 'enc${l?"a":"v"}>sinf>>tenc' box: ${Ct.hexDump(m)} -> ${Ct.hexDump(t)}`),h.set(t,8))}})})}),n}function h0(n){const e=Q(n,["schm"])[0];if(e){const t=Le(e.subarray(4,8));if(t==="cbcs"||t==="cenc")return Q(n,["schi","tenc"])[0]}return null}function oE(n,e){return Q(e,["moof","traf"]).reduce((t,r)=>{const i=Q(r,["tfdt"])[0],s=i[0],o=Q(r,["tfhd"]).reduce((a,l)=>{const u=z(l,4),c=n[u];if(c){let d=z(i,4);if(s===1){if(d===so)return w.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),a;d*=so+1,d+=z(i,8)}const f=c.timescale||9e4,h=d/f;if(G(h)&&(a===null||h<a))return h}return a},null);return o!==null&&G(o)&&(t===null||o<t)?o:t},null)}function aE(n,e){let t=0,r=0,i=0;const s=Q(n,["moof","traf"]);for(let o=0;o<s.length;o++){const a=s[o],l=Q(a,["tfhd"])[0],u=z(l,4),c=e[u];if(!c)continue;const d=c.default,f=z(l,0)|(d==null?void 0:d.flags);let h=d==null?void 0:d.duration;f&8&&(f&2?h=z(l,12):h=z(l,8));const m=c.timescale||9e4,p=Q(a,["trun"]);for(let x=0;x<p.length;x++){if(t=lE(p[x]),!t&&h){const y=z(p[x],4);t=h*y}c.type===se.VIDEO?r+=t/m:c.type===se.AUDIO&&(i+=t/m)}}if(r===0&&i===0){let o=1/0,a=0,l=0;const u=Q(n,["sidx"]);for(let c=0;c<u.length;c++){const d=rE(u[c]);if(d!=null&&d.references){o=Math.min(o,d.earliestPresentationTime/d.timescale);const f=d.references.reduce((h,m)=>h+m.info.duration||0,0);a=Math.max(a,f+d.earliestPresentationTime/d.timescale),l=a-o}}if(l&&G(l))return l}return r||i}function lE(n){const e=z(n,0);let t=8;e&1&&(t+=4),e&4&&(t+=4);let r=0;const i=z(n,4);for(let s=0;s<i;s++){if(e&256){const o=z(n,t);r+=o,t+=4}e&512&&(t+=4),e&1024&&(t+=4),e&2048&&(t+=4)}return r}function uE(n,e,t){Q(e,["moof","traf"]).forEach(r=>{Q(r,["tfhd"]).forEach(i=>{const s=z(i,4),o=n[s];if(!o)return;const a=o.timescale||9e4;Q(r,["tfdt"]).forEach(l=>{const u=l[0],c=t*a;if(c){let d=z(l,4);if(u===0)d-=c,d=Math.max(d,0),ya(l,4,d);else{d*=Math.pow(2,32),d+=z(l,8),d-=c,d=Math.max(d,0);const f=Math.floor(d/(so+1)),h=Math.floor(d%(so+1));ya(l,4,f),ya(l,8,h)}}})})})}function cE(n){const e={valid:null,remainder:null},t=Q(n,["moof"]);if(t.length<2)return e.remainder=n,e;const r=t[t.length-1];return e.valid=Un(n,0,r.byteOffset-8),e.remainder=Un(n,r.byteOffset-8),e}function ht(n,e){const t=new Uint8Array(n.length+e.length);return t.set(n),t.set(e,n.length),t}function kd(n,e){const t=[],r=e.samples,i=e.timescale,s=e.id;let o=!1;return Q(r,["moof"]).map(l=>{const u=l.byteOffset-8;Q(l,["traf"]).map(d=>{const f=Q(d,["tfdt"]).map(h=>{const m=h[0];let p=z(h,4);return m===1&&(p*=Math.pow(2,32),p+=z(h,8)),p/i})[0];return f!==void 0&&(n=f),Q(d,["tfhd"]).map(h=>{const m=z(h,4),p=z(h,0)&16777215,x=(p&1)!==0,y=(p&2)!==0,v=(p&8)!==0;let S=0;const L=(p&16)!==0;let T=0;const A=(p&32)!==0;let R=8;m===s&&(x&&(R+=8),y&&(R+=4),v&&(S=z(h,R),R+=4),L&&(T=z(h,R),R+=4),A&&(R+=4),e.type==="video"&&(o=dE(e.codec)),Q(d,["trun"]).map(k=>{const _=k[0],C=z(k,0)&16777215,P=(C&1)!==0;let H=0;const B=(C&4)!==0,q=(C&256)!==0;let Y=0;const K=(C&512)!==0;let J=0;const M=(C&1024)!==0,F=(C&2048)!==0;let N=0;const $=z(k,4);let V=8;P&&(H=z(k,V),V+=4),B&&(V+=4);let ee=H+u;for(let re=0;re<$;re++){if(q?(Y=z(k,V),V+=4):Y=S,K?(J=z(k,V),V+=4):J=T,M&&(V+=4),F&&(_===0?N=z(k,V):N=d0(k,V),V+=4),e.type===se.VIDEO){let ae=0;for(;ae<J;){const le=z(r,ee);if(ee+=4,fE(o,r[ee])){const _e=r.subarray(ee,ee+le);m0(_e,o?2:1,n+N/i,t)}ee+=le,ae+=le+4}}n+=Y/i}}))})})}),t}function dE(n){if(!n)return!1;const e=n.indexOf("."),t=e<0?n:n.substring(0,e);return t==="hvc1"||t==="hev1"||t==="dvh1"||t==="dvhe"}function fE(n,e){if(n){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function m0(n,e,t,r){const i=g0(n);let s=0;s+=e;let o=0,a=0,l=0;for(;s<i.length;){o=0;do{if(s>=i.length)break;l=i[s++],o+=l}while(l===255);a=0;do{if(s>=i.length)break;l=i[s++],a+=l}while(l===255);const u=i.length-s;let c=s;if(a<u)s+=a;else if(a>u){w.error(`Malformed SEI payload. ${a} is too small, only ${u} bytes left to parse.`);break}if(o===4){if(i[c++]===181){const f=c0(i,c);if(c+=2,f===49){const h=z(i,c);if(c+=4,h===1195456820){const m=i[c++];if(m===3){const p=i[c++],x=31&p,y=64&p,v=y?2+x*3:0,S=new Uint8Array(v);if(y){S[0]=p;for(let L=1;L<v;L++)S[L]=i[c++]}r.push({type:m,payloadType:o,pts:t,bytes:S})}}}}}else if(o===5&&a>16){const d=[];for(let m=0;m<16;m++){const p=i[c++].toString(16);d.push(p.length==1?"0"+p:p),(m===3||m===5||m===7||m===9)&&d.push("-")}const f=a-16,h=new Uint8Array(f);for(let m=0;m<f;m++)h[m]=i[c++];r.push({payloadType:o,pts:t,uuid:d.join(""),userData:Pt(h),userDataBytes:h})}}}function g0(n){const e=n.byteLength,t=[];let r=1;for(;r<e-2;)n[r]===0&&n[r+1]===0&&n[r+2]===3?(t.push(r+2),r+=2):r++;if(t.length===0)return n;const i=e-t.length,s=new Uint8Array(i);let o=0;for(r=0;r<i;o++,r++)o===t[0]&&(o++,t.shift()),s[r]=n[o];return s}function hE(n){const e=n[0];let t="",r="",i=0,s=0,o=0,a=0,l=0,u=0;if(e===0){for(;Le(n.subarray(u,u+1))!=="\0";)t+=Le(n.subarray(u,u+1)),u+=1;for(t+=Le(n.subarray(u,u+1)),u+=1;Le(n.subarray(u,u+1))!=="\0";)r+=Le(n.subarray(u,u+1)),u+=1;r+=Le(n.subarray(u,u+1)),u+=1,i=z(n,12),s=z(n,16),a=z(n,20),l=z(n,24),u=28}else if(e===1){u+=4,i=z(n,u),u+=4;const d=z(n,u);u+=4;const f=z(n,u);for(u+=4,o=2**32*d+f,Dv(o)||(o=Number.MAX_SAFE_INTEGER,w.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),a=z(n,u),u+=4,l=z(n,u),u+=4;Le(n.subarray(u,u+1))!=="\0";)t+=Le(n.subarray(u,u+1)),u+=1;for(t+=Le(n.subarray(u,u+1)),u+=1;Le(n.subarray(u,u+1))!=="\0";)r+=Le(n.subarray(u,u+1)),u+=1;r+=Le(n.subarray(u,u+1)),u+=1}const c=n.subarray(u,n.byteLength);return{schemeIdUri:t,value:r,timeScale:i,presentationTime:o,presentationTimeDelta:s,eventDuration:a,id:l,payload:c}}function mE(n,...e){const t=e.length;let r=8,i=t;for(;i--;)r+=e[i].byteLength;const s=new Uint8Array(r);for(s[0]=r>>24&255,s[1]=r>>16&255,s[2]=r>>8&255,s[3]=r&255,s.set(n,4),i=0,r=8;i<t;i++)s.set(e[i],r),r+=e[i].byteLength;return s}function gE(n,e,t){if(n.byteLength!==16)throw new RangeError("Invalid system id");let r,i;if(e){r=1,i=new Uint8Array(e.length*16);for(let a=0;a<e.length;a++){const l=e[a];if(l.byteLength!==16)throw new RangeError("Invalid key");i.set(l,a*16)}}else r=0,i=new Uint8Array;let s;r>0?(s=new Uint8Array(4),e.length>0&&new DataView(s.buffer).setUint32(0,e.length,!1)):s=new Uint8Array;const o=new Uint8Array(4);return t&&t.byteLength>0&&new DataView(o.buffer).setUint32(0,t.byteLength,!1),mE([112,115,115,104],new Uint8Array([r,0,0,0]),n,s,i,o,t||new Uint8Array)}function pE(n){const e=[];if(n instanceof ArrayBuffer){const t=n.byteLength;let r=0;for(;r+32<t;){const i=new DataView(n,r),s=yE(i);e.push(s),r+=s.size}}return e}function yE(n){const e=n.getUint32(0),t=n.byteOffset,r=n.byteLength;if(r<e)return{offset:t,size:r};if(n.getUint32(4)!==1886614376)return{offset:t,size:e};const s=n.getUint32(8)>>>24;if(s!==0&&s!==1)return{offset:t,size:e};const o=n.buffer,a=Ct.hexDump(new Uint8Array(o,t+12,16)),l=n.getUint32(28);let u=null,c=null;if(s===0){if(e-32<l||l<22)return{offset:t,size:e};c=new Uint8Array(o,t+32,l)}else if(s===1){if(!l||r<t+32+l*16+16)return{offset:t,size:e};u=[];for(let d=0;d<l;d++)u.push(new Uint8Array(o,t+32+d*16,16))}return{version:s,systemId:a,kids:u,data:c,offset:t,size:e}}let ns={};class Ri{static clearKeyUriToKeyIdMap(){ns={}}constructor(e,t,r,i=[1],s=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=r,this.keyFormatVersions=i,this.iv=s,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&e!=="AES-128"}isSupported(){if(this.method){if(this.method==="AES-128"||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case Ye.FAIRPLAY:case Ye.WIDEVINE:case Ye.PLAYREADY:case Ye.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if(this.method==="AES-128"&&this.uri&&!this.iv){typeof e!="number"&&(this.method==="AES-128"&&!this.iv&&w.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0);const r=xE(e);return new Ri(this.method,this.uri,"identity",this.keyFormatVersions,r)}const t=Kv(this.uri);if(t)switch(this.keyFormat){case Ye.WIDEVINE:this.pssh=t,t.length>=22&&(this.keyId=t.subarray(t.length-22,t.length-6));break;case Ye.PLAYREADY:{const r=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=gE(r,null,t),this.keyId=s0(t);break}default:{let r=t.subarray(0,16);if(r.length!==16){const i=new Uint8Array(16);i.set(r,16-r.length),r=i}this.keyId=r;break}}if(!this.keyId||this.keyId.byteLength!==16){let r=ns[this.uri];if(!r){const i=Object.keys(ns).length%Number.MAX_SAFE_INTEGER;r=new Uint8Array(16),new DataView(r.buffer,12,4).setUint32(0,i),ns[this.uri]=r}this.keyId=r}return this}}function xE(n){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=n>>8*(15-t)&255;return e}const p0=/\{\$([a-zA-Z0-9-_]+)\}/g;function bd(n){return p0.test(n)}function ze(n,e,t){if(n.variableList!==null||n.hasVariableRefs)for(let r=t.length;r--;){const i=t[r],s=e[i];s&&(e[i]=_l(n,s))}}function _l(n,e){if(n.variableList!==null||n.hasVariableRefs){const t=n.variableList;return e.replace(p0,r=>{const i=r.substring(2,r.length-1),s=t==null?void 0:t[i];return s===void 0?(n.playlistParsingError||(n.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${i}"`)),r):s})}return e}function Dd(n,e,t){let r=n.variableList;r||(n.variableList=r={});let i,s;if("QUERYPARAM"in e){i=e.QUERYPARAM;try{const o=new self.URL(t).searchParams;if(o.has(i))s=o.get(i);else throw new Error(`"${i}" does not match any query parameter in URI: "${t}"`)}catch(o){n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${o.message}`))}}else i=e.NAME,s=e.VALUE;i in r?n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${i}"`)):r[i]=s||""}function vE(n,e,t){const r=e.IMPORT;if(t&&r in t){let i=n.variableList;i||(n.variableList=i={}),i[r]=t[r]}else n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${r}"`))}function Hn(n=!0){return typeof self>"u"?void 0:(n||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function EE(n){return typeof self<"u"&&n===self.ManagedMediaSource}const oo={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function SE(n,e){const t=oo[e];return!!t&&!!t[n.slice(0,4)]}function va(n,e,t=!0){return!n.split(",").some(r=>!y0(r,e,t))}function y0(n,e,t=!0){var r;const i=Hn(t);return(r=i==null?void 0:i.isTypeSupported(Ai(n,e)))!=null?r:!1}function Ai(n,e){return`${e}/mp4;codecs="${n}"`}function _d(n){if(n){const e=n.substring(0,4);return oo.video[e]}return 2}function ao(n){return n.split(",").reduce((e,t)=>{const r=oo.video[t];return r?(r*2+e)/(e?3:2):(oo.audio[t]+e)/(e?2:1)},0)}const Ea={};function TE(n,e=!0){if(Ea[n])return Ea[n];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"]}[n];for(let r=0;r<t.length;r++)if(y0(t[r],"audio",e))return Ea[n]=t[r],t[r];return n}const LE=/flac|opus/i;function lo(n,e=!0){return n.replace(LE,t=>TE(t.toLowerCase(),e))}function Nd(n,e){return n&&n!=="mp4a"?n:e&&e.split(",")[0]}function RE(n){const e=n.split(",");for(let t=0;t<e.length;t++){const r=e[t].split(".");if(r.length>2){let i=r.shift()+".";i+=parseInt(r.shift()).toString(16),i+=("000"+parseInt(r.shift()).toString(16)).slice(-4),e[t]=i}}return e.join(",")}const Pd=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,Fd=/#EXT-X-MEDIA:(.*)/g,AE=/^#EXT(?:INF|-X-TARGETDURATION):/m,Od=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),wE=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class bt{static findGroup(e,t){for(let r=0;r<e.length;r++){const i=e[r];if(i.id===t)return i}}static resolve(e,t){return Hu.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return AE.test(e)}static parseMasterPlaylist(e,t){const r=bd(e),i={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:r},s=[];Pd.lastIndex=0;let o;for(;(o=Pd.exec(e))!=null;)if(o[1]){var a;const u=new me(o[1]);ze(i,u,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);const c=_l(i,o[2]),d={attrs:u,bitrate:u.decimalInteger("BANDWIDTH")||u.decimalInteger("AVERAGE-BANDWIDTH"),name:u.NAME,url:bt.resolve(c,t)},f=u.decimalResolution("RESOLUTION");f&&(d.width=f.width,d.height=f.height),CE(u.CODECS,d),(a=d.unknownCodecs)!=null&&a.length||s.push(d),i.levels.push(d)}else if(o[3]){const u=o[3],c=o[4];switch(u){case"SESSION-DATA":{const d=new me(c);ze(i,d,["DATA-ID","LANGUAGE","VALUE","URI"]);const f=d["DATA-ID"];f&&(i.sessionData===null&&(i.sessionData={}),i.sessionData[f]=d);break}case"SESSION-KEY":{const d=Md(c,t,i);d.encrypted&&d.isSupported()?(i.sessionKeys===null&&(i.sessionKeys=[]),i.sessionKeys.push(d)):w.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${c}"`);break}case"DEFINE":{{const d=new me(c);ze(i,d,["NAME","VALUE","QUERYPARAM"]),Dd(i,d,t)}break}case"CONTENT-STEERING":{const d=new me(c);ze(i,d,["SERVER-URI","PATHWAY-ID"]),i.contentSteering={uri:bt.resolve(d["SERVER-URI"],t),pathwayId:d["PATHWAY-ID"]||"."};break}case"START":{i.startTimeOffset=Ud(c);break}}}const l=s.length>0&&s.length<i.levels.length;return i.levels=l?s:i.levels,i.levels.length===0&&(i.playlistParsingError=new Error("no levels found in manifest")),i}static parseMasterPlaylistMedia(e,t,r){let i;const s={},o=r.levels,a={AUDIO:o.map(u=>({id:u.attrs.AUDIO,audioCodec:u.audioCodec})),SUBTITLES:o.map(u=>({id:u.attrs.SUBTITLES,textCodec:u.textCodec})),"CLOSED-CAPTIONS":[]};let l=0;for(Fd.lastIndex=0;(i=Fd.exec(e))!==null;){const u=new me(i[1]),c=u.TYPE;if(c){const d=a[c],f=s[c]||[];s[c]=f,ze(r,u,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);const h=u.LANGUAGE,m=u["ASSOC-LANGUAGE"],p=u.CHANNELS,x=u.CHARACTERISTICS,y=u["INSTREAM-ID"],v={attrs:u,bitrate:0,id:l++,groupId:u["GROUP-ID"]||"",name:u.NAME||h||"",type:c,default:u.bool("DEFAULT"),autoselect:u.bool("AUTOSELECT"),forced:u.bool("FORCED"),lang:h,url:u.URI?bt.resolve(u.URI,t):""};if(m&&(v.assocLang=m),p&&(v.channels=p),x&&(v.characteristics=x),y&&(v.instreamId=y),d!=null&&d.length){const S=bt.findGroup(d,v.groupId)||d[0];Bd(v,S,"audioCodec"),Bd(v,S,"textCodec")}f.push(v)}}return s}static parseLevelPlaylist(e,t,r,i,s,o){const a=new jv(t),l=a.fragments;let u=null,c=0,d=0,f=0,h=0,m=null,p=new fa(i,t),x,y,v,S=-1,L=!1,T=null;for(Od.lastIndex=0,a.m3u8=e,a.hasVariableRefs=bd(e);(x=Od.exec(e))!==null;){L&&(L=!1,p=new fa(i,t),p.start=f,p.sn=c,p.cc=h,p.level=r,u&&(p.initSegment=u,p.rawProgramDateTime=u.rawProgramDateTime,u.rawProgramDateTime=null,T&&(p.setByteRange(T),T=null)));const _=x[1];if(_){p.duration=parseFloat(_);const C=(" "+x[2]).slice(1);p.title=C||null,p.tagList.push(C?["INF",_,C]:["INF",_])}else if(x[3]){if(G(p.duration)){p.start=f,v&&Gd(p,v,a),p.sn=c,p.level=r,p.cc=h,l.push(p);const C=(" "+x[3]).slice(1);p.relurl=_l(a,C),$d(p,m),m=p,f+=p.duration,c++,d=0,L=!0}}else if(x[4]){const C=(" "+x[4]).slice(1);m?p.setByteRange(C,m):p.setByteRange(C)}else if(x[5])p.rawProgramDateTime=(" "+x[5]).slice(1),p.tagList.push(["PROGRAM-DATE-TIME",p.rawProgramDateTime]),S===-1&&(S=l.length);else{if(x=x[0].match(wE),!x){w.warn("No matches on slow regex match for level playlist!");continue}for(y=1;y<x.length&&!(typeof x[y]<"u");y++);const C=(" "+x[y]).slice(1),P=(" "+x[y+1]).slice(1),H=x[y+2]?(" "+x[y+2]).slice(1):"";switch(C){case"PLAYLIST-TYPE":a.type=P.toUpperCase();break;case"MEDIA-SEQUENCE":c=a.startSN=parseInt(P);break;case"SKIP":{const B=new me(P);ze(a,B,["RECENTLY-REMOVED-DATERANGES"]);const q=B.decimalInteger("SKIPPED-SEGMENTS");if(G(q)){a.skippedSegments=q;for(let K=q;K--;)l.unshift(null);c+=q}const Y=B.enumeratedString("RECENTLY-REMOVED-DATERANGES");Y&&(a.recentlyRemovedDateranges=Y.split("	"));break}case"TARGETDURATION":a.targetduration=Math.max(parseInt(P),1);break;case"VERSION":a.version=parseInt(P);break;case"INDEPENDENT-SEGMENTS":case"EXTM3U":break;case"ENDLIST":a.live=!1;break;case"#":(P||H)&&p.tagList.push(H?[P,H]:[P]);break;case"DISCONTINUITY":h++,p.tagList.push(["DIS"]);break;case"GAP":p.gap=!0,p.tagList.push([C]);break;case"BITRATE":p.tagList.push([C,P]);break;case"DATERANGE":{const B=new me(P);ze(a,B,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),ze(a,B,B.clientAttrs);const q=new n0(B,a.dateRanges[B.ID]);q.isValid||a.skippedSegments?a.dateRanges[q.id]=q:w.warn(`Ignoring invalid DATERANGE tag: "${P}"`),p.tagList.push(["EXT-X-DATERANGE",P]);break}case"DEFINE":{{const B=new me(P);ze(a,B,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in B?vE(a,B,o):Dd(a,B,t)}break}case"DISCONTINUITY-SEQUENCE":h=parseInt(P);break;case"KEY":{const B=Md(P,t,a);if(B.isSupported()){if(B.method==="NONE"){v=void 0;break}v||(v={}),v[B.keyFormat]&&(v=Te({},v)),v[B.keyFormat]=B}else w.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${P}"`);break}case"START":a.startTimeOffset=Ud(P);break;case"MAP":{const B=new me(P);if(ze(a,B,["BYTERANGE","URI"]),p.duration){const q=new fa(i,t);jd(q,B,r,v),u=q,p.initSegment=u,u.rawProgramDateTime&&!p.rawProgramDateTime&&(p.rawProgramDateTime=u.rawProgramDateTime)}else{const q=p.byteRangeEndOffset;if(q){const Y=p.byteRangeStartOffset;T=`${q-Y}@${Y}`}else T=null;jd(p,B,r,v),u=p,L=!0}break}case"SERVER-CONTROL":{const B=new me(P);a.canBlockReload=B.bool("CAN-BLOCK-RELOAD"),a.canSkipUntil=B.optionalFloat("CAN-SKIP-UNTIL",0),a.canSkipDateRanges=a.canSkipUntil>0&&B.bool("CAN-SKIP-DATERANGES"),a.partHoldBack=B.optionalFloat("PART-HOLD-BACK",0),a.holdBack=B.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{const B=new me(P);a.partTarget=B.decimalFloatingPoint("PART-TARGET");break}case"PART":{let B=a.partList;B||(B=a.partList=[]);const q=d>0?B[B.length-1]:void 0,Y=d++,K=new me(P);ze(a,K,["BYTERANGE","URI"]);const J=new Bv(K,p,t,Y,q);B.push(J),p.duration+=J.duration;break}case"PRELOAD-HINT":{const B=new me(P);ze(a,B,["URI"]),a.preloadHint=B;break}case"RENDITION-REPORT":{const B=new me(P);ze(a,B,["URI"]),a.renditionReports=a.renditionReports||[],a.renditionReports.push(B);break}default:w.warn(`line parsed but not handled: ${x}`);break}}}m&&!m.relurl?(l.pop(),f-=m.duration,a.partList&&(a.fragmentHint=m)):a.partList&&($d(p,m),p.cc=h,a.fragmentHint=p,v&&Gd(p,v,a));const A=l.length,R=l[0],k=l[A-1];if(f+=a.skippedSegments*a.targetduration,f>0&&A&&k){a.averagetargetduration=f/A;const _=k.sn;a.endSN=_!=="initSegment"?_:0,a.live||(k.endList=!0),R&&(a.startCC=R.cc)}else a.endSN=0,a.startCC=0;return a.fragmentHint&&(f+=a.fragmentHint.duration),a.totalduration=f,a.endCC=h,S>0&&IE(l,S),a}}function Md(n,e,t){var r,i;const s=new me(n);ze(t,s,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);const o=(r=s.METHOD)!=null?r:"",a=s.URI,l=s.hexadecimalInteger("IV"),u=s.KEYFORMATVERSIONS,c=(i=s.KEYFORMAT)!=null?i:"identity";a&&s.IV&&!l&&w.error(`Invalid IV: ${s.IV}`);const d=a?bt.resolve(a,e):"",f=(u||"1").split("/").map(Number).filter(Number.isFinite);return new Ri(o,d,c,f,l)}function Ud(n){const t=new me(n).decimalFloatingPoint("TIME-OFFSET");return G(t)?t:null}function CE(n,e){let t=(n||"").split(/[ ,]+/).filter(r=>r);["video","audio","text"].forEach(r=>{const i=t.filter(s=>SE(s,r));i.length&&(e[`${r}Codec`]=i.join(","),t=t.filter(s=>i.indexOf(s)===-1))}),e.unknownCodecs=t}function Bd(n,e,t){const r=e[t];r&&(n[t]=r)}function IE(n,e){let t=n[e];for(let r=e;r--;){const i=n[r];if(!i)return;i.programDateTime=t.programDateTime-i.duration*1e3,t=i}}function $d(n,e){n.rawProgramDateTime?n.programDateTime=Date.parse(n.rawProgramDateTime):e!=null&&e.programDateTime&&(n.programDateTime=e.endProgramDateTime),G(n.programDateTime)||(n.programDateTime=null,n.rawProgramDateTime=null)}function jd(n,e,t,r){n.relurl=e.URI,e.BYTERANGE&&n.setByteRange(e.BYTERANGE),n.level=t,n.sn="initSegment",r&&(n.levelkeys=r),n.initSegment=null}function Gd(n,e,t){n.levelkeys=e;const{encryptedFragments:r}=t;(!r.length||r[r.length-1].levelkeys!==e)&&Object.keys(e).some(i=>e[i].isCommonEncryption)&&r.push(n)}var te={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},W={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};function Vd(n){const{type:e}=n;switch(e){case te.AUDIO_TRACK:return W.AUDIO;case te.SUBTITLE_TRACK:return W.SUBTITLE;default:return W.MAIN}}function Sa(n,e){let t=n.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class kE{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(E.MANIFEST_LOADING,this.onManifestLoading,this),e.on(E.LEVEL_LOADING,this.onLevelLoading,this),e.on(E.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(E.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}unregisterListeners(){const{hls:e}=this;e.off(E.MANIFEST_LOADING,this.onManifestLoading,this),e.off(E.LEVEL_LOADING,this.onLevelLoading,this),e.off(E.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(E.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}createInternalLoader(e){const t=this.hls.config,r=t.pLoader,i=t.loader,s=r||i,o=new s(t);return this.loaders[e.type]=o,o}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:r}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:te.MANIFEST,url:r,deliveryDirectives:null})}onLevelLoading(e,t){const{id:r,level:i,pathwayId:s,url:o,deliveryDirectives:a}=t;this.load({id:r,level:i,pathwayId:s,responseType:"text",type:te.LEVEL,url:o,deliveryDirectives:a})}onAudioTrackLoading(e,t){const{id:r,groupId:i,url:s,deliveryDirectives:o}=t;this.load({id:r,groupId:i,level:null,responseType:"text",type:te.AUDIO_TRACK,url:s,deliveryDirectives:o})}onSubtitleTrackLoading(e,t){const{id:r,groupId:i,url:s,deliveryDirectives:o}=t;this.load({id:r,groupId:i,level:null,responseType:"text",type:te.SUBTITLE_TRACK,url:s,deliveryDirectives:o})}load(e){var t;const r=this.hls.config;let i=this.getInternalLoader(e);if(i){const u=i.context;if(u&&u.url===e.url&&u.level===e.level){w.trace("[playlist-loader]: playlist request ongoing");return}w.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),i.abort()}let s;if(e.type===te.MANIFEST?s=r.manifestLoadPolicy.default:s=Te({},r.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),i=this.createInternalLoader(e),G((t=e.deliveryDirectives)==null?void 0:t.part)){let u;if(e.type===te.LEVEL&&e.level!==null?u=this.hls.levels[e.level].details:e.type===te.AUDIO_TRACK&&e.id!==null?u=this.hls.audioTracks[e.id].details:e.type===te.SUBTITLE_TRACK&&e.id!==null&&(u=this.hls.subtitleTracks[e.id].details),u){const c=u.partTarget,d=u.targetduration;if(c&&d){const f=Math.max(c*3,d*.8)*1e3;s=Te({},s,{maxTimeToFirstByteMs:Math.min(f,s.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(f,s.maxTimeToFirstByteMs)})}}}const o=s.errorRetry||s.timeoutRetry||{},a={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},l={onSuccess:(u,c,d,f)=>{const h=this.getInternalLoader(d);this.resetInternalLoader(d.type);const m=u.data;if(m.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(u,d,new Error("no EXTM3U delimiter"),f||null,c);return}c.parsing.start=performance.now(),bt.isMediaPlaylist(m)?this.handleTrackOrLevelPlaylist(u,c,d,f||null,h):this.handleMasterPlaylist(u,c,d,f)},onError:(u,c,d,f)=>{this.handleNetworkError(c,d,!1,u,f)},onTimeout:(u,c,d)=>{this.handleNetworkError(c,d,!0,void 0,u)}};i.load(e,a,l)}handleMasterPlaylist(e,t,r,i){const s=this.hls,o=e.data,a=Sa(e,r),l=bt.parseMasterPlaylist(o,a);if(l.playlistParsingError){this.handleManifestParsingError(e,r,l.playlistParsingError,i,t);return}const{contentSteering:u,levels:c,sessionData:d,sessionKeys:f,startTimeOffset:h,variableList:m}=l;this.variableList=m;const{AUDIO:p=[],SUBTITLES:x,"CLOSED-CAPTIONS":y}=bt.parseMasterPlaylistMedia(o,a,l);p.length&&!p.some(S=>!S.url)&&c[0].audioCodec&&!c[0].attrs.AUDIO&&(w.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),p.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new me({}),bitrate:0,url:""})),s.trigger(E.MANIFEST_LOADED,{levels:c,audioTracks:p,subtitles:x,captions:y,contentSteering:u,url:a,stats:t,networkDetails:i,sessionData:d,sessionKeys:f,startTimeOffset:h,variableList:m})}handleTrackOrLevelPlaylist(e,t,r,i,s){const o=this.hls,{id:a,level:l,type:u}=r,c=Sa(e,r),d=0,f=G(l)?l:G(a)?a:0,h=Vd(r),m=bt.parseLevelPlaylist(e.data,c,f,h,d,this.variableList);if(u===te.MANIFEST){const p={attrs:new me({}),bitrate:0,details:m,name:"",url:c};o.trigger(E.MANIFEST_LOADED,{levels:[p],audioTracks:[],url:c,stats:t,networkDetails:i,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),r.levelDetails=m,this.handlePlaylistLoaded(m,e,t,r,i,s)}handleManifestParsingError(e,t,r,i,s){this.hls.trigger(E.ERROR,{type:X.NETWORK_ERROR,details:b.MANIFEST_PARSING_ERROR,fatal:t.type===te.MANIFEST,url:e.url,err:r,error:r,reason:r.message,response:e,context:t,networkDetails:i,stats:s})}handleNetworkError(e,t,r=!1,i,s){let o=`A network ${r?"timeout":"error"+(i?" (status "+i.code+")":"")} occurred while loading ${e.type}`;e.type===te.LEVEL?o+=`: ${e.level} id: ${e.id}`:(e.type===te.AUDIO_TRACK||e.type===te.SUBTITLE_TRACK)&&(o+=` id: ${e.id} group-id: "${e.groupId}"`);const a=new Error(o);w.warn(`[playlist-loader]: ${o}`);let l=b.UNKNOWN,u=!1;const c=this.getInternalLoader(e);switch(e.type){case te.MANIFEST:l=r?b.MANIFEST_LOAD_TIMEOUT:b.MANIFEST_LOAD_ERROR,u=!0;break;case te.LEVEL:l=r?b.LEVEL_LOAD_TIMEOUT:b.LEVEL_LOAD_ERROR,u=!1;break;case te.AUDIO_TRACK:l=r?b.AUDIO_TRACK_LOAD_TIMEOUT:b.AUDIO_TRACK_LOAD_ERROR,u=!1;break;case te.SUBTITLE_TRACK:l=r?b.SUBTITLE_TRACK_LOAD_TIMEOUT:b.SUBTITLE_LOAD_ERROR,u=!1;break}c&&this.resetInternalLoader(e.type);const d={type:X.NETWORK_ERROR,details:l,fatal:u,url:e.url,loader:c,context:e,error:a,networkDetails:t,stats:s};if(i){const f=(t==null?void 0:t.url)||e.url;d.response=De({url:f,data:void 0},i)}this.hls.trigger(E.ERROR,d)}handlePlaylistLoaded(e,t,r,i,s,o){const a=this.hls,{type:l,level:u,id:c,groupId:d,deliveryDirectives:f}=i,h=Sa(t,i),m=Vd(i),p=typeof i.level=="number"&&m===W.MAIN?u:void 0;if(!e.fragments.length){const y=new Error("No Segments found in Playlist");a.trigger(E.ERROR,{type:X.NETWORK_ERROR,details:b.LEVEL_EMPTY_ERROR,fatal:!1,url:h,error:y,reason:y.message,response:t,context:i,level:p,parent:m,networkDetails:s,stats:r});return}e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));const x=e.playlistParsingError;if(x){a.trigger(E.ERROR,{type:X.NETWORK_ERROR,details:b.LEVEL_PARSING_ERROR,fatal:!1,url:h,error:x,reason:x.message,response:t,context:i,level:p,parent:m,networkDetails:s,stats:r});return}switch(e.live&&o&&(o.getCacheAge&&(e.ageHeader=o.getCacheAge()||0),(!o.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),l){case te.MANIFEST:case te.LEVEL:a.trigger(E.LEVEL_LOADED,{details:e,level:p||0,id:c||0,stats:r,networkDetails:s,deliveryDirectives:f});break;case te.AUDIO_TRACK:a.trigger(E.AUDIO_TRACK_LOADED,{details:e,id:c||0,groupId:d||"",stats:r,networkDetails:s,deliveryDirectives:f});break;case te.SUBTITLE_TRACK:a.trigger(E.SUBTITLE_TRACK_LOADED,{details:e,id:c||0,groupId:d||"",stats:r,networkDetails:s,deliveryDirectives:f});break}}}function x0(n,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=n,e.dispatchEvent(t)}function v0(n,e){const t=n.mode;if(t==="disabled"&&(n.mode="hidden"),n.cues&&!n.cues.getCueById(e.id))try{if(n.addCue(e),!n.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(r){w.debug(`[texttrack-utils]: ${r}`);try{const i=new self.TextTrackCue(e.startTime,e.endTime,e.text);i.id=e.id,n.addCue(i)}catch(i){w.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${i}`)}}t==="disabled"&&(n.mode=t)}function dr(n){const e=n.mode;if(e==="disabled"&&(n.mode="hidden"),n.cues)for(let t=n.cues.length;t--;)n.removeCue(n.cues[t]);e==="disabled"&&(n.mode=e)}function Nl(n,e,t,r){const i=n.mode;if(i==="disabled"&&(n.mode="hidden"),n.cues&&n.cues.length>0){const s=DE(n.cues,e,t);for(let o=0;o<s.length;o++)(!r||r(s[o]))&&n.removeCue(s[o])}i==="disabled"&&(n.mode=i)}function bE(n,e){if(e<n[0].startTime)return 0;const t=n.length-1;if(e>n[t].endTime)return-1;let r=0,i=t;for(;r<=i;){const s=Math.floor((i+r)/2);if(e<n[s].startTime)i=s-1;else if(e>n[s].startTime&&r<t)r=s+1;else return s}return n[r].startTime-e<e-n[i].startTime?r:i}function DE(n,e,t){const r=[],i=bE(n,e);if(i>-1)for(let s=i,o=n.length;s<o;s++){const a=n[s];if(a.startTime>=e&&a.endTime<=t)r.push(a);else if(a.startTime>t)return r}return r}function ws(n){const e=[];for(let t=0;t<n.length;t++){const r=n[t];(r.kind==="subtitles"||r.kind==="captions")&&r.label&&e.push(n[t])}return e}var Et={audioId3:"org.id3",dateRange:"com.apple.quicktime.HLS",emsg:"https://aomedia.org/emsg/ID3"};const _E=.25;function Pl(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function Kd(n,e,t,r,i){let s=new n(e,t,"");try{s.value=r,i&&(s.type=i)}catch{s=new n(e,t,JSON.stringify(i?De({type:i},r):r))}return s}const rs=(()=>{const n=Pl();try{n&&new n(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function Ta(n,e){return n.getTime()/1e3-e}function NE(n){return Uint8Array.from(n.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}class PE{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null}_registerListeners(){const{hls:e}=this;e.on(E.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(E.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(E.MANIFEST_LOADING,this.onManifestLoading,this),e.on(E.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(E.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(E.LEVEL_UPDATED,this.onLevelUpdated,this)}_unregisterListeners(){const{hls:e}=this;e.off(E.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(E.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(E.MANIFEST_LOADING,this.onManifestLoading,this),e.off(E.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(E.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(E.LEVEL_UPDATED,this.onLevelUpdated,this)}onMediaAttached(e,t){this.media=t.media}onMediaDetaching(){this.id3Track&&(dr(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const r=e[t];if(r.kind==="metadata"&&r.label==="id3")return x0(r,this.media),r}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:r,enableID3MetadataCues:i}}}=this;if(!r&&!i)return;const{samples:s}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const o=Pl();if(o)for(let a=0;a<s.length;a++){const l=s[a].type;if(l===Et.emsg&&!r||!i)continue;const u=l0(s[a].data);if(u){const c=s[a].pts;let d=c+s[a].duration;d>rs&&(d=rs),d-c<=0&&(d=c+_E);for(let h=0;h<u.length;h++){const m=u[h];if(!a0(m)){this.updateId3CueEnds(c,l);const p=Kd(o,c,d,m,l);p&&this.id3Track.addCue(p)}}}}}updateId3CueEnds(e,t){var r;const i=(r=this.id3Track)==null?void 0:r.cues;if(i)for(let s=i.length;s--;){const o=i[s];o.type===t&&o.startTime<e&&o.endTime===rs&&(o.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:r,type:i}){const{id3Track:s,hls:o}=this;if(!o)return;const{config:{enableEmsgMetadataCues:a,enableID3MetadataCues:l}}=o;if(s&&(a||l)){let u;i==="audio"?u=c=>c.type===Et.audioId3&&l:i==="video"?u=c=>c.type===Et.emsg&&a:u=c=>c.type===Et.audioId3&&l||c.type===Et.emsg&&a,Nl(s,t,r,u)}}onLevelUpdated(e,{details:t}){if(!this.media||!t.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{dateRangeCuesAppended:r,id3Track:i}=this,{dateRanges:s}=t,o=Object.keys(s);if(i){const c=Object.keys(r).filter(d=>!o.includes(d));for(let d=c.length;d--;){const f=c[d];Object.keys(r[f].cues).forEach(h=>{i.removeCue(r[f].cues[h])}),delete r[f]}}const a=t.fragments[t.fragments.length-1];if(o.length===0||!G(a==null?void 0:a.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const l=a.programDateTime/1e3-a.start,u=Pl();for(let c=0;c<o.length;c++){const d=o[c],f=s[d],h=Ta(f.startDate,l),m=r[d],p=(m==null?void 0:m.cues)||{};let x=(m==null?void 0:m.durationKnown)||!1,y=rs;const v=f.endDate;if(v)y=Ta(v,l),x=!0;else if(f.endOnNext&&!x){const L=o.reduce((T,A)=>{if(A!==f.id){const R=s[A];if(R.class===f.class&&R.startDate>f.startDate&&(!T||f.startDate<T.startDate))return R}return T},null);L&&(y=Ta(L.startDate,l),x=!0)}const S=Object.keys(f.attr);for(let L=0;L<S.length;L++){const T=S[L];if(!Mv(T))continue;const A=p[T];if(A)x&&!m.durationKnown&&(A.endTime=y);else if(u){let R=f.attr[T];Uv(T)&&(R=NE(R));const k=Kd(u,h,y,{key:T,data:R},Et.dateRange);k&&(k.id=d,this.id3Track.addCue(k),p[T]=k)}}r[d]={cues:p,dateRange:f,durationKnown:x}}}}class FE{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=()=>this.timeupdate(),this.hls=e,this.config=e.config,this.registerListeners()}get latency(){return this._latency||0}get maxLatency(){const{config:e,levelDetails:t}=this;return e.liveMaxLatencyDuration!==void 0?e.liveMaxLatencyDuration:t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const{levelDetails:e}=this;if(e===null)return null;const{holdBack:t,partHoldBack:r,targetduration:i}=e,{liveSyncDuration:s,liveSyncDurationCount:o,lowLatencyMode:a}=this.config,l=this.hls.userConfig;let u=a&&r||t;(l.liveSyncDuration||l.liveSyncDurationCount||u===0)&&(u=s!==void 0?s:o*i);const c=i,d=1;return u+Math.min(this.stallCount*d,c)}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency,r=this.levelDetails;if(e===null||t===null||r===null)return null;const i=r.edge,s=e-t-this.edgeStalled,o=i-r.totalduration,a=i-(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.min(Math.max(o,s),a)}get drift(){const{levelDetails:e}=this;return e===null?1:e.drift}get edgeStalled(){const{levelDetails:e}=this;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e,levelDetails:t}=this;if(!e||!t)return 0;const r=e.buffered.length;return(r?e.buffered.end(r-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null}registerListeners(){this.hls.on(E.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(E.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(E.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(E.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(E.ERROR,this.onError,this)}unregisterListeners(){this.hls.off(E.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(E.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(E.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(E.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(E.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)}onManifestLoading(){this.levelDetails=null,this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){this.levelDetails=t,t.advanced&&this.timeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)}onError(e,t){var r;t.details===b.BUFFER_STALLED_ERROR&&(this.stallCount++,(r=this.levelDetails)!=null&&r.live&&w.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))}timeupdate(){const{media:e,levelDetails:t}=this;if(!e||!t)return;this.currentTime=e.currentTime;const r=this.computeLatency();if(r===null)return;this._latency=r;const{lowLatencyMode:i,maxLiveSyncPlaybackRate:s}=this.config;if(!i||s===1||!t.live)return;const o=this.targetLatency;if(o===null)return;const a=r-o,l=Math.min(this.maxLatency,o+t.targetduration);if(a<l&&a>.05&&this.forwardBufferLength>1){const c=Math.min(2,Math.max(1,s)),d=Math.round(2/(1+Math.exp(-.75*a-this.edgeStalled))*20)/20;e.playbackRate=Math.min(c,Math.max(1,d))}else e.playbackRate!==1&&e.playbackRate!==0&&(e.playbackRate=1)}estimateLiveEdge(){const{levelDetails:e}=this;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}const Fl=["NONE","TYPE-0","TYPE-1",null];function OE(n){return Fl.indexOf(n)>-1}const uo=["SDR","PQ","HLG"];function ME(n){return!!n&&uo.indexOf(n)>-1}var Cs={No:"",Yes:"YES",v2:"v2"};function Hd(n){const{canSkipUntil:e,canSkipDateRanges:t,age:r}=n,i=r<e/2;return e&&i?t?Cs.v2:Cs.Yes:Cs.No}class zd{constructor(e,t,r){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=r}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class Cr{constructor(e){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(t=>!!t).map(t=>t.substring(0,4)).join(","),this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return Wd(this._audioGroups,e)}hasSubtitleGroup(e){return Wd(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let r=this._audioGroups;r||(r=this._audioGroups=[]),r.indexOf(t)===-1&&r.push(t)}else if(e==="text"){let r=this._subtitleGroups;r||(r=this._subtitleGroups=[]),r.indexOf(t)===-1&&r.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function Wd(n,e){return!e||!n?!1:n.indexOf(e)!==-1}function La(n,e){const t=e.startPTS;if(G(t)){let r=0,i;e.sn>n.sn?(r=t-n.start,i=n):(r=n.start-t,i=e),i.duration!==r&&(i.duration=r)}else e.sn>n.sn?n.cc===e.cc&&n.minEndPTS?e.start=n.start+(n.minEndPTS-n.start):e.start=n.start+n.duration:e.start=Math.max(n.start-e.duration,0)}function E0(n,e,t,r,i,s){r-t<=0&&(w.warn("Fragment should have a positive duration",e),r=t+e.duration,s=i+e.duration);let a=t,l=r;const u=e.startPTS,c=e.endPTS;if(G(u)){const x=Math.abs(u-t);G(e.deltaPTS)?e.deltaPTS=Math.max(x,e.deltaPTS):e.deltaPTS=x,a=Math.max(t,u),t=Math.min(t,u),i=Math.min(i,e.startDTS),l=Math.min(r,c),r=Math.max(r,c),s=Math.max(s,e.endDTS)}const d=t-e.start;e.start!==0&&(e.start=t),e.duration=r-e.start,e.startPTS=t,e.maxStartPTS=a,e.startDTS=i,e.endPTS=r,e.minEndPTS=l,e.endDTS=s;const f=e.sn;if(!n||f<n.startSN||f>n.endSN)return 0;let h;const m=f-n.startSN,p=n.fragments;for(p[m]=e,h=m;h>0;h--)La(p[h],p[h-1]);for(h=m;h<p.length-1;h++)La(p[h],p[h+1]);return n.fragmentHint&&La(p[p.length-1],n.fragmentHint),n.PTSKnown=n.alignedSliding=!0,d}function UE(n,e){let t=null;const r=n.fragments;for(let a=r.length-1;a>=0;a--){const l=r[a].initSegment;if(l){t=l;break}}n.fragmentHint&&delete n.fragmentHint.endPTS;let i;jE(n,e,(a,l,u,c)=>{if(e.skippedSegments&&l.cc!==a.cc){const d=a.cc-l.cc;for(let f=u;f<c.length;f++)c[f].cc+=d}G(a.startPTS)&&G(a.endPTS)&&(l.start=l.startPTS=a.startPTS,l.startDTS=a.startDTS,l.maxStartPTS=a.maxStartPTS,l.endPTS=a.endPTS,l.endDTS=a.endDTS,l.minEndPTS=a.minEndPTS,l.duration=a.endPTS-a.startPTS,l.duration&&(i=l),e.PTSKnown=e.alignedSliding=!0),l.elementaryStreams=a.elementaryStreams,l.loader=a.loader,l.stats=a.stats,a.initSegment&&(l.initSegment=a.initSegment,t=a.initSegment)});const s=e.fragments;if(t&&(e.fragmentHint?s.concat(e.fragmentHint):s).forEach(l=>{var u;l&&(!l.initSegment||l.initSegment.relurl===((u=t)==null?void 0:u.relurl))&&(l.initSegment=t)}),e.skippedSegments){if(e.deltaUpdateFailed=s.some(a=>!a),e.deltaUpdateFailed){w.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let a=e.skippedSegments;a--;)s.shift();e.startSN=s[0].sn}else e.canSkipDateRanges&&(e.dateRanges=BE(n.dateRanges,e.dateRanges,e.recentlyRemovedDateranges));e.startCC=e.fragments[0].cc,e.endCC=s[s.length-1].cc}$E(n.partList,e.partList,(a,l)=>{l.elementaryStreams=a.elementaryStreams,l.stats=a.stats}),i?E0(e,i,i.startPTS,i.endPTS,i.startDTS,i.endDTS):S0(n,e),s.length&&(e.totalduration=e.edge-s[0].start),e.driftStartTime=n.driftStartTime,e.driftStart=n.driftStart;const o=e.advancedDateTime;if(e.advanced&&o){const a=e.edge;e.driftStart||(e.driftStartTime=o,e.driftStart=a),e.driftEndTime=o,e.driftEnd=a}else e.driftEndTime=n.driftEndTime,e.driftEnd=n.driftEnd,e.advancedDateTime=n.advancedDateTime}function BE(n,e,t){const r=Te({},n);return t&&t.forEach(i=>{delete r[i]}),Object.keys(e).forEach(i=>{const s=new n0(e[i].attr,r[i]);s.isValid?r[i]=s:w.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${JSON.stringify(e[i].attr)}"`)}),r}function $E(n,e,t){if(n&&e){let r=0;for(let i=0,s=n.length;i<=s;i++){const o=n[i],a=e[i+r];o&&a&&o.index===a.index&&o.fragment.sn===a.fragment.sn?t(o,a):r--}}}function jE(n,e,t){const r=e.skippedSegments,i=Math.max(n.startSN,e.startSN)-e.startSN,s=(n.fragmentHint?1:0)+(r?e.endSN:Math.min(n.endSN,e.endSN))-e.startSN,o=e.startSN-n.startSN,a=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,l=n.fragmentHint?n.fragments.concat(n.fragmentHint):n.fragments;for(let u=i;u<=s;u++){const c=l[o+u];let d=a[u];r&&!d&&u<r&&(d=e.fragments[u]=c),c&&d&&t(c,d,u,a)}}function S0(n,e){const t=e.startSN+e.skippedSegments-n.startSN,r=n.fragments;t<0||t>=r.length||Ol(e,r[t].start)}function Ol(n,e){if(e){const t=n.fragments;for(let r=n.skippedSegments;r<t.length;r++)t[r].start+=e;n.fragmentHint&&(n.fragmentHint.start+=e)}}function GE(n,e=1/0){let t=1e3*n.targetduration;if(n.updated){const r=n.fragments,i=4;if(r.length&&t*i>e){const s=r[r.length-1].duration*1e3;s<t&&(t=s)}}else t/=2;return Math.round(t)}function VE(n,e,t){if(!(n!=null&&n.details))return null;const r=n.details;let i=r.fragments[e-r.startSN];return i||(i=r.fragmentHint,i&&i.sn===e)?i:e<r.startSN&&t&&t.sn===e?t:null}function Yd(n,e,t){var r;return n!=null&&n.details?T0((r=n.details)==null?void 0:r.partList,e,t):null}function T0(n,e,t){if(n)for(let r=n.length;r--;){const i=n[r];if(i.index===t&&i.fragment.sn===e)return i}return null}function L0(n){n.forEach((e,t)=>{const{details:r}=e;r!=null&&r.fragments&&r.fragments.forEach(i=>{i.level=t})})}function co(n){switch(n.details){case b.FRAG_LOAD_TIMEOUT:case b.KEY_LOAD_TIMEOUT:case b.LEVEL_LOAD_TIMEOUT:case b.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function qd(n,e){const t=co(e);return n.default[`${t?"timeout":"error"}Retry`]}function qu(n,e){const t=n.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*n.retryDelayMs,n.maxRetryDelayMs)}function Xd(n){return De(De({},n),{errorRetry:null,timeoutRetry:null})}function fo(n,e,t,r){if(!n)return!1;const i=r==null?void 0:r.code,s=e<n.maxNumRetry&&(KE(i)||!!t);return n.shouldRetry?n.shouldRetry(n,e,t,r,s):s}function KE(n){return n===0&&navigator.onLine===!1||!!n&&(n<400||n>499)}const R0={search:function(n,e){let t=0,r=n.length-1,i=null,s=null;for(;t<=r;){i=(t+r)/2|0,s=n[i];const o=e(s);if(o>0)t=i+1;else if(o<0)r=i-1;else return s}return null}};function HE(n,e,t){if(e===null||!Array.isArray(n)||!n.length||!G(e))return null;const r=n[0].programDateTime;if(e<(r||0))return null;const i=n[n.length-1].endProgramDateTime;if(e>=(i||0))return null;t=t||0;for(let s=0;s<n.length;++s){const o=n[s];if(WE(e,t,o))return o}return null}function ho(n,e,t=0,r=0,i=.005){let s=null;if(n){s=e[n.sn-e[0].sn+1]||null;const a=n.endDTS-t;a>0&&a<15e-7&&(t+=15e-7)}else t===0&&e[0].start===0&&(s=e[0]);if(s&&((!n||n.level===s.level)&&Ml(t,r,s)===0||zE(s,n,Math.min(i,r))))return s;const o=R0.search(e,Ml.bind(null,t,r));return o&&(o!==n||!s)?o:s}function zE(n,e,t){if(e&&e.start===0&&e.level<n.level&&(e.endPTS||0)>0){const r=e.tagList.reduce((i,s)=>(s[0]==="INF"&&(i+=parseFloat(s[1])),i),t);return n.start<=r}return!1}function Ml(n=0,e=0,t){if(t.start<=n&&t.start+t.duration>n)return 0;const r=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-r<=n?1:t.start-r>n&&t.start?-1:0}function WE(n,e,t){const r=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-r>n}function YE(n,e){return R0.search(n,t=>t.cc<e?1:t.cc>e?-1:0)}var Pe={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},gt={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,SwitchToSDR:4};class qE{constructor(e){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=e,this.log=w.log.bind(w,"[info]:"),this.warn=w.warn.bind(w,"[warning]:"),this.error=w.error.bind(w,"[error]:"),this.registerListeners()}registerListeners(){const e=this.hls;e.on(E.ERROR,this.onError,this),e.on(E.MANIFEST_LOADING,this.onManifestLoading,this),e.on(E.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(E.ERROR,this.onError,this),e.off(E.ERROR,this.onErrorOut,this),e.off(E.MANIFEST_LOADING,this.onManifestLoading,this),e.off(E.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(e==null?void 0:e.type)===W.MAIN?e.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(e,t){var r,i;if(t.fatal)return;const s=this.hls,o=t.context;switch(t.details){case b.FRAG_LOAD_ERROR:case b.FRAG_LOAD_TIMEOUT:case b.KEY_LOAD_ERROR:case b.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case b.FRAG_PARSING_ERROR:if((r=t.frag)!=null&&r.gap){t.errorAction={action:Pe.DoNothing,flags:gt.None};return}case b.FRAG_GAP:case b.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=Pe.SendAlternateToPenaltyBox;return}case b.LEVEL_EMPTY_ERROR:case b.LEVEL_PARSING_ERROR:{var a,l;const u=t.parent===W.MAIN?t.level:s.loadLevel;t.details===b.LEVEL_EMPTY_ERROR&&((a=t.context)!=null&&(l=a.levelDetails)!=null&&l.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,u):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,u))}return;case b.LEVEL_LOAD_ERROR:case b.LEVEL_LOAD_TIMEOUT:typeof(o==null?void 0:o.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,o.level));return;case b.AUDIO_TRACK_LOAD_ERROR:case b.AUDIO_TRACK_LOAD_TIMEOUT:case b.SUBTITLE_LOAD_ERROR:case b.SUBTITLE_TRACK_LOAD_TIMEOUT:if(o){const u=s.levels[s.loadLevel];if(u&&(o.type===te.AUDIO_TRACK&&u.hasAudioGroup(o.groupId)||o.type===te.SUBTITLE_TRACK&&u.hasSubtitleGroup(o.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.loadLevel),t.errorAction.action=Pe.SendAlternateToPenaltyBox,t.errorAction.flags=gt.MoveAllAlternatesMatchingHost;return}}return;case b.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const u=s.levels[s.loadLevel],c=u==null?void 0:u.attrs["HDCP-LEVEL"];c?t.errorAction={action:Pe.SendAlternateToPenaltyBox,flags:gt.MoveAllAlternatesMatchingHDCP,hdcpLevel:c}:this.keySystemError(t)}return;case b.BUFFER_ADD_CODEC_ERROR:case b.REMUX_ALLOC_ERROR:case b.BUFFER_APPEND_ERROR:t.errorAction=this.getLevelSwitchAction(t,(i=t.level)!=null?i:s.loadLevel);return;case b.INTERNAL_EXCEPTION:case b.BUFFER_APPENDING_ERROR:case b.BUFFER_FULL_ERROR:case b.LEVEL_SWITCH_ERROR:case b.BUFFER_STALLED_ERROR:case b.BUFFER_SEEK_OVER_HOLE:case b.BUFFER_NUDGE_ON_STALL:t.errorAction={action:Pe.DoNothing,flags:gt.None};return}t.type===X.KEY_SYSTEM_ERROR&&this.keySystemError(t)}keySystemError(e){const t=this.getVariantLevelIndex(e.frag);e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,t)}getPlaylistRetryOrSwitchAction(e,t){const r=this.hls,i=qd(r.config.playlistLoadPolicy,e),s=this.playlistError++;if(fo(i,s,co(e),e.response))return{action:Pe.RetryRequest,flags:gt.None,retryConfig:i,retryCount:s};const a=this.getLevelSwitchAction(e,t);return i&&(a.retryConfig=i,a.retryCount=s),a}getFragRetryOrSwitchAction(e){const t=this.hls,r=this.getVariantLevelIndex(e.frag),i=t.levels[r],{fragLoadPolicy:s,keyLoadPolicy:o}=t.config,a=qd(e.details.startsWith("key")?o:s,e),l=t.levels.reduce((c,d)=>c+d.fragmentError,0);if(i&&(e.details!==b.FRAG_GAP&&i.fragmentError++,fo(a,l,co(e),e.response)))return{action:Pe.RetryRequest,flags:gt.None,retryConfig:a,retryCount:l};const u=this.getLevelSwitchAction(e,r);return a&&(u.retryConfig=a,u.retryCount=l),u}getLevelSwitchAction(e,t){const r=this.hls;t==null&&(t=r.loadLevel);const i=this.hls.levels[t];if(i){var s,o;const u=e.details;i.loadError++,u===b.BUFFER_APPEND_ERROR&&i.fragmentError++;let c=-1;const{levels:d,loadLevel:f,minAutoLevel:h,maxAutoLevel:m}=r;r.autoLevelEnabled||(r.loadLevel=-1);const p=(s=e.frag)==null?void 0:s.type,y=(p===W.AUDIO&&u===b.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(u===b.BUFFER_ADD_CODEC_ERROR||u===b.BUFFER_APPEND_ERROR))&&d.some(({audioCodec:A})=>i.audioCodec!==A),S=e.sourceBufferName==="video"&&(u===b.BUFFER_ADD_CODEC_ERROR||u===b.BUFFER_APPEND_ERROR)&&d.some(({codecSet:A,audioCodec:R})=>i.codecSet!==A&&i.audioCodec===R),{type:L,groupId:T}=(o=e.context)!=null?o:{};for(let A=d.length;A--;){const R=(A+f)%d.length;if(R!==f&&R>=h&&R<=m&&d[R].loadError===0){var a,l;const k=d[R];if(u===b.FRAG_GAP&&p===W.MAIN&&e.frag){const _=d[R].details;if(_){const C=ho(e.frag,_.fragments,e.frag.start);if(C!=null&&C.gap)continue}}else{if(L===te.AUDIO_TRACK&&k.hasAudioGroup(T)||L===te.SUBTITLE_TRACK&&k.hasSubtitleGroup(T))continue;if(p===W.AUDIO&&(a=i.audioGroups)!=null&&a.some(_=>k.hasAudioGroup(_))||p===W.SUBTITLE&&(l=i.subtitleGroups)!=null&&l.some(_=>k.hasSubtitleGroup(_))||y&&i.audioCodec===k.audioCodec||!y&&i.audioCodec!==k.audioCodec||S&&i.codecSet===k.codecSet)continue}c=R;break}}if(c>-1&&r.loadLevel!==c)return e.levelRetry=!0,this.playlistError=0,{action:Pe.SendAlternateToPenaltyBox,flags:gt.None,nextAutoLevel:c}}return{action:Pe.SendAlternateToPenaltyBox,flags:gt.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var r;switch((r=t.errorAction)==null?void 0:r.action){case Pe.DoNothing:break;case Pe.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==b.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,r=e.errorAction;if(!r)return;const{flags:i,hdcpLevel:s,nextAutoLevel:o}=r;switch(i){case gt.None:this.switchLevel(e,o);break;case gt.MoveAllAlternatesMatchingHDCP:s&&(t.maxHdcpLevel=Fl[Fl.indexOf(s)-1],r.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}r.resolved||this.switchLevel(e,o)}switchLevel(e,t){t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)}}class Xu{constructor(e,t){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=w.log.bind(w,`${t}:`),this.warn=w.warn.bind(w,`${t}:`),this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,r){const i=t==null?void 0:t.renditionReports;if(i){let s=-1;for(let o=0;o<i.length;o++){const a=i[o];let l;try{l=new self.URL(a.URI,t.url).href}catch(u){w.warn(`Could not construct new URL for Rendition Report: ${u}`),l=a.URI||""}if(l===e){s=o;break}else l===e.substring(0,l.length)&&(s=o)}if(s!==-1){const o=i[s],a=parseInt(o["LAST-MSN"])||(t==null?void 0:t.lastPartSn);let l=parseInt(o["LAST-PART"])||(t==null?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){const c=Math.min(t.age-t.partTarget,t.targetduration);l>=0&&c>t.partTarget&&(l+=1)}const u=r&&Hd(r);return new zd(a,l>=0?l:void 0,u)}}}loadPlaylist(e){this.requestScheduled===-1&&(this.requestScheduled=self.performance.now())}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}shouldReloadPlaylist(e){return this.timer===-1&&this.requestScheduled===-1&&this.shouldLoadPlaylist(e)}playlistLoaded(e,t,r){const{details:i,stats:s}=t,o=self.performance.now(),a=s.loading.first?Math.max(0,o-s.loading.first):0;if(i.advancedDateTime=Date.now()-a,i.live||r!=null&&r.live){if(i.reloaded(r),r&&this.log(`live playlist ${e} ${i.advanced?"REFRESHED "+i.lastPartSn+"-"+i.lastPartIndex:i.updated?"UPDATED":"MISSED"}`),r&&i.fragments.length>0&&UE(r,i),!this.canLoad||!i.live)return;let l,u,c;if(i.canBlockReload&&i.endSN&&i.advanced){const x=this.hls.config.lowLatencyMode,y=i.lastPartSn,v=i.endSN,S=i.lastPartIndex,L=S!==-1,T=y===v,A=x?0:S;L?(u=T?v+1:y,c=T?A:S+1):u=v+1;const R=i.age,k=R+i.ageHeader;let _=Math.min(k-i.partTarget,i.targetduration*1.5);if(_>0){if(r&&_>r.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${r.tuneInGoal} to: ${_} with playlist age: ${i.age}`),_=0;else{const C=Math.floor(_/i.targetduration);if(u+=C,c!==void 0){const P=Math.round(_%i.targetduration/i.partTarget);c+=P}this.log(`CDN Tune-in age: ${i.ageHeader}s last advanced ${R.toFixed(2)}s goal: ${_} skip sn ${C} to part ${c}`)}i.tuneInGoal=_}if(l=this.getDeliveryDirectives(i,t.deliveryDirectives,u,c),x||!T){this.loadPlaylist(l);return}}else(i.canBlockReload||i.canSkipUntil)&&(l=this.getDeliveryDirectives(i,t.deliveryDirectives,u,c));const d=this.hls.mainForwardBufferInfo,f=d?d.end-d.len:0,h=(i.edge-f)*1e3,m=GE(i,h);i.updated&&o>this.requestScheduled+m&&(this.requestScheduled=s.loading.start),u!==void 0&&i.canBlockReload?this.requestScheduled=s.loading.first+m-(i.partTarget*1e3||1e3):this.requestScheduled===-1||this.requestScheduled+m<o?this.requestScheduled=o:this.requestScheduled-o<=0&&(this.requestScheduled+=m);let p=this.requestScheduled-o;p=Math.max(0,p),this.log(`reload live playlist ${e} in ${Math.round(p)} ms`),this.timer=self.setTimeout(()=>this.loadPlaylist(l),p)}else this.clearTimer()}getDeliveryDirectives(e,t,r,i){let s=Hd(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(r=t.msn,i=t.part,s=Cs.No),new zd(r,i,s)}checkRetry(e){const t=e.details,r=co(e),i=e.errorAction,{action:s,retryCount:o=0,retryConfig:a}=i||{},l=!!i&&!!a&&(s===Pe.RetryRequest||!i.resolved&&s===Pe.SendAlternateToPenaltyBox);if(l){var u;if(this.requestScheduled=-1,o>=a.maxNumRetry)return!1;if(r&&(u=e.context)!=null&&u.deliveryDirectives)this.warn(`Retrying playlist loading ${o+1}/${a.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const c=qu(a,o);this.timer=self.setTimeout(()=>this.loadPlaylist(),c),this.warn(`Retrying playlist loading ${o+1}/${a.maxNumRetry} after "${t}" in ${c}ms`)}e.levelRetry=!0,i.resolved=!0}return l}}class qn{constructor(e,t=0,r=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=r}sample(e,t){const r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class XE{constructor(e,t,r,i=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new qn(e),this.fast_=new qn(t),this.defaultTTFB_=i,this.ttfb_=new qn(e)}update(e,t){const{slow_:r,fast_:i,ttfb_:s}=this;r.halfLife!==e&&(this.slow_=new qn(e,r.getEstimate(),r.getTotalWeight())),i.halfLife!==t&&(this.fast_=new qn(t,i.getEstimate(),i.getTotalWeight())),s.halfLife!==e&&(this.ttfb_=new qn(e,s.getEstimate(),s.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const r=8*t,i=e/1e3,s=r/i;this.fast_.sample(i,s),this.slow_.sample(i,s)}sampleTTFB(e){const t=e/1e3,r=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(r,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}destroy(){}}const A0={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]},Qd={};function QE(n,e,t,r,i,s){const o=n.audioCodec?n.audioGroups:null,a=s==null?void 0:s.audioCodec,l=s==null?void 0:s.channels,u=l?parseInt(l):a?1/0:2;let c=null;if(o!=null&&o.length)try{o.length===1&&o[0]?c=e.groups[o[0]].channels:c=o.reduce((d,f)=>{if(f){const h=e.groups[f];if(!h)throw new Error(`Audio track group ${f} not found`);Object.keys(h.channels).forEach(m=>{d[m]=(d[m]||0)+h.channels[m]})}return d},{2:0})}catch{return!0}return n.videoCodec!==void 0&&(n.width>1920&&n.height>1088||n.height>1920&&n.width>1088||n.frameRate>Math.max(r,30)||n.videoRange!=="SDR"&&n.videoRange!==t||n.bitrate>Math.max(i,8e6))||!!c&&G(u)&&Object.keys(c).some(d=>parseInt(d)>u)}function JE(n,e,t){const r=n.videoCodec,i=n.audioCodec;if(!r||!i||!t)return Promise.resolve(A0);const s={width:n.width,height:n.height,bitrate:Math.ceil(Math.max(n.bitrate*.9,n.averageBitrate)),framerate:n.frameRate||30},o=n.videoRange;o!=="SDR"&&(s.transferFunction=o.toLowerCase());const a=r.split(",").map(l=>({type:"media-source",video:De(De({},s),{},{contentType:Ai(l,"video")})}));return i&&n.audioGroups&&n.audioGroups.forEach(l=>{var u;l&&((u=e.groups[l])==null||u.tracks.forEach(c=>{if(c.groupId===l){const d=c.channels||"",f=parseFloat(d);G(f)&&f>2&&a.push.apply(a,i.split(",").map(h=>({type:"media-source",audio:{contentType:Ai(h,"audio"),channels:""+f}})))}}))}),Promise.all(a.map(l=>{const u=ZE(l);return Qd[u]||(Qd[u]=t.decodingInfo(l))})).then(l=>({supported:!l.some(u=>!u.supported),configurations:a,decodingInfoResults:l})).catch(l=>({supported:!1,configurations:a,decodingInfoResults:[],error:l}))}function ZE(n){const{audio:e,video:t}=n,r=t||e;if(r){const i=r.contentType.split('"')[1];if(t)return`r${t.height}x${t.width}f${Math.ceil(t.framerate)}${t.transferFunction||"sd"}_${i}_${Math.ceil(t.bitrate/1e5)}`;if(e)return`c${e.channels}${e.spatialRendering?"s":"n"}_${i}`}return""}function eS(){if(typeof matchMedia=="function"){const n=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(n.media!==e.media)return n.matches===!0}return!1}function tS(n,e){let t=!1,r=[];return n&&(t=n!=="SDR",r=[n]),e&&(r=e.allowedVideoRanges||uo.slice(0),t=e.preferHDR!==void 0?e.preferHDR:eS(),t?r=r.filter(i=>i!=="SDR"):r=["SDR"]),{preferHDR:t,allowedVideoRanges:r}}function nS(n,e,t,r,i){const s=Object.keys(n),o=r==null?void 0:r.channels,a=r==null?void 0:r.audioCodec,l=o&&parseInt(o)===2;let u=!0,c=!1,d=1/0,f=1/0,h=1/0,m=0,p=[];const{preferHDR:x,allowedVideoRanges:y}=tS(e,i);for(let T=s.length;T--;){const A=n[s[T]];u=A.channels[2]>0,d=Math.min(d,A.minHeight),f=Math.min(f,A.minFramerate),h=Math.min(h,A.minBitrate);const R=y.filter(k=>A.videoRanges[k]>0);R.length>0&&(c=!0,p=R)}d=G(d)?d:0,f=G(f)?f:0;const v=Math.max(1080,d),S=Math.max(30,f);return h=G(h)?h:t,t=Math.max(h,t),c||(e=void 0,p=[]),{codecSet:s.reduce((T,A)=>{const R=n[A];if(A===T)return T;if(R.minBitrate>t)return Bt(A,`min bitrate of ${R.minBitrate} > current estimate of ${t}`),T;if(!R.hasDefaultAudio)return Bt(A,"no renditions with default or auto-select sound found"),T;if(a&&A.indexOf(a.substring(0,4))%5!==0)return Bt(A,`audio codec preference "${a}" not found`),T;if(o&&!l){if(!R.channels[o])return Bt(A,`no renditions with ${o} channel sound found (channels options: ${Object.keys(R.channels)})`),T}else if((!a||l)&&u&&R.channels[2]===0)return Bt(A,"no renditions with stereo sound found"),T;return R.minHeight>v?(Bt(A,`min resolution of ${R.minHeight} > maximum of ${v}`),T):R.minFramerate>S?(Bt(A,`min framerate of ${R.minFramerate} > maximum of ${S}`),T):p.some(k=>R.videoRanges[k]>0)?R.maxScore<m?(Bt(A,`max score of ${R.maxScore} < selected max of ${m}`),T):T&&(ao(A)>=ao(T)||R.fragmentError>n[T].fragmentError)?T:(m=R.maxScore,A):(Bt(A,`no variants with VIDEO-RANGE of ${JSON.stringify(p)} found`),T)},void 0),videoRanges:p,preferHDR:x,minFramerate:f,minBitrate:h}}function Bt(n,e){w.log(`[abr] start candidates with "${n}" ignored because ${e}`)}function rS(n){return n.reduce((e,t)=>{let r=e.groups[t.groupId];r||(r=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),r.tracks.push(t);const i=t.channels||"2";return r.channels[i]=(r.channels[i]||0)+1,r.hasDefault=r.hasDefault||t.default,r.hasAutoSelect=r.hasAutoSelect||t.autoselect,r.hasDefault&&(e.hasDefaultAudio=!0),r.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function iS(n,e,t,r){return n.slice(t,r+1).reduce((i,s)=>{if(!s.codecSet)return i;const o=s.audioGroups;let a=i[s.codecSet];a||(i[s.codecSet]=a={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!o,fragmentError:0}),a.minBitrate=Math.min(a.minBitrate,s.bitrate);const l=Math.min(s.height,s.width);return a.minHeight=Math.min(a.minHeight,l),a.minFramerate=Math.min(a.minFramerate,s.frameRate),a.maxScore=Math.max(a.maxScore,s.score),a.fragmentError+=s.fragmentError,a.videoRanges[s.videoRange]=(a.videoRanges[s.videoRange]||0)+1,o&&o.forEach(u=>{if(!u)return;const c=e.groups[u];c&&(a.hasDefaultAudio=a.hasDefaultAudio||e.hasDefaultAudio?c.hasDefault:c.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(c.channels).forEach(d=>{a.channels[d]=(a.channels[d]||0)+c.channels[d]}))}),i},{})}function Dt(n,e,t){if("attrs"in n){const r=e.indexOf(n);if(r!==-1)return r}for(let r=0;r<e.length;r++){const i=e[r];if(Bn(n,i,t))return r}return-1}function Bn(n,e,t){const{groupId:r,name:i,lang:s,assocLang:o,default:a}=n,l=n.forced;return(r===void 0||e.groupId===r)&&(i===void 0||e.name===i)&&(s===void 0||e.lang===s)&&(s===void 0||e.assocLang===o)&&(a===void 0||e.default===a)&&(l===void 0||e.forced===l)&&(!("characteristics"in n)||sS(n.characteristics||"",e.characteristics))&&(t===void 0||t(n,e))}function sS(n,e=""){const t=n.split(","),r=e.split(",");return t.length===r.length&&!t.some(i=>r.indexOf(i)===-1)}function Dn(n,e){const{audioCodec:t,channels:r}=n;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(r===void 0||r===(e.channels||"2"))}function oS(n,e,t,r,i){const s=e[r],a=e.reduce((f,h,m)=>{const p=h.uri;return(f[p]||(f[p]=[])).push(m),f},{})[s.uri];a.length>1&&(r=Math.max.apply(Math,a));const l=s.videoRange,u=s.frameRate,c=s.codecSet.substring(0,4),d=Jd(e,r,f=>{if(f.videoRange!==l||f.frameRate!==u||f.codecSet.substring(0,4)!==c)return!1;const h=f.audioGroups,m=t.filter(p=>!h||h.indexOf(p.groupId)!==-1);return Dt(n,m,i)>-1});return d>-1?d:Jd(e,r,f=>{const h=f.audioGroups,m=t.filter(p=>!h||h.indexOf(p.groupId)!==-1);return Dt(n,m,i)>-1})}function Jd(n,e,t){for(let r=e;r>-1;r--)if(t(n[r]))return r;for(let r=e+1;r<n.length;r++)if(t(n[r]))return r;return-1}class aS{constructor(e){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this._abandonRulesCheck=()=>{const{fragCurrent:t,partCurrent:r,hls:i}=this,{autoLevelEnabled:s,media:o}=i;if(!t||!o)return;const a=performance.now(),l=r?r.stats:t.stats,u=r?r.duration:t.duration,c=a-l.loading.start,d=i.minAutoLevel;if(l.aborted||l.loaded&&l.loaded===l.total||t.level<=d){this.clearTimer(),this._nextAutoLevel=-1;return}if(!s||o.paused||!o.playbackRate||!o.readyState)return;const f=i.mainForwardBufferInfo;if(f===null)return;const h=this.bwEstimator.getEstimateTTFB(),m=Math.abs(o.playbackRate);if(c<=Math.max(h,1e3*(u/(m*2))))return;const p=f.len/m,x=l.loading.first?l.loading.first-l.loading.start:-1,y=l.loaded&&x>-1,v=this.getBwEstimate(),S=i.levels,L=S[t.level],T=l.total||Math.max(l.loaded,Math.round(u*L.averageBitrate/8));let A=y?c-x:c;A<1&&y&&(A=Math.min(c,l.loaded*8/v));const R=y?l.loaded*1e3/A:0,k=R?(T-l.loaded)/R:T*8/v+h/1e3;if(k<=p)return;const _=R?R*8:v;let C=Number.POSITIVE_INFINITY,P;for(P=t.level-1;P>d;P--){const B=S[P].maxBitrate;if(C=this.getTimeToLoadFrag(h/1e3,_,u*B,!S[P].details),C<p)break}if(C>=k||C>u*10)return;i.nextLoadLevel=i.nextAutoLevel=P,y?this.bwEstimator.sample(c-Math.min(h,x),l.loaded):this.bwEstimator.sampleTTFB(c);const H=S[P].maxBitrate;this.getBwEstimate()*this.hls.config.abrBandWidthUpFactor>H&&this.resetEstimator(H),this.clearTimer(),w.warn(`[abr] Fragment ${t.sn}${r?" part "+r.index:""} of level ${t.level} is loading too slowly;
      Time to underbuffer: ${p.toFixed(3)} s
      Estimated load time for current fragment: ${k.toFixed(3)} s
      Estimated load time for down switch fragment: ${C.toFixed(3)} s
      TTFB estimate: ${x|0} ms
      Current BW estimate: ${G(v)?v|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${P} @ ${H|0} bps`),i.trigger(E.FRAG_LOAD_EMERGENCY_ABORTED,{frag:t,part:r,stats:l})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(w.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new XE(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(E.MANIFEST_LOADING,this.onManifestLoading,this),e.on(E.FRAG_LOADING,this.onFragLoading,this),e.on(E.FRAG_LOADED,this.onFragLoaded,this),e.on(E.FRAG_BUFFERED,this.onFragBuffered,this),e.on(E.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(E.LEVEL_LOADED,this.onLevelLoaded,this),e.on(E.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(E.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(E.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(E.MANIFEST_LOADING,this.onManifestLoading,this),e.off(E.FRAG_LOADING,this.onFragLoading,this),e.off(E.FRAG_LOADED,this.onFragLoaded,this),e.off(E.FRAG_BUFFERED,this.onFragBuffered,this),e.off(E.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(E.LEVEL_LOADED,this.onLevelLoaded,this),e.off(E.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(E.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(E.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const r=t.frag;if(!this.ignoreFragment(r)){if(!r.bitrateTest){var i;this.fragCurrent=r,this.partCurrent=(i=t.part)!=null?i:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case b.BUFFER_ADD_CODEC_ERROR:case b.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case b.FRAG_LOAD_TIMEOUT:{const r=t.frag,{fragCurrent:i,partCurrent:s}=this;if(r&&i&&r.sn===i.sn&&r.level===i.level){const o=performance.now(),a=s?s.stats:r.stats,l=o-a.loading.start,u=a.loading.first?a.loading.first-a.loading.start:-1;if(a.loaded&&u>-1){const d=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(l-Math.min(d,u),a.loaded)}else this.bwEstimator.sampleTTFB(l)}break}}}getTimeToLoadFrag(e,t,r,i){const s=e+r/t,o=i?this.lastLevelLoadSec:0;return s+o}onLevelLoaded(e,t){const r=this.hls.config,{loading:i}=t.stats,s=i.end-i.start;G(s)&&(this.lastLevelLoadSec=s/1e3),t.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD)}onFragLoaded(e,{frag:t,part:r}){const i=r?r.stats:t.stats;if(t.type===W.MAIN&&this.bwEstimator.sampleTTFB(i.loading.first-i.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const s=r?r.duration:t.duration,o=this.hls.levels[t.level],a=(o.loaded?o.loaded.bytes:0)+i.loaded,l=(o.loaded?o.loaded.duration:0)+s;o.loaded={bytes:a,duration:l},o.realBitrate=Math.round(8*a/l)}if(t.bitrateTest){const s={stats:i,frag:t,part:r,id:t.type};this.onFragBuffered(E.FRAG_BUFFERED,s),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:r,part:i}=t,s=i!=null&&i.stats.loaded?i.stats:r.stats;if(s.aborted||this.ignoreFragment(r))return;const o=s.parsing.end-s.loading.start-Math.min(s.loading.first-s.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(o,s.loaded),s.bwEstimate=this.getBwEstimate(),r.bitrateTest?this.bitrateTestDelay=o/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==W.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,r=this.getBwEstimate(),i=this.hls.config.maxStarvationDelay,s=this.findBestLevel(r,t,e,0,i,1,1);if(s>-1)return s;const o=this.hls.firstLevel,a=Math.min(Math.max(o,t),e);return w.warn(`[abr] Could not find best starting auto level. Defaulting to first in playlist ${o} clamped to ${a}`),a}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,r=this.bwEstimator.canEstimate(),i=this.lastLoadedFragLevel>-1;if(e!==-1&&(!r||!i||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const s=r&&i?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const o=this.hls.levels;if(o.length>Math.max(e,s)&&o[e].loadError<=o[s].loadError)return e}return this._nextAutoLevel=s,this.nextAutoLevelKey=this.getAutoLevelKey(),s}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:r}=this,{maxAutoLevel:i,config:s,minAutoLevel:o}=r,a=t?t.duration:e?e.duration:0,l=this.getBwEstimate(),u=this.getStarvationDelay();let c=s.abrBandWidthFactor,d=s.abrBandWidthUpFactor;if(u){const x=this.findBestLevel(l,o,i,u,0,c,d);if(x>=0)return x}let f=a?Math.min(a,s.maxStarvationDelay):s.maxStarvationDelay;if(!u){const x=this.bitrateTestDelay;x&&(f=(a?Math.min(a,s.maxLoadingDelay):s.maxLoadingDelay)-x,w.info(`[abr] bitrate test took ${Math.round(1e3*x)}ms, set first fragment max fetchDuration to ${Math.round(1e3*f)} ms`),c=d=1)}const h=this.findBestLevel(l,o,i,u,f,c,d);if(w.info(`[abr] ${u?"rebuffering expected":"buffer is empty"}, optimal quality level ${h}`),h>-1)return h;const m=r.levels[o],p=r.levels[r.loadLevel];return(m==null?void 0:m.bitrate)<(p==null?void 0:p.bitrate)?o:r.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const r=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,i=e.mainForwardBufferInfo;return(i?i.len:0)/r}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,r,i,s,o,a){var l;const u=i+s,c=this.lastLoadedFragLevel,d=c===-1?this.hls.firstLevel:c,{fragCurrent:f,partCurrent:h}=this,{levels:m,allAudioTracks:p,loadLevel:x,config:y}=this.hls;if(m.length===1)return 0;const v=m[d],S=!!(v!=null&&(l=v.details)!=null&&l.live),L=x===-1||c===-1;let T,A="SDR",R=(v==null?void 0:v.frameRate)||0;const{audioPreference:k,videoPreference:_}=y,C=this.audioTracksByGroup||(this.audioTracksByGroup=rS(p));if(L){if(this.firstSelection!==-1)return this.firstSelection;const Y=this.codecTiers||(this.codecTiers=iS(m,C,t,r)),K=nS(Y,A,e,k,_),{codecSet:J,videoRanges:M,minFramerate:F,minBitrate:N,preferHDR:$}=K;T=J,A=$?M[M.length-1]:M[0],R=F,e=Math.max(e,N),w.log(`[abr] picked start tier ${JSON.stringify(K)}`)}else T=v==null?void 0:v.codecSet,A=v==null?void 0:v.videoRange;const P=h?h.duration:f?f.duration:0,H=this.bwEstimator.getEstimateTTFB()/1e3,B=[];for(let Y=r;Y>=t;Y--){var q;const K=m[Y],J=Y>d;if(!K)continue;if(y.useMediaCapabilities&&!K.supportedResult&&!K.supportedPromise){const re=navigator.mediaCapabilities;typeof(re==null?void 0:re.decodingInfo)=="function"&&QE(K,C,A,R,e,k)?(K.supportedPromise=JE(K,C,re),K.supportedPromise.then(ae=>{if(!this.hls)return;K.supportedResult=ae;const le=this.hls.levels,_e=le.indexOf(K);ae.error?w.warn(`[abr] MediaCapabilities decodingInfo error: "${ae.error}" for level ${_e} ${JSON.stringify(ae)}`):ae.supported||(w.warn(`[abr] Unsupported MediaCapabilities decodingInfo result for level ${_e} ${JSON.stringify(ae)}`),_e>-1&&le.length>1&&(w.log(`[abr] Removing unsupported level ${_e}`),this.hls.removeLevel(_e)))})):K.supportedResult=A0}if(T&&K.codecSet!==T||A&&K.videoRange!==A||J&&R>K.frameRate||!J&&R>0&&R<K.frameRate||K.supportedResult&&!((q=K.supportedResult.decodingInfoResults)!=null&&q[0].smooth)){B.push(Y);continue}const M=K.details,F=(h?M==null?void 0:M.partTarget:M==null?void 0:M.averagetargetduration)||P;let N;J?N=a*e:N=o*e;const $=P&&i>=P*2&&s===0?m[Y].averageBitrate:m[Y].maxBitrate,V=this.getTimeToLoadFrag(H,N,$*F,M===void 0);if(N>=$&&(Y===c||K.loadError===0&&K.fragmentError===0)&&(V<=H||!G(V)||S&&!this.bitrateTestDelay||V<u)){const re=this.forcedAutoLevel;return Y!==x&&(re===-1||re!==x)&&(B.length&&w.trace(`[abr] Skipped level(s) ${B.join(",")} of ${r} max with CODECS and VIDEO-RANGE:"${m[B[0]].codecs}" ${m[B[0]].videoRange}; not compatible with "${v.codecs}" ${A}`),w.info(`[abr] switch candidate:${d}->${Y} adjustedbw(${Math.round(N)})-bitrate=${Math.round(N-$)} ttfb:${H.toFixed(1)} avgDuration:${F.toFixed(1)} maxFetchDuration:${u.toFixed(1)} fetchDuration:${V.toFixed(1)} firstSelection:${L} codecSet:${T} videoRange:${A} hls.loadLevel:${x}`)),L&&(this.firstSelection=Y),Y}}return-1}set nextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:r}=this.hls,i=Math.min(Math.max(e,r),t);this._nextAutoLevel!==i&&(this.nextAutoLevelKey="",this._nextAutoLevel=i)}}class lS{constructor(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}var Ie={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class uS{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(E.BUFFER_APPENDED,this.onBufferAppended,this),e.on(E.FRAG_BUFFERED,this.onFragBuffered,this),e.on(E.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:e}=this;e.off(E.BUFFER_APPENDED,this.onBufferAppended,this),e.off(E.FRAG_BUFFERED,this.onFragBuffered,this),e.off(E.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const r=this.activePartLists[t];if(r)for(let i=r.length;i--;){const s=r[i];if(!s)break;const o=s.end;if(s.start<=e&&o!==null&&e<=o)return s}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){const{fragments:r}=this,i=Object.keys(r);for(let s=i.length;s--;){const o=r[i[s]];if((o==null?void 0:o.body.type)===t&&o.buffered){const a=o.body;if(a.start<=e&&e<=a.end)return a}}return null}detectEvictedFragments(e,t,r,i){this.timeRanges&&(this.timeRanges[e]=t);const s=(i==null?void 0:i.fragment.sn)||-1;Object.keys(this.fragments).forEach(o=>{const a=this.fragments[o];if(!a||s>=a.body.sn)return;if(!a.buffered&&!a.loaded){a.body.type===r&&this.removeFragment(a.body);return}const l=a.range[e];l&&l.time.some(u=>{const c=!this.isTimeBuffered(u.startPTS,u.endPTS,t);return c&&this.removeFragment(a.body),c})})}detectPartialFragments(e){const t=this.timeRanges,{frag:r,part:i}=e;if(!t||r.sn==="initSegment")return;const s=Xn(r),o=this.fragments[s];if(!o||o.buffered&&r.gap)return;const a=!r.relurl;Object.keys(t).forEach(l=>{const u=r.elementaryStreams[l];if(!u)return;const c=t[l],d=a||u.partial===!0;o.range[l]=this.getBufferedTimes(r,i,d,c)}),o.loaded=null,Object.keys(o.range).length?(o.buffered=!0,(o.body.endList=r.endList||o.body.endList)&&(this.endListFragments[o.body.type]=o),is(o)||this.removeParts(r.sn-1,r.type)):this.removeFragment(o.body)}removeParts(e,t){const r=this.activePartLists[t];r&&(this.activePartLists[t]=r.filter(i=>i.fragment.sn>=e))}fragBuffered(e,t){const r=Xn(e);let i=this.fragments[r];!i&&t&&(i=this.fragments[r]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),i&&(i.loaded=null,i.buffered=!0)}getBufferedTimes(e,t,r,i){const s={time:[],partial:r},o=e.start,a=e.end,l=e.minEndPTS||a,u=e.maxStartPTS||o;for(let c=0;c<i.length;c++){const d=i.start(c)-this.bufferPadding,f=i.end(c)+this.bufferPadding;if(u>=d&&l<=f){s.time.push({startPTS:Math.max(o,i.start(c)),endPTS:Math.min(a,i.end(c))});break}else if(o<f&&a>d){const h=Math.max(o,i.start(c)),m=Math.min(a,i.end(c));m>h&&(s.partial=!0,s.time.push({startPTS:h,endPTS:m}))}else if(a<=d)break}return s}getPartialFragment(e){let t=null,r,i,s,o=0;const{bufferPadding:a,fragments:l}=this;return Object.keys(l).forEach(u=>{const c=l[u];c&&is(c)&&(i=c.body.start-a,s=c.body.end+a,e>=i&&e<=s&&(r=Math.min(e-i,s-e),o<=r&&(t=c.body,o=r)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||is(t))}getState(e){const t=Xn(e),r=this.fragments[t];return r?r.buffered?is(r)?Ie.PARTIAL:Ie.OK:Ie.APPENDING:Ie.NOT_LOADED}isTimeBuffered(e,t,r){let i,s;for(let o=0;o<r.length;o++){if(i=r.start(o)-this.bufferPadding,s=r.end(o)+this.bufferPadding,e>=i&&t<=s)return!0;if(t<=i)return!1}return!1}onFragLoaded(e,t){const{frag:r,part:i}=t;if(r.sn==="initSegment"||r.bitrateTest)return;const s=i?null:t,o=Xn(r);this.fragments[o]={body:r,appendedPTS:null,loaded:s,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:r,part:i,timeRanges:s}=t;if(r.sn==="initSegment")return;const o=r.type;if(i){let a=this.activePartLists[o];a||(this.activePartLists[o]=a=[]),a.push(i)}this.timeRanges=s,Object.keys(s).forEach(a=>{const l=s[a];this.detectEvictedFragments(a,l,o,i)})}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=Xn(e);return!!this.fragments[t]}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,r,i,s){i&&!this.hasGaps||Object.keys(this.fragments).forEach(o=>{const a=this.fragments[o];if(!a)return;const l=a.body;l.type!==r||i&&!l.gap||l.start<t&&l.end>e&&(a.buffered||s)&&this.removeFragment(l)})}removeFragment(e){const t=Xn(e);e.stats.loaded=0,e.clearElementaryStreamInfo();const r=this.activePartLists[e.type];if(r){const i=e.sn;this.activePartLists[e.type]=r.filter(s=>s.fragment.sn!==i)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1}}function is(n){var e,t,r;return n.buffered&&(n.body.gap||((e=n.range.video)==null?void 0:e.partial)||((t=n.range.audio)==null?void 0:t.partial)||((r=n.range.audiovideo)==null?void 0:r.partial))}function Xn(n){return`${n.type}_${n.level}_${n.sn}`}const cS={length:0,start:()=>0,end:()=>0};class ue{static isBuffered(e,t){try{if(e){const r=ue.getBuffered(e);for(let i=0;i<r.length;i++)if(t>=r.start(i)&&t<=r.end(i))return!0}}catch{}return!1}static bufferInfo(e,t,r){try{if(e){const i=ue.getBuffered(e),s=[];let o;for(o=0;o<i.length;o++)s.push({start:i.start(o),end:i.end(o)});return this.bufferedInfo(s,t,r)}}catch{}return{len:0,start:t,end:t,nextStart:void 0}}static bufferedInfo(e,t,r){t=Math.max(0,t),e.sort(function(u,c){const d=u.start-c.start;return d||c.end-u.end});let i=[];if(r)for(let u=0;u<e.length;u++){const c=i.length;if(c){const d=i[c-1].end;e[u].start-d<r?e[u].end>d&&(i[c-1].end=e[u].end):i.push(e[u])}else i.push(e[u])}else i=e;let s=0,o,a=t,l=t;for(let u=0;u<i.length;u++){const c=i[u].start,d=i[u].end;if(t+r>=c&&t<d)a=c,l=d,s=l-t;else if(t+r<c){o=c;break}}return{len:s,start:a||0,end:l||0,nextStart:o}}static getBuffered(e){try{return e.buffered}catch(t){return w.log("failed to get media.buffered",t),cS}}}class Qu{constructor(e,t,r,i=0,s=-1,o=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=ss(),this.buffering={audio:ss(),video:ss(),audiovideo:ss()},this.level=e,this.sn=t,this.id=r,this.size=i,this.part=s,this.partial=o}}function ss(){return{start:0,executeStart:0,executeEnd:0,end:0}}function Is(n,e){for(let r=0,i=n.length;r<i;r++){var t;if(((t=n[r])==null?void 0:t.cc)===e)return n[r]}return null}function dS(n,e,t){return!!(e&&(t.endCC>t.startCC||n&&n.cc<t.startCC))}function fS(n,e){const t=n.fragments,r=e.fragments;if(!r.length||!t.length){w.log("No fragments to align");return}const i=Is(t,r[0].cc);if(!i||i&&!i.startPTS){w.log("No frag in previous level to align on");return}return i}function Zd(n,e){if(n){const t=n.start+e;n.start=n.startPTS=t,n.endPTS=t+n.duration}}function w0(n,e){const t=e.fragments;for(let r=0,i=t.length;r<i;r++)Zd(t[r],n);e.fragmentHint&&Zd(e.fragmentHint,n),e.alignedSliding=!0}function hS(n,e,t){e&&(mS(n,t,e),!t.alignedSliding&&e&&mo(t,e),!t.alignedSliding&&e&&!t.skippedSegments&&S0(e,t))}function mS(n,e,t){if(dS(n,t,e)){const r=fS(t,e);r&&G(r.start)&&(w.log(`Adjusting PTS using last level due to CC increase within current level ${e.url}`),w0(r.start,e))}}function mo(n,e){if(!n.hasProgramDateTime||!e.hasProgramDateTime)return;const t=n.fragments,r=e.fragments;if(!t.length||!r.length)return;let i,s;const o=Math.min(e.endCC,n.endCC);e.startCC<o&&n.startCC<o&&(i=Is(r,o),s=Is(t,o)),(!i||!s)&&(i=r[Math.floor(r.length/2)],s=Is(t,i.cc)||t[Math.floor(t.length/2)]);const a=i.programDateTime,l=s.programDateTime;if(!a||!l)return;const u=(l-a)/1e3-(s.start-i.start);w0(u,n)}const ef=Math.pow(2,17);class gS{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const r=e.url;if(!r)return Promise.reject(new Gt({type:X.NETWORK_ERROR,details:b.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${r?"part list":"url"}`),networkDetails:null}));this.abort();const i=this.config,s=i.fLoader,o=i.loader;return new Promise((a,l)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(h=>h[0]==="GAP")){l(nf(e));return}else e.gap=!1;const u=this.loader=e.loader=s?new s(i):new o(i),c=tf(e),d=Xd(i.fragLoadPolicy.default),f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:ef};e.stats=u.stats,u.load(c,f,{onSuccess:(h,m,p,x)=>{this.resetLoader(e,u);let y=h.data;p.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(y.slice(0,16)),y=y.slice(16)),a({frag:e,part:null,payload:y,networkDetails:x})},onError:(h,m,p,x)=>{this.resetLoader(e,u),l(new Gt({type:X.NETWORK_ERROR,details:b.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:De({url:r,data:void 0},h),error:new Error(`HTTP Error ${h.code} ${h.text}`),networkDetails:p,stats:x}))},onAbort:(h,m,p)=>{this.resetLoader(e,u),l(new Gt({type:X.NETWORK_ERROR,details:b.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:p,stats:h}))},onTimeout:(h,m,p)=>{this.resetLoader(e,u),l(new Gt({type:X.NETWORK_ERROR,details:b.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${f.timeout}ms`),networkDetails:p,stats:h}))},onProgress:(h,m,p,x)=>{t&&t({frag:e,part:null,payload:p,networkDetails:x})}})})}loadPart(e,t,r){this.abort();const i=this.config,s=i.fLoader,o=i.loader;return new Promise((a,l)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){l(nf(e,t));return}const u=this.loader=e.loader=s?new s(i):new o(i),c=tf(e,t),d=Xd(i.fragLoadPolicy.default),f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:ef};t.stats=u.stats,u.load(c,f,{onSuccess:(h,m,p,x)=>{this.resetLoader(e,u),this.updateStatsFromPart(e,t);const y={frag:e,part:t,payload:h.data,networkDetails:x};r(y),a(y)},onError:(h,m,p,x)=>{this.resetLoader(e,u),l(new Gt({type:X.NETWORK_ERROR,details:b.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:De({url:c.url,data:void 0},h),error:new Error(`HTTP Error ${h.code} ${h.text}`),networkDetails:p,stats:x}))},onAbort:(h,m,p)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,u),l(new Gt({type:X.NETWORK_ERROR,details:b.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:p,stats:h}))},onTimeout:(h,m,p)=>{this.resetLoader(e,u),l(new Gt({type:X.NETWORK_ERROR,details:b.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${f.timeout}ms`),networkDetails:p,stats:h}))}})})}updateStatsFromPart(e,t){const r=e.stats,i=t.stats,s=i.total;if(r.loaded+=i.loaded,s){const l=Math.round(e.duration/t.duration),u=Math.min(Math.round(r.loaded/s),l),d=(l-u)*Math.round(r.loaded/u);r.total=r.loaded+d}else r.total=Math.max(r.loaded,r.total);const o=r.loading,a=i.loading;o.start?o.first+=a.first-a.start:(o.start=a.start,o.first=a.first),o.end=a.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function tf(n,e=null){const t=e||n,r={frag:n,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},i=t.byteRangeStartOffset,s=t.byteRangeEndOffset;if(G(i)&&G(s)){var o;let a=i,l=s;if(n.sn==="initSegment"&&((o=n.decryptdata)==null?void 0:o.method)==="AES-128"){const u=s-i;u%16&&(l=s+(16-u%16)),i!==0&&(r.resetIV=!0,a=i-16)}r.rangeStart=a,r.rangeEnd=l}return r}function nf(n,e){const t=new Error(`GAP ${n.gap?"tag":"attribute"} found`),r={type:X.MEDIA_ERROR,details:b.FRAG_GAP,fatal:!1,frag:n,error:t,networkDetails:null};return e&&(r.part=e),(e||n).stats.aborted=!0,new Gt(r)}class Gt extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class pS{constructor(e,t){this.subtle=void 0,this.aesIV=void 0,this.subtle=e,this.aesIV=t}decrypt(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)}}class yS{constructor(e,t){this.subtle=void 0,this.key=void 0,this.subtle=e,this.key=t}expandKey(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}function xS(n){const e=n.byteLength,t=e&&new DataView(n.buffer).getUint8(e-1);return t?Un(n,0,e-t):n}class vS{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),r=new Uint32Array(4);for(let i=0;i<4;i++)r[i]=t.getUint32(i*4);return r}initTable(){const e=this.sBox,t=this.invSBox,r=this.subMix,i=r[0],s=r[1],o=r[2],a=r[3],l=this.invSubMix,u=l[0],c=l[1],d=l[2],f=l[3],h=new Uint32Array(256);let m=0,p=0,x=0;for(x=0;x<256;x++)x<128?h[x]=x<<1:h[x]=x<<1^283;for(x=0;x<256;x++){let y=p^p<<1^p<<2^p<<3^p<<4;y=y>>>8^y&255^99,e[m]=y,t[y]=m;const v=h[m],S=h[v],L=h[S];let T=h[y]*257^y*16843008;i[m]=T<<24|T>>>8,s[m]=T<<16|T>>>16,o[m]=T<<8|T>>>24,a[m]=T,T=L*16843009^S*65537^v*257^m*16843008,u[y]=T<<24|T>>>8,c[y]=T<<16|T>>>16,d[y]=T<<8|T>>>24,f[y]=T,m?(m=v^h[h[h[L^v]]],p^=h[h[p]]):m=p=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let r=!0,i=0;for(;i<t.length&&r;)r=t[i]===this.key[i],i++;if(r)return;this.key=t;const s=this.keySize=t.length;if(s!==4&&s!==6&&s!==8)throw new Error("Invalid aes key size="+s);const o=this.ksRows=(s+6+1)*4;let a,l;const u=this.keySchedule=new Uint32Array(o),c=this.invKeySchedule=new Uint32Array(o),d=this.sBox,f=this.rcon,h=this.invSubMix,m=h[0],p=h[1],x=h[2],y=h[3];let v,S;for(a=0;a<o;a++){if(a<s){v=u[a]=t[a];continue}S=v,a%s===0?(S=S<<8|S>>>24,S=d[S>>>24]<<24|d[S>>>16&255]<<16|d[S>>>8&255]<<8|d[S&255],S^=f[a/s|0]<<24):s>6&&a%s===4&&(S=d[S>>>24]<<24|d[S>>>16&255]<<16|d[S>>>8&255]<<8|d[S&255]),u[a]=v=(u[a-s]^S)>>>0}for(l=0;l<o;l++)a=o-l,l&3?S=u[a]:S=u[a-4],l<4||a<=4?c[l]=S:c[l]=m[d[S>>>24]]^p[d[S>>>16&255]]^x[d[S>>>8&255]]^y[d[S&255]],c[l]=c[l]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,r){const i=this.keySize+6,s=this.invKeySchedule,o=this.invSBox,a=this.invSubMix,l=a[0],u=a[1],c=a[2],d=a[3],f=this.uint8ArrayToUint32Array_(r);let h=f[0],m=f[1],p=f[2],x=f[3];const y=new Int32Array(e),v=new Int32Array(y.length);let S,L,T,A,R,k,_,C,P,H,B,q,Y,K;const J=this.networkToHostOrderSwap;for(;t<y.length;){for(P=J(y[t]),H=J(y[t+1]),B=J(y[t+2]),q=J(y[t+3]),R=P^s[0],k=q^s[1],_=B^s[2],C=H^s[3],Y=4,K=1;K<i;K++)S=l[R>>>24]^u[k>>16&255]^c[_>>8&255]^d[C&255]^s[Y],L=l[k>>>24]^u[_>>16&255]^c[C>>8&255]^d[R&255]^s[Y+1],T=l[_>>>24]^u[C>>16&255]^c[R>>8&255]^d[k&255]^s[Y+2],A=l[C>>>24]^u[R>>16&255]^c[k>>8&255]^d[_&255]^s[Y+3],R=S,k=L,_=T,C=A,Y=Y+4;S=o[R>>>24]<<24^o[k>>16&255]<<16^o[_>>8&255]<<8^o[C&255]^s[Y],L=o[k>>>24]<<24^o[_>>16&255]<<16^o[C>>8&255]<<8^o[R&255]^s[Y+1],T=o[_>>>24]<<24^o[C>>16&255]<<16^o[R>>8&255]<<8^o[k&255]^s[Y+2],A=o[C>>>24]<<24^o[R>>16&255]<<16^o[k>>8&255]<<8^o[_&255]^s[Y+3],v[t]=J(S^h),v[t+1]=J(A^m),v[t+2]=J(T^p),v[t+3]=J(L^x),h=P,m=H,p=B,x=q,t=t+4}return v.buffer}}const ES=16;class Ju{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const r=self.crypto;r&&(this.subtle=r.subtle||r.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const r=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?xS(r):r}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,r){return this.useSoftware?new Promise((i,s)=>{this.softwareDecrypt(new Uint8Array(e),t,r);const o=this.flush();o?i(o.buffer):s(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,r)}softwareDecrypt(e,t,r){const{currentIV:i,currentResult:s,remainderData:o}=this;this.logOnce("JS AES decrypt"),o&&(e=ht(o,e),this.remainderData=null);const a=this.getValidChunk(e);if(!a.length)return null;i&&(r=i);let l=this.softwareDecrypter;l||(l=this.softwareDecrypter=new vS),l.expandKey(t);const u=s;return this.currentResult=l.decrypt(a.buffer,0,r),this.currentIV=Un(a,-16).buffer,u||null}webCryptoDecrypt(e,t,r){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,r));this.key=t,this.fastAesKey=new yS(this.subtle,t)}return this.fastAesKey.expandKey().then(i=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new pS(this.subtle,new Uint8Array(r)).decrypt(e.buffer,i)):Promise.reject(new Error("web crypto not initialized"))).catch(i=>(w.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${i.name}: ${i.message}`),this.onWebCryptoError(e,t,r)))}onWebCryptoError(e,t,r){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,r);const i=this.flush();if(i)return i.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")}getValidChunk(e){let t=e;const r=e.length-e.length%ES;return r!==e.length&&(t=Un(e,0,r),this.remainderData=Un(e,r)),t}logOnce(e){this.logEnabled&&(w.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const SS={toString:function(n){let e="";const t=n.length;for(let r=0;r<t;r++)e+=`[${n.start(r).toFixed(3)}-${n.end(r).toFixed(3)}]`;return e}},O={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class Zu extends lS{constructor(e,t,r,i,s){super(),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=O.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.loadedmetadata=!1,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.onvseeking=null,this.onvended=null,this.logPrefix="",this.log=void 0,this.warn=void 0,this.playlistType=s,this.logPrefix=i,this.log=w.log.bind(w,`${i}:`),this.warn=w.warn.bind(w,`${i}:`),this.hls=e,this.fragmentLoader=new gS(e.config),this.keyLoader=r,this.fragmentTracker=t,this.config=e.config,this.decrypter=new Ju(e.config),e.on(E.MANIFEST_LOADED,this.onManifestLoaded,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=O.STOPPED}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}_streamEnded(e,t){if(t.live||e.nextStart||!e.end||!this.media)return!1;const r=t.partList;if(r!=null&&r.length){const s=r[r.length-1];return ue.isBuffered(this.media,s.start+s.duration/2)}const i=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(i)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null){var e;return(e=this.levelLastLoaded)==null?void 0:e.details}}onMediaAttached(e,t){const r=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),r.addEventListener("seeking",this.onvseeking),r.addEventListener("ended",this.onvended);const i=this.config;this.levels&&i.autoStartLoad&&this.state===O.STOPPED&&this.startLoad(i.startPosition)}onMediaDetaching(){const e=this.media;e!=null&&e.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&this.onvseeking&&this.onvended&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}onMediaSeeking(){const{config:e,fragCurrent:t,media:r,mediaBuffer:i,state:s}=this,o=r?r.currentTime:0,a=ue.bufferInfo(i||r,o,e.maxBufferHole);if(this.log(`media seeking to ${G(o)?o.toFixed(3):o}, state: ${s}`),this.state===O.ENDED)this.resetLoadingState();else if(t){const l=e.maxFragLookUpTolerance,u=t.start-l,c=t.start+t.duration+l;if(!a.len||c<a.start||u>a.end){const d=o>c;(o<u||d)&&(d&&t.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),t.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}r&&(this.fragmentTracker.removeFragmentsInRange(o,1/0,this.playlistType,!0),this.lastCurrentTime=o),!this.loadedmetadata&&!a.len&&(this.nextLoadPosition=this.startPosition=o),this.tickImmediate()}onMediaEnded(){this.startPosition=this.lastCurrentTime=0}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset,this.initPTS=[]}onHandlerDestroying(){this.hls.off(E.MANIFEST_LOADED,this.onManifestLoaded,this),this.stopLoad(),super.onHandlerDestroying(),this.hls=null}onHandlerDestroyed(){this.state=O.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,r){this._loadFragForPlayback(e,t,r)}_loadFragForPlayback(e,t,r){const i=s=>{if(this.fragContextChanged(e)){this.warn(`Fragment ${e.sn}${s.part?" p: "+s.part.index:""} of level ${e.level} was dropped during download.`),this.fragmentTracker.removeFragment(e);return}e.stats.chunkCount++,this._handleFragmentLoadProgress(s)};this._doFragLoad(e,t,r,i).then(s=>{if(!s)return;const o=this.state;if(this.fragContextChanged(e)){(o===O.FRAG_LOADING||!this.fragCurrent&&o===O.PARSING)&&(this.fragmentTracker.removeFragment(e),this.state=O.IDLE);return}"payload"in s&&(this.log(`Loaded fragment ${e.sn} of level ${e.level}`),this.hls.trigger(E.FRAG_LOADED,s)),this._handleFragmentLoadComplete(s)}).catch(s=>{this.state===O.STOPPED||this.state===O.ERROR||(this.warn(`Frag error: ${(s==null?void 0:s.message)||s}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:r}=this;if(r.getState(e)===Ie.APPENDING){const s=e.type,o=this.getFwdBufferInfo(this.mediaBuffer,s),a=Math.max(e.duration,o?o.len:this.config.maxBufferLength),l=this.backtrackFragment;((l?e.sn-l.sn:0)===1||this.reduceMaxBufferLength(a,e.duration))&&r.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?r.removeAllFragments():r.hasParts(e.type)&&(r.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),r.getState(e)===Ie.PARTIAL&&r.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}flushMainBuffer(e,t,r=null){if(!(e-t))return;const i={startOffset:e,endOffset:t,type:r};this.hls.trigger(E.BUFFER_FLUSHING,i)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(r=>{if(!r||this.fragContextChanged(e)||!this.levels)throw new Error("init load aborted");return r}).then(r=>{const{hls:i}=this,{payload:s}=r,o=e.decryptdata;if(s&&s.byteLength>0&&o!=null&&o.key&&o.iv&&o.method==="AES-128"){const a=self.performance.now();return this.decrypter.decrypt(new Uint8Array(s),o.key.buffer,o.iv.buffer).catch(l=>{throw i.trigger(E.ERROR,{type:X.MEDIA_ERROR,details:b.FRAG_DECRYPT_ERROR,fatal:!1,error:l,reason:l.message,frag:e}),l}).then(l=>{const u=self.performance.now();return i.trigger(E.FRAG_DECRYPTED,{frag:e,payload:l,stats:{tstart:a,tdecrypt:u}}),r.payload=l,this.completeInitSegmentLoad(r)})}return this.completeInitSegmentLoad(r)}).catch(r=>{this.state===O.STOPPED||this.state===O.ERROR||(this.warn(r),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const r=e.frag.stats;this.state=O.IDLE,e.frag.data=new Uint8Array(e.payload),r.parsing.start=r.buffering.start=self.performance.now(),r.parsing.end=r.buffering.end=self.performance.now(),this.tick()}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){var r,i,s,o;const a=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.playlistType===W.MAIN?"level":"track"} ${e.level} (frag:[${((r=e.startPTS)!=null?r:NaN).toFixed(3)}-${((i=e.endPTS)!=null?i:NaN).toFixed(3)}] > buffer:${a?SS.toString(ue.getBuffered(a)):"(detached)"})`),e.sn!=="initSegment"){var l;if(e.type!==W.SUBTITLE){const c=e.elementaryStreams;if(!Object.keys(c).some(d=>!!c[d])){this.state=O.IDLE;return}}const u=(l=this.levels)==null?void 0:l[e.level];u!=null&&u.fragmentError&&(this.log(`Resetting level fragment error count of ${u.fragmentError} on frag buffered`),u.fragmentError=0)}this.state=O.IDLE,a&&(!this.loadedmetadata&&e.type==W.MAIN&&a.buffered.length&&((s=this.fragCurrent)==null?void 0:s.sn)===((o=this.fragPrevious)==null?void 0:o.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())}seekToStartPos(){}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:r,part:i,partsLoaded:s}=e,o=!s||s.length===0||s.some(l=>!l),a=new Qu(r.level,r.sn,r.stats.chunkCount+1,0,i?i.index:-1,!o);t.flush(a)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,r=null,i){var s;const o=t==null?void 0:t.details;if(!this.levels||!o)throw new Error(`frag load aborted, missing level${o?"":" detail"}s`);let a=null;if(e.encrypted&&!((s=e.decryptdata)!=null&&s.key)?(this.log(`Loading key for ${e.sn} of [${o.startSN}-${o.endSN}], ${this.logPrefix==="[stream-controller]"?"level":"track"} ${e.level}`),this.state=O.KEY_LOADING,this.fragCurrent=e,a=this.keyLoader.load(e).then(c=>{if(!this.fragContextChanged(c.frag))return this.hls.trigger(E.KEY_LOADED,c),this.state===O.KEY_LOADING&&(this.state=O.IDLE),c}),this.hls.trigger(E.KEY_LOADING,{frag:e}),this.fragCurrent===null&&(a=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):!e.encrypted&&o.encryptedFragments.length&&this.keyLoader.loadClear(e,o.encryptedFragments),r=Math.max(e.start,r||0),this.config.lowLatencyMode&&e.sn!=="initSegment"){const c=o.partList;if(c&&i){r>e.end&&o.fragmentHint&&(e=o.fragmentHint);const d=this.getNextPart(c,e,r);if(d>-1){const f=c[d];this.log(`Loading part sn: ${e.sn} p: ${f.index} cc: ${e.cc} of playlist [${o.startSN}-${o.endSN}] parts [0-${d}-${c.length-1}] ${this.logPrefix==="[stream-controller]"?"level":"track"}: ${e.level}, target: ${parseFloat(r.toFixed(3))}`),this.nextLoadPosition=f.start+f.duration,this.state=O.FRAG_LOADING;let h;return a?h=a.then(m=>!m||this.fragContextChanged(m.frag)?null:this.doFragPartsLoad(e,f,t,i)).catch(m=>this.handleFragLoadError(m)):h=this.doFragPartsLoad(e,f,t,i).catch(m=>this.handleFragLoadError(m)),this.hls.trigger(E.FRAG_LOADING,{frag:e,part:f,targetBufferTime:r}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):h}else if(!e.url||this.loadedEndOfParts(c,r))return Promise.resolve(null)}}this.log(`Loading fragment ${e.sn} cc: ${e.cc} ${o?"of ["+o.startSN+"-"+o.endSN+"] ":""}${this.logPrefix==="[stream-controller]"?"level":"track"}: ${e.level}, target: ${parseFloat(r.toFixed(3))}`),G(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=O.FRAG_LOADING;const l=this.config.progressive;let u;return l&&a?u=a.then(c=>!c||this.fragContextChanged(c==null?void 0:c.frag)?null:this.fragmentLoader.load(e,i)).catch(c=>this.handleFragLoadError(c)):u=Promise.all([this.fragmentLoader.load(e,l?i:void 0),a]).then(([c])=>(!l&&c&&i&&i(c),c)).catch(c=>this.handleFragLoadError(c)),this.hls.trigger(E.FRAG_LOADING,{frag:e,targetBufferTime:r}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):u}doFragPartsLoad(e,t,r,i){return new Promise((s,o)=>{var a;const l=[],u=(a=r.details)==null?void 0:a.partList,c=d=>{this.fragmentLoader.loadPart(e,d,i).then(f=>{l[d.index]=f;const h=f.part;this.hls.trigger(E.FRAG_LOADED,f);const m=Yd(r,e.sn,d.index+1)||T0(u,e.sn,d.index+1);if(m)c(m);else return s({frag:e,part:h,partsLoaded:l})}).catch(o)};c(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;e.data&&t.details===b.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(E.ERROR,t)}else this.hls.trigger(E.ERROR,{type:X.OTHER_ERROR,details:b.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==O.PARSING){!this.fragCurrent&&this.state!==O.STOPPED&&this.state!==O.ERROR&&(this.state=O.IDLE);return}const{frag:r,part:i,level:s}=t,o=self.performance.now();r.stats.parsing.end=o,i&&(i.stats.parsing.end=o),this.updateLevelTiming(r,i,s,e.partial)}getCurrentContext(e){const{levels:t,fragCurrent:r}=this,{level:i,sn:s,part:o}=e;if(!(t!=null&&t[i]))return this.warn(`Levels object was unset while buffering fragment ${s} of level ${i}. The current chunk will not be buffered.`),null;const a=t[i],l=o>-1?Yd(a,s,o):null,u=l?l.fragment:VE(a,s,r);return u?(r&&r!==u&&(u.stats=r.stats),{frag:u,part:l,level:a}):null}bufferFragmentData(e,t,r,i,s){var o;if(!e||this.state!==O.PARSING)return;const{data1:a,data2:l}=e;let u=a;if(a&&l&&(u=ht(a,l)),!((o=u)!=null&&o.length))return;const c={type:e.type,frag:t,part:r,chunkMeta:i,parent:t.type,data:u};if(this.hls.trigger(E.BUFFER_APPENDING,c),e.dropped&&e.independent&&!r){if(s)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!ue.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const r=t.currentTime,i=ue.bufferInfo(t,r,0),s=e.duration,o=Math.min(this.config.maxFragLookUpTolerance*2,s*.25),a=Math.max(Math.min(e.start-o,i.end-o),r+o);e.start-a>o&&this.flushMainBuffer(a,e.start)}getFwdBufferInfo(e,t){const r=this.getLoadPosition();return G(r)?this.getFwdBufferInfoAtPos(e,r,t):null}getFwdBufferInfoAtPos(e,t,r){const{config:{maxBufferHole:i}}=this,s=ue.bufferInfo(e,t,i);if(s.len===0&&s.nextStart!==void 0){const o=this.fragmentTracker.getBufferedFrag(t,r);if(o&&s.nextStart<o.end)return ue.bufferInfo(e,t,Math.max(s.nextStart,i))}return s}getMaxBufferLength(e){const{config:t}=this;let r;return e?r=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):r=t.maxBufferLength,Math.min(r,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const r=this.config,i=Math.max(Math.min(e-t,r.maxBufferLength),t),s=Math.max(e-t*3,r.maxMaxBufferLength/2,i);return s>=i?(r.maxMaxBufferLength=s,this.warn(`Reduce max buffer length to ${s}s`),!0):!1}getAppendedFrag(e,t=W.MAIN){const r=this.fragmentTracker.getAppendedFrag(e,W.MAIN);return r&&"fragment"in r?r.fragment:r}getNextFragment(e,t){const r=t.fragments,i=r.length;if(!i)return null;const{config:s}=this,o=r[0].start;let a;if(t.live){const l=s.initialLiveManifestSize;if(i<l)return this.warn(`Not enough fragments to start playback (have: ${i}, need: ${l})`),null;(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<o)&&(a=this.getInitialLiveFragment(t,r),this.startPosition=this.nextLoadPosition=a?this.hls.liveSyncPosition||a.start:e)}else e<=o&&(a=r[0]);if(!a){const l=s.lowLatencyMode?t.partEnd:t.fragmentEnd;a=this.getFragmentAtPosition(e,l,t)}return this.mapToInitFragWhenRequired(a)}isLoopLoading(e,t){const r=this.fragmentTracker.getState(e);return(r===Ie.OK||r===Ie.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,r,i,s){const o=e.gap,a=this.getNextFragment(this.nextLoadPosition,t);if(a===null)return a;if(e=a,o&&e&&!e.gap&&r.nextStart){const l=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,r.nextStart,i);if(l!==null&&r.len+l.len>=s)return this.log(`buffer full after gaps in "${i}" playlist starting at sn: ${e.sn}`),null}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!(e!=null&&e.initSegment.data)&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,r){let i=-1,s=!1,o=!0;for(let a=0,l=e.length;a<l;a++){const u=e[a];if(o=o&&!u.independent,i>-1&&r<u.start)break;const c=u.loaded;c?i=-1:(s||u.independent||o)&&u.fragment===t&&(i=a),s=c}return i}loadedEndOfParts(e,t){const r=e[e.length-1];return r&&t>r.start&&r.loaded}getInitialLiveFragment(e,t){const r=this.fragPrevious;let i=null;if(r){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${r.programDateTime}`),i=HE(t,r.endProgramDateTime,this.config.maxFragLookUpTolerance)),!i){const s=r.sn+1;if(s>=e.startSN&&s<=e.endSN){const o=t[s-e.startSN];r.cc===o.cc&&(i=o,this.log(`Live playlist, switching playlist, load frag with next SN: ${i.sn}`))}i||(i=YE(t,r.cc),i&&this.log(`Live playlist, switching playlist, load frag with same CC: ${i.sn}`))}}else{const s=this.hls.liveSyncPosition;s!==null&&(i=this.getFragmentAtPosition(s,this.bitrateTest?e.fragmentEnd:e.edge,e))}return i}getFragmentAtPosition(e,t,r){const{config:i}=this;let{fragPrevious:s}=this,{fragments:o,endSN:a}=r;const{fragmentHint:l}=r,{maxFragLookUpTolerance:u}=i,c=r.partList,d=!!(i.lowLatencyMode&&c!=null&&c.length&&l);d&&l&&!this.bitrateTest&&(o=o.concat(l),a=l.sn);let f;if(e<t){const h=e>t-u?0:u;f=ho(s,o,e,h)}else f=o[o.length-1];if(f){const h=f.sn-r.startSN,m=this.fragmentTracker.getState(f);if((m===Ie.OK||m===Ie.PARTIAL&&f.gap)&&(s=f),s&&f.sn===s.sn&&(!d||c[0].fragment.sn>f.sn)&&s&&f.level===s.level){const x=o[h+1];f.sn<a&&this.fragmentTracker.getState(x)!==Ie.OK?f=x:f=null}}return f}synchronizeToLiveEdge(e){const{config:t,media:r}=this;if(!r)return;const i=this.hls.liveSyncPosition,s=r.currentTime,o=e.fragments[0].start,a=e.edge,l=s>=o-t.maxFragLookUpTolerance&&s<=a;if(i!==null&&r.duration>i&&(s<i||!l)){const u=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;(!l&&r.readyState<4||s<a-u)&&(this.loadedmetadata||(this.nextLoadPosition=i),r.readyState&&(this.warn(`Playback: ${s.toFixed(3)} is located too far from the end of live sliding playlist: ${a}, reset currentTime to : ${i.toFixed(3)}`),r.currentTime=i))}}alignPlaylists(e,t,r){const i=e.fragments.length;if(!i)return this.warn("No fragments in live playlist"),0;const s=e.fragments[0].start,o=!t,a=e.alignedSliding&&G(s);if(o||!a&&!s){const{fragPrevious:l}=this;hS(l,r,e);const u=e.fragments[0].start;return this.log(`Live playlist sliding: ${u.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} prev-sn: ${l?l.sn:"na"} fragments: ${i}`),u}return s}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let r=this.startPosition;if(r<t&&(r=-1),r===-1||this.lastCurrentTime===-1){const i=this.startTimeOffset!==null,s=i?this.startTimeOffset:e.startTimeOffset;s!==null&&G(s)?(r=t+s,s<0&&(r+=e.totalduration),r=Math.min(Math.max(t,r),t+e.totalduration),this.log(`Start time offset ${s} found in ${i?"multivariant":"media"} playlist, adjust startPosition to ${r}`),this.startPosition=r):e.live?r=this.hls.liveSyncPosition||t:this.startPosition=r=0,this.lastCurrentTime=r}this.nextLoadPosition=r}getLoadPosition(){const{media:e}=this;let t=0;return this.loadedmetadata&&e?t=e.currentTime:this.nextLoadPosition&&(t=this.nextLoadPosition),t}handleFragLoadAborted(e,t){this.transmuxer&&e.sn!=="initSegment"&&e.stats.aborted&&(this.warn(`Fragment ${e.sn}${t?" part "+t.index:""} of level ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==O.FRAG_LOADING_WAITING_RETRY)&&(this.state=O.IDLE)}onFragmentOrKeyLoadError(e,t){if(t.chunkMeta&&!t.frag){const c=this.getCurrentContext(t.chunkMeta);c&&(t.frag=c.frag)}const r=t.frag;if(!r||r.type!==e||!this.levels)return;if(this.fragContextChanged(r)){var i;this.warn(`Frag load error must match current frag to retry ${r.url} > ${(i=this.fragCurrent)==null?void 0:i.url}`);return}const s=t.details===b.FRAG_GAP;s&&this.fragmentTracker.fragBuffered(r,!0);const o=t.errorAction,{action:a,retryCount:l=0,retryConfig:u}=o||{};if(o&&a===Pe.RetryRequest&&u){this.resetStartWhenNotLoaded(this.levelLastLoaded);const c=qu(u,l);this.warn(`Fragment ${r.sn} of ${e} ${r.level} errored with ${t.details}, retrying loading ${l+1}/${u.maxNumRetry} in ${c}ms`),o.resolved=!0,this.retryDate=self.performance.now()+c,this.state=O.FRAG_LOADING_WAITING_RETRY}else if(u&&o)if(this.resetFragmentErrors(e),l<u.maxNumRetry)!s&&a!==Pe.RemoveAlternatePermanently&&(o.resolved=!0);else{w.warn(`${t.details} reached or exceeded max retry (${l})`);return}else(o==null?void 0:o.action)===Pe.SendAlternateToPenaltyBox?this.state=O.WAITING_LEVEL:this.state=O.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(e){if(this.state===O.PARSING||this.state===O.PARSED){const t=e.frag,r=e.parent,i=this.getFwdBufferInfo(this.mediaBuffer,r),s=i&&i.len>.5;s&&this.reduceMaxBufferLength(i.len,(t==null?void 0:t.duration)||10);const o=!s;return o&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${r} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),o}return!1}resetFragmentErrors(e){e===W.AUDIO&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==O.STOPPED&&(this.state=O.IDLE)}afterBufferFlushed(e,t,r){if(!e)return;const i=ue.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,i,r),this.state===O.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=O.IDLE}resetStartWhenNotLoaded(e){if(!this.loadedmetadata){this.startFragRequested=!1;const t=e?e.details:null;t!=null&&t.live?(this.startPosition=-1,this.setStartPosition(t,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.warn(`The loading context changed while buffering fragment ${e.sn} of level ${e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,r,i){var s;const o=r.details;if(!o){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((l,u)=>{const c=e.elementaryStreams[u];if(c){const d=c.endPTS-c.startPTS;if(d<=0)return this.warn(`Could not parse fragment ${e.sn} ${u} duration reliably (${d})`),l||!1;const f=i?0:E0(o,e,c.startPTS,c.endPTS,c.startDTS,c.endDTS);return this.hls.trigger(E.LEVEL_PTS_UPDATED,{details:o,level:r,drift:f,type:u,frag:e,start:c.startPTS,end:c.endPTS}),!0}return l},!1)&&((s=this.transmuxer)==null?void 0:s.error)===null){const l=new Error(`Found no media in fragment ${e.sn} of level ${e.level} resetting transmuxer to fallback to playlist timing`);if(r.fragmentError===0&&(r.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)),this.warn(l.message),this.hls.trigger(E.ERROR,{type:X.MEDIA_ERROR,details:b.FRAG_PARSING_ERROR,fatal:!1,error:l,frag:e,reason:`Found no media in msn ${e.sn} of level "${r.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state=O.PARSED,this.hls.trigger(E.FRAG_PARSED,{frag:e,part:t})}resetTransmuxer(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.resetTransmuxer(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}class C0{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let r;if(e.length)e.length===1?r=e[0]:r=TS(e,t);else return new Uint8Array(0);return this.reset(),r}reset(){this.chunks.length=0,this.dataLength=0}}function TS(n,e){const t=new Uint8Array(e);let r=0;for(let i=0;i<n.length;i++){const s=n[i];t.set(s,r),r+=s.length}return t}function LS(){return typeof __HLS_WORKER_BUNDLE__=="function"}function RS(){const n=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),e=self.URL.createObjectURL(n);return{worker:new self.Worker(e),objectURL:e}}function AS(n){const e=new self.URL(n,self.location.href).href;return{worker:new self.Worker(e),scriptURL:e}}function It(n="",e=9e4){return{type:n,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class ec{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,r,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,r){}demux(e,t){this.cachedData&&(e=ht(this.cachedData,e),this.cachedData=null);let r=Li(e,0),i=r?r.length:0,s;const o=this._audioTrack,a=this._id3Track,l=r?Yu(r):void 0,u=e.length;for((this.basePTS===null||this.frameIndex===0&&G(l))&&(this.basePTS=wS(l,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),r&&r.length>0&&a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:Et.audioId3,duration:Number.POSITIVE_INFINITY});i<u;){if(this.canParse(e,i)){const c=this.appendFrame(o,e,i);c?(this.frameIndex++,this.lastPTS=c.sample.pts,i+=c.length,s=i):i=u}else Wv(e,i)?(r=Li(e,i),a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:Et.audioId3,duration:Number.POSITIVE_INFINITY}),i+=r.length,s=i):i++;if(i===u&&s!==u){const c=Un(e,s);this.cachedData?this.cachedData=ht(this.cachedData,c):this.cachedData=c}}return{audioTrack:o,videoTrack:It(),id3Track:a,textTrack:It()}}demuxSampleAes(e,t,r){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:It(),id3Track:this._id3Track,textTrack:It()}}destroy(){}}const wS=(n,e,t)=>{if(G(n))return n*90;const r=t?t.baseTime*9e4/t.timescale:0;return e*9e4+r};function CS(n,e,t,r){let i,s,o,a;const l=navigator.userAgent.toLowerCase(),u=r,c=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];i=((e[t+2]&192)>>>6)+1;const d=(e[t+2]&60)>>>2;if(d>c.length-1){const f=new Error(`invalid ADTS sampling index:${d}`);n.emit(E.ERROR,E.ERROR,{type:X.MEDIA_ERROR,details:b.FRAG_PARSING_ERROR,fatal:!0,error:f,reason:f.message});return}return o=(e[t+2]&1)<<2,o|=(e[t+3]&192)>>>6,w.log(`manifest codec:${r}, ADTS type:${i}, samplingIndex:${d}`),/firefox/i.test(l)?d>=6?(i=5,a=new Array(4),s=d-3):(i=2,a=new Array(2),s=d):l.indexOf("android")!==-1?(i=2,a=new Array(2),s=d):(i=5,a=new Array(4),r&&(r.indexOf("mp4a.40.29")!==-1||r.indexOf("mp4a.40.5")!==-1)||!r&&d>=6?s=d-3:((r&&r.indexOf("mp4a.40.2")!==-1&&(d>=6&&o===1||/vivaldi/i.test(l))||!r&&o===1)&&(i=2,a=new Array(2)),s=d)),a[0]=i<<3,a[0]|=(d&14)>>1,a[1]|=(d&1)<<7,a[1]|=o<<3,i===5&&(a[1]|=(s&14)>>1,a[2]=(s&1)<<7,a[2]|=8,a[3]=0),{config:a,samplerate:c[d],channelCount:o,codec:"mp4a.40."+i,manifestCodec:u}}function I0(n,e){return n[e]===255&&(n[e+1]&246)===240}function k0(n,e){return n[e+1]&1?7:9}function tc(n,e){return(n[e+3]&3)<<11|n[e+4]<<3|(n[e+5]&224)>>>5}function IS(n,e){return e+5<n.length}function go(n,e){return e+1<n.length&&I0(n,e)}function kS(n,e){return IS(n,e)&&I0(n,e)&&tc(n,e)<=n.length-e}function bS(n,e){if(go(n,e)){const t=k0(n,e);if(e+t>=n.length)return!1;const r=tc(n,e);if(r<=t)return!1;const i=e+r;return i===n.length||go(n,i)}return!1}function b0(n,e,t,r,i){if(!n.samplerate){const s=CS(e,t,r,i);if(!s)return;n.config=s.config,n.samplerate=s.samplerate,n.channelCount=s.channelCount,n.codec=s.codec,n.manifestCodec=s.manifestCodec,w.log(`parsed codec:${n.codec}, rate:${s.samplerate}, channels:${s.channelCount}`)}}function D0(n){return 1024*9e4/n}function DS(n,e){const t=k0(n,e);if(e+t<=n.length){const r=tc(n,e)-t;if(r>0)return{headerLength:t,frameLength:r}}}function _0(n,e,t,r,i){const s=D0(n.samplerate),o=r+i*s,a=DS(e,t);let l;if(a){const{frameLength:d,headerLength:f}=a,h=f+d,m=Math.max(0,t+h-e.length);m?(l=new Uint8Array(h-f),l.set(e.subarray(t+f,e.length),0)):l=e.subarray(t+f,t+h);const p={unit:l,pts:o};return m||n.samples.push(p),{sample:p,length:h,missing:m}}const u=e.length-t;return l=new Uint8Array(u),l.set(e.subarray(t,e.length),0),{sample:{unit:l,pts:o},length:u,missing:-1}}let os=null;const _S=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],NS=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],PS=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],FS=[0,1,1,4];function N0(n,e,t,r,i){if(t+24>e.length)return;const s=P0(e,t);if(s&&t+s.frameLength<=e.length){const o=s.samplesPerFrame*9e4/s.sampleRate,a=r+i*o,l={unit:e.subarray(t,t+s.frameLength),pts:a,dts:a};return n.config=[],n.channelCount=s.channelCount,n.samplerate=s.sampleRate,n.samples.push(l),{sample:l,length:s.frameLength,missing:0}}}function P0(n,e){const t=n[e+1]>>3&3,r=n[e+1]>>1&3,i=n[e+2]>>4&15,s=n[e+2]>>2&3;if(t!==1&&i!==0&&i!==15&&s!==3){const o=n[e+2]>>1&1,a=n[e+3]>>6,l=t===3?3-r:r===3?3:4,u=_S[l*14+i-1]*1e3,d=NS[(t===3?0:t===2?1:2)*3+s],f=a===3?1:2,h=PS[t][r],m=FS[r],p=h*8*m,x=Math.floor(h*u/d+o)*m;if(os===null){const S=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);os=S?parseInt(S[1]):0}return!!os&&os<=87&&r===2&&u>=224e3&&a===0&&(n[e+3]=n[e+3]|128),{sampleRate:d,channelCount:f,frameLength:x,samplesPerFrame:p}}}function nc(n,e){return n[e]===255&&(n[e+1]&224)===224&&(n[e+1]&6)!==0}function F0(n,e){return e+1<n.length&&nc(n,e)}function OS(n,e){return nc(n,e)&&4<=n.length-e}function O0(n,e){if(e+1<n.length&&nc(n,e)){const r=P0(n,e);let i=4;r!=null&&r.frameLength&&(i=r.frameLength);const s=e+i;return s===n.length||F0(n,s)}return!1}class MS extends ec{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,r,i){super.resetInitSegment(e,t,r,i),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=Li(e,0);let r=(t==null?void 0:t.length)||0;if(O0(e,r))return!1;for(let i=e.length;r<i;r++)if(bS(e,r))return w.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return kS(e,t)}appendFrame(e,t,r){b0(e,this.observer,t,r,e.manifestCodec);const i=_0(e,t,r,this.basePTS,this.frameIndex);if(i&&i.missing===0)return i}}const US=/\/emsg[-/]ID3/i;class BS{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,r,i){const s=this.videoTrack=It("video",1),o=this.audioTrack=It("audio",1),a=this.txtTrack=It("text",1);if(this.id3Track=It("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const l=f0(e);if(l.video){const{id:u,timescale:c,codec:d}=l.video;s.id=u,s.timescale=a.timescale=c,s.codec=d}if(l.audio){const{id:u,timescale:c,codec:d}=l.audio;o.id=u,o.timescale=c,o.codec=d}a.id=u0.text,s.sampleDuration=0,s.duration=o.duration=i}resetContiguity(){this.remainderData=null}static probe(e){return nE(e)}demux(e,t){this.timeOffset=t;let r=e;const i=this.videoTrack,s=this.txtTrack;if(this.config.progressive){this.remainderData&&(r=ht(this.remainderData,e));const a=cE(r);this.remainderData=a.remainder,i.samples=a.valid||new Uint8Array}else i.samples=r;const o=this.extractID3Track(i,t);return s.samples=kd(t,i),{videoTrack:i,audioTrack:this.audioTrack,id3Track:o,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,r=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const i=this.extractID3Track(t,this.timeOffset);return r.samples=kd(e,t),{videoTrack:t,audioTrack:It(),id3Track:i,textTrack:It()}}extractID3Track(e,t){const r=this.id3Track;if(e.samples.length){const i=Q(e.samples,["emsg"]);i&&i.forEach(s=>{const o=hE(s);if(US.test(o.schemeIdUri)){const a=G(o.presentationTime)?o.presentationTime/o.timeScale:t+o.presentationTimeDelta/o.timeScale;let l=o.eventDuration===4294967295?Number.POSITIVE_INFINITY:o.eventDuration/o.timeScale;l<=.001&&(l=Number.POSITIVE_INFINITY);const u=o.payload;r.samples.push({data:u,len:u.byteLength,dts:a,pts:a,type:Et.emsg,duration:l})}})}return r}demuxSampleAes(e,t,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){}}const M0=(n,e)=>{let t=0,r=5;e+=r;const i=new Uint32Array(1),s=new Uint32Array(1),o=new Uint8Array(1);for(;r>0;){o[0]=n[e];const a=Math.min(r,8),l=8-a;s[0]=4278190080>>>24+l<<l,i[0]=(o[0]&s[0])>>l,t=t?t<<a|i[0]:i[0],e+=1,r-=a}return t};class $S extends ec{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,r,i){super.resetInitSegment(e,t,r,i),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,r){const i=U0(e,t,r,this.basePTS,this.frameIndex);if(i!==-1)return{sample:e.samples[e.samples.length-1],length:i,missing:0}}static probe(e){if(!e)return!1;const t=Li(e,0);if(!t)return!1;const r=t.length;return e[r]===11&&e[r+1]===119&&Yu(t)!==void 0&&M0(e,r)<16}}function U0(n,e,t,r,i){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const s=e[t+4]>>6;if(s>=3)return-1;const a=[48e3,44100,32e3][s],l=e[t+4]&63,c=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][l*3+s]*2;if(t+c>e.length)return-1;const d=e[t+6]>>5;let f=0;d===2?f+=2:(d&1&&d!==1&&(f+=2),d&4&&(f+=2));const h=(e[t+6]<<8|e[t+7])>>12-f&1,p=[2,1,2,3,3,4,4,5][d]+h,x=e[t+5]>>3,y=e[t+5]&7,v=new Uint8Array([s<<6|x<<1|y>>2,(y&3)<<6|d<<3|h<<2|l>>4,l<<4&224]),S=1536/a*9e4,L=r+i*S,T=e.subarray(t,t+c);return n.config=v,n.channelCount=p,n.samplerate=a,n.samples.push({unit:T,pts:L}),c}class jS{constructor(){this.VideoSample=null}createVideoSample(e,t,r,i){return{key:e,frame:!1,pts:t,dts:r,units:[],debug:i,length:0}}getLastNalUnit(e){var t;let r=this.VideoSample,i;if((!r||r.units.length===0)&&(r=e[e.length-1]),(t=r)!=null&&t.units){const s=r.units;i=s[s.length-1]}return i}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const r=t.samples,i=r.length;if(i){const s=r[i-1];e.pts=s.pts,e.dts=s.dts}else{t.dropped++;return}}t.samples.push(e)}e.debug.length&&w.log(e.pts+"/"+e.dts+":"+e.debug)}}class rf{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,r=e.byteLength-t,i=new Uint8Array(4),s=Math.min(4,t);if(s===0)throw new Error("no bytes available");i.set(e.subarray(r,r+s)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=s*8,this.bytesAvailable-=s}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const r=this.word>>>32-t;if(e>32&&w.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?r<<t|this.readBits(t):r}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}skipScalingList(e){let t=8,r=8,i;for(let s=0;s<e;s++)r!==0&&(i=this.readEG(),r=(t+i+256)%256),t=r===0?t:r}readSPS(){let e=0,t=0,r=0,i=0,s,o,a;const l=this.readUByte.bind(this),u=this.readBits.bind(this),c=this.readUEG.bind(this),d=this.readBoolean.bind(this),f=this.skipBits.bind(this),h=this.skipEG.bind(this),m=this.skipUEG.bind(this),p=this.skipScalingList.bind(this);l();const x=l();if(u(5),f(3),l(),m(),x===100||x===110||x===122||x===244||x===44||x===83||x===86||x===118||x===128){const A=c();if(A===3&&f(1),m(),m(),f(1),d())for(o=A!==3?8:12,a=0;a<o;a++)d()&&(a<6?p(16):p(64))}m();const y=c();if(y===0)c();else if(y===1)for(f(1),h(),h(),s=c(),a=0;a<s;a++)h();m(),f(1);const v=c(),S=c(),L=u(1);L===0&&f(1),f(1),d()&&(e=c(),t=c(),r=c(),i=c());let T=[1,1];if(d()&&d())switch(l()){case 1:T=[1,1];break;case 2:T=[12,11];break;case 3:T=[10,11];break;case 4:T=[16,11];break;case 5:T=[40,33];break;case 6:T=[24,11];break;case 7:T=[20,11];break;case 8:T=[32,11];break;case 9:T=[80,33];break;case 10:T=[18,11];break;case 11:T=[15,11];break;case 12:T=[64,33];break;case 13:T=[160,99];break;case 14:T=[4,3];break;case 15:T=[3,2];break;case 16:T=[2,1];break;case 255:{T=[l()<<8|l(),l()<<8|l()];break}}return{width:Math.ceil((v+1)*16-e*2-t*2),height:(2-L)*(S+1)*16-(L?2:4)*(r+i),pixelRatio:T}}readSliceType(){return this.readUByte(),this.readUEG(),this.readUEG()}}class GS extends jS{parseAVCPES(e,t,r,i,s){const o=this.parseAVCNALu(e,r.data);let a=this.VideoSample,l,u=!1;r.data=null,a&&o.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts,"")),o.forEach(c=>{var d;switch(c.type){case 1:{let p=!1;l=!0;const x=c.data;if(u&&x.length>4){const y=new rf(x).readSliceType();(y===2||y===4||y===7||y===9)&&(p=!0)}if(p){var f;(f=a)!=null&&f.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts,"")),a.frame=!0,a.key=p;break}case 5:l=!0,(d=a)!=null&&d.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts,"")),a.key=!0,a.frame=!0;break;case 6:{l=!0,m0(c.data,1,r.pts,t.samples);break}case 7:{var h,m;l=!0,u=!0;const p=c.data,y=new rf(p).readSPS();if(!e.sps||e.width!==y.width||e.height!==y.height||((h=e.pixelRatio)==null?void 0:h[0])!==y.pixelRatio[0]||((m=e.pixelRatio)==null?void 0:m[1])!==y.pixelRatio[1]){e.width=y.width,e.height=y.height,e.pixelRatio=y.pixelRatio,e.sps=[p],e.duration=s;const v=p.subarray(1,4);let S="avc1.";for(let L=0;L<3;L++){let T=v[L].toString(16);T.length<2&&(T="0"+T),S+=T}e.codec=S}break}case 8:l=!0,e.pps=[c.data];break;case 9:l=!0,e.audFound=!0,a&&this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts,"");break;case 12:l=!0;break;default:l=!1,a&&(a.debug+="unknown NAL "+c.type+" ");break}a&&l&&a.units.push(c)}),i&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}parseAVCNALu(e,t){const r=t.byteLength;let i=e.naluState||0;const s=i,o=[];let a=0,l,u,c,d=-1,f=0;for(i===-1&&(d=0,f=t[0]&31,i=0,a=1);a<r;){if(l=t[a++],!i){i=l?0:1;continue}if(i===1){i=l?0:2;continue}if(!l)i=3;else if(l===1){if(u=a-i-1,d>=0){const h={data:t.subarray(d,u),type:f};o.push(h)}else{const h=this.getLastNalUnit(e.samples);h&&(s&&a<=4-s&&h.state&&(h.data=h.data.subarray(0,h.data.byteLength-s)),u>0&&(h.data=ht(h.data,t.subarray(0,u)),h.state=0))}a<r?(c=t[a]&31,d=a,f=c,i=0):i=-1}else i=0}if(d>=0&&i>=0){const h={data:t.subarray(d,r),type:f,state:i};o.push(h)}if(o.length===0){const h=this.getLastNalUnit(e.samples);h&&(h.data=ht(h.data,t))}return e.naluState=i,o}}class VS{constructor(e,t,r){this.keyData=void 0,this.decrypter=void 0,this.keyData=r,this.decrypter=new Ju(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer)}decryptAacSample(e,t,r){const i=e[t].unit;if(i.length<=16)return;const s=i.subarray(16,i.length-i.length%16),o=s.buffer.slice(s.byteOffset,s.byteOffset+s.length);this.decryptBuffer(o).then(a=>{const l=new Uint8Array(a);i.set(l,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,r)})}decryptAacSamples(e,t,r){for(;;t++){if(t>=e.length){r();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,r),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,r=new Int8Array(t);let i=0;for(let s=32;s<e.length-16;s+=160,i+=16)r.set(e.subarray(s,s+16),i);return r}getAvcDecryptedUnit(e,t){const r=new Uint8Array(t);let i=0;for(let s=32;s<e.length-16;s+=160,i+=16)e.set(r.subarray(i,i+16),s);return e}decryptAvcSample(e,t,r,i,s){const o=g0(s.data),a=this.getAvcEncryptedData(o);this.decryptBuffer(a.buffer).then(l=>{s.data=this.getAvcDecryptedUnit(o,l),this.decrypter.isSync()||this.decryptAvcSamples(e,t,r+1,i)})}decryptAvcSamples(e,t,r,i){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,r=0){if(t>=e.length){i();return}const s=e[t].units;for(;!(r>=s.length);r++){const o=s[r];if(!(o.data.length<=48||o.type!==1&&o.type!==5)&&(this.decryptAvcSample(e,t,r,i,o),!this.decrypter.isSync()))return}}}}const we=188;class an{constructor(e,t,r){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.videoParser=new GS}static probe(e){const t=an.syncOffset(e);return t>0&&w.warn(`MPEG2-TS detected but first sync word found @ offset ${t}`),t!==-1}static syncOffset(e){const t=e.length;let r=Math.min(we*5,t-we)+1,i=0;for(;i<r;){let s=!1,o=-1,a=0;for(let l=i;l<t;l+=we)if(e[l]===71&&(t-l===we||e[l+we]===71)){if(a++,o===-1&&(o=l,o!==0&&(r=Math.min(o+we*99,e.length-we)+1)),s||(s=Ul(e,l)===0),s&&a>1&&(o===0&&a>2||l+we>r))return o}else{if(a)return-1;break}i++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:u0[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,r,i){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=an.createTrack("video"),this._audioTrack=an.createTrack("audio",i),this._id3Track=an.createTrack("id3"),this._txtTrack=an.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=r,this._duration=i}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:r}=this;e&&(e.pesData=null),t&&(t.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,r=!1,i=!1){r||(this.sampleAes=null);let s;const o=this._videoTrack,a=this._audioTrack,l=this._id3Track,u=this._txtTrack;let c=o.pid,d=o.pesData,f=a.pid,h=l.pid,m=a.pesData,p=l.pesData,x=null,y=this.pmtParsed,v=this._pmtId,S=e.length;if(this.remainderData&&(e=ht(this.remainderData,e),S=e.length,this.remainderData=null),S<we&&!i)return this.remainderData=e,{audioTrack:a,videoTrack:o,id3Track:l,textTrack:u};const L=Math.max(0,an.syncOffset(e));S-=(S-L)%we,S<e.byteLength&&!i&&(this.remainderData=new Uint8Array(e.buffer,S,e.buffer.byteLength-S));let T=0;for(let R=L;R<S;R+=we)if(e[R]===71){const k=!!(e[R+1]&64),_=Ul(e,R),C=(e[R+3]&48)>>4;let P;if(C>1){if(P=R+5+e[R+4],P===R+we)continue}else P=R+4;switch(_){case c:k&&(d&&(s=Qn(d))&&this.videoParser.parseAVCPES(o,u,s,!1,this._duration),d={data:[],size:0}),d&&(d.data.push(e.subarray(P,R+we)),d.size+=R+we-P);break;case f:if(k){if(m&&(s=Qn(m)))switch(a.segmentCodec){case"aac":this.parseAACPES(a,s);break;case"mp3":this.parseMPEGPES(a,s);break;case"ac3":this.parseAC3PES(a,s);break}m={data:[],size:0}}m&&(m.data.push(e.subarray(P,R+we)),m.size+=R+we-P);break;case h:k&&(p&&(s=Qn(p))&&this.parseID3PES(l,s),p={data:[],size:0}),p&&(p.data.push(e.subarray(P,R+we)),p.size+=R+we-P);break;case 0:k&&(P+=e[P]+1),v=this._pmtId=KS(e,P);break;case v:{k&&(P+=e[P]+1);const H=HS(e,P,this.typeSupported,r,this.observer);c=H.videoPid,c>0&&(o.pid=c,o.segmentCodec=H.segmentVideoCodec),f=H.audioPid,f>0&&(a.pid=f,a.segmentCodec=H.segmentAudioCodec),h=H.id3Pid,h>0&&(l.pid=h),x!==null&&!y&&(w.warn(`MPEG-TS PMT found at ${R} after unknown PID '${x}'. Backtracking to sync byte @${L} to parse all TS packets.`),x=null,R=L-188),y=this.pmtParsed=!0;break}case 17:case 8191:break;default:x=_;break}}else T++;T>0&&po(this.observer,new Error(`Found ${T} TS packet/s that do not start with 0x47`)),o.pesData=d,a.pesData=m,l.pesData=p;const A={audioTrack:a,videoTrack:o,id3Track:l,textTrack:u};return i&&this.extractRemainingSamples(A),A}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:r,id3Track:i,textTrack:s}=e,o=r.pesData,a=t.pesData,l=i.pesData;let u;if(o&&(u=Qn(o))?(this.videoParser.parseAVCPES(r,s,u,!0,this._duration),r.pesData=null):r.pesData=o,a&&(u=Qn(a))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,u);break;case"mp3":this.parseMPEGPES(t,u);break;case"ac3":this.parseAC3PES(t,u);break}t.pesData=null}else a!=null&&a.size&&w.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=a;l&&(u=Qn(l))?(this.parseID3PES(i,u),i.pesData=null):i.pesData=l}demuxSampleAes(e,t,r){const i=this.demux(e,r,!0,!this.config.progressive),s=this.sampleAes=new VS(this.observer,this.config,t);return this.decrypt(i,s)}decrypt(e,t){return new Promise(r=>{const{audioTrack:i,videoTrack:s}=e;i.samples&&i.segmentCodec==="aac"?t.decryptAacSamples(i.samples,0,()=>{s.samples?t.decryptAvcSamples(s.samples,0,0,()=>{r(e)}):r(e)}):s.samples&&t.decryptAvcSamples(s.samples,0,0,()=>{r(e)})})}destroy(){this._duration=0}parseAACPES(e,t){let r=0;const i=this.aacOverFlow;let s=t.data;if(i){this.aacOverFlow=null;const d=i.missing,f=i.sample.unit.byteLength;if(d===-1)s=ht(i.sample.unit,s);else{const h=f-d;i.sample.unit.set(s.subarray(0,d),h),e.samples.push(i.sample),r=i.missing}}let o,a;for(o=r,a=s.length;o<a-1&&!go(s,o);o++);if(o!==r){let d;const f=o<a-1;if(f?d=`AAC PES did not start with ADTS header,offset:${o}`:d="No ADTS header found in AAC PES",po(this.observer,new Error(d),f),!f)return}b0(e,this.observer,s,o,this.audioCodec);let l;if(t.pts!==void 0)l=t.pts;else if(i){const d=D0(e.samplerate);l=i.sample.pts+d}else{w.warn("[tsdemuxer]: AAC PES unknown PTS");return}let u=0,c;for(;o<a;)if(c=_0(e,s,o,l,u),o+=c.length,c.missing){this.aacOverFlow=c;break}else for(u++;o<a-1&&!go(s,o);o++);}parseMPEGPES(e,t){const r=t.data,i=r.length;let s=0,o=0;const a=t.pts;if(a===void 0){w.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;o<i;)if(F0(r,o)){const l=N0(e,r,o,a,s);if(l)o+=l.length,s++;else break}else o++}parseAC3PES(e,t){{const r=t.data,i=t.pts;if(i===void 0){w.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const s=r.length;let o=0,a=0,l;for(;a<s&&(l=U0(e,r,a,i,o++))>0;)a+=l}}parseID3PES(e,t){if(t.pts===void 0){w.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const r=Te({},t,{type:this._videoTrack?Et.emsg:Et.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(r)}}function Ul(n,e){return((n[e+1]&31)<<8)+n[e+2]}function KS(n,e){return(n[e+10]&31)<<8|n[e+11]}function HS(n,e,t,r,i){const s={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},o=(n[e+1]&15)<<8|n[e+2],a=e+3+o-4,l=(n[e+10]&15)<<8|n[e+11];for(e+=12+l;e<a;){const u=Ul(n,e),c=(n[e+3]&15)<<8|n[e+4];switch(n[e]){case 207:if(!r){Ra("ADTS AAC");break}case 15:s.audioPid===-1&&(s.audioPid=u);break;case 21:s.id3Pid===-1&&(s.id3Pid=u);break;case 219:if(!r){Ra("H.264");break}case 27:s.videoPid===-1&&(s.videoPid=u,s.segmentVideoCodec="avc");break;case 3:case 4:!t.mpeg&&!t.mp3?w.log("MPEG audio found, not supported in this browser"):s.audioPid===-1&&(s.audioPid=u,s.segmentAudioCodec="mp3");break;case 193:if(!r){Ra("AC-3");break}case 129:t.ac3?s.audioPid===-1&&(s.audioPid=u,s.segmentAudioCodec="ac3"):w.log("AC-3 audio found, not supported in this browser");break;case 6:if(s.audioPid===-1&&c>0){let d=e+5,f=c;for(;f>2;){switch(n[d]){case 106:t.ac3!==!0?w.log("AC-3 audio found, not supported in this browser for now"):(s.audioPid=u,s.segmentAudioCodec="ac3");break}const m=n[d+1]+2;d+=m,f-=m}}break;case 194:case 135:return po(i,new Error("Unsupported EC-3 in M2TS found")),s;case 36:return po(i,new Error("Unsupported HEVC in M2TS found")),s}e+=c+5}return s}function po(n,e,t){w.warn(`parsing error: ${e.message}`),n.emit(E.ERROR,E.ERROR,{type:X.MEDIA_ERROR,details:b.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function Ra(n){w.log(`${n} with AES-128-CBC encryption found in unencrypted stream`)}function Qn(n){let e=0,t,r,i,s,o;const a=n.data;if(!n||n.size===0)return null;for(;a[0].length<19&&a.length>1;)a[0]=ht(a[0],a[1]),a.splice(1,1);if(t=a[0],(t[0]<<16)+(t[1]<<8)+t[2]===1){if(r=(t[4]<<8)+t[5],r&&r>n.size-6)return null;const u=t[7];u&192&&(s=(t[9]&14)*536870912+(t[10]&255)*4194304+(t[11]&254)*16384+(t[12]&255)*128+(t[13]&254)/2,u&64?(o=(t[14]&14)*536870912+(t[15]&255)*4194304+(t[16]&254)*16384+(t[17]&255)*128+(t[18]&254)/2,s-o>60*9e4&&(w.warn(`${Math.round((s-o)/9e4)}s delta between PTS and DTS, align them`),s=o)):o=s),i=t[8];let c=i+9;if(n.size<=c)return null;n.size-=c;const d=new Uint8Array(n.size);for(let f=0,h=a.length;f<h;f++){t=a[f];let m=t.byteLength;if(c)if(c>m){c-=m;continue}else t=t.subarray(c),m-=c,c=0;d.set(t,e),e+=m}return r&&(r-=i+3),{data:d,pts:s,dts:o,len:r}}return null}class zS extends ec{resetInitSegment(e,t,r,i){super.resetInitSegment(e,t,r,i),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=Li(e,0);let r=(t==null?void 0:t.length)||0;if(t&&e[r]===11&&e[r+1]===119&&Yu(t)!==void 0&&M0(e,r)<=16)return!1;for(let i=e.length;r<i;r++)if(O0(e,r))return w.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return OS(e,t)}appendFrame(e,t,r){if(this.basePTS!==null)return N0(e,t,r,this.basePTS,this.frameIndex)}}class sf{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const rn=Math.pow(2,32)-1;class I{static init(){I.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in I.types)I.types.hasOwnProperty(e)&&(I.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);I.HDLR_TYPES={video:t,audio:r};const i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s=new Uint8Array([0,0,0,0,0,0,0,0]);I.STTS=I.STSC=I.STCO=s,I.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),I.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),I.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),I.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const o=new Uint8Array([105,115,111,109]),a=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);I.FTYP=I.box(I.types.ftyp,o,l,o,a),I.DINF=I.box(I.types.dinf,I.box(I.types.dref,i))}static box(e,...t){let r=8,i=t.length;const s=i;for(;i--;)r+=t[i].byteLength;const o=new Uint8Array(r);for(o[0]=r>>24&255,o[1]=r>>16&255,o[2]=r>>8&255,o[3]=r&255,o.set(e,4),i=0,r=8;i<s;i++)o.set(t[i],r),r+=t[i].byteLength;return o}static hdlr(e){return I.box(I.types.hdlr,I.HDLR_TYPES[e])}static mdat(e){return I.box(I.types.mdat,e)}static mdhd(e,t){t*=e;const r=Math.floor(t/(rn+1)),i=Math.floor(t%(rn+1));return I.box(I.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,r>>24,r>>16&255,r>>8&255,r&255,i>>24,i>>16&255,i>>8&255,i&255,85,196,0,0]))}static mdia(e){return I.box(I.types.mdia,I.mdhd(e.timescale,e.duration),I.hdlr(e.type),I.minf(e))}static mfhd(e){return I.box(I.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?I.box(I.types.minf,I.box(I.types.smhd,I.SMHD),I.DINF,I.stbl(e)):I.box(I.types.minf,I.box(I.types.vmhd,I.VMHD),I.DINF,I.stbl(e))}static moof(e,t,r){return I.box(I.types.moof,I.mfhd(e),I.traf(r,t))}static moov(e){let t=e.length;const r=[];for(;t--;)r[t]=I.trak(e[t]);return I.box.apply(null,[I.types.moov,I.mvhd(e[0].timescale,e[0].duration)].concat(r).concat(I.mvex(e)))}static mvex(e){let t=e.length;const r=[];for(;t--;)r[t]=I.trex(e[t]);return I.box.apply(null,[I.types.mvex,...r])}static mvhd(e,t){t*=e;const r=Math.floor(t/(rn+1)),i=Math.floor(t%(rn+1)),s=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,r>>24,r>>16&255,r>>8&255,r&255,i>>24,i>>16&255,i>>8&255,i&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return I.box(I.types.mvhd,s)}static sdtp(e){const t=e.samples||[],r=new Uint8Array(4+t.length);let i,s;for(i=0;i<t.length;i++)s=t[i].flags,r[i+4]=s.dependsOn<<4|s.isDependedOn<<2|s.hasRedundancy;return I.box(I.types.sdtp,r)}static stbl(e){return I.box(I.types.stbl,I.stsd(e),I.box(I.types.stts,I.STTS),I.box(I.types.stsc,I.STSC),I.box(I.types.stsz,I.STSZ),I.box(I.types.stco,I.STCO))}static avc1(e){let t=[],r=[],i,s,o;for(i=0;i<e.sps.length;i++)s=e.sps[i],o=s.byteLength,t.push(o>>>8&255),t.push(o&255),t=t.concat(Array.prototype.slice.call(s));for(i=0;i<e.pps.length;i++)s=e.pps[i],o=s.byteLength,r.push(o>>>8&255),r.push(o&255),r=r.concat(Array.prototype.slice.call(s));const a=I.box(I.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(r))),l=e.width,u=e.height,c=e.pixelRatio[0],d=e.pixelRatio[1];return I.box(I.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,l&255,u>>8&255,u&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a,I.box(I.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),I.box(I.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,c&255,d>>24,d>>16&255,d>>8&255,d&255])))}static esds(e){const t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))}static audioStsd(e){const t=e.samplerate;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return I.box(I.types.mp4a,I.audioStsd(e),I.box(I.types.esds,I.esds(e)))}static mp3(e){return I.box(I.types[".mp3"],I.audioStsd(e))}static ac3(e){return I.box(I.types["ac-3"],I.audioStsd(e),I.box(I.types.dac3,e.config))}static stsd(e){return e.type==="audio"?e.segmentCodec==="mp3"&&e.codec==="mp3"?I.box(I.types.stsd,I.STSD,I.mp3(e)):e.segmentCodec==="ac3"?I.box(I.types.stsd,I.STSD,I.ac3(e)):I.box(I.types.stsd,I.STSD,I.mp4a(e)):I.box(I.types.stsd,I.STSD,I.avc1(e))}static tkhd(e){const t=e.id,r=e.duration*e.timescale,i=e.width,s=e.height,o=Math.floor(r/(rn+1)),a=Math.floor(r%(rn+1));return I.box(I.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,o>>24,o>>16&255,o>>8&255,o&255,a>>24,a>>16&255,a>>8&255,a&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,i&255,0,0,s>>8&255,s&255,0,0]))}static traf(e,t){const r=I.sdtp(e),i=e.id,s=Math.floor(t/(rn+1)),o=Math.floor(t%(rn+1));return I.box(I.types.traf,I.box(I.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255])),I.box(I.types.tfdt,new Uint8Array([1,0,0,0,s>>24,s>>16&255,s>>8&255,s&255,o>>24,o>>16&255,o>>8&255,o&255])),I.trun(e,r.length+16+20+8+16+8+8),r)}static trak(e){return e.duration=e.duration||4294967295,I.box(I.types.trak,I.tkhd(e),I.mdia(e))}static trex(e){const t=e.id;return I.box(I.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const r=e.samples||[],i=r.length,s=12+16*i,o=new Uint8Array(s);let a,l,u,c,d,f;for(t+=8+s,o.set([e.type==="video"?1:0,0,15,1,i>>>24&255,i>>>16&255,i>>>8&255,i&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),a=0;a<i;a++)l=r[a],u=l.duration,c=l.size,d=l.flags,f=l.cts,o.set([u>>>24&255,u>>>16&255,u>>>8&255,u&255,c>>>24&255,c>>>16&255,c>>>8&255,c&255,d.isLeading<<2|d.dependsOn,d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|d.isNonSync,d.degradPrio&61440,d.degradPrio&15,f>>>24&255,f>>>16&255,f>>>8&255,f&255],12+16*a);return I.box(I.types.trun,o)}static initSegment(e){I.types||I.init();const t=I.moov(e);return ht(I.FTYP,t)}}I.types=void 0;I.HDLR_TYPES=void 0;I.STTS=void 0;I.STSC=void 0;I.STCO=void 0;I.STSZ=void 0;I.VMHD=void 0;I.SMHD=void 0;I.STSD=void 0;I.FTYP=void 0;I.DINF=void 0;const B0=9e4;function rc(n,e,t=1,r=!1){const i=n*e*t;return r?Math.round(i):i}function WS(n,e,t=1,r=!1){return rc(n,e,1/t,r)}function Kr(n,e=!1){return rc(n,1e3,1/B0,e)}function YS(n,e=1){return rc(n,B0,1/e)}const qS=10*1e3,of=1024,XS=1152,QS=1536;let Jn=null,Aa=null;class ks{constructor(e,t,r,i=""){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.ISGenerated=!1,Jn===null){const o=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Jn=o?parseInt(o[1]):0}if(Aa===null){const s=navigator.userAgent.match(/Safari\/(\d+)/i);Aa=s?parseInt(s[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){w.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){w.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){w.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const r=e[0].pts,i=e.reduce((s,o)=>{let a=o.pts,l=a-s;return l<-4294967296&&(t=!0,a=ot(a,r),l=a-s),l>0?s:a},r);return t&&w.debug("PTS rollover detected"),i}remux(e,t,r,i,s,o,a,l){let u,c,d,f,h,m,p=s,x=s;const y=e.pid>-1,v=t.pid>-1,S=t.samples.length,L=e.samples.length>0,T=a&&S>0||S>1;if((!y||L)&&(!v||T)||this.ISGenerated||a){if(this.ISGenerated){var R,k,_,C;const q=this.videoTrackConfig;q&&(t.width!==q.width||t.height!==q.height||((R=t.pixelRatio)==null?void 0:R[0])!==((k=q.pixelRatio)==null?void 0:k[0])||((_=t.pixelRatio)==null?void 0:_[1])!==((C=q.pixelRatio)==null?void 0:C[1]))&&this.resetInitSegment()}else d=this.generateIS(e,t,s,o);const P=this.isVideoContiguous;let H=-1,B;if(T&&(H=JS(t.samples),!P&&this.config.forceKeyFrameOnDiscontinuity))if(m=!0,H>0){w.warn(`[mp4-remuxer]: Dropped ${H} out of ${S} video samples due to a missing keyframe`);const q=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(H),t.dropped+=H,x+=(t.samples[0].pts-q)/t.inputTimeScale,B=x}else H===-1&&(w.warn(`[mp4-remuxer]: No keyframe found out of ${S} video samples`),m=!1);if(this.ISGenerated){if(L&&T){const q=this.getVideoStartPts(t.samples),K=(ot(e.samples[0].pts,q)-q)/t.inputTimeScale;p+=Math.max(0,K),x+=Math.max(0,-K)}if(L){if(e.samplerate||(w.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),d=this.generateIS(e,t,s,o)),c=this.remuxAudio(e,p,this.isAudioContiguous,o,v||T||l===W.AUDIO?x:void 0),T){const q=c?c.endPTS-c.startPTS:0;t.inputTimeScale||(w.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),d=this.generateIS(e,t,s,o)),u=this.remuxVideo(t,x,P,q)}}else T&&(u=this.remuxVideo(t,x,P,0));u&&(u.firstKeyFrame=H,u.independent=H!==-1,u.firstKeyFramePTS=B)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(r.samples.length&&(h=$0(r,s,this._initPTS,this._initDTS)),i.samples.length&&(f=j0(i,s,this._initPTS))),{audio:c,video:u,initSegment:d,independent:m,text:f,id3:h}}generateIS(e,t,r,i){const s=e.samples,o=t.samples,a=this.typeSupported,l={},u=this._initPTS;let c=!u||i,d="audio/mp4",f,h,m;if(c&&(f=h=1/0),e.config&&s.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":a.mpeg?(d="audio/mpeg",e.codec=""):a.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}l.audio={id:"audio",container:d,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&a.mpeg?new Uint8Array(0):I.initSegment([e]),metadata:{channelCount:e.channelCount}},c&&(m=e.inputTimeScale,!u||m!==u.timescale?f=h=s[0].pts-Math.round(m*r):c=!1)}if(t.sps&&t.pps&&o.length){if(t.timescale=t.inputTimeScale,l.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:I.initSegment([t]),metadata:{width:t.width,height:t.height}},c)if(m=t.inputTimeScale,!u||m!==u.timescale){const p=this.getVideoStartPts(o),x=Math.round(m*r);h=Math.min(h,ot(o[0].dts,p)-x),f=Math.min(f,p-x)}else c=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(l).length)return this.ISGenerated=!0,c?(this._initPTS={baseTime:f,timescale:m},this._initDTS={baseTime:h,timescale:m}):f=m=void 0,{tracks:l,initPTS:f,timescale:m}}remuxVideo(e,t,r,i){const s=e.inputTimeScale,o=e.samples,a=[],l=o.length,u=this._initPTS;let c=this.nextAvcDts,d=8,f=this.videoSampleDuration,h,m,p=Number.POSITIVE_INFINITY,x=Number.NEGATIVE_INFINITY,y=!1;if(!r||c===null){const F=t*s,N=o[0].pts-ot(o[0].dts,o[0].pts);Jn&&c!==null&&Math.abs(F-N-c)<15e3?r=!0:c=F-N}const v=u.baseTime*s/u.timescale;for(let F=0;F<l;F++){const N=o[F];N.pts=ot(N.pts-v,c),N.dts=ot(N.dts-v,c),N.dts<o[F>0?F-1:F].dts&&(y=!0)}y&&o.sort(function(F,N){const $=F.dts-N.dts,V=F.pts-N.pts;return $||V}),h=o[0].dts,m=o[o.length-1].dts;const S=m-h,L=S?Math.round(S/(l-1)):f||e.inputTimeScale/30;if(r){const F=h-c,N=F>L,$=F<-1;if((N||$)&&(N?w.warn(`AVC: ${Kr(F,!0)} ms (${F}dts) hole between fragments detected at ${t.toFixed(3)}`):w.warn(`AVC: ${Kr(-F,!0)} ms (${F}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!$||c>=o[0].pts||Jn)){h=c;const V=o[0].pts-F;if(N)o[0].dts=h,o[0].pts=V;else for(let ee=0;ee<o.length&&!(o[ee].dts>V);ee++)o[ee].dts-=F,o[ee].pts-=F;w.log(`Video: Initial PTS/DTS adjusted: ${Kr(V,!0)}/${Kr(h,!0)}, delta: ${Kr(F,!0)} ms`)}}h=Math.max(0,h);let T=0,A=0,R=h;for(let F=0;F<l;F++){const N=o[F],$=N.units,V=$.length;let ee=0;for(let re=0;re<V;re++)ee+=$[re].data.length;A+=ee,T+=V,N.length=ee,N.dts<R?(N.dts=R,R+=L/4|0||1):R=N.dts,p=Math.min(N.pts,p),x=Math.max(N.pts,x)}m=o[l-1].dts;const k=A+4*T+8;let _;try{_=new Uint8Array(k)}catch(F){this.observer.emit(E.ERROR,E.ERROR,{type:X.MUX_ERROR,details:b.REMUX_ALLOC_ERROR,fatal:!1,error:F,bytes:k,reason:`fail allocating video mdat ${k}`});return}const C=new DataView(_.buffer);C.setUint32(0,k),_.set(I.types.mdat,4);let P=!1,H=Number.POSITIVE_INFINITY,B=Number.POSITIVE_INFINITY,q=Number.NEGATIVE_INFINITY,Y=Number.NEGATIVE_INFINITY;for(let F=0;F<l;F++){const N=o[F],$=N.units;let V=0;for(let ae=0,le=$.length;ae<le;ae++){const _e=$[ae],Pr=_e.data,Mo=_e.data.byteLength;C.setUint32(d,Mo),d+=4,_.set(Pr,d),d+=Mo,V+=4+Mo}let ee;if(F<l-1)f=o[F+1].dts-N.dts,ee=o[F+1].pts-N.pts;else{const ae=this.config,le=F>0?N.dts-o[F-1].dts:L;if(ee=F>0?N.pts-o[F-1].pts:L,ae.stretchShortVideoTrack&&this.nextAudioPts!==null){const _e=Math.floor(ae.maxBufferHole*s),Pr=(i?p+i*s:this.nextAudioPts)-N.pts;Pr>_e?(f=Pr-le,f<0?f=le:P=!0,w.log(`[mp4-remuxer]: It is approximately ${Pr/90} ms to the next segment; using duration ${f/90} ms for the last video frame.`)):f=le}else f=le}const re=Math.round(N.pts-N.dts);H=Math.min(H,f),q=Math.max(q,f),B=Math.min(B,ee),Y=Math.max(Y,ee),a.push(new af(N.key,f,V,re))}if(a.length){if(Jn){if(Jn<70){const F=a[0].flags;F.dependsOn=2,F.isNonSync=0}}else if(Aa&&Y-B<q-H&&L/q<.025&&a[0].cts===0){w.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let F=h;for(let N=0,$=a.length;N<$;N++){const V=F+a[N].duration,ee=F+a[N].cts;if(N<$-1){const re=V+a[N+1].cts;a[N].duration=re-ee}else a[N].duration=N?a[N-1].duration:L;a[N].cts=0,F=V}}}f=P||!f?L:f,this.nextAvcDts=c=m+f,this.videoSampleDuration=f,this.isVideoContiguous=!0;const K=I.moof(e.sequenceNumber++,h,Te({},e,{samples:a})),J="video",M={data1:K,data2:_,startPTS:p/s,endPTS:(x+f)/s,startDTS:h/s,endDTS:c/s,type:J,hasAudio:!1,hasVideo:!0,nb:a.length,dropped:e.dropped};return e.samples=[],e.dropped=0,M}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return XS;case"ac3":return QS;default:return of}}remuxAudio(e,t,r,i,s){const o=e.inputTimeScale,a=e.samplerate?e.samplerate:o,l=o/a,u=this.getSamplesPerFrame(e),c=u*l,d=this._initPTS,f=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,h=[],m=s!==void 0;let p=e.samples,x=f?0:8,y=this.nextAudioPts||-1;const v=t*o,S=d.baseTime*o/d.timescale;if(this.isAudioContiguous=r=r||p.length&&y>0&&(i&&Math.abs(v-y)<9e3||Math.abs(ot(p[0].pts-S,v)-y)<20*c),p.forEach(function(K){K.pts=ot(K.pts-S,v)}),!r||y<0){if(p=p.filter(K=>K.pts>=0),!p.length)return;s===0?y=0:i&&!m?y=Math.max(0,v):y=p[0].pts}if(e.segmentCodec==="aac"){const K=this.config.maxAudioFramesDrift;for(let J=0,M=y;J<p.length;J++){const F=p[J],N=F.pts,$=N-M,V=Math.abs(1e3*$/o);if($<=-K*c&&m)J===0&&(w.warn(`Audio frame @ ${(N/o).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*$/o)} ms.`),this.nextAudioPts=y=M=N);else if($>=K*c&&V<qS&&m){let ee=Math.round($/c);M=N-ee*c,M<0&&(ee--,M+=c),J===0&&(this.nextAudioPts=y=M),w.warn(`[mp4-remuxer]: Injecting ${ee} audio frame @ ${(M/o).toFixed(3)}s due to ${Math.round(1e3*$/o)} ms gap.`);for(let re=0;re<ee;re++){const ae=Math.max(M,0);let le=sf.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);le||(w.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),le=F.unit.subarray()),p.splice(J,0,{unit:le,pts:ae}),M+=c,J++}}F.pts=M,M+=c}}let L=null,T=null,A,R=0,k=p.length;for(;k--;)R+=p[k].unit.byteLength;for(let K=0,J=p.length;K<J;K++){const M=p[K],F=M.unit;let N=M.pts;if(T!==null){const V=h[K-1];V.duration=Math.round((N-T)/l)}else if(r&&e.segmentCodec==="aac"&&(N=y),L=N,R>0){R+=x;try{A=new Uint8Array(R)}catch(V){this.observer.emit(E.ERROR,E.ERROR,{type:X.MUX_ERROR,details:b.REMUX_ALLOC_ERROR,fatal:!1,error:V,bytes:R,reason:`fail allocating audio mdat ${R}`});return}f||(new DataView(A.buffer).setUint32(0,R),A.set(I.types.mdat,4))}else return;A.set(F,x);const $=F.byteLength;x+=$,h.push(new af(!0,u,$,0)),T=N}const _=h.length;if(!_)return;const C=h[h.length-1];this.nextAudioPts=y=T+l*C.duration;const P=f?new Uint8Array(0):I.moof(e.sequenceNumber++,L/l,Te({},e,{samples:h}));e.samples=[];const H=L/o,B=y/o,Y={data1:P,data2:A,startPTS:H,endPTS:B,startDTS:H,endDTS:B,type:"audio",hasAudio:!0,hasVideo:!1,nb:_};return this.isAudioContiguous=!0,Y}remuxEmptyAudio(e,t,r,i){const s=e.inputTimeScale,o=e.samplerate?e.samplerate:s,a=s/o,l=this.nextAudioPts,u=this._initDTS,c=u.baseTime*9e4/u.timescale,d=(l!==null?l:i.startDTS*s)+c,f=i.endDTS*s+c,h=a*of,m=Math.ceil((f-d)/h),p=sf.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(w.warn("[mp4-remuxer]: remux empty Audio"),!p){w.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}const x=[];for(let y=0;y<m;y++){const v=d+y*h;x.push({unit:p,pts:v,dts:v})}return e.samples=x,this.remuxAudio(e,t,r,!1)}}function ot(n,e){let t;if(e===null)return n;for(e<n?t=-8589934592:t=8589934592;Math.abs(n-e)>4294967296;)n+=t;return n}function JS(n){for(let e=0;e<n.length;e++)if(n[e].key)return e;return-1}function $0(n,e,t,r){const i=n.samples.length;if(!i)return;const s=n.inputTimeScale;for(let a=0;a<i;a++){const l=n.samples[a];l.pts=ot(l.pts-t.baseTime*s/t.timescale,e*s)/s,l.dts=ot(l.dts-r.baseTime*s/r.timescale,e*s)/s}const o=n.samples;return n.samples=[],{samples:o}}function j0(n,e,t){const r=n.samples.length;if(!r)return;const i=n.inputTimeScale;for(let o=0;o<r;o++){const a=n.samples[o];a.pts=ot(a.pts-t.baseTime*i/t.timescale,e*i)/i}n.samples.sort((o,a)=>o.pts-a.pts);const s=n.samples;return n.samples=[],{samples:s}}class af{constructor(e,t,r,i){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=t,this.size=r,this.cts=i,this.flags={isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:e?2:1,isNonSync:e?0:1}}}class ZS{constructor(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}destroy(){}resetTimeStamp(e){this.initPTS=e,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(e,t,r,i){this.audioCodec=t,this.videoCodec=r,this.generateInitSegment(sE(e,i)),this.emitInitSegment=!0}generateInitSegment(e){let{audioCodec:t,videoCodec:r}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const i=this.initData=f0(e);i.audio&&(t=lf(i.audio,se.AUDIO)),i.video&&(r=lf(i.video,se.VIDEO));const s={};i.audio&&i.video?s.audiovideo={container:"video/mp4",codec:t+","+r,initSegment:e,id:"main"}:i.audio?s.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:i.video?s.video={container:"video/mp4",codec:r,initSegment:e,id:"main"}:w.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=s}remux(e,t,r,i,s,o){var a,l;let{initPTS:u,lastEndTime:c}=this;const d={audio:void 0,video:void 0,text:i,id3:r,initSegment:void 0};G(c)||(c=this.lastEndTime=s||0);const f=t.samples;if(!(f!=null&&f.length))return d;const h={initPTS:void 0,timescale:1};let m=this.initData;if((a=m)!=null&&a.length||(this.generateInitSegment(f),m=this.initData),!((l=m)!=null&&l.length))return w.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),d;this.emitInitSegment&&(h.tracks=this.initTracks,this.emitInitSegment=!1);const p=aE(f,m),x=oE(m,f),y=x===null?s:x;(eT(u,y,s,p)||h.timescale!==u.timescale&&o)&&(h.initPTS=y-s,u&&u.timescale===1&&w.warn(`Adjusting initPTS by ${h.initPTS-u.baseTime}`),this.initPTS=u={baseTime:h.initPTS,timescale:1});const v=e?y-u.baseTime/u.timescale:c,S=v+p;uE(m,f,u.baseTime/u.timescale),p>0?this.lastEndTime=S:(w.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const L=!!m.audio,T=!!m.video;let A="";L&&(A+="audio"),T&&(A+="video");const R={data1:f,startPTS:v,startDTS:v,endPTS:S,endDTS:S,type:A,hasAudio:L,hasVideo:T,nb:1,dropped:0};return d.audio=R.type==="audio"?R:void 0,d.video=R.type!=="audio"?R:void 0,d.initSegment=h,d.id3=$0(r,s,u,u),i.samples.length&&(d.text=j0(i,s,u)),d}}function eT(n,e,t,r){if(n===null)return!0;const i=Math.max(r,1),s=e-n.baseTime/n.timescale;return Math.abs(s-t)>i}function lf(n,e){const t=n==null?void 0:n.codec;if(t&&t.length>4)return t;if(e===se.AUDIO){if(t==="ec-3"||t==="ac-3"||t==="alac")return t;if(t==="fLaC"||t==="Opus")return lo(t,!1);const r="mp4a.40.5";return w.info(`Parsed audio codec "${t}" or audio object type not handled. Using "${r}"`),r}return w.warn(`Unhandled video codec "${t}"`),t==="hvc1"||t==="hev1"?"hvc1.1.6.L120.90":t==="av01"?"av01.0.04M.08":"avc1.42e01e"}let Vt;try{Vt=self.performance.now.bind(self.performance)}catch{w.debug("Unable to use Performance API on this environment"),Vt=wr==null?void 0:wr.Date.now}const bs=[{demux:BS,remux:ZS},{demux:an,remux:ks},{demux:MS,remux:ks},{demux:zS,remux:ks}];bs.splice(2,0,{demux:$S,remux:ks});class uf{constructor(e,t,r,i,s){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=r,this.vendor=i,this.id=s}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,r,i){const s=r.transmuxing;s.executeStart=Vt();let o=new Uint8Array(e);const{currentTransmuxState:a,transmuxConfig:l}=this;i&&(this.currentTransmuxState=i);const{contiguous:u,discontinuity:c,trackSwitch:d,accurateTimeOffset:f,timeOffset:h,initSegmentChange:m}=i||a,{audioCodec:p,videoCodec:x,defaultInitPts:y,duration:v,initSegmentData:S}=l,L=tT(o,t);if(L&&L.method==="AES-128"){const k=this.getDecrypter();if(k.isSync()){let _=k.softwareDecrypt(o,L.key.buffer,L.iv.buffer);if(r.part>-1&&(_=k.flush()),!_)return s.executeEnd=Vt(),wa(r);o=new Uint8Array(_)}else return this.decryptionPromise=k.webCryptoDecrypt(o,L.key.buffer,L.iv.buffer).then(_=>{const C=this.push(_,null,r);return this.decryptionPromise=null,C}),this.decryptionPromise}const T=this.needsProbing(c,d);if(T){const k=this.configureTransmuxer(o);if(k)return w.warn(`[transmuxer] ${k.message}`),this.observer.emit(E.ERROR,E.ERROR,{type:X.MEDIA_ERROR,details:b.FRAG_PARSING_ERROR,fatal:!1,error:k,reason:k.message}),s.executeEnd=Vt(),wa(r)}(c||d||m||T)&&this.resetInitSegment(S,p,x,v,t),(c||m||T)&&this.resetInitialTimestamp(y),u||this.resetContiguity();const A=this.transmux(o,L,h,f,r),R=this.currentTransmuxState;return R.contiguous=!0,R.discontinuity=!1,R.trackSwitch=!1,s.executeEnd=Vt(),A}flush(e){const t=e.transmuxing;t.executeStart=Vt();const{decrypter:r,currentTransmuxState:i,decryptionPromise:s}=this;if(s)return s.then(()=>this.flush(e));const o=[],{timeOffset:a}=i;if(r){const d=r.flush();d&&o.push(this.push(d,null,e))}const{demuxer:l,remuxer:u}=this;if(!l||!u)return t.executeEnd=Vt(),[wa(e)];const c=l.flush(a);return Ds(c)?c.then(d=>(this.flushRemux(o,d,e),o)):(this.flushRemux(o,c,e),o)}flushRemux(e,t,r){const{audioTrack:i,videoTrack:s,id3Track:o,textTrack:a}=t,{accurateTimeOffset:l,timeOffset:u}=this.currentTransmuxState;w.log(`[transmuxer.ts]: Flushed fragment ${r.sn}${r.part>-1?" p: "+r.part:""} of level ${r.level}`);const c=this.remuxer.remux(i,s,o,a,u,l,!0,this.id);e.push({remuxResult:c,chunkMeta:r}),r.transmuxing.executeEnd=Vt()}resetInitialTimestamp(e){const{demuxer:t,remuxer:r}=this;!t||!r||(t.resetTimeStamp(e),r.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,r,i,s){const{demuxer:o,remuxer:a}=this;!o||!a||(o.resetInitSegment(e,t,r,i),a.resetInitSegment(e,t,r,s))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,r,i,s){let o;return t&&t.method==="SAMPLE-AES"?o=this.transmuxSampleAes(e,t,r,i,s):o=this.transmuxUnencrypted(e,r,i,s),o}transmuxUnencrypted(e,t,r,i){const{audioTrack:s,videoTrack:o,id3Track:a,textTrack:l}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(s,o,a,l,t,r,!1,this.id),chunkMeta:i}}transmuxSampleAes(e,t,r,i,s){return this.demuxer.demuxSampleAes(e,t,r).then(o=>({remuxResult:this.remuxer.remux(o.audioTrack,o.videoTrack,o.id3Track,o.textTrack,r,i,!1,this.id),chunkMeta:s}))}configureTransmuxer(e){const{config:t,observer:r,typeSupported:i,vendor:s}=this;let o;for(let f=0,h=bs.length;f<h;f++){var a;if((a=bs[f].demux)!=null&&a.probe(e)){o=bs[f];break}}if(!o)return new Error("Failed to find demuxer by probing fragment data");const l=this.demuxer,u=this.remuxer,c=o.remux,d=o.demux;(!u||!(u instanceof c))&&(this.remuxer=new c(r,t,i,s)),(!l||!(l instanceof d))&&(this.demuxer=new d(r,t,i),this.probe=d.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new Ju(this.config)),e}}function tT(n,e){let t=null;return n.byteLength>0&&(e==null?void 0:e.key)!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const wa=n=>({remuxResult:{},chunkMeta:n});function Ds(n){return"then"in n&&n.then instanceof Function}class nT{constructor(e,t,r,i,s){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=r,this.duration=i,this.defaultInitPts=s||null}}class rT{constructor(e,t,r,i,s,o){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=r,this.trackSwitch=i,this.timeOffset=s,this.initSegmentChange=o}}var G0={exports:{}};(function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function i(l,u,c){this.fn=l,this.context=u,this.once=c||!1}function s(l,u,c,d,f){if(typeof c!="function")throw new TypeError("The listener must be a function");var h=new i(c,d||l,f),m=t?t+u:u;return l._events[m]?l._events[m].fn?l._events[m]=[l._events[m],h]:l._events[m].push(h):(l._events[m]=h,l._eventsCount++),l}function o(l,u){--l._eventsCount===0?l._events=new r:delete l._events[u]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var u=[],c,d;if(this._eventsCount===0)return u;for(d in c=this._events)e.call(c,d)&&u.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(c)):u},a.prototype.listeners=function(u){var c=t?t+u:u,d=this._events[c];if(!d)return[];if(d.fn)return[d.fn];for(var f=0,h=d.length,m=new Array(h);f<h;f++)m[f]=d[f].fn;return m},a.prototype.listenerCount=function(u){var c=t?t+u:u,d=this._events[c];return d?d.fn?1:d.length:0},a.prototype.emit=function(u,c,d,f,h,m){var p=t?t+u:u;if(!this._events[p])return!1;var x=this._events[p],y=arguments.length,v,S;if(x.fn){switch(x.once&&this.removeListener(u,x.fn,void 0,!0),y){case 1:return x.fn.call(x.context),!0;case 2:return x.fn.call(x.context,c),!0;case 3:return x.fn.call(x.context,c,d),!0;case 4:return x.fn.call(x.context,c,d,f),!0;case 5:return x.fn.call(x.context,c,d,f,h),!0;case 6:return x.fn.call(x.context,c,d,f,h,m),!0}for(S=1,v=new Array(y-1);S<y;S++)v[S-1]=arguments[S];x.fn.apply(x.context,v)}else{var L=x.length,T;for(S=0;S<L;S++)switch(x[S].once&&this.removeListener(u,x[S].fn,void 0,!0),y){case 1:x[S].fn.call(x[S].context);break;case 2:x[S].fn.call(x[S].context,c);break;case 3:x[S].fn.call(x[S].context,c,d);break;case 4:x[S].fn.call(x[S].context,c,d,f);break;default:if(!v)for(T=1,v=new Array(y-1);T<y;T++)v[T-1]=arguments[T];x[S].fn.apply(x[S].context,v)}}return!0},a.prototype.on=function(u,c,d){return s(this,u,c,d,!1)},a.prototype.once=function(u,c,d){return s(this,u,c,d,!0)},a.prototype.removeListener=function(u,c,d,f){var h=t?t+u:u;if(!this._events[h])return this;if(!c)return o(this,h),this;var m=this._events[h];if(m.fn)m.fn===c&&(!f||m.once)&&(!d||m.context===d)&&o(this,h);else{for(var p=0,x=[],y=m.length;p<y;p++)(m[p].fn!==c||f&&!m[p].once||d&&m[p].context!==d)&&x.push(m[p]);x.length?this._events[h]=x.length===1?x[0]:x:o(this,h)}return this},a.prototype.removeAllListeners=function(u){var c;return u?(c=t?t+u:u,this._events[c]&&o(this,c)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,n.exports=a})(G0);var iT=G0.exports,ic=Cv(iT);class V0{constructor(e,t,r,i){this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;const s=e.config;this.hls=e,this.id=t,this.useWorker=!!s.enableWorker,this.onTransmuxComplete=r,this.onFlush=i;const o=(u,c)=>{c=c||{},c.frag=this.frag,c.id=this.id,u===E.ERROR&&(this.error=c.error),this.hls.trigger(u,c)};this.observer=new ic,this.observer.on(E.FRAG_DECRYPTED,o),this.observer.on(E.ERROR,o);const a=Hn(s.preferManagedMediaSource)||{isTypeSupported:()=>!1},l={mpeg:a.isTypeSupported("audio/mpeg"),mp3:a.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:a.isTypeSupported('audio/mp4; codecs="ac-3"')};if(this.useWorker&&typeof Worker<"u"&&(s.workerPath||LS())){try{s.workerPath?(w.log(`loading Web Worker ${s.workerPath} for "${t}"`),this.workerContext=AS(s.workerPath)):(w.log(`injecting Web Worker for "${t}"`),this.workerContext=RS()),this.onwmsg=d=>this.onWorkerMessage(d);const{worker:c}=this.workerContext;c.addEventListener("message",this.onwmsg),c.onerror=d=>{const f=new Error(`${d.message}  (${d.filename}:${d.lineno})`);s.enableWorker=!1,w.warn(`Error in "${t}" Web Worker, fallback to inline`),this.hls.trigger(E.ERROR,{type:X.OTHER_ERROR,details:b.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:f})},c.postMessage({cmd:"init",typeSupported:l,vendor:"",id:t,config:JSON.stringify(s)})}catch(c){w.warn(`Error setting up "${t}" Web Worker, fallback to inline`,c),this.resetWorker(),this.error=null,this.transmuxer=new uf(this.observer,l,s,"",t)}return}this.transmuxer=new uf(this.observer,l,s,"",t)}resetWorker(){if(this.workerContext){const{worker:e,objectURL:t}=this.workerContext;t&&self.URL.revokeObjectURL(t),e.removeEventListener("message",this.onwmsg),e.onerror=null,e.terminate(),this.workerContext=null}}destroy(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null}push(e,t,r,i,s,o,a,l,u,c){var d,f;u.transmuxing.start=self.performance.now();const{transmuxer:h}=this,m=o?o.start:s.start,p=s.decryptdata,x=this.frag,y=!(x&&s.cc===x.cc),v=!(x&&u.level===x.level),S=x?u.sn-x.sn:-1,L=this.part?u.part-this.part.index:-1,T=S===0&&u.id>1&&u.id===(x==null?void 0:x.stats.chunkCount),A=!v&&(S===1||S===0&&(L===1||T&&L<=0)),R=self.performance.now();(v||S||s.stats.parsing.start===0)&&(s.stats.parsing.start=R),o&&(L||!A)&&(o.stats.parsing.start=R);const k=!(x&&((d=s.initSegment)==null?void 0:d.url)===((f=x.initSegment)==null?void 0:f.url)),_=new rT(y,A,l,v,m,k);if(!A||y||k){w.log(`[transmuxer-interface, ${s.type}]: Starting new transmux session for sn: ${u.sn} p: ${u.part} level: ${u.level} id: ${u.id}
        discontinuity: ${y}
        trackSwitch: ${v}
        contiguous: ${A}
        accurateTimeOffset: ${l}
        timeOffset: ${m}
        initSegmentChange: ${k}`);const C=new nT(r,i,t,a,c);this.configureTransmuxer(C)}if(this.frag=s,this.part=o,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:e,decryptdata:p,chunkMeta:u,state:_},e instanceof ArrayBuffer?[e]:[]);else if(h){const C=h.push(e,p,u,_);Ds(C)?(h.async=!0,C.then(P=>{this.handleTransmuxComplete(P)}).catch(P=>{this.transmuxerError(P,u,"transmuxer-interface push error")})):(h.async=!1,this.handleTransmuxComplete(C))}}flush(e){e.transmuxing.start=self.performance.now();const{transmuxer:t}=this;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:e});else if(t){let r=t.flush(e);Ds(r)||t.async?(Ds(r)||(r=Promise.resolve(r)),r.then(s=>{this.handleFlushResult(s,e)}).catch(s=>{this.transmuxerError(s,e,"transmuxer-interface flush error")})):this.handleFlushResult(r,e)}}transmuxerError(e,t,r){this.hls&&(this.error=e,this.hls.trigger(E.ERROR,{type:X.MEDIA_ERROR,details:b.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,fatal:!1,error:e,err:e,reason:r}))}handleFlushResult(e,t){e.forEach(r=>{this.handleTransmuxComplete(r)}),this.onFlush(t)}onWorkerMessage(e){const t=e.data;if(!(t!=null&&t.event)){w.warn(`worker message received with no ${t?"event name":"data"}`);return}const r=this.hls;if(this.hls)switch(t.event){case"init":{var i;const s=(i=this.workerContext)==null?void 0:i.objectURL;s&&self.URL.revokeObjectURL(s);break}case"transmuxComplete":{this.handleTransmuxComplete(t.data);break}case"flush":{this.onFlush(t.data);break}case"workerLog":w[t.data.logType]&&w[t.data.logType](t.data.message);break;default:{t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,r.trigger(t.event,t.data);break}}}configureTransmuxer(e){const{transmuxer:t}=this;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:e}):t&&t.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const cf=100;class sT extends Zu{constructor(e,t,r){super(e,t,r,"[audio-stream-controller]",W.AUDIO),this.videoBuffer=null,this.videoTrackCC=-1,this.waitingVideoCC=-1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null}_registerListeners(){const{hls:e}=this;e.on(E.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(E.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(E.MANIFEST_LOADING,this.onManifestLoading,this),e.on(E.LEVEL_LOADED,this.onLevelLoaded,this),e.on(E.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(E.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(E.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(E.ERROR,this.onError,this),e.on(E.BUFFER_RESET,this.onBufferReset,this),e.on(E.BUFFER_CREATED,this.onBufferCreated,this),e.on(E.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(E.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(E.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(E.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(E.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(E.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(E.MANIFEST_LOADING,this.onManifestLoading,this),e.off(E.LEVEL_LOADED,this.onLevelLoaded,this),e.off(E.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(E.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(E.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(E.ERROR,this.onError,this),e.off(E.BUFFER_RESET,this.onBufferReset,this),e.off(E.BUFFER_CREATED,this.onBufferCreated,this),e.off(E.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(E.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(E.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(E.FRAG_BUFFERED,this.onFragBuffered,this)}onInitPtsFound(e,{frag:t,id:r,initPTS:i,timescale:s}){if(r==="main"){const o=t.cc;this.initPTS[t.cc]={baseTime:i,timescale:s},this.log(`InitPTS for cc: ${o} found from main: ${i}`),this.videoTrackCC=o,this.state===O.WAITING_INIT_PTS&&this.tick()}}startLoad(e){if(!this.levels){this.startPosition=e,this.state=O.STOPPED;return}const t=this.lastCurrentTime;this.stopLoad(),this.setInterval(cf),t>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t,this.state=O.IDLE):(this.loadedmetadata=!1,this.state=O.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}doTick(){switch(this.state){case O.IDLE:this.doTickIdle();break;case O.WAITING_TRACK:{var e;const{levels:r,trackId:i}=this,s=r==null||(e=r[i])==null?void 0:e.details;if(s){if(this.waitForCdnTuneIn(s))break;this.state=O.WAITING_INIT_PTS}break}case O.FRAG_LOADING_WAITING_RETRY:{var t;const r=performance.now(),i=this.retryDate;if(!i||r>=i||(t=this.media)!=null&&t.seeking){const{levels:s,trackId:o}=this;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded((s==null?void 0:s[o])||null),this.state=O.IDLE}break}case O.WAITING_INIT_PTS:{const r=this.waitingData;if(r){const{frag:i,part:s,cache:o,complete:a}=r;if(this.initPTS[i.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=O.FRAG_LOADING;const l=o.flush(),u={frag:i,part:s,payload:l,networkDetails:null};this._handleFragmentLoadProgress(u),a&&super._handleFragmentLoadComplete(u)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log(`Waiting fragment cc (${i.cc}) cancelled because video is at cc ${this.videoTrackCC}`),this.clearWaitingFragment();else{const l=this.getLoadPosition(),u=ue.bufferInfo(this.mediaBuffer,l,this.config.maxBufferHole);Ml(u.end,this.config.maxFragLookUpTolerance,i)<0&&(this.log(`Waiting fragment cc (${i.cc}) @ ${i.start} cancelled because another fragment at ${u.end} is needed`),this.clearWaitingFragment())}}else this.state=O.IDLE}}this.onTickEnd()}clearWaitingFragment(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=O.IDLE)}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){const{hls:e,levels:t,media:r,trackId:i}=this,s=e.config;if(!this.buffering||!r&&(this.startFragRequested||!s.startFragPrefetch)||!(t!=null&&t[i]))return;const o=t[i],a=o.details;if(!a||a.live&&this.levelLastLoaded!==o||this.waitForCdnTuneIn(a)){this.state=O.WAITING_TRACK;return}const l=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&l&&(this.bufferFlushed=!1,this.afterBufferFlushed(l,se.AUDIO,W.AUDIO));const u=this.getFwdBufferInfo(l,W.AUDIO);if(u===null)return;if(!this.switchingTrack&&this._streamEnded(u,a)){e.trigger(E.BUFFER_EOS,{type:"audio"}),this.state=O.ENDED;return}const c=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,W.MAIN),d=u.len,f=this.getMaxBufferLength(c==null?void 0:c.len),h=a.fragments,m=h[0].start,p=this.getLoadPosition(),x=this.flushing?p:u.end;if(this.switchingTrack&&r){const L=p;a.PTSKnown&&L<m&&(u.end>m||u.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),r.currentTime=m+.05)}if(d>=f&&!this.switchingTrack&&x<h[h.length-1].start)return;let y=this.getNextFragment(x,a),v=!1;if(y&&this.isLoopLoading(y,x)&&(v=!!y.gap,y=this.getNextFragmentLoopLoading(y,a,u,W.MAIN,f)),!y){this.bufferFlushed=!0;return}const S=c&&y.start>c.end+a.targetduration;if(S||!(c!=null&&c.len)&&u.len){const L=this.getAppendedFrag(y.start,W.MAIN);if(L===null||(v||(v=!!L.gap||!!S&&c.len===0),S&&!v||v&&u.nextStart&&u.nextStart<L.end))return}this.loadFragment(y,o,x)}getMaxBufferLength(e){const t=super.getMaxBufferLength();return e?Math.min(Math.max(t,e),this.config.maxMaxBufferLength):t}onMediaDetaching(){this.videoBuffer=null,this.bufferFlushed=this.flushing=!1,super.onMediaDetaching()}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(r=>new Cr(r))}onAudioTrackSwitching(e,t){const r=!!t.url;this.trackId=t.id;const{fragCurrent:i}=this;i&&(i.abortRequests(),this.removeUnbufferedFrags(i.start)),this.resetLoadingState(),r?this.setInterval(cf):this.resetTransmuxer(),r?(this.switchingTrack=t,this.state=O.IDLE,this.flushAudioIfNeeded(t)):(this.switchingTrack=null,this.bufferedTrack=t,this.state=O.STOPPED),this.tick()}onManifestLoading(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=this.flushing=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1}onLevelLoaded(e,t){this.mainDetails=t.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(E.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)}onAudioTrackLoaded(e,t){var r;if(this.mainDetails==null){this.cachedTrackLoadedData=t;return}const{levels:i}=this,{details:s,id:o}=t;if(!i){this.warn(`Audio tracks were reset while loading level ${o}`);return}this.log(`Audio track ${o} loaded [${s.startSN},${s.endSN}]${s.lastPartSn?`[part-${s.lastPartSn}-${s.lastPartIndex}]`:""},duration:${s.totalduration}`);const a=i[o];let l=0;if(s.live||(r=a.details)!=null&&r.live){this.checkLiveUpdate(s);const c=this.mainDetails;if(s.deltaUpdateFailed||!c)return;if(!a.details&&s.hasProgramDateTime&&c.hasProgramDateTime)mo(s,c),l=s.fragments[0].start;else{var u;l=this.alignPlaylists(s,a.details,(u=this.levelLastLoaded)==null?void 0:u.details)}}a.details=s,this.levelLastLoaded=a,!this.startFragRequested&&(this.mainDetails||!s.live)&&this.setStartPosition(this.mainDetails||s,l),this.state===O.WAITING_TRACK&&!this.waitForCdnTuneIn(s)&&(this.state=O.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const{frag:r,part:i,payload:s}=e,{config:o,trackId:a,levels:l}=this;if(!l){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);return}const u=l[a];if(!u){this.warn("Audio track is undefined on fragment load progress");return}const c=u.details;if(!c){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(r.start);return}const d=o.defaultAudioCodec||u.audioCodec||"mp4a.40.2";let f=this.transmuxer;f||(f=this.transmuxer=new V0(this.hls,W.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const h=this.initPTS[r.cc],m=(t=r.initSegment)==null?void 0:t.data;if(h!==void 0){const x=i?i.index:-1,y=x!==-1,v=new Qu(r.level,r.sn,r.stats.chunkCount,s.byteLength,x,y);f.push(s,m,d,"",r,i,c.totalduration,!1,v,h)}else{this.log(`Unknown video PTS for cc ${r.cc}, waiting for video PTS before demuxing audio frag ${r.sn} of [${c.startSN} ,${c.endSN}],track ${a}`);const{cache:p}=this.waitingData=this.waitingData||{frag:r,part:i,cache:new C0,complete:!1};p.push(new Uint8Array(s)),this.waitingVideoCC=this.videoTrackCC,this.state=O.WAITING_INIT_PTS}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1}onBufferCreated(e,t){const r=t.tracks.audio;r&&(this.mediaBuffer=r.buffer||null),t.tracks.video&&(this.videoBuffer=t.tracks.video.buffer||null)}onFragBuffered(e,t){const{frag:r,part:i}=t;if(r.type!==W.AUDIO){if(!this.loadedmetadata&&r.type===W.MAIN){const s=this.videoBuffer||this.media;s&&ue.getBuffered(s).length&&(this.loadedmetadata=!0)}return}if(this.fragContextChanged(r)){this.warn(`Fragment ${r.sn}${i?" p: "+i.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(r.sn!=="initSegment"){this.fragPrevious=r;const s=this.switchingTrack;s&&(this.bufferedTrack=s,this.switchingTrack=null,this.hls.trigger(E.AUDIO_TRACK_SWITCHED,De({},s)))}this.fragBufferedComplete(r,i)}onError(e,t){var r;if(t.fatal){this.state=O.ERROR;return}switch(t.details){case b.FRAG_GAP:case b.FRAG_PARSING_ERROR:case b.FRAG_DECRYPT_ERROR:case b.FRAG_LOAD_ERROR:case b.FRAG_LOAD_TIMEOUT:case b.KEY_LOAD_ERROR:case b.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(W.AUDIO,t);break;case b.AUDIO_TRACK_LOAD_ERROR:case b.AUDIO_TRACK_LOAD_TIMEOUT:case b.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===O.WAITING_TRACK&&((r=t.context)==null?void 0:r.type)===te.AUDIO_TRACK&&(this.state=O.IDLE);break;case b.BUFFER_APPEND_ERROR:case b.BUFFER_FULL_ERROR:if(!t.parent||t.parent!=="audio")return;if(t.details===b.BUFFER_APPEND_ERROR){this.resetLoadingState();return}this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case b.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==se.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==se.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===O.ENDED&&(this.state=O.IDLE);const r=this.mediaBuffer||this.media;r&&(this.afterBufferFlushed(r,t,W.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const r="audio",{hls:i}=this,{remuxResult:s,chunkMeta:o}=e,a=this.getCurrentContext(o);if(!a){this.resetWhenMissingContext(o);return}const{frag:l,part:u,level:c}=a,{details:d}=c,{audio:f,text:h,id3:m,initSegment:p}=s;if(this.fragContextChanged(l)||!d){this.fragmentTracker.removeFragment(l);return}if(this.state=O.PARSING,this.switchingTrack&&f&&this.completeAudioSwitch(this.switchingTrack),p!=null&&p.tracks){const x=l.initSegment||l;this._bufferInitSegment(c,p.tracks,x,o),i.trigger(E.FRAG_PARSING_INIT_SEGMENT,{frag:x,id:r,tracks:p.tracks})}if(f){const{startPTS:x,endPTS:y,startDTS:v,endDTS:S}=f;u&&(u.elementaryStreams[se.AUDIO]={startPTS:x,endPTS:y,startDTS:v,endDTS:S}),l.setElementaryStreamInfo(se.AUDIO,x,y,v,S),this.bufferFragmentData(f,l,u,o)}if(m!=null&&(t=m.samples)!=null&&t.length){const x=Te({id:r,frag:l,details:d},m);i.trigger(E.FRAG_PARSING_METADATA,x)}if(h){const x=Te({id:r,frag:l,details:d},h);i.trigger(E.FRAG_PARSING_USERDATA,x)}}_bufferInitSegment(e,t,r,i){if(this.state!==O.PARSING)return;t.video&&delete t.video;const s=t.audio;if(!s)return;s.id="audio";const o=e.audioCodec;this.log(`Init audio buffer, container:${s.container}, codecs[level/parsed]=[${o}/${s.codec}]`),o&&o.split(",").length===1&&(s.levelCodec=o),this.hls.trigger(E.BUFFER_CODECS,t);const a=s.initSegment;if(a!=null&&a.byteLength){const l={type:"audio",frag:r,part:null,chunkMeta:i,parent:r.type,data:a};this.hls.trigger(E.BUFFER_APPENDING,l)}this.tickImmediate()}loadFragment(e,t,r){const i=this.fragmentTracker.getState(e);if(this.fragCurrent=e,this.switchingTrack||i===Ie.NOT_LOADED||i===Ie.PARTIAL){var s;if(e.sn==="initSegment")this._loadInitSegment(e,t);else if((s=t.details)!=null&&s.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=O.WAITING_INIT_PTS;const o=this.mainDetails;o&&o.fragments[0].start!==t.details.fragments[0].start&&mo(t.details,o)}else this.startFragRequested=!0,super.loadFragment(e,t,r)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:r,assocLang:i,characteristics:s,audioCodec:o,channels:a}=this.bufferedTrack;Bn({name:t,lang:r,assocLang:i,characteristics:s,audioCodec:o,channels:a},e,Dn)||(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(E.AUDIO_TRACK_SWITCHED,De({},e))}}function K0(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!wi(n[t].attrs,e[t].attrs))return!1;return!0}function wi(n,e,t){const r=n["STABLE-RENDITION-ID"];return r&&!t?r===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(i=>n[i]!==e[i])}function Bl(n,e){return e.label.toLowerCase()===n.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(n.lang||"").toLowerCase())}class oT extends Xu{constructor(e){super(e,"[audio-track-controller]"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(E.MANIFEST_LOADING,this.onManifestLoading,this),e.on(E.MANIFEST_PARSED,this.onManifestParsed,this),e.on(E.LEVEL_LOADING,this.onLevelLoading,this),e.on(E.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(E.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(E.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(E.MANIFEST_LOADING,this.onManifestLoading,this),e.off(E.MANIFEST_PARSED,this.onManifestParsed,this),e.off(E.LEVEL_LOADING,this.onLevelLoading,this),e.off(E.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(E.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(E.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:r,groupId:i,details:s}=t,o=this.tracksInGroup[r];if(!o||o.groupId!==i){this.warn(`Audio track with id:${r} and group:${i} not found in active group ${o==null?void 0:o.groupId}`);return}const a=o.details;o.details=t.details,this.log(`Audio track ${r} "${o.name}" lang:${o.lang} group:${i} loaded [${s.startSN}-${s.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const r=t.audioGroups||null,i=this.groupIds;let s=this.currentTrack;if(!r||(i==null?void 0:i.length)!==(r==null?void 0:r.length)||r!=null&&r.some(a=>(i==null?void 0:i.indexOf(a))===-1)){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const a=this.tracks.filter(f=>!r||r.indexOf(f.groupId)!==-1);if(a.length)this.selectDefaultTrack&&!a.some(f=>f.default)&&(this.selectDefaultTrack=!1),a.forEach((f,h)=>{f.id=h});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=a;const l=this.hls.config.audioPreference;if(!s&&l){const f=Dt(l,a,Dn);if(f>-1)s=a[f];else{const h=Dt(l,this.tracks);s=this.tracks[h]}}let u=this.findTrackId(s);u===-1&&s&&(u=this.findTrackId(null));const c={audioTracks:a};this.log(`Updating audio tracks, ${a.length} track(s) found in group(s): ${r==null?void 0:r.join(",")}`),this.hls.trigger(E.AUDIO_TRACKS_UPDATED,c);const d=this.trackId;if(u!==-1&&d===-1)this.setAudioTrack(u);else if(a.length&&d===-1){var o;const f=new Error(`No audio track selected for current audio group-ID(s): ${(o=this.groupIds)==null?void 0:o.join(",")} track count: ${a.length}`);this.warn(f.message),this.hls.trigger(E.ERROR,{type:X.MEDIA_ERROR,details:b.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:f})}}else this.shouldReloadPlaylist(s)&&this.setAudioTrack(this.trackId)}onError(e,t){t.fatal||!t.context||t.context.type===te.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&(this.requestScheduled=-1,this.checkRetry(t))}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const r=this.allAudioTracks;if(this.selectDefaultTrack=!1,r.length){const i=this.currentTrack;if(i&&Bn(e,i,Dn))return i;const s=Dt(e,this.tracksInGroup,Dn);if(s>-1){const o=this.tracksInGroup[s];return this.setAudioTrack(s),o}else if(i){let o=t.loadLevel;o===-1&&(o=t.firstAutoLevel);const a=oS(e,t.levels,r,o,Dn);if(a===-1)return null;t.nextLoadLevel=a}if(e.channels||e.audioCodec){const o=Dt(e,r);if(o>-1)return r[o]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.clearTimer(),this.selectDefaultTrack=!1;const r=this.currentTrack,i=t[e],s=i.details&&!i.details.live;if(e===this.trackId&&i===r&&s||(this.log(`Switching to audio-track ${e} "${i.name}" lang:${i.lang} group:${i.groupId} channels:${i.channels}`),this.trackId=e,this.currentTrack=i,this.hls.trigger(E.AUDIO_TRACK_SWITCHING,De({},i)),s))return;const o=this.switchParams(i.url,r==null?void 0:r.details,i.details);this.loadPlaylist(o)}findTrackId(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const i=t[r];if(!(this.selectDefaultTrack&&!i.default)&&(!e||Bn(e,i,Dn)))return r}if(e){const{name:r,lang:i,assocLang:s,characteristics:o,audioCodec:a,channels:l}=e;for(let u=0;u<t.length;u++){const c=t[u];if(Bn({name:r,lang:i,assocLang:s,characteristics:o,audioCodec:a,channels:l},c,Dn))return u}for(let u=0;u<t.length;u++){const c=t[u];if(wi(e.attrs,c.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return u}for(let u=0;u<t.length;u++){const c=t[u];if(wi(e.attrs,c.attrs,["LANGUAGE"]))return u}}return-1}loadPlaylist(e){const t=this.currentTrack;if(this.shouldLoadPlaylist(t)&&t){super.loadPlaylist();const r=t.id,i=t.groupId;let s=t.url;if(e)try{s=e.addDirectives(s)}catch(o){this.warn(`Could not construct new URL with HLS Delivery Directives: ${o}`)}this.log(`loading audio-track playlist ${r} "${t.name}" lang:${t.lang} group:${i}`),this.clearTimer(),this.hls.trigger(E.AUDIO_TRACK_LOADING,{url:s,id:r,groupId:i,deliveryDirectives:e||null})}}}const df=500;class aT extends Zu{constructor(e,t,r){super(e,t,r,"[subtitle-stream-controller]",W.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}_registerListeners(){const{hls:e}=this;e.on(E.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(E.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(E.MANIFEST_LOADING,this.onManifestLoading,this),e.on(E.LEVEL_LOADED,this.onLevelLoaded,this),e.on(E.ERROR,this.onError,this),e.on(E.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(E.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(E.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(E.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(E.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(E.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(E.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(E.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(E.MANIFEST_LOADING,this.onManifestLoading,this),e.off(E.LEVEL_LOADED,this.onLevelLoaded,this),e.off(E.ERROR,this.onError,this),e.off(E.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(E.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(E.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(E.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(E.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(E.FRAG_BUFFERED,this.onFragBuffered,this)}startLoad(e){this.stopLoad(),this.state=O.IDLE,this.setInterval(df),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}onManifestLoading(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()}onMediaDetaching(){this.tracksBuffered=[],super.onMediaDetaching()}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:r,success:i}=t;if(this.fragPrevious=r,this.state=O.IDLE,!i)return;const s=this.tracksBuffered[this.currentTrackId];if(!s)return;let o;const a=r.start;for(let u=0;u<s.length;u++)if(a>=s[u].start&&a<=s[u].end){o=s[u];break}const l=r.start+r.duration;o?o.end=l:(o={start:a,end:l},s.push(o)),this.fragmentTracker.fragBuffered(r),this.fragBufferedComplete(r,null)}onBufferFlushing(e,t){const{startOffset:r,endOffset:i}=t;if(r===0&&i!==Number.POSITIVE_INFINITY){const s=i-1;if(s<=0)return;t.endOffsetSubtitles=Math.max(0,s),this.tracksBuffered.forEach(o=>{for(let a=0;a<o.length;){if(o[a].end<=s){o.shift();continue}else if(o[a].start<s)o[a].start=s;else break;a++}}),this.fragmentTracker.removeFragmentsInRange(r,s,W.SUBTITLE)}}onFragBuffered(e,t){if(!this.loadedmetadata&&t.frag.type===W.MAIN){var r;(r=this.media)!=null&&r.buffered.length&&(this.loadedmetadata=!0)}}onError(e,t){const r=t.frag;(r==null?void 0:r.type)===W.SUBTITLE&&(t.details===b.FRAG_GAP&&this.fragmentTracker.fragBuffered(r,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==O.STOPPED&&(this.state=O.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&K0(this.levels,t)){this.levels=t.map(r=>new Cr(r));return}this.tracksBuffered=[],this.levels=t.map(r=>{const i=new Cr(r);return this.tracksBuffered[i.id]=[],i}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,W.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var r;if(this.currentTrackId=t.id,!((r=this.levels)!=null&&r.length)||this.currentTrackId===-1){this.clearInterval();return}const i=this.levels[this.currentTrackId];i!=null&&i.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,i&&this.setInterval(df)}onSubtitleTrackLoaded(e,t){var r;const{currentTrackId:i,levels:s}=this,{details:o,id:a}=t;if(!s){this.warn(`Subtitle tracks were reset while loading level ${a}`);return}const l=s[a];if(a>=s.length||!l)return;this.log(`Subtitle track ${a} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""},duration:${o.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let u=0;if(o.live||(r=l.details)!=null&&r.live){const d=this.mainDetails;if(o.deltaUpdateFailed||!d)return;const f=d.fragments[0];if(!l.details)o.hasProgramDateTime&&d.hasProgramDateTime?(mo(o,d),u=o.fragments[0].start):f&&(u=f.start,Ol(o,u));else{var c;u=this.alignPlaylists(o,l.details,(c=this.levelLastLoaded)==null?void 0:c.details),u===0&&f&&(u=f.start,Ol(o,u))}}l.details=o,this.levelLastLoaded=l,a===i&&(!this.startFragRequested&&(this.mainDetails||!o.live)&&this.setStartPosition(this.mainDetails||o,u),this.tick(),o.live&&!this.fragCurrent&&this.media&&this.state===O.IDLE&&(ho(null,o.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),l.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:r}=e,i=t.decryptdata,s=this.hls;if(!this.fragContextChanged(t)&&r&&r.byteLength>0&&i!=null&&i.key&&i.iv&&i.method==="AES-128"){const o=performance.now();this.decrypter.decrypt(new Uint8Array(r),i.key.buffer,i.iv.buffer).catch(a=>{throw s.trigger(E.ERROR,{type:X.MEDIA_ERROR,details:b.FRAG_DECRYPT_ERROR,fatal:!1,error:a,reason:a.message,frag:t}),a}).then(a=>{const l=performance.now();s.trigger(E.FRAG_DECRYPTED,{frag:t,payload:a,stats:{tstart:o,tdecrypt:l}})}).catch(a=>{this.warn(`${a.name}: ${a.message}`),this.state=O.IDLE})}}doTick(){if(!this.media){this.state=O.IDLE;return}if(this.state===O.IDLE){const{currentTrackId:e,levels:t}=this,r=t==null?void 0:t[e];if(!r||!t.length||!r.details)return;const{config:i}=this,s=this.getLoadPosition(),o=ue.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],s,i.maxBufferHole),{end:a,len:l}=o,u=this.getFwdBufferInfo(this.media,W.MAIN),c=r.details,d=this.getMaxBufferLength(u==null?void 0:u.len)+c.levelTargetDuration;if(l>d)return;const f=c.fragments,h=f.length,m=c.edge;let p=null;const x=this.fragPrevious;if(a<m){const y=i.maxFragLookUpTolerance,v=a>m-y?0:y;p=ho(x,f,Math.max(f[0].start,a),v),!p&&x&&x.start<f[0].start&&(p=f[0])}else p=f[h-1];if(!p)return;if(p=this.mapToInitFragWhenRequired(p),p.sn!=="initSegment"){const y=p.sn-c.startSN,v=f[y-1];v&&v.cc===p.cc&&this.fragmentTracker.getState(v)===Ie.NOT_LOADED&&(p=v)}this.fragmentTracker.getState(p)===Ie.NOT_LOADED&&this.loadFragment(p,r,a)}}getMaxBufferLength(e){const t=super.getMaxBufferLength();return e?Math.max(t,e):t}loadFragment(e,t,r){this.fragCurrent=e,e.sn==="initSegment"?this._loadInitSegment(e,t):(this.startFragRequested=!0,super.loadFragment(e,t,r))}get mediaBufferTimeRanges(){return new lT(this.tracksBuffered[this.currentTrackId]||[])}}class lT{constructor(e){this.buffered=void 0;const t=(r,i,s)=>{if(i=i>>>0,i>s-1)throw new DOMException(`Failed to execute '${r}' on 'TimeRanges': The index provided (${i}) is greater than the maximum bound (${s})`);return e[i][r]};this.buffered={get length(){return e.length},end(r){return t("end",r,e.length)},start(r){return t("start",r,e.length)}}}}class uT extends Xu{constructor(e){super(e,"[subtitle-track-controller]"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const r=ws(this.media.textTracks);for(let s=0;s<r.length;s++)if(r[s].mode==="hidden")t=r[s];else if(r[s].mode==="showing"){t=r[s];break}const i=this.findTrackForTextTrack(t);this.subtitleTrack!==i&&this.setSubtitleTrack(i)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(E.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(E.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(E.MANIFEST_LOADING,this.onManifestLoading,this),e.on(E.MANIFEST_PARSED,this.onManifestParsed,this),e.on(E.LEVEL_LOADING,this.onLevelLoading,this),e.on(E.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(E.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(E.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(E.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(E.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(E.MANIFEST_LOADING,this.onManifestLoading,this),e.off(E.MANIFEST_PARSED,this.onManifestParsed,this),e.off(E.LEVEL_LOADING,this.onLevelLoading,this),e.off(E.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(E.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(E.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(){if(!this.media)return;self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),ws(this.media.textTracks).forEach(t=>{dr(t)}),this.subtitleTrack=-1,this.media=null}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:r,groupId:i,details:s}=t,o=this.tracksInGroup[r];if(!o||o.groupId!==i){this.warn(`Subtitle track with id:${r} and group:${i} not found in active group ${o==null?void 0:o.groupId}`);return}const a=o.details;o.details=t.details,this.log(`Subtitle track ${r} "${o.name}" lang:${o.lang} group:${i} loaded [${s.startSN}-${s.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const r=t.subtitleGroups||null,i=this.groupIds;let s=this.currentTrack;if(!r||(i==null?void 0:i.length)!==(r==null?void 0:r.length)||r!=null&&r.some(o=>(i==null?void 0:i.indexOf(o))===-1)){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(c=>!r||r.indexOf(c.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(c=>c.default)&&(this.selectDefaultTrack=!1),o.forEach((c,d)=>{c.id=d});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const a=this.hls.config.subtitlePreference;if(!s&&a){this.selectDefaultTrack=!1;const c=Dt(a,o);if(c>-1)s=o[c];else{const d=Dt(a,this.tracks);s=this.tracks[d]}}let l=this.findTrackId(s);l===-1&&s&&(l=this.findTrackId(null));const u={subtitleTracks:o};this.log(`Updating subtitle tracks, ${o.length} track(s) found in "${r==null?void 0:r.join(",")}" group-id`),this.hls.trigger(E.SUBTITLE_TRACKS_UPDATED,u),l!==-1&&this.trackId===-1&&this.setSubtitleTrack(l)}else this.shouldReloadPlaylist(s)&&this.setSubtitleTrack(this.trackId)}findTrackId(e){const t=this.tracksInGroup,r=this.selectDefaultTrack;for(let i=0;i<t.length;i++){const s=t[i];if(!(r&&!s.default||!r&&!e)&&(!e||Bn(s,e)))return i}if(e){for(let i=0;i<t.length;i++){const s=t[i];if(wi(e.attrs,s.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return i}for(let i=0;i<t.length;i++){const s=t[i];if(wi(e.attrs,s.attrs,["LANGUAGE"]))return i}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const i=t[r];if(Bl(i,e))return r}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===te.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const r=this.currentTrack;if(r&&Bn(e,r))return r;const i=Dt(e,this.tracksInGroup);if(i>-1){const s=this.tracksInGroup[i];return this.setSubtitleTrack(i),s}else{if(r)return null;{const s=Dt(e,t);if(s>-1)return t[s]}}}}return null}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;if(this.shouldLoadPlaylist(t)&&t){const r=t.id,i=t.groupId;let s=t.url;if(e)try{s=e.addDirectives(s)}catch(o){this.warn(`Could not construct new URL with HLS Delivery Directives: ${o}`)}this.log(`Loading subtitle playlist for id ${r}`),this.hls.trigger(E.SUBTITLE_TRACK_LOADING,{url:s,id:r,groupId:i,deliveryDirectives:e||null})}}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=ws(e.textTracks),r=this.currentTrack;let i;if(r&&(i=t.filter(s=>Bl(r,s))[0],i||this.warn(`Unable to find subtitle TextTrack with name "${r.name}" and language "${r.lang}"`)),[].slice.call(t).forEach(s=>{s.mode!=="disabled"&&s!==i&&(s.mode="disabled")}),i){const s=this.subtitleDisplay?"showing":"hidden";i.mode!==s&&(i.mode=s)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!G(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.clearTimer(),this.selectDefaultTrack=!1;const r=this.currentTrack,i=t[e]||null;if(this.trackId=e,this.currentTrack=i,this.toggleTrackModes(),!i){this.hls.trigger(E.SUBTITLE_TRACK_SWITCH,{id:e});return}const s=!!i.details&&!i.details.live;if(e===this.trackId&&i===r&&s)return;this.log(`Switching to subtitle-track ${e}`+(i?` "${i.name}" lang:${i.lang} group:${i.groupId}`:""));const{id:o,groupId:a="",name:l,type:u,url:c}=i;this.hls.trigger(E.SUBTITLE_TRACK_SWITCH,{id:o,groupId:a,name:l,type:u,url:c});const d=this.switchParams(i.url,r==null?void 0:r.details,i.details);this.loadPlaylist(d)}}class cT{constructor(e){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=e}append(e,t,r){const i=this.queues[t];i.push(e),i.length===1&&!r&&this.executeNext(t)}insertAbort(e,t){this.queues[t].unshift(e),this.executeNext(t)}appendBlocker(e){let t;const r=new Promise(s=>{t=s}),i={execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};return this.append(i,e),r}executeNext(e){const t=this.queues[e];if(t.length){const r=t[0];try{r.execute()}catch(i){w.warn(`[buffer-operation-queue]: Exception executing "${e}" SourceBuffer operation: ${i}`),r.onError(i);const s=this.buffers[e];s!=null&&s.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues[e].shift(),this.executeNext(e)}current(e){return this.queues[e][0]}}const ff=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/;class dT{constructor(e){this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendSource=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this.log=void 0,this.warn=void 0,this.error=void 0,this._onEndStreaming=r=>{this.hls&&this.hls.pauseBuffering()},this._onStartStreaming=r=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=()=>{const{media:r,mediaSource:i}=this;this.log("Media source opened"),r&&(r.removeEventListener("emptied",this._onMediaEmptied),this.updateMediaElementDuration(),this.hls.trigger(E.MEDIA_ATTACHED,{media:r,mediaSource:i})),i&&i.removeEventListener("sourceopen",this._onMediaSourceOpen),this.checkPendingTracks()},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:r,_objectUrl:i}=this;r!==i&&w.error(`Media element src was set while attaching MediaSource (${i} > ${r})`)},this.hls=e;const t="[buffer-controller]";this.appendSource=EE(Hn(e.config.preferManagedMediaSource)),this.log=w.log.bind(w,t),this.warn=w.warn.bind(w,t),this.error=w.error.bind(w,t),this._initSourceBuffer(),this.registerListeners()}hasSourceTypes(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null,this.hls=null}registerListeners(){const{hls:e}=this;e.on(E.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(E.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(E.MANIFEST_LOADING,this.onManifestLoading,this),e.on(E.MANIFEST_PARSED,this.onManifestParsed,this),e.on(E.BUFFER_RESET,this.onBufferReset,this),e.on(E.BUFFER_APPENDING,this.onBufferAppending,this),e.on(E.BUFFER_CODECS,this.onBufferCodecs,this),e.on(E.BUFFER_EOS,this.onBufferEos,this),e.on(E.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(E.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(E.FRAG_PARSED,this.onFragParsed,this),e.on(E.FRAG_CHANGED,this.onFragChanged,this)}unregisterListeners(){const{hls:e}=this;e.off(E.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(E.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(E.MANIFEST_LOADING,this.onManifestLoading,this),e.off(E.MANIFEST_PARSED,this.onManifestParsed,this),e.off(E.BUFFER_RESET,this.onBufferReset,this),e.off(E.BUFFER_APPENDING,this.onBufferAppending,this),e.off(E.BUFFER_CODECS,this.onBufferCodecs,this),e.off(E.BUFFER_EOS,this.onBufferEos,this),e.off(E.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(E.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(E.FRAG_PARSED,this.onFragParsed,this),e.off(E.FRAG_CHANGED,this.onFragChanged,this)}_initSourceBuffer(){this.sourceBuffer={},this.operationQueue=new cT(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.appendErrors={audio:0,video:0,audiovideo:0},this.lastMpegAudioChunk=null}onManifestLoading(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){let r=2;(t.audio&&!t.video||!t.altAudio)&&(r=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=r,this.log(`${this.bufferCodecEventsExpected} bufferCodec event(s) expected`)}onMediaAttaching(e,t){const r=this.media=t.media,i=Hn(this.appendSource);if(r&&i){var s;const o=this.mediaSource=new i;this.log(`created media source: ${(s=o.constructor)==null?void 0:s.name}`),o.addEventListener("sourceopen",this._onMediaSourceOpen),o.addEventListener("sourceended",this._onMediaSourceEnded),o.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(o.addEventListener("startstreaming",this._onStartStreaming),o.addEventListener("endstreaming",this._onEndStreaming));const a=this._objectUrl=self.URL.createObjectURL(o);if(this.appendSource)try{r.removeAttribute("src");const l=self.ManagedMediaSource;r.disableRemotePlayback=r.disableRemotePlayback||l&&o instanceof l,hf(r),fT(r,a),r.load()}catch{r.src=a}else r.src=a;r.addEventListener("emptied",this._onMediaEmptied)}}onMediaDetaching(){const{media:e,mediaSource:t,_objectUrl:r}=this;if(t){if(this.log("media source detaching"),t.readyState==="open")try{t.endOfStream()}catch(i){this.warn(`onMediaDetaching: ${i.message} while calling endOfStream`)}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(t.removeEventListener("startstreaming",this._onStartStreaming),t.removeEventListener("endstreaming",this._onEndStreaming)),e&&(e.removeEventListener("emptied",this._onMediaEmptied),r&&self.URL.revokeObjectURL(r),this.mediaSrc===r?(e.removeAttribute("src"),this.appendSource&&hf(e),e.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(E.MEDIA_DETACHED,void 0)}onBufferReset(){this.getSourceBufferTypes().forEach(e=>{this.resetBuffer(e)}),this._initSourceBuffer(),this.hls.resumeBuffering()}resetBuffer(e){const t=this.sourceBuffer[e];try{if(t){var r;this.removeBufferListeners(e),this.sourceBuffer[e]=void 0,(r=this.mediaSource)!=null&&r.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(t)}}catch(i){this.warn(`onBufferReset ${e}`,i)}}onBufferCodecs(e,t){const r=this.getSourceBufferTypes().length,i=Object.keys(t);if(i.forEach(o=>{if(r){const l=this.tracks[o];if(l&&typeof l.buffer.changeType=="function"){var a;const{id:u,codec:c,levelCodec:d,container:f,metadata:h}=t[o],m=Nd(l.codec,l.levelCodec),p=m==null?void 0:m.replace(ff,"$1");let x=Nd(c,d);const y=(a=x)==null?void 0:a.replace(ff,"$1");if(x&&p!==y){o.slice(0,5)==="audio"&&(x=lo(x,this.appendSource));const v=`${f};codecs=${x}`;this.appendChangeType(o,v),this.log(`switching codec ${m} to ${x}`),this.tracks[o]={buffer:l.buffer,codec:c,container:f,levelCodec:d,metadata:h,id:u}}}}else this.pendingTracks[o]=t[o]}),r)return;const s=Math.max(this.bufferCodecEventsExpected-1,0);this.bufferCodecEventsExpected!==s&&(this.log(`${s} bufferCodec event(s) expected ${i.join(",")}`),this.bufferCodecEventsExpected=s),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks()}appendChangeType(e,t){const{operationQueue:r}=this,i={execute:()=>{const s=this.sourceBuffer[e];s&&(this.log(`changing ${e} sourceBuffer type to ${t}`),s.changeType(t)),r.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:s=>{this.warn(`Failed to change ${e} SourceBuffer type`,s)}};r.append(i,e,!!this.pendingTracks[e])}onBufferAppending(e,t){const{hls:r,operationQueue:i,tracks:s}=this,{data:o,type:a,frag:l,part:u,chunkMeta:c}=t,d=c.buffering[a],f=self.performance.now();d.start=f;const h=l.stats.buffering,m=u?u.stats.buffering:null;h.start===0&&(h.start=f),m&&m.start===0&&(m.start=f);const p=s.audio;let x=!1;a==="audio"&&(p==null?void 0:p.container)==="audio/mpeg"&&(x=!this.lastMpegAudioChunk||c.id===1||this.lastMpegAudioChunk.sn!==c.sn,this.lastMpegAudioChunk=c);const y=l.start,v={execute:()=>{if(d.executeStart=self.performance.now(),x){const S=this.sourceBuffer[a];if(S){const L=y-S.timestampOffset;Math.abs(L)>=.1&&(this.log(`Updating audio SourceBuffer timestampOffset to ${y} (delta: ${L}) sn: ${l.sn})`),S.timestampOffset=y)}}this.appendExecutor(o,a)},onStart:()=>{},onComplete:()=>{const S=self.performance.now();d.executeEnd=d.end=S,h.first===0&&(h.first=S),m&&m.first===0&&(m.first=S);const{sourceBuffer:L}=this,T={};for(const A in L)T[A]=ue.getBuffered(L[A]);this.appendErrors[a]=0,a==="audio"||a==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(E.BUFFER_APPENDED,{type:a,frag:l,part:u,chunkMeta:c,parent:l.type,timeRanges:T})},onError:S=>{const L={type:X.MEDIA_ERROR,parent:l.type,details:b.BUFFER_APPEND_ERROR,sourceBufferName:a,frag:l,part:u,chunkMeta:c,error:S,err:S,fatal:!1};if(S.code===DOMException.QUOTA_EXCEEDED_ERR)L.details=b.BUFFER_FULL_ERROR;else{const T=++this.appendErrors[a];L.details=b.BUFFER_APPEND_ERROR,this.warn(`Failed ${T}/${r.config.appendErrorMaxRetry} times to append segment in "${a}" sourceBuffer`),T>=r.config.appendErrorMaxRetry&&(L.fatal=!0)}r.trigger(E.ERROR,L)}};i.append(v,a,!!this.pendingTracks[a])}onBufferFlushing(e,t){const{operationQueue:r}=this,i=s=>({execute:this.removeExecutor.bind(this,s,t.startOffset,t.endOffset),onStart:()=>{},onComplete:()=>{this.hls.trigger(E.BUFFER_FLUSHED,{type:s})},onError:o=>{this.warn(`Failed to remove from ${s} SourceBuffer`,o)}});t.type?r.append(i(t.type),t.type):this.getSourceBufferTypes().forEach(s=>{r.append(i(s),s)})}onFragParsed(e,t){const{frag:r,part:i}=t,s=[],o=i?i.elementaryStreams:r.elementaryStreams;o[se.AUDIOVIDEO]?s.push("audiovideo"):(o[se.AUDIO]&&s.push("audio"),o[se.VIDEO]&&s.push("video"));const a=()=>{const l=self.performance.now();r.stats.buffering.end=l,i&&(i.stats.buffering.end=l);const u=i?i.stats:r.stats;this.hls.trigger(E.FRAG_BUFFERED,{frag:r,part:i,stats:u,id:r.type})};s.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${r.type} level: ${r.level} sn: ${r.sn}`),this.blockBuffers(a,s)}onFragChanged(e,t){this.trimBuffers()}onBufferEos(e,t){this.getSourceBufferTypes().reduce((i,s)=>{const o=this.sourceBuffer[s];return o&&(!t.type||t.type===s)&&(o.ending=!0,o.ended||(o.ended=!0,this.log(`${s} sourceBuffer now EOS`))),i&&!!(!o||o.ended)},!0)&&(this.log("Queueing mediaSource.endOfStream()"),this.blockBuffers(()=>{this.getSourceBufferTypes().forEach(s=>{const o=this.sourceBuffer[s];o&&(o.ending=!1)});const{mediaSource:i}=this;if(!i||i.readyState!=="open"){i&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${i.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),i.endOfStream()}))}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())}trimBuffers(){const{hls:e,details:t,media:r}=this;if(!r||t===null||!this.getSourceBufferTypes().length)return;const s=e.config,o=r.currentTime,a=t.levelTargetDuration,l=t.live&&s.liveBackBufferLength!==null?s.liveBackBufferLength:s.backBufferLength;if(G(l)&&l>0){const u=Math.max(l,a),c=Math.floor(o/a)*a-u;this.flushBackBuffer(o,a,c)}if(G(s.frontBufferFlushThreshold)&&s.frontBufferFlushThreshold>0){const u=Math.max(s.maxBufferLength,s.frontBufferFlushThreshold),c=Math.max(u,a),d=Math.floor(o/a)*a+c;this.flushFrontBuffer(o,a,d)}}flushBackBuffer(e,t,r){const{details:i,sourceBuffer:s}=this;this.getSourceBufferTypes().forEach(a=>{const l=s[a];if(l){const u=ue.getBuffered(l);if(u.length>0&&r>u.start(0)){if(this.hls.trigger(E.BACK_BUFFER_REACHED,{bufferEnd:r}),i!=null&&i.live)this.hls.trigger(E.LIVE_BACK_BUFFER_REACHED,{bufferEnd:r});else if(l.ended&&u.end(u.length-1)-e<t*2){this.log(`Cannot flush ${a} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(E.BUFFER_FLUSHING,{startOffset:0,endOffset:r,type:a})}}})}flushFrontBuffer(e,t,r){const{sourceBuffer:i}=this;this.getSourceBufferTypes().forEach(o=>{const a=i[o];if(a){const l=ue.getBuffered(a),u=l.length;if(u<2)return;const c=l.start(u-1),d=l.end(u-1);if(r>c||e>=c&&e<=d)return;if(a.ended&&e-d<2*t){this.log(`Cannot flush ${o} front buffer while SourceBuffer is in ended state`);return}this.hls.trigger(E.BUFFER_FLUSHING,{startOffset:c,endOffset:1/0,type:o})}})}updateMediaElementDuration(){if(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")return;const{details:e,hls:t,media:r,mediaSource:i}=this,s=e.fragments[0].start+e.totalduration,o=r.duration,a=G(i.duration)?i.duration:0;e.live&&t.config.liveDurationInfinity?(i.duration=1/0,this.updateSeekableRange(e)):(s>a&&s>o||!G(o))&&(this.log(`Updating Media Source duration to ${s.toFixed(3)}`),i.duration=s)}updateSeekableRange(e){const t=this.mediaSource,r=e.fragments;if(r.length&&e.live&&t!=null&&t.setLiveSeekableRange){const s=Math.max(0,r[0].start),o=Math.max(s,s+e.totalduration);this.log(`Media Source duration is set to ${t.duration}. Setting seekable range to ${s}-${o}.`),t.setLiveSeekableRange(s,o)}}checkPendingTracks(){const{bufferCodecEventsExpected:e,operationQueue:t,pendingTracks:r}=this,i=Object.keys(r).length;if(i&&(!e||i===2||"audiovideo"in r)){this.createSourceBuffers(r),this.pendingTracks={};const s=this.getSourceBufferTypes();if(s.length)this.hls.trigger(E.BUFFER_CREATED,{tracks:this.tracks}),s.forEach(o=>{t.executeNext(o)});else{const o=new Error("could not create source buffer for media codec(s)");this.hls.trigger(E.ERROR,{type:X.MEDIA_ERROR,details:b.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:o,reason:o.message})}}}createSourceBuffers(e){const{sourceBuffer:t,mediaSource:r}=this;if(!r)throw Error("createSourceBuffers called when mediaSource was null");for(const s in e)if(!t[s]){var i;const o=e[s];if(!o)throw Error(`source buffer exists for track ${s}, however track does not`);let a=((i=o.levelCodec)==null?void 0:i.indexOf(","))===-1?o.levelCodec:o.codec;a&&s.slice(0,5)==="audio"&&(a=lo(a,this.appendSource));const l=`${o.container};codecs=${a}`;this.log(`creating sourceBuffer(${l})`);try{const u=t[s]=r.addSourceBuffer(l),c=s;this.addBufferListener(c,"updatestart",this._onSBUpdateStart),this.addBufferListener(c,"updateend",this._onSBUpdateEnd),this.addBufferListener(c,"error",this._onSBUpdateError),this.appendSource&&this.addBufferListener(c,"bufferedchange",(d,f)=>{const h=f.removedRanges;h!=null&&h.length&&this.hls.trigger(E.BUFFER_FLUSHED,{type:s})}),this.tracks[s]={buffer:u,codec:a,container:o.container,levelCodec:o.levelCodec,metadata:o.metadata,id:o.id}}catch(u){this.error(`error while trying to add sourceBuffer: ${u.message}`),this.hls.trigger(E.ERROR,{type:X.MEDIA_ERROR,details:b.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:u,sourceBufferName:s,mimeType:l})}}}get mediaSrc(){var e,t;const r=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return r==null?void 0:r.src}_onSBUpdateStart(e){const{operationQueue:t}=this;t.current(e).onStart()}_onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const{operationQueue:r}=this;r.current(e).onComplete(),r.shiftAndExecuteNext(e)}_onSBUpdateError(e,t){var r;const i=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(r=this.mediaSource)==null?void 0:r.readyState}`);this.error(`${i}`,t),this.hls.trigger(E.ERROR,{type:X.MEDIA_ERROR,details:b.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:i,fatal:!1});const s=this.operationQueue.current(e);s&&s.onError(i)}removeExecutor(e,t,r){const{media:i,mediaSource:s,operationQueue:o,sourceBuffer:a}=this,l=a[e];if(!i||!s||!l){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),o.shiftAndExecuteNext(e);return}const u=G(i.duration)?i.duration:1/0,c=G(s.duration)?s.duration:1/0,d=Math.max(0,t),f=Math.min(r,u,c);f>d&&(!l.ending||l.ended)?(l.ended=!1,this.log(`Removing [${d},${f}] from the ${e} SourceBuffer`),l.remove(d,f)):o.shiftAndExecuteNext(e)}appendExecutor(e,t){const r=this.sourceBuffer[t];if(!r){if(!this.pendingTracks[t])throw new Error(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);return}r.ended=!1,r.appendBuffer(e)}blockBuffers(e,t=this.getSourceBufferTypes()){if(!t.length){this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);return}const{operationQueue:r}=this,i=t.map(s=>r.appendBlocker(s));Promise.all(i).then(()=>{e(),t.forEach(s=>{const o=this.sourceBuffer[s];o!=null&&o.updating||r.shiftAndExecuteNext(s)})})}getSourceBufferTypes(){return Object.keys(this.sourceBuffer)}addBufferListener(e,t,r){const i=this.sourceBuffer[e];if(!i)return;const s=r.bind(this,e);this.listeners[e].push({event:t,listener:s}),i.addEventListener(t,s)}removeBufferListeners(e){const t=this.sourceBuffer[e];t&&this.listeners[e].forEach(r=>{t.removeEventListener(r.event,r.listener)})}}function hf(n){const e=n.querySelectorAll("source");[].slice.call(e).forEach(t=>{n.removeChild(t)})}function fT(n,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,n.appendChild(t)}const hT={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},H0=n=>String.fromCharCode(hT[n]||n),pt=15,$t=100,mT={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},gT={17:2,18:4,21:6,22:8,23:10,19:13,20:15},pT={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},yT={25:2,26:4,29:6,30:8,31:10,27:13,28:15},xT=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class vT{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const r=typeof t=="function"?t():t;w.log(`${this.time} [${e}] ${r}`)}}}const wn=function(e){const t=[];for(let r=0;r<e.length;r++)t.push(e[r].toString(16));return t};class z0{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let r=0;r<t.length;r++){const i=t[r];e.hasOwnProperty(i)&&(this[i]=e[i])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class ET{constructor(){this.uchar=" ",this.penState=new z0}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class ST{constructor(e){this.chars=[],this.pos=0,this.currPenState=new z0,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<$t;t++)this.chars.push(new ET);this.logger=e}equals(e){for(let t=0;t<$t;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<$t;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<$t;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>$t&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=$t)}moveCursor(e){const t=this.pos+e;if(e>1)for(let r=this.pos+1;r<t+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=H0(e);if(this.pos>=$t){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<$t;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let r=0;r<$t;r++){const i=this.chars[r].uchar;i!==" "&&(t=!1),e.push(i)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class Ca{constructor(e){this.rows=[],this.currRow=pt-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<pt;t++)this.rows.push(new ST(e));this.logger=e}reset(){for(let e=0;e<pt;e++)this.rows[e].clear();this.currRow=pt-1}equals(e){let t=!0;for(let r=0;r<pt;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t}copy(e){for(let t=0;t<pt;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<pt;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+JSON.stringify(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let a=0;a<pt;a++)this.rows[a].clear();const s=this.currRow+1-this.nrRollUpRows,o=this.lastOutputScreen;if(o){const a=o.rows[s].cueStartTime,l=this.logger.time;if(a!==null&&l!==null&&a<l)for(let u=0;u<this.nrRollUpRows;u++)this.rows[t-this.nrRollUpRows+u+1].copy(o.rows[s+u])}}this.currRow=t;const r=this.rows[this.currRow];if(e.indent!==null){const s=e.indent,o=Math.max(s-1,0);r.setCursor(e.indent),e.color=r.chars[o].penState.foreground}const i={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(i)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let r="",i=-1;for(let s=0;s<pt;s++){const o=this.rows[s].getTextString();o&&(i=s+1,e?t.push("Row "+i+": '"+o+"'"):t.push(o.trim()))}return t.length>0&&(e?r="["+t.join(" | ")+"]":r=t.join(`
`)),r}getTextAndFormat(){return this.rows}}class mf{constructor(e,t,r){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Ca(r),this.nonDisplayedMemory=new Ca(r),this.lastOutputScreen=new Ca(r),this.currRollUpRow=this.displayedMemory.rows[pt-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=r}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[pt-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let r=0;r<e.length;r++)this.writeScreen.insertChar(e[r]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const r=Math.floor(e/2)-16,i=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=i[r]}this.logger.log(2,"MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class gf{constructor(e,t,r){this.channels=void 0,this.currentChannel=0,this.cmdHistory=LT(),this.logger=void 0;const i=this.logger=new vT;this.channels=[null,new mf(e,t,i),new mf(e+1,r,i)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let r=0;r<t.length;r+=2){const i=t[r]&127,s=t[r+1]&127;let o=!1,a=null;if(i===0&&s===0)continue;this.logger.log(3,()=>"["+wn([t[r],t[r+1]])+"] -> ("+wn([i,s])+")");const l=this.cmdHistory;if(i>=16&&i<=31){if(TT(i,s,l)){as(null,null,l),this.logger.log(3,()=>"Repeated command ("+wn([i,s])+") is dropped");continue}as(i,s,this.cmdHistory),o=this.parseCmd(i,s),o||(o=this.parseMidrow(i,s)),o||(o=this.parsePAC(i,s)),o||(o=this.parseBackgroundAttributes(i,s))}else as(null,null,l);if(!o&&(a=this.parseChars(i,s),a)){const c=this.currentChannel;c&&c>0?this.channels[c].insertChars(a):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!o&&!a&&this.logger.log(2,()=>"Couldn't parse cleaned data "+wn([i,s])+" orig: "+wn([t[r],t[r+1]]))}}parseCmd(e,t){const r=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,i=(e===23||e===31)&&t>=33&&t<=35;if(!(r||i))return!1;const s=e===20||e===21||e===23?1:2,o=this.channels[s];return e===20||e===21||e===28||e===29?t===32?o.ccRCL():t===33?o.ccBS():t===34?o.ccAOF():t===35?o.ccAON():t===36?o.ccDER():t===37?o.ccRU(2):t===38?o.ccRU(3):t===39?o.ccRU(4):t===40?o.ccFON():t===41?o.ccRDC():t===42?o.ccTR():t===43?o.ccRTD():t===44?o.ccEDM():t===45?o.ccCR():t===46?o.ccENM():t===47&&o.ccEOC():o.ccTO(t-32),this.currentChannel=s,!0}parseMidrow(e,t){let r=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?r=1:r=2,r!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const i=this.channels[r];return i?(i.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+wn([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let r;const i=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,s=(e===16||e===24)&&t>=64&&t<=95;if(!(i||s))return!1;const o=e<=23?1:2;t>=64&&t<=95?r=o===1?mT[e]:pT[e]:r=o===1?gT[e]:yT[e];const a=this.channels[o];return a?(a.setPAC(this.interpretPAC(r,t)),this.currentChannel=o,!0):!1}interpretPAC(e,t){let r;const i={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?r=t-96:r=t-64,i.underline=(r&1)===1,r<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(i.italics=!0,i.color="white"):i.indent=Math.floor((r-16)/2)*4,i}parseChars(e,t){let r,i=null,s=null;if(e>=25?(r=2,s=e-8):(r=1,s=e),s>=17&&s<=19){let o;s===17?o=t+80:s===18?o=t+112:o=t+144,this.logger.log(2,()=>"Special char '"+H0(o)+"' in channel "+r),i=[o]}else e>=32&&e<=127&&(i=t===0?[e]:[e,t]);return i&&this.logger.log(3,()=>"Char codes =  "+wn(i).join(",")),i}parseBackgroundAttributes(e,t){const r=(e===16||e===24)&&t>=32&&t<=47,i=(e===23||e===31)&&t>=45&&t<=47;if(!(r||i))return!1;let s;const o={};e===16||e===24?(s=Math.floor((t-32)/2),o.background=xT[s],t%2===1&&(o.background=o.background+"_semi")):t===45?o.background="transparent":(o.foreground="black",t===47&&(o.underline=!0));const a=e<=23?1:2;return this.channels[a].setBkgData(o),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}as(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const r=this.channels[t];r&&r.cueSplitAtTime(e)}}}function as(n,e,t){t.a=n,t.b=e}function TT(n,e,t){return t.a===n&&t.b===e}function LT(){return{a:null,b:null}}class ls{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,r){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}var sc=function(){if(wr!=null&&wr.VTTCue)return self.VTTCue;const n=["","lr","rl"],e=["start","middle","end","left","right"];function t(a,l){if(typeof l!="string"||!Array.isArray(a))return!1;const u=l.toLowerCase();return~a.indexOf(u)?u:!1}function r(a){return t(n,a)}function i(a){return t(e,a)}function s(a,...l){let u=1;for(;u<arguments.length;u++){const c=arguments[u];for(const d in c)a[d]=c[d]}return a}function o(a,l,u){const c=this,d={enumerable:!0};c.hasBeenReset=!1;let f="",h=!1,m=a,p=l,x=u,y=null,v="",S=!0,L="auto",T="start",A=50,R="middle",k=50,_="middle";Object.defineProperty(c,"id",s({},d,{get:function(){return f},set:function(C){f=""+C}})),Object.defineProperty(c,"pauseOnExit",s({},d,{get:function(){return h},set:function(C){h=!!C}})),Object.defineProperty(c,"startTime",s({},d,{get:function(){return m},set:function(C){if(typeof C!="number")throw new TypeError("Start time must be set to a number.");m=C,this.hasBeenReset=!0}})),Object.defineProperty(c,"endTime",s({},d,{get:function(){return p},set:function(C){if(typeof C!="number")throw new TypeError("End time must be set to a number.");p=C,this.hasBeenReset=!0}})),Object.defineProperty(c,"text",s({},d,{get:function(){return x},set:function(C){x=""+C,this.hasBeenReset=!0}})),Object.defineProperty(c,"region",s({},d,{get:function(){return y},set:function(C){y=C,this.hasBeenReset=!0}})),Object.defineProperty(c,"vertical",s({},d,{get:function(){return v},set:function(C){const P=r(C);if(P===!1)throw new SyntaxError("An invalid or illegal string was specified.");v=P,this.hasBeenReset=!0}})),Object.defineProperty(c,"snapToLines",s({},d,{get:function(){return S},set:function(C){S=!!C,this.hasBeenReset=!0}})),Object.defineProperty(c,"line",s({},d,{get:function(){return L},set:function(C){if(typeof C!="number"&&C!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");L=C,this.hasBeenReset=!0}})),Object.defineProperty(c,"lineAlign",s({},d,{get:function(){return T},set:function(C){const P=i(C);if(!P)throw new SyntaxError("An invalid or illegal string was specified.");T=P,this.hasBeenReset=!0}})),Object.defineProperty(c,"position",s({},d,{get:function(){return A},set:function(C){if(C<0||C>100)throw new Error("Position must be between 0 and 100.");A=C,this.hasBeenReset=!0}})),Object.defineProperty(c,"positionAlign",s({},d,{get:function(){return R},set:function(C){const P=i(C);if(!P)throw new SyntaxError("An invalid or illegal string was specified.");R=P,this.hasBeenReset=!0}})),Object.defineProperty(c,"size",s({},d,{get:function(){return k},set:function(C){if(C<0||C>100)throw new Error("Size must be between 0 and 100.");k=C,this.hasBeenReset=!0}})),Object.defineProperty(c,"align",s({},d,{get:function(){return _},set:function(C){const P=i(C);if(!P)throw new SyntaxError("An invalid or illegal string was specified.");_=P,this.hasBeenReset=!0}})),c.displayState=void 0}return o.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},o}();class RT{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function W0(n){function e(r,i,s,o){return(r|0)*3600+(i|0)*60+(s|0)+parseFloat(o||0)}const t=n.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class AT{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,r){return r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,r){for(let i=0;i<r.length;++i)if(t===r[i]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const r=parseFloat(t);if(r>=0&&r<=100)return this.set(e,r),!0}return!1}}function Y0(n,e,t,r){const i=r?n.split(r):[n];for(const s in i){if(typeof i[s]!="string")continue;const o=i[s].split(t);if(o.length!==2)continue;const a=o[0],l=o[1];e(a,l)}}const $l=new sc(0,0,""),us=$l.align==="middle"?"middle":"center";function wT(n,e,t){const r=n;function i(){const a=W0(n);if(a===null)throw new Error("Malformed timestamp: "+r);return n=n.replace(/^[^\sa-zA-Z-]+/,""),a}function s(a,l){const u=new AT;Y0(a,function(f,h){let m;switch(f){case"region":for(let p=t.length-1;p>=0;p--)if(t[p].id===h){u.set(f,t[p].region);break}break;case"vertical":u.alt(f,h,["rl","lr"]);break;case"line":m=h.split(","),u.integer(f,m[0]),u.percent(f,m[0])&&u.set("snapToLines",!1),u.alt(f,m[0],["auto"]),m.length===2&&u.alt("lineAlign",m[1],["start",us,"end"]);break;case"position":m=h.split(","),u.percent(f,m[0]),m.length===2&&u.alt("positionAlign",m[1],["start",us,"end","line-left","line-right","auto"]);break;case"size":u.percent(f,h);break;case"align":u.alt(f,h,["start",us,"end","left","right"]);break}},/:/,/\s/),l.region=u.get("region",null),l.vertical=u.get("vertical","");let c=u.get("line","auto");c==="auto"&&$l.line===-1&&(c=-1),l.line=c,l.lineAlign=u.get("lineAlign","start"),l.snapToLines=u.get("snapToLines",!0),l.size=u.get("size",100),l.align=u.get("align",us);let d=u.get("position","auto");d==="auto"&&$l.position===50&&(d=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=d}function o(){n=n.replace(/^\s+/,"")}if(o(),e.startTime=i(),o(),n.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+r);n=n.slice(3),o(),e.endTime=i(),o(),s(n,e)}function q0(n){return n.replace(/<br(?: \/)?>/gi,`
`)}class CT{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new RT,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function r(){let s=t.buffer,o=0;for(s=q0(s);o<s.length&&s[o]!=="\r"&&s[o]!==`
`;)++o;const a=s.slice(0,o);return s[o]==="\r"&&++o,s[o]===`
`&&++o,t.buffer=s.slice(o),a}function i(s){Y0(s,function(o,a){},/:/)}try{let s="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;s=r();const a=s.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!(a!=null&&a[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let o=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(o?o=!1:s=r(),t.state){case"HEADER":/:/.test(s)?i(s):s||(t.state="ID");continue;case"NOTE":s||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(s)){t.state="NOTE";break}if(!s)continue;if(t.cue=new sc(0,0,""),t.state="CUE",s.indexOf("-->")===-1){t.cue.id=s;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{wT(s,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const a=s.indexOf("-->")!==-1;if(!s||a&&(o=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=s}continue;case"BADCUE":s||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const IT=/\r\n|\n\r|\n|\r/g,Ia=function(e,t,r=0){return e.slice(r,r+t.length)===t},kT=function(e){let t=parseInt(e.slice(-3));const r=parseInt(e.slice(-6,-4)),i=parseInt(e.slice(-9,-7)),s=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!G(t)||!G(r)||!G(i)||!G(s))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*r,t+=60*1e3*i,t+=60*60*1e3*s,t},ka=function(e){let t=5381,r=e.length;for(;r;)t=t*33^e.charCodeAt(--r);return(t>>>0).toString()};function oc(n,e,t){return ka(n.toString())+ka(e.toString())+ka(t)}const bT=function(e,t,r){let i=e[t],s=e[i.prevCC];if(!s||!s.new&&i.new){e.ccOffset=e.presentationOffset=i.start,i.new=!1;return}for(;(o=s)!=null&&o.new;){var o;e.ccOffset+=i.start-s.start,i.new=!1,i=s,s=e[i.prevCC]}e.presentationOffset=r};function DT(n,e,t,r,i,s,o){const a=new CT,l=Pt(new Uint8Array(n)).trim().replace(IT,`
`).split(`
`),u=[],c=e?YS(e.baseTime,e.timescale):0;let d="00:00.000",f=0,h=0,m,p=!0;a.oncue=function(x){const y=t[r];let v=t.ccOffset;const S=(f-c)/9e4;if(y!=null&&y.new&&(h!==void 0?v=t.ccOffset=y.start:bT(t,r,S)),S){if(!e){m=new Error("Missing initPTS for VTT MPEGTS");return}v=S-t.presentationOffset}const L=x.endTime-x.startTime,T=ot((x.startTime+v-h)*9e4,i*9e4)/9e4;x.startTime=Math.max(T,0),x.endTime=Math.max(T+L,0);const A=x.text.trim();x.text=decodeURIComponent(encodeURIComponent(A)),x.id||(x.id=oc(x.startTime,x.endTime,A)),x.endTime>0&&u.push(x)},a.onparsingerror=function(x){m=x},a.onflush=function(){if(m){o(m);return}s(u)},l.forEach(x=>{if(p)if(Ia(x,"X-TIMESTAMP-MAP=")){p=!1,x.slice(16).split(",").forEach(y=>{Ia(y,"LOCAL:")?d=y.slice(6):Ia(y,"MPEGTS:")&&(f=parseInt(y.slice(7)))});try{h=kT(d)/1e3}catch(y){m=y}return}else x===""&&(p=!1);a.parse(x+`
`)}),a.flush()}const ba="stpp.ttml.im1t",X0=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,Q0=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,_T={left:"start",center:"center",right:"end",start:"start",end:"end"};function pf(n,e,t,r){const i=Q(new Uint8Array(n),["mdat"]);if(i.length===0){r(new Error("Could not parse IMSC1 mdat"));return}const s=i.map(a=>Pt(a)),o=WS(e.baseTime,1,e.timescale);try{s.forEach(a=>t(NT(a,o)))}catch(a){r(a)}}function NT(n,e){const i=new DOMParser().parseFromString(n,"text/xml").getElementsByTagName("tt")[0];if(!i)throw new Error("Invalid ttml");const s={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},o=Object.keys(s).reduce((d,f)=>(d[f]=i.getAttribute(`ttp:${f}`)||s[f],d),{}),a=i.getAttribute("xml:space")!=="preserve",l=yf(Da(i,"styling","style")),u=yf(Da(i,"layout","region")),c=Da(i,"body","[begin]");return[].map.call(c,d=>{const f=J0(d,a);if(!f||!d.hasAttribute("begin"))return null;const h=Na(d.getAttribute("begin"),o),m=Na(d.getAttribute("dur"),o);let p=Na(d.getAttribute("end"),o);if(h===null)throw xf(d);if(p===null){if(m===null)throw xf(d);p=h+m}const x=new sc(h-e,p-e,f);x.id=oc(x.startTime,x.endTime,x.text);const y=u[d.getAttribute("region")],v=l[d.getAttribute("style")],S=PT(y,v,l),{textAlign:L}=S;if(L){const T=_T[L];T&&(x.lineAlign=T),x.align=L}return Te(x,S),x}).filter(d=>d!==null)}function Da(n,e,t){const r=n.getElementsByTagName(e)[0];return r?[].slice.call(r.querySelectorAll(t)):[]}function yf(n){return n.reduce((e,t)=>{const r=t.getAttribute("xml:id");return r&&(e[r]=t),e},{})}function J0(n,e){return[].slice.call(n.childNodes).reduce((t,r,i)=>{var s;return r.nodeName==="br"&&i?t+`
`:(s=r.childNodes)!=null&&s.length?J0(r,e):e?t+r.textContent.trim().replace(/\s+/g," "):t+r.textContent},"")}function PT(n,e,t){const r="http://www.w3.org/ns/ttml#styling";let i=null;const s=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],o=n!=null&&n.hasAttribute("style")?n.getAttribute("style"):null;return o&&t.hasOwnProperty(o)&&(i=t[o]),s.reduce((a,l)=>{const u=_a(e,r,l)||_a(n,r,l)||_a(i,r,l);return u&&(a[l]=u),a},{})}function _a(n,e,t){return n&&n.hasAttributeNS(e,t)?n.getAttributeNS(e,t):null}function xf(n){return new Error(`Could not parse ttml timestamp ${n}`)}function Na(n,e){if(!n)return null;let t=W0(n);return t===null&&(X0.test(n)?t=FT(n,e):Q0.test(n)&&(t=OT(n,e))),t}function FT(n,e){const t=X0.exec(n),r=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+r/e.frameRate}function OT(n,e){const t=Q0.exec(n),r=Number(t[1]);switch(t[2]){case"h":return r*3600;case"m":return r*60;case"ms":return r*1e3;case"f":return r/e.frameRate;case"t":return r/e.tickRate}return r}class MT{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Ef(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(E.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(E.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(E.MANIFEST_LOADING,this.onManifestLoading,this),e.on(E.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(E.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(E.FRAG_LOADING,this.onFragLoading,this),e.on(E.FRAG_LOADED,this.onFragLoaded,this),e.on(E.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(E.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(E.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(E.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(E.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(E.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(E.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(E.MANIFEST_LOADING,this.onManifestLoading,this),e.off(E.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(E.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(E.FRAG_LOADING,this.onFragLoading,this),e.off(E.FRAG_LOADED,this.onFragLoaded,this),e.off(E.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(E.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(E.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(E.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(E.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){if(this.config.enableCEA708Captions&&(!this.cea608Parser1||!this.cea608Parser2)){const e=new ls(this,"textTrack1"),t=new ls(this,"textTrack2"),r=new ls(this,"textTrack3"),i=new ls(this,"textTrack4");this.cea608Parser1=new gf(1,e,t),this.cea608Parser2=new gf(3,r,i)}}addCues(e,t,r,i,s){let o=!1;for(let a=s.length;a--;){const l=s[a],u=UT(l[0],l[1],t,r);if(u>=0&&(l[0]=Math.min(l[0],t),l[1]=Math.max(l[1],r),o=!0,u/(r-t)>.5))return}if(o||s.push([t,r]),this.config.renderTextTracksNatively){const a=this.captionsTracks[e];this.Cues.newCue(a,t,r,i)}else{const a=this.Cues.newCue(null,t,r,i);this.hls.trigger(E.CUES_PARSED,{type:"captions",cues:a,track:e})}}onInitPtsFound(e,{frag:t,id:r,initPTS:i,timescale:s}){const{unparsedVttFrags:o}=this;r==="main"&&(this.initPTS[t.cc]={baseTime:i,timescale:s}),o.length&&(this.unparsedVttFrags=[],o.forEach(a=>{this.onFragLoaded(E.FRAG_LOADED,a)}))}getExistingTrack(e,t){const{media:r}=this;if(r)for(let i=0;i<r.textTracks.length;i++){const s=r.textTracks[i];if(vf(s,{name:e,lang:t,attrs:{}}))return s}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:r,media:i}=this,{label:s,languageCode:o}=t[e],a=this.getExistingTrack(s,o);if(a)r[e]=a,dr(r[e]),x0(r[e],i);else{const l=this.createTextTrack("captions",s,o);l&&(l[e]=!0,r[e]=l)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const r=t.label,i={_id:e,label:r,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=i,this.hls.trigger(E.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[i]})}createTextTrack(e,t,r){const i=this.media;if(i)return i.addTextTrack(e,t,r)}onMediaAttaching(e,t){this.media=t.media,this._cleanTracks()}onMediaDetaching(){const{captionsTracks:e}=this;Object.keys(e).forEach(t=>{dr(e[t]),delete e[t]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Ef(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let r=0;r<t.length;r++)dr(t[r])}onSubtitleTracksUpdated(e,t){const r=t.subtitleTracks||[],i=r.some(s=>s.textCodec===ba);if(this.config.enableWebVTT||i&&this.config.enableIMSC1){if(K0(this.tracks,r)){this.tracks=r;return}if(this.textTracks=[],this.tracks=r,this.config.renderTextTracksNatively){const o=this.media,a=o?ws(o.textTracks):null;if(this.tracks.forEach((l,u)=>{let c;if(a){let d=null;for(let f=0;f<a.length;f++)if(a[f]&&vf(a[f],l)){d=a[f],a[f]=null;break}d&&(c=d)}if(c)dr(c);else{const d=Z0(l);c=this.createTextTrack(d,l.name,l.lang),c&&(c.mode="disabled")}c&&this.textTracks.push(c)}),a!=null&&a.length){const l=a.filter(u=>u!==null).map(u=>u.label);l.length&&w.warn(`Media element contains unused subtitle tracks: ${l.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const o=this.tracks.map(a=>({label:a.name,kind:a.type.toLowerCase(),default:a.default,subtitleTrack:a}));this.hls.trigger(E.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:o})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(r=>{const i=/(?:CC|SERVICE)([1-4])/.exec(r.instreamId);if(!i)return;const s=`textTrack${i[1]}`,o=this.captionsProperties[s];o&&(o.label=r.name,r.lang&&(o.languageCode=r.lang),o.media=r)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===W.MAIN){var r,i;const{cea608Parser1:s,cea608Parser2:o,lastSn:a}=this,{cc:l,sn:u}=t.frag,c=(r=(i=t.part)==null?void 0:i.index)!=null?r:-1;s&&o&&(u!==a+1||u===a&&c!==this.lastPartIndex+1||l!==this.lastCc)&&(s.reset(),o.reset()),this.lastCc=l,this.lastSn=u,this.lastPartIndex=c}}onFragLoaded(e,t){const{frag:r,payload:i}=t;if(r.type===W.SUBTITLE)if(i.byteLength){const s=r.decryptdata,o="stats"in t;if(s==null||!s.encrypted||o){const a=this.tracks[r.level],l=this.vttCCs;l[r.cc]||(l[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),a&&a.textCodec===ba?this._parseIMSC1(r,i):this._parseVTTs(t)}}else this.hls.trigger(E.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const r=this.hls;pf(t,this.initPTS[e.cc],i=>{this._appendCues(i,e.level),r.trigger(E.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},i=>{w.log(`Failed to parse IMSC1: ${i}`),r.trigger(E.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:i})})}_parseVTTs(e){var t;const{frag:r,payload:i}=e,{initPTS:s,unparsedVttFrags:o}=this,a=s.length-1;if(!s[r.cc]&&a===-1){o.push(e);return}const l=this.hls,u=(t=r.initSegment)!=null&&t.data?ht(r.initSegment.data,new Uint8Array(i)):i;DT(u,this.initPTS[r.cc],this.vttCCs,r.cc,r.start,c=>{this._appendCues(c,r.level),l.trigger(E.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:r})},c=>{const d=c.message==="Missing initPTS for VTT MPEGTS";d?o.push(e):this._fallbackToIMSC1(r,i),w.log(`Failed to parse VTT cue: ${c}`),!(d&&a>r.cc)&&l.trigger(E.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:c})})}_fallbackToIMSC1(e,t){const r=this.tracks[e.level];r.textCodec||pf(t,this.initPTS[e.cc],()=>{r.textCodec=ba,this._parseIMSC1(e,t)},()=>{r.textCodec="wvtt"})}_appendCues(e,t){const r=this.hls;if(this.config.renderTextTracksNatively){const i=this.textTracks[t];if(!i||i.mode==="disabled")return;e.forEach(s=>v0(i,s))}else{const i=this.tracks[t];if(!i)return;const s=i.default?"default":"subtitles"+t;r.trigger(E.CUES_PARSED,{type:"subtitles",cues:e,track:s})}}onFragDecrypted(e,t){const{frag:r}=t;r.type===W.SUBTITLE&&this.onFragLoaded(E.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){this.initCea608Parsers();const{cea608Parser1:r,cea608Parser2:i}=this;if(!this.enabled||!r||!i)return;const{frag:s,samples:o}=t;if(!(s.type===W.MAIN&&this.closedCaptionsForLevel(s)==="NONE"))for(let a=0;a<o.length;a++){const l=o[a].bytes;if(l){const u=this.extractCea608Data(l);r.addData(o[a].pts,u[0]),i.addData(o[a].pts,u[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:r,endOffsetSubtitles:i,type:s}){const{media:o}=this;if(!(!o||o.currentTime<r)){if(!s||s==="video"){const{captionsTracks:a}=this;Object.keys(a).forEach(l=>Nl(a[l],t,r))}if(this.config.renderTextTracksNatively&&t===0&&i!==void 0){const{textTracks:a}=this;Object.keys(a).forEach(l=>Nl(a[l],t,i))}}}extractCea608Data(e){const t=[[],[]],r=e[0]&31;let i=2;for(let s=0;s<r;s++){const o=e[i++],a=127&e[i++],l=127&e[i++];if(a===0&&l===0)continue;if((4&o)!==0){const c=3&o;(c===0||c===1)&&(t[c].push(a),t[c].push(l))}}return t}}function Z0(n){return n.characteristics&&/transcribes-spoken-dialog/gi.test(n.characteristics)&&/describes-music-and-sound/gi.test(n.characteristics)?"captions":"subtitles"}function vf(n,e){return!!n&&n.kind===Z0(e)&&Bl(e,n)}function UT(n,e,t,r){return Math.min(e,r)-Math.max(n,t)}function Ef(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}class ac{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(E.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(E.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(E.MANIFEST_PARSED,this.onManifestParsed,this),e.on(E.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(E.BUFFER_CODECS,this.onBufferCodecs,this),e.on(E.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(E.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(E.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(E.MANIFEST_PARSED,this.onManifestParsed,this),e.off(E.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(E.BUFFER_CODECS,this.onBufferCodecs,this),e.off(E.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const r=this.hls.levels[t.droppedLevel];this.isLevelAllowed(r)&&this.restrictedLevels.push({bitrate:r.bitrate,height:r.height,width:r.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const r=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,r.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&G(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping()}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,r=this.getMaxLevel(e.length-1);r!==this.autoLevelCapping&&w.log(`Setting autoLevelCapping to ${r}: ${e[r].height}p@${e[r].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=r,t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const r=t.filter((i,s)=>this.isLevelAllowed(i)&&s<=e);return this.clientRect=null,ac.getMaxLevelByMediaSize(r,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const r=e.getBoundingClientRect();t.width=r.width,t.height=r.height,!t.width&&!t.height&&(t.width=r.right-r.left||e.width||0,t.height=r.bottom-r.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return e}isLevelAllowed(e){return!this.restrictedLevels.some(r=>e.bitrate===r.bitrate&&e.width===r.width&&e.height===r.height)}static getMaxLevelByMediaSize(e,t,r){if(!(e!=null&&e.length))return-1;const i=(a,l)=>l?a.width!==l.width||a.height!==l.height:!0;let s=e.length-1;const o=Math.max(t,r);for(let a=0;a<e.length;a+=1){const l=e[a];if((l.width>=o||l.height>=o)&&i(l,e[a+1])){s=a;break}}return s}}class BT{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(E.MEDIA_ATTACHING,this.onMediaAttaching,this)}unregisterListeners(){this.hls.off(E.MEDIA_ATTACHING,this.onMediaAttaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const r=this.hls.config;if(r.capLevelOnFPSDrop){const i=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=i,i&&typeof i.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}}checkFPS(e,t,r){const i=performance.now();if(t){if(this.lastTime){const s=i-this.lastTime,o=r-this.lastDroppedFrames,a=t-this.lastDecodedFrames,l=1e3*o/s,u=this.hls;if(u.trigger(E.FPS_DROP,{currentDropped:o,currentDecoded:a,totalDroppedFrames:r}),l>0&&o>u.config.fpsDroppedMonitoringThreshold*a){let c=u.currentLevel;w.warn("drop FPS ratio greater than max allowed value for currentLevel: "+c),c>0&&(u.autoLevelCapping===-1||u.autoLevelCapping>=c)&&(c=c-1,u.trigger(E.FPS_DROP_LEVEL_CAPPING,{level:c,droppedLevel:u.currentLevel}),u.autoLevelCapping=c,this.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=r,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}const cs="[eme]";class xr{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=xr.CDMCleanupPromise?[xr.CDMCleanupPromise]:[],this.debug=w.debug.bind(w,cs),this.log=w.log.bind(w,cs),this.warn=w.warn.bind(w,cs),this.error=w.error.bind(w,cs),this.onMediaEncrypted=t=>{const{initDataType:r,initData:i}=t,s=`"${t.type}" event: init data type: "${r}"`;if(this.debug(s),i!==null){if(!this.keyFormatPromise){let o=Object.keys(this.keySystemAccessPromises);o.length||(o=es(this.config));const a=o.map(ga).filter(l=>!!l);this.keyFormatPromise=this.getKeyFormatPromise(a)}this.keyFormatPromise.then(o=>{const a=ha(o);let l,u;if(r==="sinf"){if(a!==ie.FAIRPLAY){this.warn(`Ignoring unexpected "${t.type}" event with init data type: "${r}" for selected key-system ${a}`);return}const m=Le(new Uint8Array(i));try{const p=zu(JSON.parse(m).sinf),x=h0(p);if(!x)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");l=x.subarray(8,24),u=ie.FAIRPLAY}catch(p){this.warn(`${s} Failed to parse sinf: ${p}`);return}}else{if(a!==ie.WIDEVINE&&a!==ie.PLAYREADY){this.warn(`Ignoring unexpected "${t.type}" event with init data type: "${r}" for selected key-system ${a}`);return}const m=pE(i),p=m.filter(y=>!!y.systemId&&ma(y.systemId)===a);p.length>1&&this.warn(`${s} Using first of ${p.length} pssh found for selected key-system ${a}`);const x=p[0];if(!x){m.length===0||m.some(y=>!y.systemId)?this.warn(`${s} contains incomplete or invalid pssh data`):this.log(`ignoring ${s} for ${m.map(y=>ma(y.systemId)).join(",")} pssh data in favor of playlist keys`);return}if(u=ma(x.systemId),x.version===0&&x.data)if(u===ie.WIDEVINE){const y=x.data.length-22;l=x.data.subarray(y,y+16)}else u===ie.PLAYREADY&&(l=s0(x.data))}if(!u||!l){this.log(`Unable to handle ${s} with key-system ${a}`);return}const c=Ct.hexDump(l),{keyIdToKeySessionPromise:d,mediaKeySessions:f}=this;let h=d[c];for(let m=0;m<f.length;m++){const p=f[m],x=p.decryptdata;if(!x.keyId)continue;const y=Ct.hexDump(x.keyId);if(c===y||x.uri.replace(/-/g,"").indexOf(c)!==-1){if(h=d[y],x.pssh)break;delete d[y],x.pssh=new Uint8Array(i),x.keyId=l,h=d[c]=h.then(()=>this.generateRequestWithPreferredKeySession(p,r,i,"encrypted-event-key-match")),h.catch(v=>this.handleError(v));break}}if(!h){if(u!==a){this.log(`Ignoring "${s}" with ${u} init data for selected key-system ${a}`);return}h=d[c]=this.getKeySystemSelectionPromise([u]).then(({keySystem:m,mediaKeys:p})=>{var x;this.throwIfDestroyed();const y=new Ri("ISO-23001-7",c,(x=ga(m))!=null?x:"");return y.pssh=new Uint8Array(i),y.keyId=l,this.attemptSetMediaKeys(m,p).then(()=>{this.throwIfDestroyed();const v=this.createMediaKeySessionContext({decryptdata:y,keySystem:m,mediaKeys:p});return this.generateRequestWithPreferredKeySession(v,r,i,"encrypted-event-no-match")})}),h.catch(m=>this.handleError(m))}})}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.unregisterListeners(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(E.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(E.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(E.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(E.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(E.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(E.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(E.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(E.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:r}=this.config,i=t[e];if(i)return i.licenseUrl;if(e===ie.WIDEVINE&&r)return r}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,r=t[e];if(r)return r.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,r=(o,a,l)=>!!o&&l.indexOf(o)===a,i=t.map(o=>o.audioCodec).filter(r),s=t.map(o=>o.videoCodec).filter(r);return i.length+s.length===0&&s.push("avc1.42e01e"),new Promise((o,a)=>{const l=u=>{const c=u.shift();this.getMediaKeysPromise(c,i,s).then(d=>o({keySystem:c,mediaKeys:d})).catch(d=>{u.length?l(u):d instanceof st?a(d):a(new st({type:X.KEY_SYSTEM_ERROR,details:b.KEY_SYSTEM_NO_ACCESS,error:d,fatal:!0},d.message))})};l(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:r}=this.config;if(typeof r!="function"){let i=`Configured requestMediaKeySystemAccess is not a function ${r}`;return i0===null&&self.location.protocol==="http:"&&(i=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(i))}return r(e,t)}getMediaKeysPromise(e,t,r){const i=Hv(e,t,r,this.config.drmSystemOptions),s=this.keySystemAccessPromises[e];let o=s==null?void 0:s.keySystemAccess;if(!o){this.log(`Requesting encrypted media "${e}" key-system access with config: ${JSON.stringify(i)}`),o=this.requestMediaKeySystemAccess(e,i);const a=this.keySystemAccessPromises[e]={keySystemAccess:o};return o.catch(l=>{this.log(`Failed to obtain access to key-system "${e}": ${l}`)}),o.then(l=>{this.log(`Access for key-system "${l.keySystem}" obtained`);const u=this.fetchServerCertificate(e);return this.log(`Create media-keys for "${e}"`),a.mediaKeys=l.createMediaKeys().then(c=>(this.log(`Media-keys created for "${e}"`),u.then(d=>d?this.setMediaKeysServerCertificate(c,e,d):c))),a.mediaKeys.catch(c=>{this.error(`Failed to create media-keys for "${e}"}: ${c}`)}),a.mediaKeys})}return o.then(()=>s.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:r}){this.log(`Creating key-system session "${t}" keyId: ${Ct.hexDump(e.keyId||[])}`);const i=r.createSession(),s={decryptdata:e,keySystem:t,mediaKeys:r,mediaKeysSession:i,keyStatus:"status-pending"};return this.mediaKeySessions.push(s),s}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const r=this.createMediaKeySessionContext(e),i=this.getKeyIdString(t),s="cenc";this.keyIdToKeySessionPromise[i]=this.generateRequestWithPreferredKeySession(r,s,t.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}getKeyIdString(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(e.keyId===null)throw new Error("keyId is null");return Ct.hexDump(e.keyId)}updateKeySession(e,t){var r;const i=e.mediaKeysSession;return this.log(`Updating key-session "${i.sessionId}" for keyID ${Ct.hexDump(((r=e.decryptdata)==null?void 0:r.keyId)||[])}
      } (data length: ${t&&t.byteLength})`),i.update(t)}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){return new Promise((t,r)=>{const i=es(this.config),s=e.map(ha).filter(o=>!!o&&i.indexOf(o)!==-1);return this.getKeySystemSelectionPromise(s).then(({keySystem:o})=>{const a=ga(o);a?t(a):r(new Error(`Unable to find format for key-system "${o}"`))}).catch(r)})}loadKey(e){const t=e.keyInfo.decryptdata,r=this.getKeyIdString(t),i=`(keyId: ${r} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${i}`);let s=this.keyIdToKeySessionPromise[r];return s||(s=this.keyIdToKeySessionPromise[r]=this.getKeySystemForKeyPromise(t).then(({keySystem:o,mediaKeys:a})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${i}`),this.attemptSetMediaKeys(o,a).then(()=>{this.throwIfDestroyed();const l=this.createMediaKeySessionContext({keySystem:o,mediaKeys:a,decryptdata:t}),u="cenc";return this.generateRequestWithPreferredKeySession(l,u,t.pssh,"playlist-key")}))),s.catch(o=>this.handleError(o))),s}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e){this.hls&&(this.error(e.message),e instanceof st?this.hls.trigger(E.ERROR,e.data):this.hls.trigger(E.ERROR,{type:X.KEY_SYSTEM_ERROR,details:b.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))}getKeySystemForKeyPromise(e){const t=this.getKeyIdString(e),r=this.keyIdToKeySessionPromise[t];if(!r){const i=ha(e.keyFormat),s=i?[i]:es(this.config);return this.attemptKeySystemAccess(s)}return r}getKeySystemSelectionPromise(e){if(e.length||(e=es(this.config)),e.length===0)throw new st({type:X.KEY_SYSTEM_ERROR,details:b.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${JSON.stringify({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){const r=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const i=Promise.all(r).then(()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)});return this.setMediaKeysQueue.push(i),i.then(()=>{this.log(`Media-keys set for "${e}"`),r.push(i),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(s=>r.indexOf(s)===-1)})}generateRequestWithPreferredKeySession(e,t,r,i){var s,o;const a=(s=this.config.drmSystems)==null||(o=s[e.keySystem])==null?void 0:o.generateRequest;if(a)try{const m=a.call(this.hls,t,r,e);if(!m)throw new Error("Invalid response from configured generateRequest filter");t=m.initDataType,r=e.decryptdata.pssh=m.initData?new Uint8Array(m.initData):null}catch(m){var l;if(this.warn(m.message),(l=this.hls)!=null&&l.config.debug)throw m}if(r===null)return this.log(`Skipping key-session request for "${i}" (no initData)`),Promise.resolve(e);const u=this.getKeyIdString(e.decryptdata);this.log(`Generating key-session request for "${i}": ${u} (init data type: ${t} length: ${r?r.byteLength:null})`);const c=new ic,d=e._onmessage=m=>{const p=e.mediaKeysSession;if(!p){c.emit("error",new Error("invalid state"));return}const{messageType:x,message:y}=m;this.log(`"${x}" message event for session "${p.sessionId}" message size: ${y.byteLength}`),x==="license-request"||x==="license-renewal"?this.renewLicense(e,y).catch(v=>{this.handleError(v),c.emit("error",v)}):x==="license-release"?e.keySystem===ie.FAIRPLAY&&(this.updateKeySession(e,Dl("acknowledged")),this.removeSession(e)):this.warn(`unhandled media key message type "${x}"`)},f=e._onkeystatuseschange=m=>{if(!e.mediaKeysSession){c.emit("error",new Error("invalid state"));return}this.onKeyStatusChange(e);const x=e.keyStatus;c.emit("keyStatus",x),x==="expired"&&(this.warn(`${e.keySystem} expired for key ${u}`),this.renewKeySession(e))};e.mediaKeysSession.addEventListener("message",d),e.mediaKeysSession.addEventListener("keystatuseschange",f);const h=new Promise((m,p)=>{c.on("error",p),c.on("keyStatus",x=>{x.startsWith("usable")?m():x==="output-restricted"?p(new st({type:X.KEY_SYSTEM_ERROR,details:b.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):x==="internal-error"?p(new st({type:X.KEY_SYSTEM_ERROR,details:b.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${x}"`)):x==="expired"?p(new Error("key expired while generating request")):this.warn(`unhandled key status change "${x}"`)})});return e.mediaKeysSession.generateRequest(t,r).then(()=>{var m;this.log(`Request generated for key-session "${(m=e.mediaKeysSession)==null?void 0:m.sessionId}" keyId: ${u}`)}).catch(m=>{throw new st({type:X.KEY_SYSTEM_ERROR,details:b.KEY_SYSTEM_NO_SESSION,error:m,fatal:!1},`Error generating key-session request: ${m}`)}).then(()=>h).catch(m=>{throw c.removeAllListeners(),this.removeSession(e),m}).then(()=>(c.removeAllListeners(),e))}onKeyStatusChange(e){e.mediaKeysSession.keyStatuses.forEach((t,r)=>{this.log(`key status change "${t}" for keyStatuses keyId: ${Ct.hexDump("buffer"in r?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):new Uint8Array(r))} session keyId: ${Ct.hexDump(new Uint8Array(e.decryptdata.keyId||[]))} uri: ${e.decryptdata.uri}`),e.keyStatus=t})}fetchServerCertificate(e){const t=this.config,r=t.loader,i=new r(t),s=this.getServerCertificateUrl(e);return s?(this.log(`Fetching server certificate for "${e}"`),new Promise((o,a)=>{const l={responseType:"arraybuffer",url:s},u=t.certLoadPolicy.default,c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(f,h,m,p)=>{o(f.data)},onError:(f,h,m,p)=>{a(new st({type:X.KEY_SYSTEM_ERROR,details:b.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:m,response:De({url:l.url,data:void 0},f)},`"${e}" certificate request failed (${s}). Status: ${f.code} (${f.text})`))},onTimeout:(f,h,m)=>{a(new st({type:X.KEY_SYSTEM_ERROR,details:b.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:m,response:{url:l.url,data:void 0}},`"${e}" certificate request timed out (${s})`))},onAbort:(f,h,m)=>{a(new Error("aborted"))}};i.load(l,c,d)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,r){return new Promise((i,s)=>{e.setServerCertificate(r).then(o=>{this.log(`setServerCertificate ${o?"success":"not supported by CDM"} (${r==null?void 0:r.byteLength}) on "${t}"`),i(e)}).catch(o=>{s(new st({type:X.KEY_SYSTEM_ERROR,details:b.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:o,fatal:!0},o.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(r=>this.updateKeySession(e,new Uint8Array(r)).catch(i=>{throw new st({type:X.KEY_SYSTEM_ERROR,details:b.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:i,fatal:!0},i.message)}))}unpackPlayReadyKeyMessage(e,t){const r=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!r.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const i=new DOMParser().parseFromString(r,"application/xml"),s=i.querySelectorAll("HttpHeader");if(s.length>0){let c;for(let d=0,f=s.length;d<f;d++){var o,a;c=s[d];const h=(o=c.querySelector("name"))==null?void 0:o.textContent,m=(a=c.querySelector("value"))==null?void 0:a.textContent;h&&m&&e.setRequestHeader(h,m)}}const l=i.querySelector("Challenge"),u=l==null?void 0:l.textContent;if(!u)throw new Error("Cannot find <Challenge> in key message");return Dl(atob(u))}setupLicenseXHR(e,t,r,i){const s=this.config.licenseXhrSetup;return s?Promise.resolve().then(()=>{if(!r.decryptdata)throw new Error("Key removed");return s.call(this.hls,e,t,r,i)}).catch(o=>{if(!r.decryptdata)throw o;return e.open("POST",t,!0),s.call(this.hls,e,t,r,i)}).then(o=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:o||i})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:i}))}requestLicense(e,t){const r=this.config.keyLoadPolicy.default;return new Promise((i,s)=>{const o=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${o}`);const a=new XMLHttpRequest;a.responseType="arraybuffer",a.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return s(new Error("invalid state"));if(a.readyState===4)if(a.status===200){this._requestLicenseFailureCount=0;let l=a.response;this.log(`License received ${l instanceof ArrayBuffer?l.byteLength:l}`);const u=this.config.licenseResponseCallback;if(u)try{l=u.call(this.hls,a,o,e)}catch(c){this.error(c)}i(l)}else{const l=r.errorRetry,u=l?l.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>u||a.status>=400&&a.status<500)s(new st({type:X.KEY_SYSTEM_ERROR,details:b.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:a,response:{url:o,data:void 0,code:a.status,text:a.statusText}},`License Request XHR failed (${o}). Status: ${a.status} (${a.statusText})`));else{const c=u-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${c} attempts left`),this.requestLicense(e,t).then(i,s)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=a,this.setupLicenseXHR(a,o,e,t).then(({xhr:l,licenseChallenge:u})=>{e.keySystem==ie.PLAYREADY&&(u=this.unpackPlayReadyKeyMessage(l,u)),l.send(u)})})}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const r=t.media;this.media=r,r.removeEventListener("encrypted",this.onMediaEncrypted),r.removeEventListener("waitingforkey",this.onWaitingForKey),r.addEventListener("encrypted",this.onMediaEncrypted),r.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){const e=this.media,t=this.mediaKeySessions;e&&(e.removeEventListener("encrypted",this.onMediaEncrypted),e.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},Ri.clearKeyUriToKeyIdMap();const r=t.length;xr.CDMCleanupPromise=Promise.all(t.map(i=>this.removeSession(i)).concat(e==null?void 0:e.setMediaKeys(null).catch(i=>{this.log(`Could not clear media keys: ${i}`)}))).then(()=>{r&&(this.log("finished closing key sessions and clearing media keys"),t.length=0)}).catch(i=>{this.log(`Could not close sessions and clear media keys: ${i}`)})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const r=t.reduce((i,s)=>(i.indexOf(s.keyFormat)===-1&&i.push(s.keyFormat),i),[]);this.log(`Selecting key-system from session-keys ${r.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(r)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:r}=e;if(t){this.log(`Remove licenses and keys and close session ${t.sessionId}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),r&&r.readyState!==XMLHttpRequest.DONE&&r.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const i=this.mediaKeySessions.indexOf(e);return i>-1&&this.mediaKeySessions.splice(i,1),t.remove().catch(s=>{this.log(`Could not remove session: ${s}`)}).then(()=>t.close()).catch(s=>{this.log(`Could not close session: ${s}`)})}}}xr.CDMCleanupPromise=void 0;class st extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}var Be;(function(n){n.MANIFEST="m",n.AUDIO="a",n.VIDEO="v",n.MUXED="av",n.INIT="i",n.CAPTION="c",n.TIMED_TEXT="tt",n.KEY="k",n.OTHER="o"})(Be||(Be={}));var jl;(function(n){n.DASH="d",n.HLS="h",n.SMOOTH="s",n.OTHER="o"})(jl||(jl={}));var Fn;(function(n){n.OBJECT="CMCD-Object",n.REQUEST="CMCD-Request",n.SESSION="CMCD-Session",n.STATUS="CMCD-Status"})(Fn||(Fn={}));const $T={[Fn.OBJECT]:["br","d","ot","tb"],[Fn.REQUEST]:["bl","dl","mtp","nor","nrr","su"],[Fn.SESSION]:["cid","pr","sf","sid","st","v"],[Fn.STATUS]:["bs","rtp"]};class Ir{constructor(e,t){this.value=void 0,this.params=void 0,Array.isArray(e)&&(e=e.map(r=>r instanceof Ir?r:new Ir(r))),this.value=e,this.params=t}}class eg{constructor(e){this.description=void 0,this.description=e}}const jT="Dict";function GT(n){return Array.isArray(n)?JSON.stringify(n):n instanceof Map?"Map{}":n instanceof Set?"Set{}":typeof n=="object"?JSON.stringify(n):String(n)}function VT(n,e,t,r){return new Error(`failed to ${n} "${GT(e)}" as ${t}`,{cause:r})}const Sf="Bare Item",KT="Boolean",HT="Byte Sequence",zT="Decimal",WT="Integer";function YT(n){return n<-999999999999999||999999999999999<n}const qT=/[\x00-\x1f\x7f]+/,XT="Token",QT="Key";function Ot(n,e,t){return VT("serialize",n,e,t)}function JT(n){if(typeof n!="boolean")throw Ot(n,KT);return n?"?1":"?0"}function ZT(n){return btoa(String.fromCharCode(...n))}function e1(n){if(ArrayBuffer.isView(n)===!1)throw Ot(n,HT);return`:${ZT(n)}:`}function tg(n){if(YT(n))throw Ot(n,WT);return n.toString()}function t1(n){return`@${tg(n.getTime()/1e3)}`}function ng(n,e){if(n<0)return-ng(-n,e);const t=Math.pow(10,e);if(Math.abs(n*t%1-.5)<Number.EPSILON){const i=Math.floor(n*t);return(i%2===0?i:i+1)/t}else return Math.round(n*t)/t}function n1(n){const e=ng(n,3);if(Math.floor(Math.abs(e)).toString().length>12)throw Ot(n,zT);const t=e.toString();return t.includes(".")?t:`${t}.0`}const r1="String";function i1(n){if(qT.test(n))throw Ot(n,r1);return`"${n.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function s1(n){return n.description||n.toString().slice(7,-1)}function Tf(n){const e=s1(n);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw Ot(e,XT);return e}function Gl(n){switch(typeof n){case"number":if(!G(n))throw Ot(n,Sf);return Number.isInteger(n)?tg(n):n1(n);case"string":return i1(n);case"symbol":return Tf(n);case"boolean":return JT(n);case"object":if(n instanceof Date)return t1(n);if(n instanceof Uint8Array)return e1(n);if(n instanceof eg)return Tf(n);default:throw Ot(n,Sf)}}function Vl(n){if(/^[a-z*][a-z0-9\-_.*]*$/.test(n)===!1)throw Ot(n,QT);return n}function lc(n){return n==null?"":Object.entries(n).map(([e,t])=>t===!0?`;${Vl(e)}`:`;${Vl(e)}=${Gl(t)}`).join("")}function rg(n){return n instanceof Ir?`${Gl(n.value)}${lc(n.params)}`:Gl(n)}function o1(n){return`(${n.value.map(rg).join(" ")})${lc(n.params)}`}function a1(n,e={whitespace:!0}){if(typeof n!="object")throw Ot(n,jT);const t=n instanceof Map?n.entries():Object.entries(n),r=e!=null&&e.whitespace?" ":"";return Array.from(t).map(([i,s])=>{s instanceof Ir||(s=new Ir(s));let o=Vl(i);return s.value===!0?o+=lc(s.params):(o+="=",Array.isArray(s.value)?o+=o1(s):o+=rg(s)),o}).join(`,${r}`)}function l1(n,e){return a1(n,e)}const u1=n=>n==="ot"||n==="sf"||n==="st",c1=n=>typeof n=="number"?G(n):n!=null&&n!==""&&n!==!1;function d1(n,e){const t=new URL(n),r=new URL(e);if(t.origin!==r.origin)return n;const i=t.pathname.split("/").slice(1),s=r.pathname.split("/").slice(1,-1);for(;i[0]===s[0];)i.shift(),s.shift();for(;s.length;)s.shift(),i.unshift("..");return i.join("/")}function f1(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,i=>{const s=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(i=="x"?s:s&3|8).toString(16)})}}}const _s=n=>Math.round(n),h1=(n,e)=>(e!=null&&e.baseUrl&&(n=d1(n,e.baseUrl)),encodeURIComponent(n)),ds=n=>_s(n/100)*100,m1={br:_s,d:_s,bl:ds,dl:ds,mtp:ds,nor:h1,rtp:ds,tb:_s};function g1(n,e){const t={};if(n==null||typeof n!="object")return t;const r=Object.keys(n).sort(),i=Te({},m1,e==null?void 0:e.formatters),s=e==null?void 0:e.filter;return r.forEach(o=>{if(s!=null&&s(o))return;let a=n[o];const l=i[o];l&&(a=l(a,e)),!(o==="v"&&a===1)&&(o=="pr"&&a===1||c1(a)&&(u1(o)&&typeof a=="string"&&(a=new eg(a)),t[o]=a))}),t}function ig(n,e={}){return n?l1(g1(n,e),Te({whitespace:!1},e)):""}function p1(n,e={}){if(!n)return{};const t=Object.entries(n),r=Object.entries($T).concat(Object.entries((e==null?void 0:e.customHeaderMap)||{})),i=t.reduce((s,o)=>{var a,l;const[u,c]=o,d=((a=r.find(f=>f[1].includes(u)))==null?void 0:a[0])||Fn.REQUEST;return(l=s[d])!=null||(s[d]={}),s[d][u]=c,s},{});return Object.entries(i).reduce((s,[o,a])=>(s[o]=ig(a,e),s),{})}function y1(n,e,t){return Te(n,p1(e,t))}const x1="CMCD";function v1(n,e={}){if(!n)return"";const t=ig(n,e);return`${x1}=${encodeURIComponent(t)}`}const Lf=/CMCD=[^&#]+/;function E1(n,e,t){const r=v1(e,t);if(!r)return n;if(Lf.test(n))return n.replace(Lf,r);const i=n.includes("?")?"&":"?";return`${n}${i}${r}`}class S1{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=i=>{try{this.apply(i,{ot:Be.MANIFEST,su:!this.initialized})}catch(s){w.warn("Could not generate manifest CMCD data.",s)}},this.applyFragmentData=i=>{try{const s=i.frag,o=this.hls.levels[s.level],a=this.getObjectType(s),l={d:s.duration*1e3,ot:a};(a===Be.VIDEO||a===Be.AUDIO||a==Be.MUXED)&&(l.br=o.bitrate/1e3,l.tb=this.getTopBandwidth(a)/1e3,l.bl=this.getBufferLength(a)),this.apply(i,l)}catch(s){w.warn("Could not generate segment CMCD data.",s)}},this.hls=e;const t=this.config=e.config,{cmcd:r}=t;r!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=r.sessionId||f1(),this.cid=r.contentId,this.useHeaders=r.useHeaders===!0,this.includeKeys=r.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(E.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(E.MEDIA_DETACHED,this.onMediaDetached,this),e.on(E.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(E.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(E.MEDIA_DETACHED,this.onMediaDetached,this),e.off(E.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var r,i;this.audioBuffer=(r=t.tracks.audio)==null?void 0:r.buffer,this.videoBuffer=(i=t.tracks.video)==null?void 0:i.buffer}createData(){var e;return{v:1,sf:jl.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){Te(t,this.createData());const r=t.ot===Be.INIT||t.ot===Be.VIDEO||t.ot===Be.MUXED;this.starved&&r&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:i}=this;i&&(t=Object.keys(t).reduce((s,o)=>(i.includes(o)&&(s[o]=t[o]),s),{})),this.useHeaders?(e.headers||(e.headers={}),y1(e.headers,t)):e.url=E1(e.url,t)}getObjectType(e){const{type:t}=e;if(t==="subtitle")return Be.TIMED_TEXT;if(e.sn==="initSegment")return Be.INIT;if(t==="audio")return Be.AUDIO;if(t==="main")return this.hls.audioTracks.length?Be.VIDEO:Be.MUXED}getTopBandwidth(e){let t=0,r;const i=this.hls;if(e===Be.AUDIO)r=i.audioTracks;else{const s=i.maxAutoLevel,o=s>-1?s+1:i.levels.length;r=i.levels.slice(0,o)}for(const s of r)s.bitrate>t&&(t=s.bitrate);return t>0?t:NaN}getBufferLength(e){const t=this.hls.media,r=e===Be.AUDIO?this.audioBuffer:this.videoBuffer;return!r||!t?NaN:ue.bufferInfo(r,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,r=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new r(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,o,a){t(s),this.loader.load(s,o,a)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,r=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new r(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,o,a){t(s),this.loader.load(s,o,a)}}}}const T1=3e5;class L1{constructor(e){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.log=w.log.bind(w,"[content-steering]:"),this.registerListeners()}registerListeners(){const e=this.hls;e.on(E.MANIFEST_LOADING,this.onManifestLoading,this),e.on(E.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(E.MANIFEST_PARSED,this.onManifestParsed,this),e.on(E.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(E.MANIFEST_LOADING,this.onManifestLoading,this),e.off(E.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(E.MANIFEST_PARSED,this.onManifestParsed,this),e.off(E.ERROR,this.onError,this))}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(r=>r!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:r}=t;r!==null&&(this.pathwayId=r.pathwayId,this.uri=r.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:r}=t;if((r==null?void 0:r.action)===Pe.SendAlternateToPenaltyBox&&r.flags===gt.MoveAllAlternatesMatchingHost){const i=this.levels;let s=this.pathwayPriority,o=this.pathwayId;if(t.context){const{groupId:a,pathwayId:l,type:u}=t.context;a&&i?o=this.getPathwayForGroupId(a,u,o):l&&(o=l)}o in this.penalizedPathways||(this.penalizedPathways[o]=performance.now()),!s&&i&&(s=i.reduce((a,l)=>(a.indexOf(l.pathwayId)===-1&&a.push(l.pathwayId),a),[])),s&&s.length>1&&(this.updatePathwayPriority(s),r.resolved=this.pathwayId!==o),r.resolved||w.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${o} levels: ${i&&i.length} priorities: ${JSON.stringify(s)} penalized: ${JSON.stringify(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const r=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${r}"`),t=this.getLevelsForPathway(r),this.pathwayId=r}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this.pathwayPriority=e;let t;const r=this.penalizedPathways,i=performance.now();Object.keys(r).forEach(s=>{i-r[s]>T1&&delete r[s]});for(let s=0;s<e.length;s++){const o=e[s];if(o in r)continue;if(o===this.pathwayId)return;const a=this.hls.nextLoadLevel,l=this.hls.levels[a];if(t=this.getLevelsForPathway(o),t.length>0){this.log(`Setting Pathway to "${o}"`),this.pathwayId=o,L0(t),this.hls.trigger(E.LEVELS_UPDATED,{levels:t});const u=this.hls.levels[a];l&&u&&this.levels&&(u.attrs["STABLE-VARIANT-ID"]!==l.attrs["STABLE-VARIANT-ID"]&&u.bitrate!==l.bitrate&&this.log(`Unstable Pathways change from bitrate ${l.bitrate} to ${u.bitrate}`),this.hls.nextLoadLevel=a);break}}}getPathwayForGroupId(e,t,r){const i=this.getLevelsForPathway(r).concat(this.levels||[]);for(let s=0;s<i.length;s++)if(t===te.AUDIO_TRACK&&i[s].hasAudioGroup(e)||t===te.SUBTITLE_TRACK&&i[s].hasSubtitleGroup(e))return i[s].pathwayId;return r}clonePathways(e){const t=this.levels;if(!t)return;const r={},i={};e.forEach(s=>{const{ID:o,"BASE-ID":a,"URI-REPLACEMENT":l}=s;if(t.some(c=>c.pathwayId===o))return;const u=this.getLevelsForPathway(a).map(c=>{const d=new me(c.attrs);d["PATHWAY-ID"]=o;const f=d.AUDIO&&`${d.AUDIO}_clone_${o}`,h=d.SUBTITLES&&`${d.SUBTITLES}_clone_${o}`;f&&(r[d.AUDIO]=f,d.AUDIO=f),h&&(i[d.SUBTITLES]=h,d.SUBTITLES=h);const m=sg(c.uri,d["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",l),p=new Cr({attrs:d,audioCodec:c.audioCodec,bitrate:c.bitrate,height:c.height,name:c.name,url:m,videoCodec:c.videoCodec,width:c.width});if(c.audioGroups)for(let x=1;x<c.audioGroups.length;x++)p.addGroupId("audio",`${c.audioGroups[x]}_clone_${o}`);if(c.subtitleGroups)for(let x=1;x<c.subtitleGroups.length;x++)p.addGroupId("text",`${c.subtitleGroups[x]}_clone_${o}`);return p});t.push(...u),Rf(this.audioTracks,r,l,o),Rf(this.subtitleTracks,i,l,o)})}loadSteeringManifest(e){const t=this.hls.config,r=t.loader;this.loader&&this.loader.destroy(),this.loader=new r(t);let i;try{i=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(i.protocol!=="data:"){const c=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;i.searchParams.set("_HLS_pathway",this.pathwayId),i.searchParams.set("_HLS_throughput",""+c)}const s={responseType:"json",url:i.href},o=t.steeringManifestLoadPolicy.default,a=o.errorRetry||o.timeoutRetry||{},l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},u={onSuccess:(c,d,f,h)=>{this.log(`Loaded steering manifest: "${i}"`);const m=c.data;if(m.VERSION!==1){this.log(`Steering VERSION ${m.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=m.TTL;const{"RELOAD-URI":p,"PATHWAY-CLONES":x,"PATHWAY-PRIORITY":y}=m;if(p)try{this.uri=new self.URL(p,i).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${p}`);return}this.scheduleRefresh(this.uri||f.url),x&&this.clonePathways(x);const v={steeringManifest:m,url:i.toString()};this.hls.trigger(E.STEERING_MANIFEST_LOADED,v),y&&this.updatePathwayPriority(y)},onError:(c,d,f,h)=>{if(this.log(`Error loading steering manifest: ${c.code} ${c.text} (${d.url})`),this.stopLoad(),c.code===410){this.enabled=!1,this.log(`Steering manifest ${d.url} no longer available`);return}let m=this.timeToLoad*1e3;if(c.code===429){const p=this.loader;if(typeof(p==null?void 0:p.getResponseHeader)=="function"){const x=p.getResponseHeader("Retry-After");x&&(m=parseFloat(x)*1e3)}this.log(`Steering manifest ${d.url} rate limited`);return}this.scheduleRefresh(this.uri||d.url,m)},onTimeout:(c,d,f)=>{this.log(`Timeout loading steering manifest (${d.url})`),this.scheduleRefresh(this.uri||d.url)}};this.log(`Requesting steering manifest: ${i}`),this.loader.load(s,l,u)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var r;const i=(r=this.hls)==null?void 0:r.media;if(i&&!i.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function Rf(n,e,t,r){n&&Object.keys(e).forEach(i=>{const s=n.filter(o=>o.groupId===i).map(o=>{const a=Te({},o);return a.details=void 0,a.attrs=new me(a.attrs),a.url=a.attrs.URI=sg(o.url,o.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),a.groupId=a.attrs["GROUP-ID"]=e[i],a.attrs["PATHWAY-ID"]=r,a});n.push(...s)})}function sg(n,e,t,r){const{HOST:i,PARAMS:s,[t]:o}=r;let a;e&&(a=o==null?void 0:o[e],a&&(n=a));const l=new self.URL(n);return i&&!a&&(l.host=i),s&&Object.keys(s).sort().forEach(u=>{u&&l.searchParams.set(u,s[u])}),l.href}const R1=/^age:\s*[\d.]+\s*$/im;class og{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new Fo,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=r,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const r=this.loader=new self.XMLHttpRequest,i=this.stats;i.loading.first=0,i.loaded=0,i.aborted=!1;const s=this.xhrSetup;s?Promise.resolve().then(()=>{if(!(this.loader!==r||this.stats.aborted))return s(r,t.url)}).catch(o=>{if(!(this.loader!==r||this.stats.aborted))return r.open("GET",t.url,!0),s(r,t.url)}).then(()=>{this.loader!==r||this.stats.aborted||this.openAndSendXhr(r,t,e)}).catch(o=>{this.callbacks.onError({code:r.status,text:o.message},t,r,i)}):this.openAndSendXhr(r,t,e)}openAndSendXhr(e,t,r){e.readyState||e.open("GET",t.url,!0);const i=t.headers,{maxTimeToFirstByteMs:s,maxLoadTimeMs:o}=r.loadPolicy;if(i)for(const a in i)e.setRequestHeader(a,i[a]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),r.timeout=s&&G(s)?s:o,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:r}=this;if(!e||!t)return;const i=t.readyState,s=this.config;if(!r.aborted&&i>=2&&(r.loading.first===0&&(r.loading.first=Math.max(self.performance.now(),r.loading.start),s.timeout!==s.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),s.timeout=s.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.loadPolicy.maxLoadTimeMs-(r.loading.first-r.loading.start)))),i===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const o=t.status,a=t.responseType==="text"?t.responseText:null;if(o>=200&&o<300){const d=a??t.response;if(d!=null){r.loading.end=Math.max(self.performance.now(),r.loading.first);const f=t.responseType==="arraybuffer"?d.byteLength:d.length;if(r.loaded=r.total=f,r.bwEstimate=r.total*8e3/(r.loading.end-r.loading.first),!this.callbacks)return;const h=this.callbacks.onProgress;if(h&&h(r,e,d,t),!this.callbacks)return;const m={url:t.responseURL,data:d,code:o};this.callbacks.onSuccess(m,r,e,t);return}}const l=s.loadPolicy.errorRetry,u=r.retry,c={url:e.url,data:void 0,code:o};fo(l,u,!1,c)?this.retry(l):(w.error(`${o} while loading ${e.url}`),this.callbacks.onError({code:o,text:t.statusText},e,t,r))}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(fo(e,t,!0))this.retry(e);else{var r;w.warn(`timeout while loading ${(r=this.context)==null?void 0:r.url}`);const i=this.callbacks;i&&(this.abortInternal(),i.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:r}=this;this.retryDelay=qu(e,r.retry),r.retry++,w.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t==null?void 0:t.url}, retrying ${r.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&R1.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}function A1(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const w1=/(\d+)-(\d+)\/(\d+)/;class Af{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||b1,this.controller=new self.AbortController,this.stats=new Fo}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,r){const i=this.stats;if(i.loading.start)throw new Error("Loader can only be used once.");i.loading.start=self.performance.now();const s=C1(e,this.controller.signal),o=r.onProgress,a=e.responseType==="arraybuffer",l=a?"byteLength":"length",{maxTimeToFirstByteMs:u,maxLoadTimeMs:c}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=r,this.request=this.fetchSetup(e,s),self.clearTimeout(this.requestTimeout),t.timeout=u&&G(u)?u:c,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),r.onTimeout(i,e,this.response)},t.timeout),self.fetch(this.request).then(d=>{this.response=this.loader=d;const f=Math.max(self.performance.now(),i.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=c,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),r.onTimeout(i,e,this.response)},c-(f-i.loading.start)),!d.ok){const{status:h,statusText:m}=d;throw new D1(m||"fetch, bad network response",h,d)}return i.loading.first=f,i.total=k1(d.headers)||i.total,o&&G(t.highWaterMark)?this.loadProgressively(d,i,e,t.highWaterMark,o):a?d.arrayBuffer():e.responseType==="json"?d.json():d.text()}).then(d=>{const f=this.response;if(!f)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),i.loading.end=Math.max(self.performance.now(),i.loading.first);const h=d[l];h&&(i.loaded=i.total=h);const m={url:f.url,data:d,code:f.status};o&&!G(t.highWaterMark)&&o(i,e,d,f),r.onSuccess(m,i,e,f)}).catch(d=>{if(self.clearTimeout(this.requestTimeout),i.aborted)return;const f=d&&d.code||0,h=d?d.message:null;r.onError({code:f,text:h},e,d?d.details:null,i)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,r,i=0,s){const o=new C0,a=e.body.getReader(),l=()=>a.read().then(u=>{if(u.done)return o.dataLength&&s(t,r,o.flush(),e),Promise.resolve(new ArrayBuffer(0));const c=u.value,d=c.length;return t.loaded+=d,d<i||o.dataLength?(o.push(c),o.dataLength>=i&&s(t,r,o.flush(),e)):s(t,r,c,e),l()}).catch(()=>Promise.reject());return l()}}function C1(n,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(Te({},n.headers))};return n.rangeEnd&&t.headers.set("Range","bytes="+n.rangeStart+"-"+String(n.rangeEnd-1)),t}function I1(n){const e=w1.exec(n);if(e)return parseInt(e[2])-parseInt(e[1])+1}function k1(n){const e=n.get("Content-Range");if(e){const r=I1(e);if(G(r))return r}const t=n.get("Content-Length");if(t)return parseInt(t)}function b1(n,e){return new self.Request(n.url,e)}class D1 extends Error{constructor(e,t,r){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=r}}const _1=/\s/,N1={newCue(n,e,t,r){const i=[];let s,o,a,l,u;const c=self.VTTCue||self.TextTrackCue;for(let f=0;f<r.rows.length;f++)if(s=r.rows[f],a=!0,l=0,u="",!s.isEmpty()){var d;for(let p=0;p<s.chars.length;p++)_1.test(s.chars[p].uchar)&&a?l++:(u+=s.chars[p].uchar,a=!1);s.cueStartTime=e,e===t&&(t+=1e-4),l>=16?l--:l++;const h=q0(u.trim()),m=oc(e,t,h);n!=null&&(d=n.cues)!=null&&d.getCueById(m)||(o=new c(e,t,h),o.id=m,o.line=f+1,o.align="left",o.position=10+Math.min(80,Math.floor(l*8/32)*10),i.push(o))}return n&&i.length&&(i.sort((f,h)=>f.line==="auto"||h.line==="auto"?0:f.line>8&&h.line>8?h.line-f.line:f.line-h.line),i.forEach(f=>v0(n,f))),i}},P1={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},ag=De(De({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:og,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:aS,bufferController:dT,capLevelController:ac,errorController:qE,fpsController:BT,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:i0,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,useMediaCapabilities:!0,certLoadPolicy:{default:P1},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},F1()),{},{subtitleStreamController:aT,subtitleTrackController:uT,timelineController:MT,audioStreamController:sT,audioTrackController:oT,emeController:xr,cmcdController:S1,contentSteeringController:L1});function F1(){return{cueHandler:N1,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function O1(n,e){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const t=Kl(n),r=["manifest","level","frag"],i=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return r.forEach(s=>{const o=`${s==="level"?"playlist":s}LoadPolicy`,a=e[o]===void 0,l=[];i.forEach(u=>{const c=`${s}Loading${u}`,d=e[c];if(d!==void 0&&a){l.push(c);const f=t[o].default;switch(e[o]={default:f},u){case"TimeOut":f.maxLoadTimeMs=d,f.maxTimeToFirstByteMs=d;break;case"MaxRetry":f.errorRetry.maxNumRetry=d,f.timeoutRetry.maxNumRetry=d;break;case"RetryDelay":f.errorRetry.retryDelayMs=d,f.timeoutRetry.retryDelayMs=d;break;case"MaxRetryTimeout":f.errorRetry.maxRetryDelayMs=d,f.timeoutRetry.maxRetryDelayMs=d;break}}}),l.length&&w.warn(`hls.js config: "${l.join('", "')}" setting(s) are deprecated, use "${o}": ${JSON.stringify(e[o])}`)}),De(De({},t),e)}function Kl(n){return n&&typeof n=="object"?Array.isArray(n)?n.map(Kl):Object.keys(n).reduce((e,t)=>(e[t]=Kl(n[t]),e),{}):n}function M1(n){const e=n.loader;e!==Af&&e!==og?(w.log("[config]: Custom loader detected, cannot enable progressive streaming"),n.progressive=!1):A1()&&(n.loader=Af,n.progressive=!0,n.enableSoftwareAES=!0,w.log("[config]: Progressive streaming enabled, using FetchLoader"))}let Pa;class U1 extends Xu{constructor(e,t){super(e,"[level-controller]"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(E.MANIFEST_LOADING,this.onManifestLoading,this),e.on(E.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(E.LEVEL_LOADED,this.onLevelLoaded,this),e.on(E.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(E.FRAG_BUFFERED,this.onFragBuffered,this),e.on(E.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(E.MANIFEST_LOADING,this.onManifestLoading,this),e.off(E.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(E.LEVEL_LOADED,this.onLevelLoaded,this),e.off(E.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(E.FRAG_BUFFERED,this.onFragBuffered,this),e.off(E.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const r=this.hls.config.preferManagedMediaSource,i=[],s={},o={};let a=!1,l=!1,u=!1;t.levels.forEach(c=>{var d,f;const h=c.attrs;let{audioCodec:m,videoCodec:p}=c;((d=m)==null?void 0:d.indexOf("mp4a.40.34"))!==-1&&(Pa||(Pa=/chrome|firefox/i.test(navigator.userAgent)),Pa&&(c.audioCodec=m=void 0)),m&&(c.audioCodec=m=lo(m,r)),((f=p)==null?void 0:f.indexOf("avc1"))===0&&(p=c.videoCodec=RE(p));const{width:x,height:y,unknownCodecs:v}=c;if(a||(a=!!(x&&y)),l||(l=!!p),u||(u=!!m),v!=null&&v.length||m&&!va(m,"audio",r)||p&&!va(p,"video",r))return;const{CODECS:S,"FRAME-RATE":L,"HDCP-LEVEL":T,"PATHWAY-ID":A,RESOLUTION:R,"VIDEO-RANGE":k}=h,C=`${`${A||"."}-`}${c.bitrate}-${R}-${L}-${S}-${k}-${T}`;if(s[C])if(s[C].uri!==c.url&&!c.attrs["PATHWAY-ID"]){const P=o[C]+=1;c.attrs["PATHWAY-ID"]=new Array(P+1).join(".");const H=new Cr(c);s[C]=H,i.push(H)}else s[C].addGroupId("audio",h.AUDIO),s[C].addGroupId("text",h.SUBTITLES);else{const P=new Cr(c);s[C]=P,o[C]=1,i.push(P)}}),this.filterAndSortMediaOptions(i,t,a,l,u)}filterAndSortMediaOptions(e,t,r,i,s){let o=[],a=[],l=e;if((r||i)&&s&&(l=l.filter(({videoCodec:m,videoRange:p,width:x,height:y})=>(!!m||!!(x&&y))&&ME(p))),l.length===0){Promise.resolve().then(()=>{if(this.hls){t.levels.length&&this.warn(`One or more CODECS in variant not supported: ${JSON.stringify(t.levels[0].attrs)}`);const m=new Error("no level with compatible codecs found in manifest");this.hls.trigger(E.ERROR,{type:X.MEDIA_ERROR,details:b.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:m,reason:m.message})}});return}if(t.audioTracks){const{preferManagedMediaSource:m}=this.hls.config;o=t.audioTracks.filter(p=>!p.audioCodec||va(p.audioCodec,"audio",m)),wf(o)}t.subtitles&&(a=t.subtitles,wf(a));const u=l.slice(0);l.sort((m,p)=>{if(m.attrs["HDCP-LEVEL"]!==p.attrs["HDCP-LEVEL"])return(m.attrs["HDCP-LEVEL"]||"")>(p.attrs["HDCP-LEVEL"]||"")?1:-1;if(r&&m.height!==p.height)return m.height-p.height;if(m.frameRate!==p.frameRate)return m.frameRate-p.frameRate;if(m.videoRange!==p.videoRange)return uo.indexOf(m.videoRange)-uo.indexOf(p.videoRange);if(m.videoCodec!==p.videoCodec){const x=_d(m.videoCodec),y=_d(p.videoCodec);if(x!==y)return y-x}if(m.uri===p.uri&&m.codecSet!==p.codecSet){const x=ao(m.codecSet),y=ao(p.codecSet);if(x!==y)return y-x}return m.averageBitrate!==p.averageBitrate?m.averageBitrate-p.averageBitrate:0});let c=u[0];if(this.steering&&(l=this.steering.filterParsedLevels(l),l.length!==u.length)){for(let m=0;m<u.length;m++)if(u[m].pathwayId===l[0].pathwayId){c=u[m];break}}this._levels=l;for(let m=0;m<l.length;m++)if(l[m]===c){var d;this._firstLevel=m;const p=c.bitrate,x=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${l.length} level(s) found, first bitrate: ${p}`),((d=this.hls.userConfig)==null?void 0:d.abrEwmaDefaultEstimate)===void 0){const y=Math.min(p,this.hls.config.abrEwmaDefaultEstimateMax);y>x&&x===ag.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=y)}break}const f=s&&!i,h={levels:l,audioTracks:o,subtitleTracks:a,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:s,video:i,altAudio:!f&&o.some(m=>!!m.url)};this.hls.trigger(E.MANIFEST_PARSED,h),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}get levels(){return this._levels.length===0?null:this._levels}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const c=new Error("invalid level idx"),d=e<0;if(this.hls.trigger(E.ERROR,{type:X.OTHER_ERROR,details:b.LEVEL_SWITCH_ERROR,level:e,fatal:d,error:c,reason:c.message}),d)return;e=Math.min(e,t.length-1)}const r=this.currentLevelIndex,i=this.currentLevel,s=i?i.attrs["PATHWAY-ID"]:void 0,o=t[e],a=o.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=o,r===e&&o.details&&i&&s===a)return;this.log(`Switching to level ${e} (${o.height?o.height+"p ":""}${o.videoRange?o.videoRange+" ":""}${o.codecSet?o.codecSet+" ":""}@${o.bitrate})${a?" with Pathway "+a:""} from level ${r}${s?" with Pathway "+s:""}`);const l={level:e,attrs:o.attrs,details:o.details,bitrate:o.bitrate,averageBitrate:o.averageBitrate,maxBitrate:o.maxBitrate,realBitrate:o.realBitrate,width:o.width,height:o.height,codecSet:o.codecSet,audioCodec:o.audioCodec,videoCodec:o.videoCodec,audioGroups:o.audioGroups,subtitleGroups:o.subtitleGroups,loaded:o.loaded,loadError:o.loadError,fragmentError:o.fragmentError,name:o.name,id:o.id,uri:o.uri,url:o.url,urlId:0,audioGroupIds:o.audioGroupIds,textGroupIds:o.textGroupIds};this.hls.trigger(E.LEVEL_SWITCHING,l);const u=o.details;if(!u||u.live){const c=this.switchParams(o.uri,i==null?void 0:i.details,u);this.loadPlaylist(c)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}onError(e,t){t.fatal||!t.context||t.context.type===te.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===W.MAIN){const r=t.elementaryStreams;if(!Object.keys(r).some(s=>!!r[s]))return;const i=this._levels[t.level];i!=null&&i.loadError&&(this.log(`Resetting level error count of ${i.loadError} on frag buffered`),i.loadError=0)}}onLevelLoaded(e,t){var r;const{level:i,details:s}=t,o=this._levels[i];if(!o){var a;this.warn(`Invalid level index ${i}`),(a=t.deliveryDirectives)!=null&&a.skip&&(s.deltaUpdateFailed=!0);return}i===this.currentLevelIndex?(o.fragmentError===0&&(o.loadError=0),this.playlistLoaded(i,t,o.details)):(r=t.deliveryDirectives)!=null&&r.skip&&(s.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist();const t=this.currentLevelIndex,r=this.currentLevel;if(r&&this.shouldLoadPlaylist(r)){let i=r.uri;if(e)try{i=e.addDirectives(i)}catch(o){this.warn(`Could not construct new URL with HLS Delivery Directives: ${o}`)}const s=r.attrs["PATHWAY-ID"];this.log(`Loading level index ${t}${(e==null?void 0:e.msn)!==void 0?" at sn "+e.msn+" part "+e.part:""} with${s?" Pathway "+s:""} ${i}`),this.clearTimer(),this.hls.trigger(E.LEVEL_LOADING,{url:i,level:t,pathwayId:r.attrs["PATHWAY-ID"],id:0,deliveryDirectives:e||null})}}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;const r=this._levels.filter((i,s)=>s!==e?!0:(this.steering&&this.steering.removeLevel(i),i===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,i.details&&i.details.fragments.forEach(o=>o.level=-1)),!1));L0(r),this._levels=r,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.hls.trigger(E.LEVELS_UPDATED,{levels:r})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:r}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(E.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:r}))}}function wf(n){const e={};n.forEach(t=>{const r=t.groupId||"";t.id=e[r]=e[r]||0,e[r]++})}class B1{constructor(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const r in this.keyUriToKeyInfo){const i=this.keyUriToKeyInfo[r].loader;if(i){var t;if(e&&e!==((t=i.context)==null?void 0:t.frag.type))return;i.abort()}}}detach(){for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(e,t=b.KEY_LOAD_ERROR,r,i,s){return new Gt({type:X.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:s,error:r,networkDetails:i})}loadClear(e,t){if(this.emeController&&this.config.emeEnabled){const{sn:r,cc:i}=e;for(let s=0;s<t.length;s++){const o=t[s];if(i<=o.cc&&(r==="initSegment"||o.sn==="initSegment"||r<o.sn)){this.emeController.selectKeySystemFormat(o).then(a=>{o.setKeyFormat(a)});break}}}}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var r,i;t&&e.setKeyFormat(t);const s=e.decryptdata;if(!s){const u=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,b.KEY_LOAD_ERROR,u))}const o=s.uri;if(!o)return Promise.reject(this.createKeyLoadError(e,b.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${o}"`)));let a=this.keyUriToKeyInfo[o];if((r=a)!=null&&r.decryptdata.key)return s.key=a.decryptdata.key,Promise.resolve({frag:e,keyInfo:a});if((i=a)!=null&&i.keyLoadPromise){var l;switch((l=a.mediaKeySessionContext)==null?void 0:l.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return a.keyLoadPromise.then(u=>(s.key=u.keyInfo.decryptdata.key,{frag:e,keyInfo:a}))}}switch(a=this.keyUriToKeyInfo[o]={decryptdata:s,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},s.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return s.keyFormat==="identity"?this.loadKeyHTTP(a,e):this.loadKeyEME(a,e);case"AES-128":return this.loadKeyHTTP(a,e);default:return Promise.reject(this.createKeyLoadError(e,b.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${s.method}"`)))}}loadKeyEME(e,t){const r={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){const i=this.emeController.loadKey(r);if(i)return(e.keyLoadPromise=i.then(s=>(e.mediaKeySessionContext=s,r))).catch(s=>{throw e.keyLoadPromise=null,s})}return Promise.resolve(r)}loadKeyHTTP(e,t){const r=this.config,i=r.loader,s=new i(r);return t.keyLoader=e.loader=s,e.keyLoadPromise=new Promise((o,a)=>{const l={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},u=r.keyLoadPolicy.default,c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(f,h,m,p)=>{const{frag:x,keyInfo:y,url:v}=m;if(!x.decryptdata||y!==this.keyUriToKeyInfo[v])return a(this.createKeyLoadError(x,b.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),p));y.decryptdata.key=x.decryptdata.key=new Uint8Array(f.data),x.keyLoader=null,y.loader=null,o({frag:x,keyInfo:y})},onError:(f,h,m,p)=>{this.resetLoader(h),a(this.createKeyLoadError(t,b.KEY_LOAD_ERROR,new Error(`HTTP Error ${f.code} loading key ${f.text}`),m,De({url:l.url,data:void 0},f)))},onTimeout:(f,h,m)=>{this.resetLoader(h),a(this.createKeyLoadError(t,b.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),m))},onAbort:(f,h,m)=>{this.resetLoader(h),a(this.createKeyLoadError(t,b.INTERNAL_ABORTED,new Error("key loading aborted"),m))}};s.load(l,c,d)})}resetLoader(e){const{frag:t,keyInfo:r,url:i}=e,s=r.loader;t.keyLoader===s&&(t.keyLoader=null,r.loader=null),delete this.keyUriToKeyInfo[i],s&&s.destroy()}}function lg(){return self.SourceBuffer||self.WebKitSourceBuffer}function ug(){if(!Hn())return!1;const e=lg();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function $1(){if(!ug())return!1;const n=Hn();return typeof(n==null?void 0:n.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>n.isTypeSupported(Ai(e,"video")))||["mp4a.40.2","fLaC"].some(e=>n.isTypeSupported(Ai(e,"audio"))))}function j1(){var n;const e=lg();return typeof(e==null||(n=e.prototype)==null?void 0:n.changeType)=="function"}const G1=250,Ns=2,V1=.1,K1=.05;class H1{constructor(e,t,r,i){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=e,this.media=t,this.fragmentTracker=r,this.hls=i}destroy(){this.media=null,this.hls=this.fragmentTracker=null}poll(e,t){const{config:r,media:i,stalled:s}=this;if(i===null)return;const{currentTime:o,seeking:a}=i,l=this.seeking&&!a,u=!this.seeking&&a;if(this.seeking=a,o!==e){if(this.moved=!0,a||(this.nudgeRetry=0),s!==null){if(this.stallReported){const x=self.performance.now()-s;w.warn(`playback not stuck anymore @${o}, after ${Math.round(x)}ms`),this.stallReported=!1}this.stalled=null}return}if(u||l){this.stalled=null;return}if(i.paused&&!a||i.ended||i.playbackRate===0||!ue.getBuffered(i).length){this.nudgeRetry=0;return}const c=ue.bufferInfo(i,o,0),d=c.nextStart||0;if(a){const x=c.len>Ns,y=!d||t&&t.start<=o||d-o>Ns&&!this.fragmentTracker.getPartialFragment(o);if(x||y)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var f;if(!(c.len>0)&&!d)return;const y=Math.max(d,c.start||0)-o,v=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,L=(v==null||(f=v.details)==null?void 0:f.live)?v.details.targetduration*2:Ns,T=this.fragmentTracker.getPartialFragment(o);if(y>0&&(y<=L||T)){i.paused||this._trySkipBufferHole(T);return}}const h=self.performance.now();if(s===null){this.stalled=h;return}const m=h-s;if(!a&&m>=G1&&(this._reportStall(c),!this.media))return;const p=ue.bufferInfo(i,o,r.maxBufferHole);this._tryFixBufferStall(p,m)}_tryFixBufferStall(e,t){const{config:r,fragmentTracker:i,media:s}=this;if(s===null)return;const o=s.currentTime,a=i.getPartialFragment(o);a&&(this._trySkipBufferHole(a)||!this.media)||(e.len>r.maxBufferHole||e.nextStart&&e.nextStart-o<r.maxBufferHole)&&t>r.highBufferWatchdogPeriod*1e3&&(w.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}_reportStall(e){const{hls:t,media:r,stallReported:i}=this;if(!i&&r){this.stallReported=!0;const s=new Error(`Playback stalling at @${r.currentTime} due to low buffer (${JSON.stringify(e)})`);w.warn(s.message),t.trigger(E.ERROR,{type:X.MEDIA_ERROR,details:b.BUFFER_STALLED_ERROR,fatal:!1,error:s,buffer:e.len})}}_trySkipBufferHole(e){const{config:t,hls:r,media:i}=this;if(i===null)return 0;const s=i.currentTime,o=ue.bufferInfo(i,s,0),a=s<o.start?o.start:o.nextStart;if(a){const l=o.len<=t.maxBufferHole,u=o.len>0&&o.len<1&&i.readyState<3,c=a-s;if(c>0&&(l||u)){if(c>t.maxBufferHole){const{fragmentTracker:f}=this;let h=!1;if(s===0){const m=f.getAppendedFrag(0,W.MAIN);m&&a<m.end&&(h=!0)}if(!h){const m=e||f.getAppendedFrag(s,W.MAIN);if(m){let p=!1,x=m.end;for(;x<a;){const y=f.getPartialFragment(x);if(y)x+=y.duration;else{p=!0;break}}if(p)return 0}}}const d=Math.max(a+K1,s+V1);if(w.warn(`skipping hole, adjusting currentTime from ${s} to ${d}`),this.moved=!0,this.stalled=null,i.currentTime=d,e&&!e.gap){const f=new Error(`fragment loaded with buffer holes, seeking from ${s} to ${d}`);r.trigger(E.ERROR,{type:X.MEDIA_ERROR,details:b.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:f,reason:f.message,frag:e})}return d}}return 0}_tryNudgeBuffer(){const{config:e,hls:t,media:r,nudgeRetry:i}=this;if(r===null)return;const s=r.currentTime;if(this.nudgeRetry++,i<e.nudgeMaxRetry){const o=s+(i+1)*e.nudgeOffset,a=new Error(`Nudging 'currentTime' from ${s} to ${o}`);w.warn(a.message),r.currentTime=o,t.trigger(E.ERROR,{type:X.MEDIA_ERROR,details:b.BUFFER_NUDGE_ON_STALL,error:a,fatal:!1})}else{const o=new Error(`Playhead still not moving while enough data buffered @${s} after ${e.nudgeMaxRetry} nudges`);w.error(o.message),t.trigger(E.ERROR,{type:X.MEDIA_ERROR,details:b.BUFFER_STALLED_ERROR,error:o,fatal:!0})}}}const z1=100;class W1 extends Zu{constructor(e,t,r){super(e,t,r,"[stream-controller]",W.MAIN),this.audioCodecSwap=!1,this.gapController=null,this.level=-1,this._forceStartLoad=!1,this.altAudio=!1,this.audioOnly=!1,this.fragPlaying=null,this.onvplaying=null,this.onvseeked=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(E.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(E.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(E.MANIFEST_LOADING,this.onManifestLoading,this),e.on(E.MANIFEST_PARSED,this.onManifestParsed,this),e.on(E.LEVEL_LOADING,this.onLevelLoading,this),e.on(E.LEVEL_LOADED,this.onLevelLoaded,this),e.on(E.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(E.ERROR,this.onError,this),e.on(E.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(E.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(E.BUFFER_CREATED,this.onBufferCreated,this),e.on(E.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(E.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(E.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(E.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(E.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(E.MANIFEST_LOADING,this.onManifestLoading,this),e.off(E.MANIFEST_PARSED,this.onManifestParsed,this),e.off(E.LEVEL_LOADED,this.onLevelLoaded,this),e.off(E.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(E.ERROR,this.onError,this),e.off(E.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(E.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(E.BUFFER_CREATED,this.onBufferCreated,this),e.off(E.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(E.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(E.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying()}startLoad(e){if(this.levels){const{lastCurrentTime:t,hls:r}=this;if(this.stopLoad(),this.setInterval(z1),this.level=-1,!this.startFragRequested){let i=r.startLevel;i===-1&&(r.config.testBandwidth&&this.levels.length>1?(i=0,this.bitrateTest=!0):i=r.firstAutoLevel),r.nextLoadLevel=i,this.level=r.loadLevel,this.loadedmetadata=!1}t>0&&e===-1&&(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t),this.state=O.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this._forceStartLoad=!0,this.state=O.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case O.WAITING_LEVEL:{const{levels:t,level:r}=this,i=t==null?void 0:t[r],s=i==null?void 0:i.details;if(s&&(!s.live||this.levelLastLoaded===i)){if(this.waitForCdnTuneIn(s))break;this.state=O.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=O.IDLE;break}break}case O.FRAG_LOADING_WAITING_RETRY:{var e;const t=self.performance.now(),r=this.retryDate;if(!r||t>=r||(e=this.media)!=null&&e.seeking){const{levels:i,level:s}=this,o=i==null?void 0:i[s];this.resetStartWhenNotLoaded(o||null),this.state=O.IDLE}}break}this.state===O.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){super.onTickEnd(),this.checkBuffer(),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:r,media:i}=this;if(t===null||!i&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const s=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(r!=null&&r[s]))return;const o=r[s],a=this.getMainFwdBufferInfo();if(a===null)return;const l=this.getLevelDetails();if(l&&this._streamEnded(a,l)){const p={};this.altAudio&&(p.type="video"),this.hls.trigger(E.BUFFER_EOS,p),this.state=O.ENDED;return}if(!this.buffering)return;e.loadLevel!==s&&e.manualLevel===-1&&this.log(`Adapting to level ${s} from level ${this.level}`),this.level=e.nextLoadLevel=s;const u=o.details;if(!u||this.state===O.WAITING_LEVEL||u.live&&this.levelLastLoaded!==o){this.level=s,this.state=O.WAITING_LEVEL;return}const c=a.len,d=this.getMaxBufferLength(o.maxBitrate);if(c>=d)return;this.backtrackFragment&&this.backtrackFragment.start>a.end&&(this.backtrackFragment=null);const f=this.backtrackFragment?this.backtrackFragment.start:a.end;let h=this.getNextFragment(f,u);if(this.couldBacktrack&&!this.fragPrevious&&h&&h.sn!=="initSegment"&&this.fragmentTracker.getState(h)!==Ie.OK){var m;const x=((m=this.backtrackFragment)!=null?m:h).sn-u.startSN,y=u.fragments[x-1];y&&h.cc===y.cc&&(h=y,this.fragmentTracker.removeFragment(y))}else this.backtrackFragment&&a.len&&(this.backtrackFragment=null);if(h&&this.isLoopLoading(h,f)){if(!h.gap){const x=this.audioOnly&&!this.altAudio?se.AUDIO:se.VIDEO,y=(x===se.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;y&&this.afterBufferFlushed(y,x,W.MAIN)}h=this.getNextFragmentLoopLoading(h,u,a,W.MAIN,d)}h&&(h.initSegment&&!h.initSegment.data&&!this.bitrateTest&&(h=h.initSegment),this.loadFragment(h,o,f))}loadFragment(e,t,r){const i=this.fragmentTracker.getState(e);this.fragCurrent=e,i===Ie.NOT_LOADED||i===Ie.PARTIAL?e.sn==="initSegment"?this._loadInitSegment(e,t):this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):(this.startFragRequested=!0,super.loadFragment(e,t,r)):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,W.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let r;const i=this.getAppendedFrag(t.currentTime);i&&i.start>1&&this.flushMainBuffer(0,i.start-1);const s=this.getLevelDetails();if(s!=null&&s.live){const a=this.getMainFwdBufferInfo();if(!a||a.len<s.targetduration*2)return}if(!t.paused&&e){const a=this.hls.nextLoadLevel,l=e[a],u=this.fragLastKbps;u&&this.fragCurrent?r=this.fragCurrent.duration*l.maxBitrate/(1e3*u)+1:r=0}else r=0;const o=this.getBufferedFrag(t.currentTime+r);if(o){const a=this.followingBufferedFrag(o);if(a){this.abortCurrentFrag();const l=a.maxStartPTS?a.maxStartPTS:a.start,u=a.duration,c=Math.max(o.end,l+Math.min(Math.max(u-this.config.maxFragLookUpTolerance,u*(this.couldBacktrack?.5:.125)),u*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(c,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case O.KEY_LOADING:case O.FRAG_LOADING:case O.FRAG_LOADING_WAITING_RETRY:case O.PARSING:case O.PARSED:this.state=O.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const r=t.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),r.addEventListener("playing",this.onvplaying),r.addEventListener("seeked",this.onvseeked),this.gapController=new H1(this.config,r,this.fragmentTracker,this.hls)}onMediaDetaching(){const{media:e}=this;e&&this.onvplaying&&this.onvseeked&&(e.removeEventListener("playing",this.onvplaying),e.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),super.onMediaDetaching()}onMediaPlaying(){this.tick()}onMediaSeeked(){const e=this.media,t=e?e.currentTime:null;G(t)&&this.log(`Media seeked to ${t.toFixed(3)}`);const r=this.getMainFwdBufferInfo();if(r===null||r.len===0){this.warn(`Main forward buffer length on "seeked" event ${r?r.len:"empty"})`);return}this.tick()}onManifestLoading(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(E.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=this.fragLastKbps=0,this.levels=this.fragPlaying=this.backtrackFragment=this.levelLastLoaded=null,this.altAudio=this.audioOnly=this.startFragRequested=!1}onManifestParsed(e,t){let r=!1,i=!1;t.levels.forEach(s=>{const o=s.audioCodec;o&&(r=r||o.indexOf("mp4a.40.2")!==-1,i=i||o.indexOf("mp4a.40.5")!==-1)}),this.audioCodecSwitch=r&&i&&!j1(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:r}=this;if(!r||this.state!==O.IDLE)return;const i=r[t.level];(!i.details||i.details.live&&this.levelLastLoaded!==i||this.waitForCdnTuneIn(i.details))&&(this.state=O.WAITING_LEVEL)}onLevelLoaded(e,t){var r;const{levels:i}=this,s=t.level,o=t.details,a=o.totalduration;if(!i){this.warn(`Levels were reset while loading level ${s}`);return}this.log(`Level ${s} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""}, cc [${o.startCC}, ${o.endCC}] duration:${a}`);const l=i[s],u=this.fragCurrent;u&&(this.state===O.FRAG_LOADING||this.state===O.FRAG_LOADING_WAITING_RETRY)&&u.level!==t.level&&u.loader&&this.abortCurrentFrag();let c=0;if(o.live||(r=l.details)!=null&&r.live){var d;if(this.checkLiveUpdate(o),o.deltaUpdateFailed)return;c=this.alignPlaylists(o,l.details,(d=this.levelLastLoaded)==null?void 0:d.details)}if(l.details=o,this.levelLastLoaded=l,this.hls.trigger(E.LEVEL_UPDATED,{details:o,level:s}),this.state===O.WAITING_LEVEL){if(this.waitForCdnTuneIn(o))return;this.state=O.IDLE}this.startFragRequested?o.live&&this.synchronizeToLiveEdge(o):this.setStartPosition(o,c),this.tick()}_handleFragmentLoadProgress(e){var t;const{frag:r,part:i,payload:s}=e,{levels:o}=this;if(!o){this.warn(`Levels were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);return}const a=o[r.level],l=a.details;if(!l){this.warn(`Dropping fragment ${r.sn} of level ${r.level} after level details were reset`),this.fragmentTracker.removeFragment(r);return}const u=a.videoCodec,c=l.PTSKnown||!l.live,d=(t=r.initSegment)==null?void 0:t.data,f=this._getAudioCodec(a),h=this.transmuxer=this.transmuxer||new V0(this.hls,W.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),m=i?i.index:-1,p=m!==-1,x=new Qu(r.level,r.sn,r.stats.chunkCount,s.byteLength,m,p),y=this.initPTS[r.cc];h.push(s,d,f,u,r,i,l.totalduration,c,x,y)}onAudioTrackSwitching(e,t){const r=this.altAudio;if(!!!t.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const o=this.fragCurrent;o&&(this.log("Switching to main audio track, cancel main fragment load"),o.abortRequests(),this.fragmentTracker.removeFragment(o)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();const s=this.hls;r&&(s.trigger(E.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),s.trigger(E.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const r=t.id,i=!!this.hls.audioTracks[r].url;if(i){const s=this.videoBuffer;s&&this.mediaBuffer!==s&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=s)}this.altAudio=i,this.tick()}onBufferCreated(e,t){const r=t.tracks;let i,s,o=!1;for(const a in r){const l=r[a];if(l.id==="main"){if(s=a,i=l,a==="video"){const u=r[a];u&&(this.videoBuffer=u.buffer)}}else o=!0}o&&i?(this.log(`Alternate track found, use ${s}.buffered to schedule main fragment loading`),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:r,part:i}=t;if(r&&r.type!==W.MAIN)return;if(this.fragContextChanged(r)){this.warn(`Fragment ${r.sn}${i?" p: "+i.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}`),this.state===O.PARSED&&(this.state=O.IDLE);return}const s=i?i.stats:r.stats;this.fragLastKbps=Math.round(8*s.total/(s.buffering.end-s.loading.first)),r.sn!=="initSegment"&&(this.fragPrevious=r),this.fragBufferedComplete(r,i)}onError(e,t){var r;if(t.fatal){this.state=O.ERROR;return}switch(t.details){case b.FRAG_GAP:case b.FRAG_PARSING_ERROR:case b.FRAG_DECRYPT_ERROR:case b.FRAG_LOAD_ERROR:case b.FRAG_LOAD_TIMEOUT:case b.KEY_LOAD_ERROR:case b.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(W.MAIN,t);break;case b.LEVEL_LOAD_ERROR:case b.LEVEL_LOAD_TIMEOUT:case b.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===O.WAITING_LEVEL&&((r=t.context)==null?void 0:r.type)===te.LEVEL&&(this.state=O.IDLE);break;case b.BUFFER_APPEND_ERROR:case b.BUFFER_FULL_ERROR:if(!t.parent||t.parent!=="main")return;if(t.details===b.BUFFER_APPEND_ERROR){this.resetLoadingState();return}this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case b.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}checkBuffer(){const{media:e,gapController:t}=this;if(!(!e||!t||!e.readyState)){if(this.loadedmetadata||!ue.getBuffered(e).length){const r=this.state!==O.IDLE?this.fragCurrent:null;t.poll(this.lastCurrentTime,r)}this.lastCurrentTime=e.currentTime}}onFragLoadEmergencyAborted(){this.state=O.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==se.AUDIO||this.audioOnly&&!this.altAudio){const r=(t===se.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(r,t,W.MAIN),this.tick()}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let r=this.startPosition;if(r>=0&&t<r){if(e.seeking){this.log(`could not seek to ${r}, already seeking at ${t}`);return}const i=ue.getBuffered(e),o=(i.length?i.start(0):0)-r;o>0&&(o<this.config.maxBufferHole||o<this.config.maxFragLookUpTolerance)&&(this.log(`adjusting start position by ${o} to match buffer start`),r+=o,this.startPosition=r),this.log(`seek to target start position ${r} from current time ${t}`),e.currentTime=r}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(r=>{const{hls:i}=this;if(!r||this.fragContextChanged(e))return;t.fragmentError=0,this.state=O.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const s=e.stats;s.parsing.start=s.parsing.end=s.buffering.start=s.buffering.end=self.performance.now(),i.trigger(E.FRAG_LOADED,r),e.bitrateTest=!1})}_handleTransmuxComplete(e){var t;const r="main",{hls:i}=this,{remuxResult:s,chunkMeta:o}=e,a=this.getCurrentContext(o);if(!a){this.resetWhenMissingContext(o);return}const{frag:l,part:u,level:c}=a,{video:d,text:f,id3:h,initSegment:m}=s,{details:p}=c,x=this.altAudio?void 0:s.audio;if(this.fragContextChanged(l)){this.fragmentTracker.removeFragment(l);return}if(this.state=O.PARSING,m){if(m!=null&&m.tracks){const S=l.initSegment||l;this._bufferInitSegment(c,m.tracks,S,o),i.trigger(E.FRAG_PARSING_INIT_SEGMENT,{frag:S,id:r,tracks:m.tracks})}const y=m.initPTS,v=m.timescale;G(y)&&(this.initPTS[l.cc]={baseTime:y,timescale:v},i.trigger(E.INIT_PTS_FOUND,{frag:l,id:r,initPTS:y,timescale:v}))}if(d&&p&&l.sn!=="initSegment"){const y=p.fragments[l.sn-1-p.startSN],v=l.sn===p.startSN,S=!y||l.cc>y.cc;if(s.independent!==!1){const{startPTS:L,endPTS:T,startDTS:A,endDTS:R}=d;if(u)u.elementaryStreams[d.type]={startPTS:L,endPTS:T,startDTS:A,endDTS:R};else if(d.firstKeyFrame&&d.independent&&o.id===1&&!S&&(this.couldBacktrack=!0),d.dropped&&d.independent){const k=this.getMainFwdBufferInfo(),_=(k?k.end:this.getLoadPosition())+this.config.maxBufferHole,C=d.firstKeyFramePTS?d.firstKeyFramePTS:L;if(!v&&_<C-this.config.maxBufferHole&&!S){this.backtrack(l);return}else S&&(l.gap=!0);l.setElementaryStreamInfo(d.type,l.start,T,l.start,R,!0)}else v&&L>Ns&&(l.gap=!0);l.setElementaryStreamInfo(d.type,L,T,A,R),this.backtrackFragment&&(this.backtrackFragment=l),this.bufferFragmentData(d,l,u,o,v||S)}else if(v||S)l.gap=!0;else{this.backtrack(l);return}}if(x){const{startPTS:y,endPTS:v,startDTS:S,endDTS:L}=x;u&&(u.elementaryStreams[se.AUDIO]={startPTS:y,endPTS:v,startDTS:S,endDTS:L}),l.setElementaryStreamInfo(se.AUDIO,y,v,S,L),this.bufferFragmentData(x,l,u,o)}if(p&&h!=null&&(t=h.samples)!=null&&t.length){const y={id:r,frag:l,details:p,samples:h.samples};i.trigger(E.FRAG_PARSING_METADATA,y)}if(p&&f){const y={id:r,frag:l,details:p,samples:f.samples};i.trigger(E.FRAG_PARSING_USERDATA,y)}}_bufferInitSegment(e,t,r,i){if(this.state!==O.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&delete t.audio;const{audio:s,video:o,audiovideo:a}=t;if(s){let l=e.audioCodec;const u=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){l&&(l.indexOf("mp4a.40.5")!==-1?l="mp4a.40.2":l="mp4a.40.5");const c=s.metadata;c&&"channelCount"in c&&(c.channelCount||1)!==1&&u.indexOf("firefox")===-1&&(l="mp4a.40.5")}l&&l.indexOf("mp4a.40.5")!==-1&&u.indexOf("android")!==-1&&s.container!=="audio/mpeg"&&(l="mp4a.40.2",this.log(`Android: force audio codec to ${l}`)),e.audioCodec&&e.audioCodec!==l&&this.log(`Swapping manifest audio codec "${e.audioCodec}" for "${l}"`),s.levelCodec=l,s.id="main",this.log(`Init audio buffer, container:${s.container}, codecs[selected/level/parsed]=[${l||""}/${e.audioCodec||""}/${s.codec}]`)}o&&(o.levelCodec=e.videoCodec,o.id="main",this.log(`Init video buffer, container:${o.container}, codecs[level/parsed]=[${e.videoCodec||""}/${o.codec}]`)),a&&this.log(`Init audiovideo buffer, container:${a.container}, codecs[level/parsed]=[${e.codecs}/${a.codec}]`),this.hls.trigger(E.BUFFER_CODECS,t),Object.keys(t).forEach(l=>{const c=t[l].initSegment;c!=null&&c.byteLength&&this.hls.trigger(E.BUFFER_APPENDING,{type:l,data:c,frag:r,part:null,chunkMeta:i,parent:r.type})}),this.tickImmediate()}getMainFwdBufferInfo(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,W.MAIN)}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=O.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const r=e.currentTime;if(ue.isBuffered(e,r)?t=this.getAppendedFrag(r):ue.isBuffered(e,r+.1)&&(t=this.getAppendedFrag(r+.1)),t){this.backtrackFragment=null;const i=this.fragPlaying,s=t.level;(!i||t.sn!==i.sn||i.level!==s)&&(this.fragPlaying=t,this.hls.trigger(E.FRAG_CHANGED,{frag:t}),(!i||i.level!==s)&&this.hls.trigger(E.LEVEL_SWITCHED,{level:s}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){const e=this.media;return e?this.fragPlaying||this.getAppendedFrag(e.currentTime):null}get currentProgramDateTime(){const e=this.media;if(e){const t=e.currentTime,r=this.currentFrag;if(r&&G(t)&&G(r.programDateTime)){const i=r.programDateTime+(t-r.start)*1e3;return new Date(i)}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class Wt{static get version(){return"1.5.20"}static isMSESupported(){return ug()}static isSupported(){return $1()}static getMediaSource(){return Hn()}static get Events(){return E}static get ErrorTypes(){return X}static get ErrorDetails(){return b}static get DefaultConfig(){return Wt.defaultConfig?Wt.defaultConfig:ag}static set DefaultConfig(e){Wt.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this.started=!1,this._emitter=new ic,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,this.triggeringException=void 0,Fv(e.debug||!1,"Hls instance");const t=this.config=O1(Wt.DefaultConfig,e);this.userConfig=e,t.progressive&&M1(t);const{abrController:r,bufferController:i,capLevelController:s,errorController:o,fpsController:a}=t,l=new o(this),u=this.abrController=new r(this),c=this.bufferController=new i(this),d=this.capLevelController=new s(this),f=new a(this),h=new kE(this),m=new PE(this),p=t.contentSteeringController,x=p?new p(this):null,y=this.levelController=new U1(this,x),v=new uS(this),S=new B1(this.config),L=this.streamController=new W1(this,v,S);d.setStreamController(L),f.setStreamController(L);const T=[h,y,L];x&&T.splice(1,0,x),this.networkControllers=T;const A=[u,c,d,f,m,v];this.audioTrackController=this.createController(t.audioTrackController,T);const R=t.audioStreamController;R&&T.push(new R(this,v,S)),this.subtitleTrackController=this.createController(t.subtitleTrackController,T);const k=t.subtitleStreamController;k&&T.push(new k(this,v,S)),this.createController(t.timelineController,A),S.emeController=this.emeController=this.createController(t.emeController,A),this.cmcdController=this.createController(t.cmcdController,A),this.latencyController=this.createController(FE,A),this.coreComponents=A,T.push(l);const _=l.onErrorOut;typeof _=="function"&&this.on(E.ERROR,_,l)}createController(e,t){if(e){const r=new e(this);return t&&t.push(r),r}return null}on(e,t,r=this){this._emitter.on(e,t,r)}once(e,t,r=this){this._emitter.once(e,t,r)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,r=this,i){this._emitter.off(e,t,r,i)}listeners(e){return this._emitter.listeners(e)}emit(e,t,r){return this._emitter.emit(e,t,r)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(r){if(w.error("An internal error happened while handling event "+e+'. Error message: "'+r.message+'". Here is a stacktrace:',r),!this.triggeringException){this.triggeringException=!0;const i=e===E.ERROR;this.trigger(E.ERROR,{type:X.OTHER_ERROR,details:b.INTERNAL_EXCEPTION,fatal:i,event:e,error:r}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){w.log("destroy"),this.trigger(E.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){w.log("attachMedia"),this._media=e,this.trigger(E.MEDIA_ATTACHING,{media:e})}detachMedia(){w.log("detachMedia"),this.trigger(E.MEDIA_DETACHING,void 0),this._media=null}loadSource(e){this.stopLoad();const t=this.media,r=this.url,i=this.url=Hu.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,w.log(`loadSource:${i}`),t&&r&&(r!==i||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(E.MANIFEST_LOADING,{url:e})}startLoad(e=-1){w.log(`startLoad(${e})`),this.started=!0,this.resumeBuffering();for(let t=0;t<this.networkControllers.length&&(this.networkControllers[t].startLoad(e),!(!this.started||!this.networkControllers));t++);}stopLoad(){w.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}resumeBuffering(){w.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()})}pauseBuffering(){w.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()})}swapAudioCodec(){w.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){w.log("recoverMediaError");const e=this._media;this.detachMedia(),e&&this.attachMedia(e)}removeLevel(e){this.levelController.removeLevel(e)}get levels(){const e=this.levelController.levels;return e||[]}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){w.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){w.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){w.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){w.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){w.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(w.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){OE(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const r=e.length;for(let i=0;i<r;i++)if(e[i].maxBitrate>=t)return i;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:r}=this;let i;if(t===-1&&e!=null&&e.length?i=e.length-1:i=t,r)for(let s=i;s--;){const o=e[s].attrs["HDCP-LEVEL"];if(o&&o<=r)return s}return i}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}setAudioOption(e){var t;return(t=this.audioTrackController)==null?void 0:t.setAudioOption(e)}setSubtitleOption(e){var t;return(t=this.subtitleTrackController)==null||t.setSubtitleOption(e),null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}}Wt.defaultConfig=void 0;function Y1(){const n=D.useRef(null),e="https://videos-3.earthcam.com/fecnetwork/32781.flv/chunklist_w678325738.m3u8?t=wFpB2Fyz3qRC%2BL7EEuRepKwbaynYM1VRHVhMSXiPmu6doVjT%2BpI06iVNLdLPV4ra&td=202502042208";return D.useEffect(()=>{if(Wt.isSupported()){const t=new Wt;return t.loadSource(e),t.attachMedia(n.current),t.on(Wt.Events.MANIFEST_PARSED,()=>{n.current.play()}),()=>{t.destroy()}}else n.current.canPlayType("application/vnd.apple.mpegurl")&&(n.current.src=e,n.current.addEventListener("loadedmetadata",()=>{n.current.play()}))},[e]),g.jsxs("div",{children:[g.jsx("h1",{children:"EarthCam Live Stream"}),g.jsx("video",{ref:n,controls:!0,style:{width:"100%",maxWidth:"640px"},autoPlay:!0,muted:!0})]})}function q1(){return g.jsxs(Bx,{children:[g.jsx(kn,{path:"/",element:g.jsx(Ev,{})}),g.jsx(kn,{path:"/monitor",element:g.jsx(Tv,{})}),g.jsx(kn,{path:"/ai-insight",element:g.jsx(wv,{})}),g.jsx(kn,{path:"/dashboard",element:g.jsx(Rv,{})}),g.jsx(kn,{path:"/guide",element:g.jsx(Av,{})}),g.jsx(kn,{path:"/live",element:g.jsx(Y1,{})})]})}Fa.createRoot(document.getElementById("root")).render(g.jsx(wg.StrictMode,{children:g.jsx(cv,{children:g.jsx(q1,{})})}));
